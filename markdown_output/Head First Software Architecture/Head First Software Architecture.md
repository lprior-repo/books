**Software Architecture**

A Learner's Guide to Architectural Thinking

**Raju Gandhi, Mark Richards & Neal Ford**

![](_page_0_Picture_5.jpeg)

# **Head First**

# Software Architecture

#### What will you learn from this book?

If you're a software developer looking to learn about software architecture, this Head First guide is a great place to start. From the authors of *Head First Git* and *Fundamentals of Software Architecture*, this fantastic resource, packed with fun narratives and hands-on exercises, teaches you how to think architecturally. You'll learn about the two laws of software architecture and the four dimensions that describe an architecture. You'll gain a deep understanding of architectural characteristics, learn how to identify a system's logical components, and get an in-depth tour of several architectural styles. By the end of this book, you'll be well on your way to the world of software architecture.

"This book masterfully distills complex software architecture concepts into easily digestible pieces. With its engaging exercises and readerfriendly writing style, it is an ideal resource for students and seasoned professionals alike."

**-James Erler** Embedded Software Engineer, Medtronic

![](_page_1_Picture_6.jpeg)

#### What's so special about this book?

If you've read a Head First book, you know what to expect: a visually rich format designed for the way your brain works. If you haven't, you're in for a treat. With this book, you'll learn about software architecture through a multisensory experience that engages your mind—rather than a text-heavy approach that puts you to sleep.

SOFTWARE ARCHITECTURE

US \$79.99 CAN \$99.99
ISBN: 978-1-098-13435-8

![](_page_1_Picture_11.jpeg)

![](_page_1_Picture_12.jpeg)

#### Other related books from O'Reilly

Fundamentals of Software Architecture

Software Architecture: The Hard Parts

#### Other books in O'Reilly's Head First series

Head First Android Development

Head First C#

Head First Design Patterns

Head First Git

Head First Go

Head First iPhone and iPad Development

Head First Java

Head First JavaScript Programming

Head First Learn to Code

Head First Object-Oriented Analysis and Design

Head First Programming

Head First Python

Head First Software Development

Head First Web Design

# Head First Software Architecture

Wouldn't it be dreamy if there was a book about software architecture that was more fun than getting a root canal and more revealing than reams of documentation? It's probably just a fantasy...

q

![](_page_4_Picture_3.jpeg)

Raju Gandhi Mark Richards Neal Ford

![](_page_4_Picture_5.jpeg)

#### Head First Software Architecture

by Raju Gandhi, Mark Richards & Neal Ford

Copyright © 2024 Defmacro Software L.L.C., Mark Richards and Neal Ford. All rights reserved.

Printed in the United States of America.

Published by O'Reilly Media, Inc., 1005 Gravenstein Highway North, Sebastopol, CA 95472.

O'Reilly Media books may be purchased for educational, business, or sales promotional use. Online editions are also available for most titles (*http://oreilly.com*). For more information, contact our corporate/institutional sales department: (800) 998-9938 or *corporate@oreilly.com*.

Series Creators: Kathy Sierra, Bert Bates

Series Advisors: Eric Freeman, Elisabeth Robson

Acquisitions Editor: Melissa Duffield

Development Editor: Sarah Grey

Cover Designer: Susan Thompson, based on a series design by Ellie Volckhausen

Cover/Interior Illustrations: José Marzan Jr.

Production Editor: Christopher Faucher

Proofreader: Rachel Head Indexer: nSight, Inc.

Page Viewers: Buddy and Skye ("the dogs"), Princess Zara, baby Delphine,

Sparks, Fauci, Linda Ruth, and Amadeus ("the cats")

#### Printing History:

March 2024: First Edition.

The O'Reilly logo is a registered trademark of O'Reilly Media, Inc. The *Head First* series designations, *Head First Software Architecture*, and related trade dress are trademarks of O'Reilly Media, Inc.

Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this book, and O'Reilly Media, Inc., was aware of a trademark claim, the designations have been printed in caps or initial caps.

While every precaution has been taken in the preparation of this book, the publisher and the authors assume no responsibility for errors or omissions, or for damages resulting from the use of the information contained herein.

No dogs, cats, or chefs were harmed in the making of this book.

ISBN: 978-1-098-13435-8

[LSI] [2024-03-04]

#### DEDICATION

#### **From Mark and Neal**

To all the conference attendees who patiently sat through many drafts of this material

(2004-2024)

#### **From Raju**

To my Dad

જય શ્રી કૃષ્ણ

# Authors of Head First Software Architecture

![](_page_7_Picture_2.jpeg)

#### **Raju Gandhi**

Raju is an architect, consultant, author, and teacher and a regularly invited speaker at conferences around the world. He believes in keeping things simple, and his approach is always to understand and explain the "why," as opposed to the "how." He lives in Columbus, Ohio, with his wonderful wife, Michelle; their sons, Mason and Micah; their daughter, Delphine; and three furry family members, Buddy, Skye, and Princess Zara. You can find his contact information at *RajuGandhi.com*.

#### **Mark Richards**

Mark is an experienced hands-on software architect and the founder of DeveloperToArchitect.com, a free website devoted to helping developers in their journeys to becoming software architects. He has been in the software industry since 1983 and has significant experience and expertise in application, integration, and enterprise architecture. Mark has authored numerous technical books and videos, including *Fundamentals of Software Architecture* and *Software Architecture: The Hard Parts* (O'Reilly), co-authored with Neal Ford. Mark also does training and has spoken at hundreds of conferences and user groups around the world.

#### **Neal Ford**

Neal Ford is director, software architect, and meme wrangler at ThoughtWorks, a global IT consultancy with a focus on end-to-end software development and delivery. He is also the designer and developer of many applications, articles, and video presentations and the author and/or editor of an increasingly large number of books, spanning a variety of subjects and technologies. His professional focus is designing and building largescale enterprise applications. He is also an internationally acclaimed speaker who has spoken at more than 300 developer conferences worldwide and has delivered more than 2,000 presentations.

# **Table of Contents (the summary)**

|    | Intro                                                           | xix |
|----|-----------------------------------------------------------------|-----|
| 1  | Software Architecture Demystified: Let's Get Started!           | 1   |
| 2  | Architectural Characteristics: Know Your Capabilities           | 41  |
| 3  | The Two Laws of Software Architecture: Everything's a Trade-Off | 81  |
| 4  | Logical Components: The Building Blocks                         | 123 |
| 5  | Architectural Styles: Categorization and Philosophies           | 167 |
| 6  | Layered Architecture: Separating Concerns                       | 185 |
| 7  | Modular Monoliths: Driven by the Domain                         | 215 |
| 8  | Microkernel Architecture: Crafting Customizations               | 247 |
| 9  | Do It Yourself: The TripEZ Travel App                           | 277 |
| 10 | Microservices Architecture: Bit by Bit                          | 303 |
| 11 | Event-Driven Architecture: Asynchronous Adventures              | 349 |
| 12 | Do It Yourself: Testing Your Knowledge                          | 403 |
| 13 | Appendix: Leftovers: The Top Six Topics We Didn't Cover         | 427 |
|    | Index                                                           | 441 |

# **Table of Contents (the real thing)**

#### Intro

**Because software architecture is hard, your brain will trick you into thinking you can't learn it.** Your brain's thinking, "Better to

focus on more important things, like what to eat for lunch and whether pigs have wings." The good news is that you CAN trick your brain into thinking software architecture is an important skill to learn, and in this chapter we're going to show you just how to do that.

| Who is this book for?                                     | xxii   |
|-----------------------------------------------------------|--------|
| We know what you're thinking                              | xxiii  |
| We know what your brain is thinking                       | xxiii  |
| Metacognition: Thinking about thinking                    | xxv    |
| Here's what WE did                                        | xxvi   |
| Here's what YOU can do to bend your brain into submission | xxvii  |
| Read me                                                   | xxviii |
| Do it yourself chapters                                   | xxx    |
| The technical review team                                 | xxxi   |
| Joint acknowledgments                                     | xxxii  |
| Individual acknowledgments                                | xxxiii |

# software architecture demystified

1

#### Let's Get Started!

**Software architecture is fundamental to the success of your system.** This chapter demystifies software architecture. You'll
gain an understanding of architectural dimensions and the differences between
architecture and design. Why is this important? Because understanding and
applying architectural practices helps you build more effective and correct
software systems—systems that not only function better, but also meet the
needs and concerns of the business and continue to operate as your business
and technical environments undergo constant change. So, without further delay,
let's get started.

| Building your understanding of software architecture |   |
|------------------------------------------------------|---|
| Building plans and software architecture             |   |
| The dimensions of software architecture              |   |
| Puzzling out the dimensions                          |   |
| The first dimension: Architectural characteristics   |   |
| The second dimension: Architectural decisions        |   |
| The third dimension: Logical components              | 1 |
| The fourth dimension: Architectural styles           | 1 |
| A design perspective                                 | 1 |
| An architectural perspective                         | 1 |
| The spectrum between architecture and design         | 1 |
| Where along the spectrum does your decision fall?    | 1 |
| Strategic versus tactical                            | 2 |
| High versus low levels of effort                     | 2 |
| Significant versus less-significant trade-offs       | 2 |
| Putting it all together                              | 2 |
| You made it!                                         | 2 |

![](_page_9_Picture_6.jpeg)

# architectural characteristics

#### Know Your Capabilities

**2**

**What does your architecture need to support?** Architectural characteristics (the capabilities of an architecture) are the fundamental building blocks of any system. Without them, you cannot make architectural decisions, select an architectural style, or in many cases even create a logical architecture. In this chapter you'll learn how to define some of the more common characteristics (like scalability, reliability, and testability), how they influence a software architecture, how they help you make architectural decisions, and how to identify which ones are important for your particular situation. Ready to add some capabilities to your software architecture?

![](_page_10_Picture_5.jpeg)

| Causing Lafter                                                        | 42 |
|-----------------------------------------------------------------------|----|
| Cubicle conversation                                                  | 43 |
| What are architectural characteristics?                               | 44 |
| Defining architectural characteristics                                | 45 |
| Characteristics are nondomain design considerations                   | 46 |
| Characteristics influence architectural structure                     | 47 |
| Limit characteristics to prevent overengineering                      | 48 |
| Consider explicit and implicit capabilities                           | 50 |
| The International Zoo of "-ilities"                                   | 51 |
| Process architectural characteristics                                 | 52 |
| Structural architectural characteristics                              | 53 |
| Operational architectural characteristics                             | 54 |
| Cross-cutting architectural characteristics                           | 55 |
| Sourcing architectural characteristics from the problem domain        | 60 |
| Sourcing architectural characteristics from environmental awareness   | 61 |
| Sourcing architectural characteristics from holistic domain knowledge | 61 |
| Composite architectural characteristics                               | 63 |
| Priorities are contextual                                             | 64 |
| Lost in translation                                                   | 66 |
| Architectural characteristics and logical components                  | 68 |
| Balancing domain considerations and architectural characteristics     | 69 |
| Limiting architectural characteristics                                | 70 |

## the two laws of software architecture

# 3

#### **Everything's a Trade-Off**

What happens when there are no "best practices"? The nice thing about best practices is that they're relatively risk-free ways to achieve certain goals. They're called "best" (not "better" or "good") for a reason—you know they work, so why not just use them? But one thing you'll quickly learn about software architecture is that it has no best practices. You'll have to analyze every situation carefully to make a decision, and you'll need to communicate not just the "what" of the decision, but the "why."

So, how *do* you navigate this new frontier? Fortunately, you have the laws of software architecture to guide you. This chapter shows you how to analyze trade-offs as you make decisions. We'll also show you how to create architectural decision records to capture the "hows" and "whys" of decisions. By the end of this chapter, you'll have the tools to navigate the uncertain territory that is software architecture.

![](_page_11_Picture_6.jpeg)

| it starts with a sneaker app               | 82  |
|--------------------------------------------|-----|
| What do we know so far?                    | 84  |
| Communicating with downstream services     | 86  |
| Analyzing trade-offs                       | 87  |
| Trade-off analysis: Queue edition          | 88  |
| Trade-off analysis: Topic edition          | 89  |
| The first law of software architecture     | 90  |
| It always comes back to trade-offs         | 92  |
| Making an architectural decision           | 93  |
| What else makes a decision architectural?  | 94  |
| The second law of software architecture    | 96  |
| Architectural decision records (ADRs)      | 97  |
| Writing ADRs: Getting the title right      | 99  |
| Writing ADRs: What's your status?          | 100 |
| Writing ADRs: Establishing the context     | 104 |
| Writing ADRs: Communicating the decision   | 105 |
| Writing ADRs: Considering the consequences | 107 |
| Writing ADRs: Ensuring governance          | 109 |
| Writing ADRs: Closing notes                | 109 |
| The benefits of ADRs                       | 112 |
| Two Many Sneakers is a success             | 113 |

## logical components

# **4**

#### The Building Blocks

**Ready to start creating an architecture?** It's not as easy as it sounds—and if you don't do it correctly, your software system could come crumbling to the ground, just like a poorly designed skyscraper or bridge.

In this chapter we'll show you several approaches for identifying and creating *logical components*, the functional building blocks of a system that describe how its pieces all fit together. Using the techniques described in this chapter will help you to create a solid architecture—a foundation upon which you can build a successful software system.

Put on your hard hat and gloves, get your tools ready, and let's get started.

![](_page_12_Picture_7.jpeg)

| Logical components revisited                | 124 |
|---------------------------------------------|-----|
| Name that component                         | 125 |
| Adventurous Auctions goes online            | 126 |
| Logical versus physical architecture        | 127 |
| Creating a logical architecture             | 129 |
| Step 1: Identifying initial core components | 130 |
| Workflow approach                           | 132 |
| Actor/action approach                       | 134 |
| The entity trap                             | 136 |
| Step 2: Assign requirements                 | 138 |
| Step 3: Analyze roles and responsibilities  | 140 |
| Sticking to cohesion                        | 141 |
| Step 4: Analyze characteristics             | 142 |
| The Bid Capture component                   | 144 |
| Component coupling                          | 145 |
| Afferent coupling                           | 146 |
| Efferent coupling                           | 147 |
| Measuring coupling                          | 148 |
| A tightly coupled system                    | 150 |
| Applying the Law of Demeter                 | 151 |
| A balancing act                             | 153 |
| Some final words about components           | 154 |
| Name that component                         | 156 |

# architectural styles

# 5

## **Categorization and Philosophies**

#### There are lots of different architectural styles out

**there.** Each one exists for a reason and has its own philosophy about how and when it should be used. Understanding a style's philosophy will help you judge whether it's the right one for your domain. This chapter gives you a framework for the different kinds of architectural styles (which we'll be diving into for the remainder of this book), to help you make sense of these and all the other architectural styles you'll encounter as a software architect.

Let's fill in that final piece of the puzzle, shall we?

| There are lots of architecture styles           | 16 |
|-------------------------------------------------|----|
| The world of architecture styles                | 16 |
| Partitioning: technical versus domain           | 17 |
| Deployment model: monolithic versus distributed | 17 |
| Monolithic deployment models: the cons          | 17 |
| Monolithic: the pros                            | 17 |
| Distributed deployment models: the pros         | 17 |
| Distributed: The cons                           | 17 |
| And that's a wrap!                              | 18 |

![](_page_13_Picture_8.jpeg)

![](_page_13_Picture_9.jpeg)

![](_page_13_Picture_10.jpeg)

# layered architecture

#### Separating Concerns

# **What if your problem is simple and time is of the 6**

**essence?** Should you even bother with architecture? It depends on how long you want to keep what you build. If it's disposable, throw caution to the wind. If not, then choose the simplest architecture that still provides some measurable organization and benefit, without imposing many constraints on speed of delivery. The *layered architecture* has become that architecture because it's easy to understand and implement, leveraging design patterns developers already know. Let's peel back the layers of this architecture.

| Naan & Pop: Gathering requirements                  | 186 |
|-----------------------------------------------------|-----|
| Design patterns redux                               | 188 |
| Layering MVC                                        | 189 |
| Layering it on                                      | 192 |
| Translating layers into code                        | 193 |
| Domains, components, and layers                     | 195 |
| Drivers for layered architecture                    | 198 |
| Layers, meet the real world: Physical architectures | 199 |
| Physical architecture trade-offs                    | 200 |
| One final caveat about domain changes               | 203 |
| Layered architecture superpowers                    | 204 |
| Layered architecture kryptonite                     | 205 |
| Layered architecture star ratings                   | 206 |
| Wrapping it up                                      | 208 |

![](_page_14_Picture_6.jpeg)

## modular monoliths

# **7**

#### Driven by the Domain

**There's more than one way to build a monolith.** So far,

you've encountered the layered architecture, which aligns things *technically*. You can go a long way with a layered monolith, but when changes begin to involve lots of communication and coordination between different teams, you might need a little more horsepower under the hood—and perhaps even a different architectural style.

This chapter looks at the *modular monolith* architectural style, which divides applications up by *business concerns* as opposed to technical concerns. You'll learn what this means, what to look out for, and all the trade-offs associated with this style. Let's take the modular monolith for a spin, shall we?

| Modular monolith?                             | 219 |
|-----------------------------------------------|-----|
| Domain changes                                | 22  |
| Why modular monoliths?                        | 222 |
| Show me the code!                             | 224 |
| Keeping modules modular                       | 227 |
| Taking modularity all the way to the database | 23  |
| Beware of joins                               | 233 |
| Modular monolith superpowers                  | 234 |
| Modular monolith kryptonite                   | 235 |
| Modular monolith star ratings                 | 236 |
| Naan & Pop is delivering pizza!               | 238 |

![](_page_15_Picture_8.jpeg)

## microkernel architecture

# 8

#### **Crafting Customizations**

#### You can craft custom experiences, one capability at a

**time.** Some architecture styles are particularly well suited for some capabilities, and the microkernel architecture is the world champion at customization. But it's also useful for a bewildering range of applications. Once you understand this architectural style, you'll start seeing it everywhere!

Let's dig into an architecture that lets your users have it their way.

![](_page_16_Picture_7.jpeg)

| The benefits of Going Green                | 248 |
|--------------------------------------------|-----|
| The two parts of microkernel architectures | 251 |
| The spectrum of “microkern-ality”          | 253 |
| Device assessment service core             | 255 |
| Encapsulated versus distributed plugins    | 257 |
| Plugin communication                       | 259 |
| Plugin contracts                           | 264 |
| Going Green goes green                     | 265 |
| Microkernel superpowers                    | 266 |
| Microkernel kryptonite                     | 267 |
| Microkernel star ratings                   | 268 |
| Wrapping it up                             | 270 |

# do it yourself

# The TripEZ Travel App

**9**

## **Ready to extend your journey into software**

**architecture?** In this chapter, you're the software architect. You'll be determining architectural characteristics, building a logical architecture, making architectural decisions, and deciding whether to use a layered, modular, or microkernel architecture. The exercises in this chapter will give you an end-to-end view of what a software architect does and show you how much you've learned. Get ready to create an architecture for a startup company building a travel integration convenience site. *Bon voyage*—we hope you have a good trip building your architecture.

| Making travel easier                           | 278 |
|------------------------------------------------|-----|
| TripEZ's user workflow                         | 279 |
| Planning the architecture                      | 280 |
| The architects' roadmap                        | 28  |
| Step 1: Identify architectural characteristics | 282 |
| Step 2: Identify logical components            | 284 |
| Step 3: Choose an architectural style          | 286 |
| Step 4: Document your decision                 | 288 |
| Step 5: Diagram your architecture              | 290 |
| There are no right (or wrong) answers          | 292 |

![](_page_17_Picture_6.jpeg)

## microservices architecture

# 10

#### Bit by Bit

#### How do you make an architecture easier to change?

Business is changing faster than ever, and software architectures need to keep up. In this chapter you'll learn how to create a flexible architecture that can change as your business changes, scale as your business grows, and remain operational even when system failures occur. Intrigued? We hope so, because in this chapter we're going to show you *microservices*—an architectural style that solves all of these problems and more. Let's get started on our journey through microservices, bit by bit.

![](_page_18_Picture_6.jpeg)

| Are you feeling okay?                      | 304 |
|--------------------------------------------|-----|
| What's a microservice?                     | 307 |
| It's my data, not yours                    | 308 |
| How micro is “micro”?                      | 310 |
| Granularity disintegrators                 | 312 |
| Why should you make microservices smaller? | 313 |
| Granularity integrators                    | 314 |
| Why should you make microservices bigger?  | 315 |
| It's all about balance                     | 316 |
| Sharing functionality                      | 319 |
| Code reuse with a shared service           | 320 |
| Code reuse with a shared library           | 321 |
| Managing workflows                         | 325 |
| Orchestration: Conducting microservices    | 326 |
| Choreography: Let's dance                  | 328 |
| Microservices architecture superpowers     | 332 |
| Microservices architecture kryptonite      | 333 |
| Microservices star ratings                 | 334 |
| Wrapping it up                             | 336 |

# **11**

# event-driven architecture

#### Asynchronous Adventures

#### **What if your architecture could do lots of things at the**

**same time?** As businesses grow and become more successful, they need to be able to handle more and more users, without slowing down or crashing systems. In this chapter, you'll learn how to design high-performance systems that can scale as a business grows. Get ready for *event-driven architecture*, a highly popular distributed architecture style. It's very fast, highly scalable, and easy to extend—but it's also quite complex. You'll be learning about lots of new concepts in this chapter, including things like events, messages, and asynchronous communication, so you can create an architectural that can do many things at once. Fasten your seatbelt, and let's go on an asynchronous adventure through event-driven architecture.

![](_page_19_Picture_6.jpeg)

| Too slow                               | 350 |
|----------------------------------------|-----|
| Speeding things up                     | 351 |
| Der Nile flows faster than ever        | 352 |
| What is an event?                      | 354 |
| Events versus messages                 | 356 |
| Initiating and derived events          | 358 |
| Is anyone listening?                   | 360 |
| Asynchronous communication             | 361 |
| Fire-and-forget                        | 363 |
| Asynchronous for the win               | 365 |
| Synchronous for the win                | 367 |
| Database topologies                    | 369 |
| Monolithic database                    | 370 |
| Domain-partitioned databases           | 372 |
| Database-per-service                   | 374 |
| EDA versus microservices               | 378 |
| Hybrids: Event-driven microservices    | 382 |
| Event-driven architecture superpowers  | 384 |
| Event-driven architecture kryptonite   | 385 |
| Event-driven architecture star ratings | 386 |
| Putting it all together                | 388 |
| Wrapping up                            | 389 |

# do it yourself

# 12

#### **Testing Your Knowledge**

Ready to test your skills in creating a distributed architecture? In this chapter, you're the software architect. You'll be determining architectural characteristics, building a logical architecture, making architectural decisions, and deciding whether to use microservices or event-driven architecture. The exercises in this chapter will give you an end-to-end view of what a software architect does and show you how much you've learned. Get ready to create an architecture for a student standardized test—taking system called Make the Grade. Good luck—we hope you get an A on your architecture!

![](_page_20_Picture_5.jpeg)

| Welcome to Make The Grade                      | 40 |
|------------------------------------------------|----|
| Student testing workflow                       | 40 |
| Planning the architecture                      | 40 |
| The architects' roadmap                        | 40 |
| Step 1: Identify architectural characteristics | 40 |
| Step 2: Identify logical components            | 41 |
| Step 3: Choose an architectural style          | 41 |
| Step 4: Document your decision                 | 41 |
| Step 5: Diagram your architecture              | 41 |
| There are no right (or wrong) answers!         |    |

## appendix: leftovers

# **A**

#### The Top Six Topics We Didn't Cover

**There's a lot more to be said about software architecture.** We promise you're done with this book. But reading this book is just the first step in your journey to thinking architecturally, and we couldn't in good conscience let you go without a little more preparation. So, we've gathered a few additional juicy bits into this appendix. Each of the topics that follow deserves as much attention as the other topics we've covered. However, our goal here is just to give you a high-level idea of what they're all about. And yes, this really *is* the end of the book. Except for the index, of course—it's a real page-turner!

![](_page_21_Picture_5.jpeg)

| #1 The coding architect               | 428 |
|---------------------------------------|-----|
| #2 Expectations for architects        | 430 |
| #3 The soft skills of architecture    | 432 |
| #4 Diagramming techniques             | 434 |
| #5 Knowledge depth versus breadth     | 436 |
| #6 Practicing architecture with katas | 438 |

# how to use this book

![](_page_22_Picture_1.jpeg)

In this section we answer the burning question: "So why DID they put that in a software architecture book?"

# <span id="page-23-0"></span>Who is this book for?

If you can answer "yes" to both of these:

- Do you want to learn what software architecture is all about? **1**
- Do you prefer **stimulating dinner-party conversation** to **dry, dull academic lectures**? **2**

This book is for you.

## Who should probably back away from this book?

If you can answer "yes" to any of these:

**1 Are you completely new to the tech industry?** 

(While we firmly believe that software developers should understand the basics of software architecture, you might want to get a bit of experience developing software before diving into this book.)

- Are you a seasoned software architect looking for a *reference* **book**? **2**
- Are you **afraid to try something new**? Would you rather sit in a corner licking 9-volt batteries than advance your career? Do you believe that a technical book can't be serious if it uses zoo animals to explain architectural characteristics like scalability and fault tolerance? **3**

This book is *not* for you.

[Note from marketing: This book is for anyone with a credit card.]

![](_page_23_Picture_14.jpeg)

# <span id="page-24-0"></span>We know what you're thinking

"How can *this* be a serious book on software architecture?"

"What's with all the graphics?"

"Can I actually *learn* it this way?"

# We know what your brain is thinking

Your brain craves novelty. It's always searching, scanning, *waiting* for something unusual. It was built that way, and it helps you stay alive.

So what does your brain do with all the routine, ordinary, normal things you encounter? Everything it *can* to stop them from interfering with the brain's *real* job—recording things that *matter*. It doesn't bother saving the boring things; they never make it past the "this is obviously not important" filter.

How does your brain *know* what's important? Suppose you're out for a day hike and a tiger jumps in front of you. What happens inside your head and body?

Neurons fire. Emotions crank up. *Chemicals surge*.

And that's how your brain knows...

#### This must be important! Don't forget it!

But imagine you're at home, or in a library. It's a safe, warm, tiger-free zone. You're studying. Getting ready for an exam. Or trying to learn some tough technical topic your boss thinks will take a week, 10 days at the most.

Just one problem. Your brain's trying to do you a big favor. It's trying to make sure that this *obviously* unimportant content doesn't clutter up scarce resources. Resources that are better spent storing the really *big* things. Like tigers. Like the danger of fire. Like how you should never have posted those "party" photos on your Facebook page. And there's no simple way to tell your brain, "Hey brain, thank you very much, but no matter how dull this book is and how little I'm registering on the emotional Richter scale right now, I really *do* want you to keep this stuff around."

![](_page_24_Picture_14.jpeg)

![](_page_24_Picture_15.jpeg)

# We think of a "Head First" reader as a learner.

So what does it take to *learn* something? First you have to *get* it, then make sure you don't *forget* it. It's not about pushing facts into your head. Based on the latest research in cognitive science, neurobiology, and educational psychology, *learning* takes a lot more than text on a page. We know what turns your brain on.

# Some of the Head First learning principles:

**Make it visual.** Images are far more memorable than words alone and make learning much more effective (up to 89% improvement in recall and transfer studies). They also make things more understandable. **Put the words within or near the graphics** they relate to, rather than on the bottom or on another page, and learners will be up to *twice* as likely to be able to solve problems related to the content.

**Use a conversational and personalized style.** In recent studies, students performed up to 40% better on post-learning tests if the content spoke directly to the reader, using a first-person, conversational style rather than taking a formal tone. Tell stories instead of lecturing. Use casual language. Don't take yourself too seriously. Which would *you* pay more attention to: a stimulating dinner party companion, or a lecture?

**Get the learner to think more deeply.** Unless you actively flex your neurons, nothing much happens in your head. A reader has to be motivated, engaged, curious, and inspired to solve problems, draw conclusions, and generate new knowledge. And for that, you need challenges, exercises, and thought-provoking questions, and activities that involve both sides of the brain and multiple senses.

**Get—and keep—the reader's attention.** We've all had the "I really want to learn this but I can't stay awake past page one" experience. Your brain pays attention to things that are out of the ordinary, interesting, strange, eye-catching, unexpected. Learning a new, tough, technical topic doesn't have to be boring. Your brain will learn much more quickly if it's not.

**Touch their emotions.** We now know that your ability to remember something is largely dependent on its emotional content. You remember what you care about. You remember when you *feel* something. No, we're not talking heart-wrenching stories about a boy and his dog. We're talking emotions like surprise, curiosity, fun, "what the...?" and the feeling of "I rule!" that comes when you solve a puzzle, learn something everybody else thinks is hard, or realize you know something that "I'm more technical than thou" Bob from engineering *doesn't*.

# <span id="page-26-0"></span>Metacognition: Thinking about thinking

If you really want to learn, and you want to learn more quickly and more deeply, pay attention to how you pay attention. Think about how you think. Learn how you learn.

Most of us did not take courses on metacognition or learning theory when we were growing up. We were *expected* to learn, but rarely *taught* to learn.

But we assume that if you're holding this book, you really want to learn what software architecture is all about. And you probably don't want to spend a lot of time on it. If you want to use what you read in this book, you need to *remember* what you read. And for that, you've got to *understand* it. To get the most from this book, or *any* book or learning experience, take responsibility for your brain. Your brain on *this* content.

The trick is to get your brain to see the new material you're learning as Really Important. Crucial to your well-being. As important as a tiger. Otherwise, you're in for a constant battle, with your brain doing its best to keep the new content from sticking.

# So just how *DO* you get your brain to treat software architecture like it's a hungry tiger?

There's the slow, tedious way, or the faster, more effective way. The slow way is about sheer repetition. You obviously know that you *are* able to learn and remember even the dullest of topics if you keep pounding the same thing into your brain. With enough repetition, your brain says, "This doesn't *feel* important, but they keep looking at the same thing *over* and *over*, so I suppose it must be."

The faster way is to do **anything that increases brain activity**, especially different *types* of brain activity. The things on the previous page are a big part of the solution, and they're all things that have been proven to help your brain work in your favor. For example, studies show that putting words *within* the pictures they describe (as opposed to somewhere else on the page, like a caption or in the body text) causes your brain to try to make sense of how the words and picture relate, and this causes more neurons to fire. More neurons firing = more chances for your brain to *get* that this is something worth paying attention to, and possibly recording.

A conversational style helps because people tend to pay more attention when they perceive that they're in a conversation, since they're expected to follow along and hold up their end. The amazing thing is, your brain doesn't necessarily *care* that the "conversation" is between you and a book! On the other hand, if the writing style is formal and dry, your brain perceives it the same way you experience being lectured to while sitting in a roomful of passive attendees. No need to stay awake.

But pictures and conversational style are just the beginning...

I wonder how
I can trick my brain
into remembering
this stuff...

٥

![](_page_26_Picture_13.jpeg)

# <span id="page-27-0"></span>Here's what WE did

We used *visuals*, because your brain is tuned for visuals, not text. As far as your brain's concerned, a visual really *is* worth a thousand words. And when text and visuals work together, we embedded the text *in* the visuals because your brain works more effectively when the text is *within* the thing the text refers to, as opposed to in a caption or buried in a paragraph somewhere.

We used *redundancy*, saying the same thing in *different* ways and with different media types, and *multiple senses*, to increase the chance that the content gets coded into more than one area of your brain.

We used concepts and visuals in *unexpected* ways because your brain is tuned for novelty, and we used visuals and ideas with at least *some emotional content*, because your brain is tuned to pay attention to the biochemistry of emotions. That which causes you to *feel*  something is more likely to be remembered, even if that feeling is nothing more than a little *humor*, *surprise*, or *interest.*

We used a personalized, *conversational style*, because your brain is tuned to pay more attention when it believes you're in a conversation than if it thinks you're passively listening to a presentation. Your brain does this even when you're *reading*.

We included dozens of *activities*, because your brain is tuned to learn and remember more when you *do* things than when you *read* about things. And we made the exercises challenging yet doable, because that's what most people prefer.

We used *multiple learning styles*, because *you* might prefer step-by-step procedures, while someone else wants to understand the big picture first, and someone else just wants to see an example. But regardless of your own learning preference, *everyone* benefits from seeing the same content represented in multiple ways.

We included content for *both sides of your brain*, because the more of your brain you engage, the more likely you are to learn and remember, and the longer you can stay focused. Since working one side of the brain often means giving the other side a chance to rest, you can be more productive at learning for a longer period of time.

And we included *stories* and exercises that present *more than one point of view,* because your brain is tuned to learn more deeply when it's forced to make evaluations and judgments.

We included *challenges*, with exercises, and we asked *questions* that don't always have a straight answer, because your brain is tuned to learn and remember when it has to *work* at something. Think about it—you can't get your *body* in shape just by *watching* people at the gym. But we did our best to make sure that when you're working hard, it's on the *right* things. That *you're not spending one extra dendrite* processing a hard-to-understand example or parsing difficult, jargon-laden, or overly terse text.

We used *people*. In stories, examples, visuals, etc., because, well, because *you're* a person. And your brain pays more attention to *people* than it does to *things*.

<span id="page-28-0"></span>![](_page_28_Picture_1.jpeg)

# Here's what YOU can do to bend your brain into submission

So, we did our part. The rest is up to you. These tips are a starting point; listen to your brain and figure out what works for you and what doesn't. Try new things.

Cut this out and stick it on your refrigerator.

#### Slow down. The more you understand, the less you have to memorize. **1**

Don't just *read*. Stop and think. When the book asks you a question, don't just skip to the answer. Imagine that someone really *is* asking the question. The more deeply you force your brain to think, the better chance you have of learning and remembering.

#### **2** Do the exercises. Write your own notes.

We put them in, but if we did them for you, that would be like having someone else do your workouts for you. And don't just *look* at the exercises. **Use a pencil.** There's plenty of evidence that physical activity *while* learning can increase the learning.

## **3** Read the "There Are No Dumb Questions."

That means all of them. They're not optional sidebars, *they're part of the core content!* Don't skip them.

#### **4** Make this the last thing you read before bed. Or at least the last challenging thing.

Part of learning (especially the transfer to long-term memory) happens *after* you put the book down. Your brain needs time on its own, to do more processing. If you put in something new during that processing time, some of what you just learned will be lost.

#### **5** Talk about it. Out loud.

Speaking activates a different part of the brain. If you're trying to understand something, or increase your chance of remembering it later, say it out loud. Better still, try to explain it out loud to someone else. You'll learn more quickly, and you might uncover ideas you hadn't known were there when you were reading about it.

#### **6** Drink water. Lots of it.

Your brain works best in a nice bath of fluid. Dehydration (which can happen before you ever feel thirsty) decreases cognitive function.

#### **7** Listen to your brain.

Pay attention to whether your brain is getting overloaded. If you find yourself starting to skim the surface or forget what you just read, it's time for a break. Once you go past a certain point, you won't learn faster by trying to shove more in, and you might even hurt the process.

#### **8** Feel something.

Your brain needs to know that this *matters*. Get involved with the stories. Make up your own captions for the photos. Groaning over a bad joke is *still* better than feeling nothing at all.

#### **9** Apply it every day!

There's only one way to learn how to *really* understand software architecture: **apply it every day**. You are going to be doing software architecture a lot in this book, and like with any other skill, the only way to get good at it is to practice. We're going to give you a lot of practice: every chapter has exercises that pose problems for you to solve. Don't just skip over them—a lot of the learning happens when you solve the exercises. We included a solution to each exercise—don't be afraid to **peek at the solution** if you get stuck! (It's easy to get snagged on something small.) But try to solve the problem before you look at the solution. And definitely get it working before you move on to the next part of the book.

# <span id="page-29-0"></span>Read me

This is a learning experience, not a reference book. We deliberately stripped out everything that might get in the way of learning whatever it is we're working on at that point in the book. And the first time through, you need to begin at the beginning, because the book makes assumptions about what you've already seen and learned.

#### We break things down, then build them back again.

We are fans of teasing things apart. This gives us the chance to focus on one aspect of software architecture at a time. We use a lot of visuals to explain various aspects of software architecture. We make sure you have a deep understanding of each aspect, and have the confidence to know when and how to use them. Only *then* do we start to bring things together, to explain the more complex ideas in software architecture.

#### We don't exhaustively cover everything.

We use the 80/20 approach. We assume that if you are going for a PhD in software architecture, this isn't going to be your only book. So, we don't talk about everything—just the stuff that you'll actually use, and that you need to hit the ground running. We want to hit the ground running.

#### The activities are NOT optional.

The exercises and activities are not add-ons; they're part of the core content of the book. Some of them are to help with memory, some are for understanding, and some will help you apply what you've learned. *Don't skip the exercises.* The crossword puzzles are the only thing you don't *have* to do, but they're good for giving your brain a chance to think about the words and terms you've been learning in a different context.

#### The redundancy is intentional and important.

One distinct difference in a Head First book is that we want you to *really* get it. And we want you to finish the book remembering what you've learned. Most reference books don't have retention and recall as a goal, but this book is about *learning*, so you'll see some of the same concepts come up more than once.

#### The examples are as generic as possible.

To teach you software architecture, we have to use business problems—otherwise, the concepts we introduce in this book would be too abstract and hard to follow. We've deliberately made the examples in this book generic, yet also interesting, fascinating, and downright fun. No matter your background, we are certain you will be able to relate to them when practicing software architecture, whatever kind of work you do.

#### The Brain Power exercises don't always have answers.

For some of them, there is no right answer, and for others, part of the learning experience is for you to decide if and when your answers are right. In some of the Brain Power exercises, you will find hints to point you in the right direction.

# O'Reilly online learning

![](_page_30_Picture_8.jpeg)

For more than 40 years, O'Reilly Media has provided technology and business training, knowledge, and insight to help companies succeed.

Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our online learning platform. O'Reilly's online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O'Reilly and 200+ other publishers. For more information, visit *http://oreilly.com.*

# <span id="page-31-0"></span>Do it yourself chapters

A unique aspect of this particular Head First book is what we call "do it yourself " chapters. These chapters (there are two of them) are entirely exercise-based and give you a chance to create an architecture from beginning to end, applying all the concepts you've learned up to that point.

In these chapters, *you're the software architect*. You'll determine architectural characteristics, build a logical architecture, and make architectural decisions, including what kind of architectural style to use. Doing the exercises in these chapters gives you an end-to-end view of what a software architect does and shows you how much you've learned.

![](_page_31_Picture_4.jpeg)

![](_page_31_Picture_5.jpeg)

In Chapter 9, the first "do it yourself " chapter, you'll create an architecture for a trip-management system called TripEZ (pronounced like "trapeze") that aims to make travel easier, especially for road warriors. This new online trip-management dashboard app will allow travelers to see and manage all of their travel reservations, organized by trip, through a browser or on their mobile devices.

In Chapter 12, the second "do it yourself " chapter, you'll create an architecture for a standardized-testing system called Make the Grade. All Dataville Public School students in specific grade levels take the same test to determine how well students, teachers, and the school are doing. This chapter will be a great way for you to *test* your knowledge (so to speak).

![](_page_31_Picture_8.jpeg)

## The technical review team

#### Meet our review team!

We were lucky enough to round up a powerhouse team of people to review this book, including senior developers, software architects, renowned public speakers, and prolific book authors.

These experts read every chapter, did the exercises, corrected our mistakes, and provided detailed commentary on every single page of this book. They also acted as our sounding board, letting us work through ideas, analogies, and narratives. They even helped us think through how this book should be organized.

Every single reviewer here made huge contributions to this book and vastly improved its quality. We deeply appreciate the countless hours they spent poring over the manuscript. We remain indebted to them.

#### Thank you!

Special thanks also to Moataz Sanad for finding lots of our typos!

Despite our (and our reviewers') best efforts, any and all errors and omissions are ours and ours alone.

Nate Schutta

![](_page_32_Picture_10.jpeg)

Tanya Reilly

![](_page_32_Picture_12.jpeg)

Christine Schutta

![](_page_32_Picture_14.jpeg)

Clare Sudbery

![](_page_32_Picture_16.jpeg)

Venkat Subramaniam

![](_page_32_Picture_18.jpeg)

Patrick Viafore

![](_page_32_Picture_20.jpeg)

Marc Loy

![](_page_32_Picture_22.jpeg)

James Erler

![](_page_32_Picture_24.jpeg)

Max Schubert

![](_page_32_Picture_26.jpeg)

# Joint acknowledgments

This book would not have been possible without the help, guidance, and support from a number of great individuals. We have a lot of people to thank, so let's get started!

#### *Our editor:*

Our first and foremost acknowledgment goes, along with our utmost thanks, to our brilliant editor **Sarah Grey**. Writing a book like *Head First Software Architecture* presented a number of unique challenges for us, and Sarah was there to guide us the entire time. She helped keep us on track when we deviated from the Head First style of writing (which was quite often) and made constant suggestions about every page's layout (really, we mean *every* page). Sarah took on the role of crossword expert and helped us out quite a bit with the *Make It Stick* poetry. We frequently referred to Sarah as our "fourth author," and in reality, she deserves much of the credit for the outcome of this book.

![](_page_33_Picture_5.jpeg)

The brilliant Sarah Grey

#### *The O'Reilly team:*

A big thanks to the entire O'Reilly Media team, including **Kristen Brown** and **Chris Faucher** for making sure that our book was production-worthy, and to **Rachel Head** for her keen and astute copyediting eye. And if, like us, you routinely use book indexes, you have **Tom Dinse** to thank for this one.

We'd also like to thank **Melissa Duffield** for her continued support and patience throughout this process, and for considering us for this long project.

Much appreciation to the **O'Reilly online training team**, especially **Yasmina Greco**, **Lindsay Ventimiglia**, and **all the producers**, for giving us a platform to teach software architecture to thousands of developers and architects around the world.

A shoutout to the **Early Release team**, who put out raw and unedited chapters as they were written for the audience on the O'Reilly platform to review. This gave many of our readers a chance to submit errata and feedback that made this book just that much better.

Finally, we would be remiss if we did not mention series editors **Elisabeth Robson** and **Eric Freeman**, who took the time to review our work and ensure that it aligned with the vision that is the Head First series—not to mention giving us some really useful InDesign tips. Thank you!

# Individual acknowledgments

#### From Raju Gandhi:

It's hard for me to express how much of a privilege it has been to work on this project, and to be able to work with Mark and Neal—two of the smartest and most wonderful human beings, who not only were kind enough to consider me as a coauthor, but who since have spent countless hours teaching me the nuances of software architecture. Someday I hope I can repay that debt. For now, they have my deepest appreciation. A shoutout to so many friends, colleagues, unwitting mentors and teachers, and fellow speakers who've been a source of inspiration for me—you all know you who are. And finally, to my wife **Michelle**. We had baby **Delphine** while I was working on this project, and Michelle has certainly taken on more than her share as I spent many an hour working on this book. Thank you. I love you both.

![](_page_34_Picture_4.jpeg)

![](_page_34_Picture_5.jpeg)

#### From Mark Richards:

In addition to the joint acknowledgments, I would like to thank my friends and coauthors Raju and Neal. Raju brought prior Head First experience to the table from his great book *Head First Git*, and helped teach us the Head First style of writing and the ins and outs of InDesign. This is my third book with Neal, and as usual, working and collaborating with him was a very rewarding and enjoyable experience. I would also like to thank my lovely wife **Rebecca** for her patience and understanding while I was hidden away in my office for so many evenings writing this book instead of enjoying her company.

#### From Neal Ford:

I would like to thank first and foremost my coauthors, Mark and Raju, both of whom were a delight to work with and made this book possible. Mark is as always a fantastic collaborative juggernaut with a good sense of humor, both vital when writing is not our day job. I'd also like to thank our editor **Sarah**, who has an outsized role in this book series, for helping keep us in check. Thanks also to my extended families, both genetic and chosen, for their support and respite. That includes our weekly neighborhood cocktail club that moved to the parking lot during the pandemic and stayed there; it's great to catch up with what is happening nearby. And finally and primarily, I'd like to thank my wonderful wife **Candy**, who endures many long hours with me away from her and our cats, working on stuff like what you hold in your hand.

![](_page_34_Picture_10.jpeg)

Good thing we only had three authors, or these acknowledgments would go on and on and on...

And finally, you, the readers. Your attention is a scarce resource, and we deeply appreciate the time you'll spend with this book. Happy learning.

# software architecture demystified **1**

# Let's Get Started!

![](_page_36_Picture_2.jpeg)

#### **Software architecture is fundamental to the success of your**

**system.** This chapter demystifies software architecture. You'll gain an understanding of architectural dimensions and the differences between architecture and design. Why is this important? Because understanding and applying architectural practices helps you build more effective and correct software systems—systems that not only function better, but also meet the needs and concerns of the business and continue to operate as your business and technical environments undergo constant change. So, without further delay, let's get started.

# <span id="page-37-0"></span>Building your understanding of software architecture

To better understand software architecture, think about a typical home in your neighborhood. The structure of the home is its *architecture*—things like its shape, how many rooms and floors it has, its dimensions, and so on. A house is usually represented through a building plan, which contains all the lines and boxes necessary to know how to build the house. Structural things like those shown below are hard and expensive to change later and are the *important* stuff about the house.

The building metaphor is a very popular one for understanding software architecture.

![](_page_37_Picture_4.jpeg)

ugly, it's not very functional either.

Not only is this house

Architecture is essential for building a house. Can you imagine building one without an architecture? It might turn out looking something like the house on the right.

Architecture is also essential for building software systems. Have you ever come across a system that doesn't scale, or is unreliable or difficult to maintain? It's likely not enough emphasis was placed on that system's architecture.

![](_page_37_Picture_8.jpeg)

![](_page_37_Picture_9.jpeg)

# Exercise

Gardening is another useful metaphor for describing software architecture. Using the space below, can you describe how planning a garden might relate to software architecture? You can see what we came up with at the end of this chapter.

Solution on page 29

# <span id="page-38-0"></span>Building plans and software architecture

You might be wondering how the building plans of your home relate to software architecture. Each is a representation of the thing being built. So what does the "building plan" of a software system look like? Lines and boxes, of course.

A building plan specifies the structure of your home—the rooms, walls, stairs, and so on—in the same way a software architecture diagram specifies its structure (user interfaces, services, databases, and communication protocols). Both artifacts provide guidelines and constraints, as well as a vision of the final result.

![](_page_38_Picture_4.jpeg)

![](_page_38_Picture_5.jpeg)

# Sharpen your pencil

What features of your home can you list that are *structural* and related to its *architecture*? You can find our thoughts at the end of this chapter.

Use this space to write down your ideas.

Solution on page 29

Did you notice that the floor plan for the house above doesn't specify the details of the rooms—things like the type of flooring (carpet or hardwood), the color of the walls, and where a bed might go in a bedroom? That's because those things aren't *structural*. In other words, they don't specify something about the *architecture* of the house, but rather about its *design*.

Don't worry—you'll learn a lot more about this distinction later in this chapter. Right now, just focus on the structure of something—in other words, its architecture.

## <span id="page-39-0"></span>The dimensions of software architecture

![](_page_39_Picture_2.jpeg)

Most things around us are multidimensional. For example, you might describe a particular room in your home by saying it is 5 meters long and 4 meters wide, with a ceiling height of 2.5 meters. Notice that to properly describe the room you needed to specify all three dimensions—its height, length, and width.

You can describe software architecture by its dimensions, too. The difference is that software architecture has *four dimensions*.

## Architectural characteristics

This dimension describes what aspects of the system the architecture needs to support—things like scalability, testability, availability, and so on.

## Architectural decisions

This dimension includes important decisions that have long-term or significant implications for the system—for example, the kind of database it uses, the number of services it has, and how those services communicate with each other.

# 3 Logical components

This dimension describes the building blocks of the system's functionality and how they interact with each other. For example, an ecommerce system might have components for inventory management, payment processing, and so on.

# 4 Architectural style

This dimension defines the overall physical shape and structure of a software system in the same way a building plan defines the overall shape and structure of your home.

![](_page_39_Picture_13.jpeg)

![](_page_39_Picture_14.jpeg)

# <span id="page-40-0"></span>Puzzling out the dimensions

You can think of software architecture as a puzzle, with each dimension representing a separate puzzle piece. While each piece has its own unique shape and properties, they must all fit together and interact to build a complete picture.

![](_page_40_Picture_3.jpeg)

![](_page_40_Picture_4.jpeg)

#### Everything is interconnected.

Did you notice how the pieces of this puzzle are joined in the middle? That's exactly how software architecture works: *each dimension must align*.

The architectural style must align with the architectural characteristics you choose as well as the architectural decisions you make. Similarly, the logical components you define must align with the characteristics and the architectural style as well as the decisions you make.

![](_page_40_Picture_8.jpeg)

Do you need all four dimensions when creating an architecture, or can you skip some if you don't have time?

Infortunately, you can't skip any of these dimensions—they are all required to create and describe an architecture. One common mistake software architects make is using only one or two of these dimensions when describing their architecture. "Our architecture is microservices" describes a single dimension—the architectural style—but leaves too many unanswered questions. For example, what architectural characteristics are critical to the success of the system? What are its logical components (functional building blocks)? What major decisions have you made about how you'll implement the architecture?

## <span id="page-41-0"></span>The first dimension: Architectural characteristics

![](_page_41_Picture_2.jpeg)

Architectural characteristics form the foundation of the architecture in a software system. Without them, you cannot make architectural decisions or analyze important trade-offs.

Imagine you're trying to choose between two homes. One home is roomy but is next to a busy, noisy motorway. The other home is in a

nice, quiet neighborhood, but is much smaller. Which characteristic is more important to youhome size or the level of noise and traffic? Without knowing that, you can't make the right choice.

The same is true with software architecture. Let's say you need to decide what kind of database to use for your new system. Should it be a relational database, a simple key/value database, or a complex graph database? The answer will be based on what architectural characteristics are critical to you. For example, you might choose a graph database if you need high-speed search capability (we'll call that **performance**), whereas a traditional relational database might be better if you need to preserve data relationships (we'll call that *data integrity*).

# performance The amount of time it takes for the system to process a business request

# availability

The amount of uptime of a system; usually measured in "nines" (so 99.9% would be

# scalability

The system's ability to maintain a consistent response time and error rate as the number of users or requests increases

Here are some of the more common architectural characteristics. You'll be learning all about these in Chapter 2.

![](_page_41_Picture_13.jpeg)

Check the things you think might be considered architectural characteristics—something that the *structure* of the software system supports.

| <input type="checkbox"/> | Changing the font size in a window on the user interface screen       |
|--------------------------|-----------------------------------------------------------------------|
| <input type="checkbox"/> | Making changes quickly                                                |
| <input type="checkbox"/> | Handling thousands of concurrent users                                |
| <input type="checkbox"/> | Encrypting user passwords stored in the database                      |
| <input type="checkbox"/> | Interacting with many external systems to complete a business request |

Solution on page 30

<span id="page-42-0"></span>The term *architectural characteristics* might not be familiar to you, but that doesn't mean you haven't heard of them before. Collectively, things like performance, scalability, reliability, and availability are also known as nonfunctional requirements, system quality attributes, and simply "the -ilities" because most end with the suffix *-ility*. We like the term *architectural characteristics* because these qualities help define the character of the architecture and what it needs to support.

Architectural characteristics are capabilities that are critical or important to the success of the system.

# Make it Stick

To architect software you must first address:

Capabilities key to the new app's success

# Who Does What?

Here's your chance to see how much you already know about many common architectural characteristics. Can you match up each architectural characteristic on the left with its definition on the right? You'll notice there are more definitions than characteristics, so be careful—not all of the definitions have matches.

# Extensibility We did this one for you. Agility Interoperability

Fault tolerance

**Feasibility** 

Taking into account time frames, budgets, and developer skills when making architectural choices

The system's ability to keep its other parts functioning when fatal errors occur

The ease with which the system can be enhanced to support additional features and functionality

The amount of time it takes to get a response to the user

The system's ability to respond quickly to change (a function of maintainability, testability, and deployability)

The system's ability to interface and interact with other systems to complete a business request

Solution on page 30

7

## <span id="page-43-0"></span>The second dimension: Architectural decisions

![](_page_43_Picture_2.jpeg)

**Architectural decisions** are choices you make about structural aspects of the system that have long-term or significant implications. As constraints, they'll guide your development team in planning and building the system.

Should your new home have one floor or two? Should the roof be flat or peaked? Should you build a big, sprawling ranch house? These are good examples of architectural decisions because they involve the *structural* aspect of your home.

What should your home look like? This kind of decision is an architectural one.

![](_page_43_Picture_6.jpeg)

![](_page_43_Picture_7.jpeg)

![](_page_43_Picture_8.jpeg)

![](_page_43_Picture_9.jpeg)

![](_page_43_Picture_10.jpeg)

You might decide that your system's user interface should not communicate directly with the database, but instead must go through the underlying services to retrieve and update data. This architectural decision places a particular constraint on the development of the user interface, and also guides the development team about how other components should access and update data in the database.

![](_page_43_Figure_12.jpeg)

![](_page_44_Figure_1.jpeg)

![](_page_44_Picture_2.jpeg)

*Decisions* are structural guides for dev teams.

They often focus on significant themes.

It's not uncommon to have several dozen or more documented architectural decisions within any system. Generally, the larger and more complicated the system, the more architectural decisions it will have.

# **BE the architect**

**Your job is to be the architect and identify as many architectural decisions as you can in the diagram below. Draw a circle around anything that you think might be an architectural decision and write what that decision might be.**

Here's a hint—do you have questions about why certain things are done the way they are?

![](_page_44_Figure_9.jpeg)

# <span id="page-45-0"></span>The third dimension: Logical components

![](_page_45_Picture_2.jpeg)

Logical components are the building blocks of a system, much in the same way rooms are the building blocks of your home. A logical component performs some sort of function, such as processing the payment for an

order, managing item inventory, or tracking orders.

Logical components in a system are usually represented through a directory or namespace. For example, the directory app/order/payment with the corresponding namespace app.order.payment identifies a logical component named Payment Processing. The source code that allows users to pay for an order is stored in this directory and uses this namespace.

![](_page_45_Picture_6.jpeg)

![](_page_45_Figure_7.jpeg)

# <span id="page-46-0"></span>Sharpen your pencil

You've just created the following two components for a new system, and your development team wants to start writing class files to implement them. Can you create a directory structure for them so they can start coding? Flip to the end of the chapter for our solution.

Customer Profile

Customer Preferences

Use this space to write down your answer.

Solution on page 32

A logical component should always have a well-defined role and responsibility in the system—in other words, a clear definition of what it does.

This component is responsible for "pick and pack." It locates items in a warehouse (that's the "pick" part), then determines the correct box size for the items so they can be shipped (that's the "pack" part).

Order Fulfillment

This is the role and responsibility statement for the Order Fulfillment component.

Make it Stick

Logical components are blocks in

They hold the source code for each business function.

there are no **Dumb Questions** 

Q: What is the difference between the system functionality and the domain?

A: The *domain* is the problem you are trying to solve, and the *system functionality* is *how* you are solving that problem. In other words, the domain is the "what," and the system's functionality is the "how."

# <span id="page-47-0"></span>The fourth dimension: Architectural styles

![](_page_47_Picture_2.jpeg)

Homes come in all shapes, sizes, and styles. While there are some wild-looking houses out there, most conform to a particular style, such as Victorian, ranch, or Tudor. The style of a home says a lot about its overall structure. For example, ranch homes typically have only one floor; colonial and Tudor homes typically have chimneys; contemporary homes typically have flat roofs.

Each region of the world has its own set of home styles—check em out at https://en.wikipedia.org/wiki/List\_of\_house\_styles.

![](_page_47_Picture_5.jpeg)

![](_page_47_Picture_6.jpeg)

![](_page_47_Picture_7.jpeg)

Architectural styles define the overall shape and structure of a software system, each with its own unique set of characteristics. For example, the *microservices* architectural style scales very well and provides a high level of *agility*—the ability to respond quickly to change—whereas the *layered* architectural style is less complex and less costly. The *event-driven* architectural style provides high levels of scalability and is very fast and responsive.

Don't worry—you'll be learning all about these architectural styles later in the book. We've devoted chapters to each of them.

![](_page_47_Figure_10.jpeg)

<span id="page-48-0"></span>Because the architectural style defines the overall shape and characteristics of the system, it's important to get it right the first time. Why? Can you imagine starting construction on a one-story ranch home, and in the middle of construction changing your mind and deciding you're going to build a three-story Victorian house instead? That would be a major undertaking, and likely exceed your budget and affect when you can move into the house.

Software architecture is no different. It's not easy changing from a monolithic layered architecture to microservices. Like the house example, this would be quite an undertaking.

![](_page_48_Picture_3.jpeg)

![](_page_48_Picture_4.jpeg)

Later in the book, we'll show you how to properly select an architectural style based on characteristics that are important to you.

Which brings us back to an earlier point—all of the dimensions of software architecture are interconnected. You can't select an architectural style without knowing what's important to you.

![](_page_48_Figure_7.jpeg)

The tightly wound tendons and muscles in a lion's legs enable it to reach speeds as fast as reach speeds as fast as 50 miles (80 kilometers) per hour and leap up to 36 feet (11 meters) in a single bound. This characteristic allows lions to survive by catching fast prey.

Look around you—what else has a structure or shape that defines its characteristics and capabilities?

Fun fact: A lion doesn't have much stamina and can only run fast in short bursts. If you can last longer than the lion chasing you, then you just might survive.

# Who Does What

<span id="page-49-0"></span>We were trying to describe our architecture, but all the puzzle pieces got mixed up. Can you help us figure out which dimension does what by matching the statements on the left with the software architecture dimensions on the right? Be careful—some of the statements don't have a match because they are not related to architecture.

This system must be available for our overseas customers. This is about availability.

We did this one for you.

Customers are complaining about the background color of the new user interface.

The product owner insists that we get new features and bug fixes out to our customers as fast as possible.

Our system uses an event-driven architecture.

![](_page_49_Picture_8.jpeg)

The single payment service will be broken apart into separate services, one for each payment type we accept.

We are going to start offering reward points as a new payment option when paying for an order.

We are breaking up the orderPlacement class into three smaller class files.

The user interface shall not communicate directly with the database.

![](_page_49_Picture_13.jpeg)

![](_page_49_Picture_14.jpeg)

![](_page_49_Picture_15.jpeg)

**Solution on page 33**

If I'm responsible for the design of a software system, does that mean I'm responsible for its architecture as well? Aren't those the same thing?

<span id="page-50-0"></span>![](_page_50_Picture_2.jpeg)

#### **No, architecture and design are different.**

You see, architecture is less about appearance and more about structure, while design is less about structure and more about appearance.

The color of a room's walls, the placement of furniture, and the type of flooring (carpet or wood) are all aspects of design, whereas the physical size of the room and the placement of doors and windows are part of architecture—in other words, the *structure* of the room.

Think about a typical business application. The architecture, or structure, is all about how the web pages communicate with backend services and databases to retrieve and save data, whereas the design is all about what each page looks like: the colors, the placement of the fields, which design patterns you use, and so on. Again, it becomes a matter of structure versus appearance.

Your question is a good one, because sometimes it gets confusing trying to tell what is considered architecture and what is considered design. Let's investigate these differences.

# <span id="page-51-0"></span>A design perspective

Suppose your company wants to replace its outdated order processing system with a new custom-built one that better suits its specific needs. Customers can place orders and can view or cancel orders once they have been placed. They can pay for an order using a credit card, a gift card, or both payment methods.

![](_page_51_Picture_3.jpeg)

From a *design* perspective, you might build a Unified Modeling Language (UML) class diagram like the one below to show how the classes interact with each other to implement the payment functionality. While you could write source code to implement these class files, this design says nothing about the *physical structure* of the source code—in other words, how these class files would be organized and deployed.

![](_page_51_Figure_5.jpeg)

# <span id="page-52-0"></span>An architectural perspective

Unlike design, architecture is about the *structure* of the system—things like services, databases, and how services communicate with each other and the user interface.

Let's think about that new order processing system again. What would the *system* look like? From an *architectural* perspective, you might decide to create separate services for each payment type within the order payment process and have an orchestrator service to manage the payment processing part of the system, like in the diagram below.

![](_page_52_Figure_4.jpeg)

# <span id="page-53-0"></span>The spectrum between architecture and design

Some decisions are certainly architectural (such as deciding which architectural style to use), and others are clearly design-related (such as changing the position of a field on a screen or changing the type of a field within a class). In reality, most decisions you encounter will fall between these two examples, within a *spectrum* of architecture and design.

![](_page_53_Figure_3.jpeg)

Why should I care where in the spectrum between architecture and design my decision lies?

Does it really matter that much?

**Yes, it matters a lot.** You see, knowing where along the spectrum between architecture and design your decision lies helps determine *who* should be responsible for ultimately making that decision. There are some decisions that the development team should make (such as designing the classes to implement a certain feature), some decisions that an architect should make (such as choosing the most appropriate architectural style for a system), and others that should be made together (such as breaking apart services or putting them back together).

# <span id="page-54-0"></span>Where along the spectrum does your decision fall?

![](_page_54_Picture_2.jpeg)

#### Is it strategic or tactical?

Strategic decisions are long term and influence future actions or decisions. Tactical decisions are short term and generally stand independent of other actions or decisions (but may be made in the context of a particular strategy). For example, deciding how big your new home will be influences the number of rooms and the sizes of those rooms, whereas deciding on a particular lighting fixture won't affect decisions about the size of your dining room table. The more strategic the decision, the more it sits toward the architecture side of the spectrum.

Sometimes waking up in the morning requires a lot of effort—we'll call those "architecture" mornings.

#### How much effort will it take to construct or change?

Architectural decisions require more effort to construct or change, while design decisions require relatively less. For example, building an addition to your home generally requires a high level of effort and would therefore be more on the architecture side of the spectrum, whereas adding an area rug to a room requires much less effort and would therefore be more on the design side.

![](_page_54_Picture_8.jpeg)

![](_page_54_Picture_9.jpeg)

#### Poes it have significant trade-offs?

*Trade-offs* are the pros and cons you evaluate as you are making a decision. Decisions that involve significant trade-offs require much more time and analysis to make and tend to be more architectural in nature. Decisions that have less-significant trade-offs can be made quicker, with less analysis, and therefore tend to be more on the design side.

We're going to walk you through the details of all three of these factors in the next several pages.

![](_page_54_Picture_13.jpeg)

Can you think of a decision that doesn't involve a trade-off, no matter how small or insignificant? Here's a hint: if you think you've found a decision that doesn't involve a trade-off, keep looking.

# <span id="page-55-0"></span>Strategic versus tactical

The more strategic a decision is, the more architectural it becomes. This is an important distinction, because decisions that are strategic require more thought and planning and are generally long term.

![](_page_55_Figure_3.jpeg)

**How many people are involved in the decision? 2.**

The more people involved, the more strategic the decision. A decision you can make by yourself or with a colleague is likely to be tactical. A decision that requires many meetings with lots of stakeholders is probably more strategic.

#### **Does your decision involve a long-term vision or a short-term action? 3.**

If you are making a quick decision about something that is temporary or likely to change soon, it's more tactical and hence more about design. Conversely, if this is a decision you'll be living with for a very long time, it's more strategic and more about architecture.

# <span id="page-56-0"></span>**Sharpen your pencil**

Oh dear. We've lost all of our marbles and we need your help collecting them and putting them back in the right spot. Using the three questions on the previous page as a guide, can you figure out which jar each marble should go in?

![](_page_56_Picture_3.jpeg)

Picking a programming language for your new project

![](_page_56_Picture_5.jpeg)

Deciding to get your first dog

![](_page_56_Picture_7.jpeg)

Deploying in the cloud or on premises

![](_page_56_Picture_9.jpeg)

Redesigning your user interface

![](_page_56_Picture_11.jpeg)

Migrating your system to microservices

![](_page_56_Picture_13.jpeg)

Choosing a parsing library

![](_page_56_Picture_15.jpeg)

Using a design pattern

![](_page_56_Picture_17.jpeg)

![](_page_56_Picture_18.jpeg)

Strategic Somewhere in Tactical between

![](_page_56_Picture_20.jpeg)

**Solution on page 35**

# <span id="page-57-0"></span>High versus low levels of effort

Renowned software architect and author Martin Fowler once wrote that "software architecture is the stuff that's hard to change." You can use Martin's definition to help determine where along the spectrum your decision lies. The harder something is to change later, the further it falls toward the architecture side of the spectrum. Conversely, the easier it is to change later, the more it's probably related to design.

Martin Fowler's website (https://martinfowler. com/architecture) has lots of useful stuff about architecture.

![](_page_57_Figure_4.jpeg)

Suppose you are planning on moving from one architectural style to another; say, from a traditional *n*-tiered layered architecture to microservices. This migration effort is rather difficult and will take a lot of time. Because the level of effort is high, this would be on the far end of the *architecture side* of the spectrum.

![](_page_57_Picture_6.jpeg)

Changing the layout of the fields on a web page is more about appearance than structure—yet another reason why this would be considered design.

Now suppose you're rearranging fields on a user interface screen. This task takes relatively less effort, so it resides on the far end of the *design side* of the spectrum.

![](_page_57_Figure_9.jpeg)

![](_page_58_Picture_1.jpeg)

# Code Magnets

We had all of these magnets from our to-do list arranged from high effort to low effort, and somehow they all fell on the floor and got mixed up. Can you help us put them back in the right order based on the amount of effort it would take to make each change?

amount of effort it would take to make each change? Draw arrows to put the high-effort tasks at the top of the page, and the lower-effort ones toward the bottom of High effort the page. Resolving a merge conflict in Git Replacing your user interface framework Migrating your system to a cloud environment Deciding which mustard to buy Renaming a method or function Breaking apart a single service into separate ones Moving from a relational to a graph database Low effort Breaking apart a class file Solution on page 36

# <span id="page-59-0"></span>Significant versus less-significant trade-offs

Some decisions you make might involve significant trade-offs, such as choosing which city to live in. Others might involve less significant trade-offs, like deciding on the color of your living room rug. You can use the level of significance of the trade-offs in a particular decision to help determine whether that decision is more about architecture or design. The more significant the trade-offs, the more it's about architecture; the less significant the trade-offs, the more it's about design.

![](_page_59_Figure_3.jpeg)

![](_page_60_Picture_1.jpeg)

# **Exercise**

Decisions, decisions, decisions. How can we ever tackle all of these decisions? One thing we think might help is to identify the decisions that involve significant trade-offs, since those will require more thinking and will take longer. Can you help us by identifying which decisions have significant trade-offs and which don't?

Is this a significant trade-off?

| Yes | No | Picking out what clothes to wear to work today       |
|-----|----|------------------------------------------------------|
| Yes | No | Choosing to deploy in the cloud or on premises       |
| Yes | No | Selecting a user interface framework                 |
| Yes | No | Naming a variable in a class file                    |
| Yes | No | Choosing between vanilla and chocolate ice cream     |
| Yes | No | Deciding which architectural style to use            |
| Yes | No | Choosing between REST and messaging                  |
| Yes | No | Using full data or only keys for the message payload |
| Yes | No | Selecting an XML parsing library                     |
| Yes | No | Deciding whether or not to break apart a service     |
| Yes | No | Choosing between atomic or distributed transactions  |
| Yes | No | Deciding whether or not to go out to dinner tonight  |

Solution on page 37

# <span id="page-61-0"></span>Putting it all together

Now it's time to put all three of these factors to use to figure out whether a decision is more about architecture or more about design. This tells development teams when to collaborate with an architect and when to make a decision on their own.

Let's say you decide to use asynchronous messaging between the Order Placement service and the Inventory Management service to increase the system's responsiveness when customers place orders. After all, why should the customer have to wait for the business to adjust and process inventory? Let's see if we can determine where in the spectrum this decision lies.

![](_page_61_Figure_4.jpeg)

![](_page_61_Figure_5.jpeg)

# <span id="page-62-0"></span>You made it!

Congratulations—you made it through the first part of your journey to understanding software architecture. But before you roll up your sleeves to dig into further chapters, here's a little quiz for you to test your knowledge so far. For each of the statements below, circle whether it is true or false.

# **True or False**

| True | False | Design is like the structure of a house (walls, roof, layout, and so on), and<br>software architecture is like the furniture and decoration.     |
|------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| True | False | Most decisions are purely about architecture or design. Very few<br>exist along a spectrum between architecture and design.                      |
| True | False | The more strategic your decision, the more it's about architecture;<br>the more tactical, the more it's about design.                            |
| True | False | The more effort it takes to implement or change your decision, the more<br>it's about design; the less effort, the more it's about architecture. |
| True | False | Trade-offs are the pros and cons of a given decision or task. The more<br>significant the trade-offs become, the more it's about architecture.   |
|      |       | Solution on page 38                                                                                                                              |

# **Bullet Points**

- Software architecture is less about appearance and more about structure, whereas design is more about appearance and less about structure.
- You need to use four dimensions to understand and describe software architecture: architectural characteristics, architectural decisions, logical components, and architectural style.
- Architectural characteristics form the foundational aspects of software architecture. You must know which architectural characteristics are most important to your specific system, so you can analyze trade-offs and make the right architectural decisions.
- Architectural decisions serve as guideposts to help development teams understand the constraints and conditions of the architecture.

- The logical components of a software architecture solution make up the building blocks of the system. They represent things the system does and are implemented through class files or source code.
- Like with houses, with software there are many different architectural styles you can use. Each style supports a specific set of architectural characteristics, so it's important to make sure you select the right one (or combination of them) for your system.
- It's important to know if a decision is about architecture or design, because that helps determine who should be responsible for the decision and how important it is.

![](_page_63_Picture_1.jpeg)

# **Software Architecture Crossword**

Congratulations! You made it through the first chapter and learned about what software architecture is (and isn't). Now, why don't you try architecting the solution to this crossword?

![](_page_63_Picture_4.jpeg)

#### Across

| 2. An architectural style determings the system's overall |
|-----------------------------------------------------------|
|-----------------------------------------------------------|

 \_\_\_\_\_ 4. \_\_\_\_\_-driven is an architectural style 5. Architectural characteristics are sometimes called this 10. Architectural decisions are usually \_\_\_\_\_ term 12. If something takes a lot of \_\_\_\_\_ to implement, it's probably architectural 13. You're learning about software \_\_\_\_\_ 15. You'll make lots of architectural \_\_\_\_\_ 16. A system's \_\_\_\_\_ components are its building blocks 18. The number of rooms in your home is part of its \_\_\_\_\_ 19. Architecture and design exist on a \_\_\_\_\_

#### Down

- 1. Strategic decisions typically involve a lot of these
- 3. Building this can be a great metaphor
- 6. Decisions can be strategic of \_\_\_\_\_
- 7. How many dimensions it takes to describe a software architecture
- 8. A website's user \_\_\_\_\_ involves lots of design decisions
- 9. The overall shape of a house or a system, like Victorian or microservices
- 11. It's important to know whether a decision is about architecture or this
- 13. You might want to become one after reading this book
- 14. You analyze these when making an architectural decision
- 17. Trade-offs are about the \_\_\_\_\_ and cons

**Solution on page 39**

![](_page_64_Picture_1.jpeg)

Gardening is another useful metaphor for describing software architecture. Using the space below, can you describe how a garden might relate to software architecture?

The overall layout of a garden can be compared to the architectural style, whereas each grouping of like plants (either by type or color) can represent the architectural components. Individual plants within a group represent the class files implementing those components.

Gardens are influenced by weather in the same way a software architecture is influenced by changes in technology, platforms, the deployment environment, and so on. Also, if you don't pay attention to the garden, weeds grow—just like structural decay within your architecture.

![](_page_64_Picture_6.jpeg)

From page 3

What features of your home can you list that are structural and related to its architecture?

The size and shape of your kitchen (who doesn't your kitchen about how small complain about his?)

How many floors it has (as you get older, stairs might be a Problem)

Where the front door is and if the entranceway is wheelchair accessible

The size of your bedroom closet (if you bedroom closet lothes) have lots of clothes)

The height of your ceilings (especially if you happen to be very tall)

How many bathrooms it has (adding a new bathroom is really hard to do)

An attic for storing all of the stuff you never use

Outside deck or patio (unless you live in the Arctic, of course)

![](_page_65_Picture_1.jpeg)

# Exercise Solution

From page 6

Check the things you think might be considered architectural characteristics—something that the structure of the software system supports.

| <input type="checkbox"/> Changing the font size in a window on the user interface screen                                                     |
|----------------------------------------------------------------------------------------------------------------------------------------------|
| <input checked="" type="checkbox"/> Making changes quickly   This is known as agility in architecture.                                       |
| <input checked="" type="checkbox"/> Handling thousands of concurrent users This is known as elasticity.                                      |
| <input type="checkbox"/> Encrypting user passwords stored in the database                                                                    |
| <input checked="" type="checkbox"/> Interacting with many external systems to complete a business request This is known as interoperability. |

![](_page_65_Figure_5.jpeg)

From page 7

Here's your chance to see how much you already know about many common architectural characteristics. Can you match up each architectural characteristic on the left with its definition on the right? You'll notice there are more definitions than characteristics, so be careful—not all of the definitions have matches.

![](_page_65_Figure_8.jpeg)

Taking into account time frames, budgets, and developer skills when making architectural choices

The system's ability to keep its other parts functioning when fatal errors occur

The ease with which the system can be enhanced to support additional features and functionality

The amount of time it takes to get a response to the user

The system's ability to respond quickly to change (a function of maintainability, testability, and deployability)

The system's ability to interface and interact with other systems to complete a business request

# BE the architect Solution

Your job is to be the architect and identify as many architectural decisions as you can in the diagram below. Draw a circle around anything that you think might be an architectural decision and write what that decision might be.

![](_page_66_Figure_4.jpeg)

![](_page_67_Figure_2.jpeg)

# Who Does What ? Solution

#### From page 14

We were trying to describe our architecture, but all the puzzle pieces got mixed up. Can you help us figure out which dimension does what by matching the statements on the left with the software architecture dimensions on the right? Be careful—some of the statements don't have a match because they are not related to architecture.

![](_page_68_Figure_4.jpeg)

![](_page_69_Picture_1.jpeg)

Sharpen your pencil From page 18

Solution

Circle all of the things that you think fall somewhere in the middle of the spectrum between architecture and design.

| This is design.                      |
|--------------------------------------|
| Breaking up a class file             |
| Deciding to use a graph database     |
| Choosing a persistence framework     |
| Breaking apart a service             |
| Selecting a user interface framework |
| Redesigning a web page               |
| These are design.                    |
| This is architecture.                |
| Migrating to microservices           |
| Choosing an XML parsing library      |

![](_page_70_Figure_2.jpeg)

![](_page_71_Picture_1.jpeg)

# Code Magnets Solution

From page 23

We had all of these magnets from our to-do list arranged from high effort to low effort, and somehow they all fell on the floor and got mixed up. Can you help us put them back in the right order based on the amount of effort it would take to make each change?

![](_page_71_Figure_5.jpeg)

Low effort

![](_page_72_Picture_1.jpeg)

![](_page_72_Picture_2.jpeg)

Decisions, decisions, decisions. How can we ever tackle all of these decisions? One thing we think might help is to identify the decisions that involve significant trade-offs, since those will require more thinking and will take longer. Can you help us by identifying which decisions have significant trade-offs and which ones don't?

| Significant Tradeoffs?                                                                     |      | Okay, so maybe this is a difficult decision sometimes. |
|--------------------------------------------------------------------------------------------|------|--------------------------------------------------------|
| Yes                                                                                        | ⊠ No | Picking out what clothes to wear to work today         |
| ⊠ Yes                                                                                      | ☐ No | Choosing to deploy in the cloud or on premisis         |
| Yes                                                                                        | ⊠ No | Selecting a user interface framework                   |
| There are certainly trade-offs here, so this one could go either way.                      |      |                                                        |
| Yes                                                                                        | ⊠ No | Deciding on the name of a variable in a class file     |
| Yes                                                                                        | ⊠ No | Choosing between vanilla and chocolate ice cream       |
| ⊠ Yes                                                                                      | ☐ No | Deciding which architectural style to use              |
| These can impact scalability, performance, and overall maintainability.                    |      |                                                        |
| ⊠ Yes                                                                                      | ☐ No | Choosing between REST and messaging                    |
| ⊠ Yes                                                                                      | ☐ No | Using full data or only keys for the message payload   |
| Yes                                                                                        | ⊠ No | Selecting an XML parsing library                       |
| ⊠ Yes                                                                                      | ☐ No | Deciding whether or not to break apart a service       |
| ⊠ Yes                                                                                      | ☐ No | Choosing between atomic or distributed transactions    |
| This can impact data integrity and data consistency, but also scalability and performance. |      |                                                        |
| Yes                                                                                        | ⊠ No | Deciding whether or not to go out to dinner tonight    |
| Are you getting hungry yet?                                                                |      |                                                        |

# True or False. Solution

True

False

Design is like the structure of a house (walls, roof, layout, and so on), and software architecture is like the furniture and decoration.

True False

Most decisions are purely about architecture or design. Very few exist along a spectrum between architecture and design.

Most decisions lie within the spectrum between architecture and design.

This is backwards.

True

The more strategic your decision, the more it's about architecture; the more tactical, the more it's about design.

True

False

False

The more effort it takes to implement or change your decision, the more it's about design; the less effort, the more it's about architecture.

This is backwards.

True False

*Trade-offs* are the pros and cons of a given decision or task. The more significant the trade-offs become, the more it's about architecture.

# **Software Architecture Crossword Solution**

**From page 23**

![](_page_74_Figure_3.jpeg)

2

# architectural characteristics **2** Know Your Capabilities

![](_page_76_Picture_3.jpeg)

**What does your architecture need to support?** Architectural characteristics (the capabilities of an architecture) are the fundamental building blocks of any system. Without them, you cannot make architectural decisions, select an architectural style, or in many cases even create a logical architecture. In this chapter you'll learn how to define some of the more common characteristics (like scalability, reliability, and testability), how they influence a software architecture, how they help you make architectural decisions, and how to identify which ones are important for your particular situation. Ready to add some capabilities to your software architecture?

# <span id="page-77-0"></span>Causing Lafter

Silly con Symposia is a startup with a Bay Area feel whose business plan combines technology-themed conferences with comedy. By gathering like minds, Silly con provides unique offerings for each group and keeps them engaged by keeping them laughing.

How hard could it be to start a social networking site?!

Part of the business plan includes building Lafter, a social media network related to (but not limited to) the conferences Sillycon hosts. The business stakeholders put together a *requirements document* for it:

The good news is that they've got the logo figured out. The rest is up to you.

![](_page_77_Picture_6.jpeg)

A pretty standard level of detail for a requirements document

Sillycon Symposia is hosting a social media network of like-minded technologists named Lafter.

Users: Hundreds of speakers, thousands of users

#### Requirements:

Users can register for usernames and approve the privacy policy

Users can add new content on Lafter as a "Joke" (long-form post) or "Pun" (short-form post)  $\,$ 

Followers can "HaHa" (indicating strong approval) or "Giggle" (a milder approval message) content they like

Speakers at Sillycon Symposia events have a special icon

Speakers can host forums on the platform related to their content

Users can post messages of up to 281 characters

Users can also post links to external content

#### Additional Context:

International support

Very small support staff

"Bursty" traffic: extremely busy during live conferences

![](_page_78_Picture_1.jpeg)

# <span id="page-78-0"></span>Cubicle conversation Mara Sam Alex

**Alex:** Look what just landed in my inbox—the Powers That Be want me to be the architect for the Sillycon Symposia social media app, Lafter.

**Sam:** You have the requirements? You should jump right into the design of the system—it seems really straightforward.

**Mara:** Well, you can really only do that for the simplest of applications, and I don't think this one qualifies. Remember the diagram I drew on the whiteboard the other day?

![](_page_78_Figure_6.jpeg)

You need to analyze both architectural characteristics and logical components before you can choose an architectural style as a starting point.

You can implement just about any application in any architectural style, but some are more suitable than others. Choosing the style before performing this type of analysis is a classic case of putting the cart before the horse.

**Sam:** Can't we just be super-agile, start with something tiny, and then keep iterating on it until we have the entire system?

**Mara:** The iterative approach you talk about doesn't quite work like that for architectural characteristics analysis. For example, it's difficult to make a system highly scalable if it wasn't designed for that.

**Alex:** That makes sense. I guess I need to roll up my sleeves and analyze some architectural characteristics—thanks!

## <span id="page-79-0"></span>What are architectural characteristics?

You have a problem. You decide, "I'm going to write some software to solve this problem!" The *thing* you're writing software about is called the *domain*, and designing for it will occupy much of your effort—that is, after all, why you're writing software. However, it's not the only thing an architect must consider—they must also analyze *architectural characteristics*. Here are a few examples of architectural characteristics that show how different domains have different, but often overlapping, architectural characteristics.

These make up one of the dimensions that help describe your architecture.

Notice how many of them end with "-ility".

#### Auditability

Banks must provide a way to verify transactions.

**Pata integrity** 

Financial transactions must be consistent and accurate.

#### Security

Banks require stringent security to protect — financial concerns.

Both domains have scalability as an architectural characteristic

they must support.

Scalability

Banks must support large numbers of concurrent users.

Bank

Online auctions must support a large number of bidders.

#### **Usability**

Auction sites must be easy to use for quick and efficient entry of bids.

![](_page_79_Picture_17.jpeg)

#### Online auction

#### Consistency

Bids must be captured consistently and in order for auctions to work.

#### Reliability

Auction sites must be reliable—users don't like it if their connection drops in the middle of an auction.

# <span id="page-80-0"></span>**Pefining architectural characteristics**

Part of your job as an architect is structural design for software systems, for which there are two parts: *logical components* and *architectural characteristics*. Logical components represent the domain of the application—the motivation for writing the software system (we cover these in Chapter 4). If you combine architectural characteristics with logical components, you have the structural considerations for an architecture.

Architectural characteristics are the important parts of the construction process of a software system or application, irrespective of the problem domain. They represent its operational capabilities, internal structure decisions, and other necessary characteristics.

We'll show you lots of examples of architectural characteristics in the upcoming pages, but first we want to cover the concept itself.

We define architectural characteristics in **three parts**, as shown here.

![](_page_80_Figure_6.jpeg)

Let's look at each of these edges one at a time.

# <span id="page-81-0"></span>Characteristics are nondomain design considerations

To define architectural characteristics, we first need to look at what they are *not*. The *requirements* specify what the application should do; *architectural characteristics* specify operational and design criteria for success, how to implement the requirements, and why certain choices were made. For example, an application's level of performance is an important architectural characteristic that often doesn't appear in requirements documents.

Structural design in architecture can be divided into *domain and non-domain considerations*. Architectural characteristics represent your design effort to create the capabilities necessary for the project to succeed.

![](_page_81_Picture_4.jpeg)

Mara: C
away to c

**Mara:** OK, the business analysts and subject matter experts have toiled away to create both a requirements document and the beginning of a domain design. But we need to work with them to figure out what architectural characteristics we need to support.

**Sam:** Isn't that part of the domain design? Why does an architect need to get involved at this point?

**Alex:** Well, our business analysts have never worked on a software porject, so they probably won't understand the impact of one decision versus another.

**Mara:** That's correct—often what seems like a minor difference to a business person makes a big difference for an architect! What they want may turn out to be difficult to support in architecture. That's why it's important for architects to be involved early and often in the design process.

**Sam:** What kinds of things are we looking for?

**Alex:** Part of the definition of *architectural characteristics* is "nondomain design considerations." Let's look at what they've designed and see if they've considered things like performance and scalability.

In a distributed

# <span id="page-82-0"></span>Characteristics influence architectural structure

The primary reason architects try to describe architectural characteristics has to do with architectural considerations: does this characteristic require special structural support to succeed? For example, security is a concern in virtually every project, and all systems must take baseline precautions during design and coding. However, security becomes an *architectural* characteristic when the architect needs to make a special effort to accommodate it.

Consider the following potential architecture diagrams for Lafter, which include functionality for marketing upcoming promotions and rules for when each promotion applies. An architect could design this as a *monolithic architecture*—one with a single deployable unit and matching database—or as a series of independent services.

We've moved on to the second edge here.

For the monolithic architecture, the entire application would have to be redeployed when the promotion rules change, because monoliths are built and deployed as a single unit. However, in a *distributed architecture*, only the Promotions service would be affected, and it could be redeployed independently.

![](_page_82_Picture_6.jpeg)

You must consider many trade-offs when making architectural decisions, such as whether to use a monolithic versus distributed physical architecture.

# <span id="page-83-0"></span>Limit characteristics to prevent overengineering

Applications *could* support a huge number of architectural characteristics...but they shouldn't. Every architectural characteristic the system must support adds complexity.

The sheer number and variety of architectural characteristics means there are many tempting choices. But as architects, we should try to pick as *few* architectural characteristics as possible, rather than as many as possible. This is because architectural characteristics are:

![](_page_83_Picture_4.jpeg)

CRITICAL OR IMPORTANT TO APPLICATION SI

We are talking about the third edge. Almost there!

#### Impossible to standardize

Different organizations use different terms for the same architectural characteristics. For example, performance and responsiveness might indicate the same behavior.

It's a good idea to create a "ubiquitous language" (shared vocabulary) for architectural characteristics within your organization—this gives you a fighting chance at creating a usable standard list.

#### **Synergistic**

Your takeaway? You often cannot choose one architectural characteristic without considering how it may affect others.

Architectural characteristics affect other architectural characteristics and domain concerns. For example, if you want to make an application more secure, the required changes will almost certainly affect performance negatively (more on-the-fly encryption and other similar changes will lead to performance overhead).

#### Overabundant

Possible architectural characteristics are extraordinarily abundant,  $\angle$  and new ones appear all the time. For example, a few years ago there was no such thing as on-demand elasticity via a cloud provider.

A common hazard for architects is *overengineering*: supporting too many architectural characteristics and complicating the overall design to little or no benefit. Knowing which architectural characteristics are *critical or important to application success* acts as a filtering tool. It help us *eliminate* features that would be nice to have but just end up adding needless complexity to the system.

Beware of resume-driven development (RDD)! It's fun to play with new stuff, and we should keep learning, but trying to support too many architectural characteristics in our systems will not align with larger priorities or help the application succeed.

Even the number of categories of architectural characteristics has increased over the last few years, with additions such as cloud constraints and capabilities.

We'll be discussing some categories of architectural characteristics soon.

<span id="page-84-0"></span>![](_page_84_Picture_1.jpeg)

#### Synergy can be dangerous!

Architects would love to design for architectural characteristics irrespective of the domain design. Unfortunately, the real world refuses to cooperate. When we say that architectural characteristics are *synergistic*, we mean that changes to one might require changes to other

architectural characteristics and/or the domain. No matter how clever you are, no architect can make every single architecture scalable. Some architectures can't scale as successfully as others because of physical constraints such as memory and bandwidth.

Be careful when you change one architectural characteristic; consider how that change may affect other parts of your architecture. The same applies to making changes to domain design, such as component boundaries and distribution—changes to the domain may synergistically affect your architectural characteristics. For example, if you change your application to begin storing users' payment information, the security and data integrity architectural characteristics will also change.

# **Brain Power**

Many things in the the real world are **synergistic**—that is, combining them yields something different than the sum of the parts. See if you can think of some real-world examples of synergy. *Hint: These might include things that are still identifiable (like peanut butter and chocolate) or things that merge (such as emulsions like oil and vinegar).*  Use this space to

jot down your ideas.

# <span id="page-85-0"></span>Consider explicit and implicit capabilities

Some things are *explicit*—stated clearly—whereas others are *implicit* assumed based on context or other knowledge. Imagine if you saw a bunch of mail and packages piling up outside the door of a home—what conclusions would you draw?

Packages are stacked outside a door.

The door is locked.

![](_page_85_Picture_6.jpeg)

No one is home.

This family orders a bunch of stuff online.

Is this family on vacation?

*Explicit* architectural characteristics are specified in the requirements for the application.

*Implicit* architectural characteristics are factors that influence an architect's decisions but aren't explicitly called out in the requirements. Security is often an implicit architectural characteristic: even if it isn't mentioned in the requirements, architects know that we shouldn't design an insecure system.

You must use your knowledge of the problem domain to uncover these architectural characteristics during the analysis phase. For example, a high-frequency trading firm may not specify how critical it is for transactions to complete within milliseconds, but the architects in that problem domain know how important this is.

![](_page_85_Picture_14.jpeg)

![](_page_85_Picture_15.jpeg)

Q: **What about important things like good internal structure that no one thinks to ask for?**

A: Some implicit architectural characteristics are more subtle, but just as important. For example, architects should pay attention to the application's internal structure as developers create it, to ensure that sloppy coding and other deficiencies don't degrade the longevity of the application. However, virtually no requirements list will specify "Don't mess up the internal modularity of the system as you build it!" or "Make sure the software is maintainable!"

# <span id="page-86-0"></span>The International Zoo of "-ilities"

Like the animals in a zoo, architectural characteristics exist along a broad spectrum. Just as animals range from primates to reptiles, architectural characteristics range from low-level code characteristics, such as modularity, to sophisticated operational concerns, such as scalability and elasticity. Unfortunately, there is no "universal list" of architectural characteristics, nor are there any real standards for what many of these terms mean (although people have tried). Instead, each organization interprets these terms for itself.

Additionally, the software ecosystem is constantly adding new concepts, terms, measures, and verifications, providing new opportunities to define *even more* architectural characteristics.

Think this is a big list? Check out https://iso25000.com/ index.php/en/iso-25000 standards/iso-25010.

| scalability      | accessibility   | observability |
|------------------|-----------------|---------------|
| availability     | maintainability | testability   |
| interoperability | reusability     | portability   |
| security         | simplicity      | feasibility   |
| stability        | reliability     | usability     |
| agility          | integrity       | performance   |
| traceability     | localizability  | auditability  |

This is not the complete list. There is no complete list!

![](_page_86_Picture_7.jpeg)

**Sam:** We're supposed to define architectural characteristics for Lafter, but I can't seem to find a standard list anywhere.

**Alex:** Gosh, there are so many possibilities...

**Mara:** That's why I like to categorize them. Remember the old zoo maps that broke the zoo into "houses" and "enclosures" for each type of animal? That same kind of categorization can work here. It's sort of like the genus and species of architectural characteristics.

"Ladies and gentlemen, boys and girls, children of all ages—welcome to the International Zoo of '-ilities'!"

![](_page_86_Picture_12.jpeg)

**Operational house**

![](_page_86_Picture_14.jpeg)

**Structural pen**

**Cross-cutting savannah**

**Process enclosure**

## <span id="page-87-0"></span>Process architectural characteristics

**Process architectural characteristics** are where the software development process intersects with software architecture. They reflect the decisions about the mechanics of building software.

![](_page_87_Picture_3.jpeg)

![](_page_87_Picture_4.jpeg)

#### modularity

The degree to which the software is composed of discrete components. Modularity affects how architects partition behavior and organize logical building blocks.

![](_page_87_Picture_7.jpeg)

#### testability

How complete the system's testing is and how easy these tests are to run, including unit, functional, user acceptance, and exploratory tests.

![](_page_87_Picture_10.jpeg)

quality assurance.

![](_page_87_Picture_11.jpeg)

## agility

A composite architectural characteristic that encompasses testability, deployability, modularity, and a host of other architectural characteristics that facilitate and enable agile software development practices.

![](_page_87_Picture_14.jpeg)

![](_page_87_Picture_15.jpeg)

Agility is a composite

architectural characteristic

we'll discuss later in this

chapter-stay tuned!

#### deployability

How easy and efficient it is to deploy the software system.

This is one of the many architectural characteristics that make up "agility."

![](_page_87_Picture_19.jpeg)

## extensibility

How easy it is for developers to extend the system. This may encompass architectural structure, engineering practices, internal design, and governance.

![](_page_87_Picture_22.jpeg)

## decouple-ability

Coupling describes how parts of the system are joined together. Some architectures define how to decouple parts in specific ways to achieve certain benefits; this architectural characteristic measures the extent to which this is possible in a software system.

Yes, we know this is a made— up word. That happens a lot in software architecture!

## <span id="page-88-0"></span>Structural architectural characteristics

Structural architectural characteristics affect the internal structure of the software system, including factors like the degree of coupling between components and the relationships between different integration points.

![](_page_88_Picture_3.jpeg)

![](_page_88_Picture_4.jpeg)

#### security

How secure the system is, holistically. Does the data need to be encrypted in the database? How about for network communication between internal systems? What type of authentication needs to be in place for remote user access?

Security appears in every application, as an implicit or explicit architectural characteristic.

![](_page_88_Picture_8.jpeg)

#### maintainability

How easy it is for architects and developers to apply changes to enhance the system and/or fix bugs.

This is one of those characteristics that belong to more than one category.

![](_page_88_Picture_12.jpeg)

#### extensibility

How easy it is for developers to extend the system. This may encompass architectural structure, engineering practices, internal design, and governance.

Some architectural characteristics cover development concerns rather than purely domain concerns.

Portability can apply to any part of the system, including the user interface and implementation platform.

![](_page_88_Picture_17.jpeg)

Another flavor \_ of localization is

(il8n).

internationalization

## portability

How easy it is to run the system on more than one platform (for example, Windows and macOS).

![](_page_88_Picture_20.jpeg)

#### localization

How well the system supports multiple languages, units of measurement, currencies, and other factors that allow it to be used globally.

# <span id="page-89-0"></span>Operational architectural characteristics

*Operational architectural characteristics* represent how architectural decisions influence what operational team members can do.

![](_page_89_Picture_3.jpeg)

#### availability

What percentage of the time the system needs to be available and, if 24/7, how easy it is to get the system up and running quickly after a failure.

Usually represented as a number of "nines" (99.999% uptime = 5 nines, a bit under 6 minutes/year).

![](_page_89_Picture_7.jpeg)

A good example of the axiom that you can take any adjective and add "-ility" to make a new architectural characteristic!

![](_page_89_Picture_9.jpeg)

## recoverability

How quickly the system can get online again and maintain business continuity in case of a disaster. This will affect the backup strategy and requirements for duplicated hardware.

![](_page_89_Picture_12.jpeg)

#### robustness

The system's ability to handle errors and boundary conditions while running, such as if the power, internet connection, or hardware fails.

When these are important, they are very important.

![](_page_89_Picture_16.jpeg)

## reliability/safety

Whether the system needs to be fail-safe, or if it is mission critical in a way that affects lives. If it fails, will it endanger people's lives or cost the company large sums of money? Common for medical systems, hospital software, and airplane applications.

![](_page_89_Picture_19.jpeg)

#### performance

How well the system achieves its timing requirements using the available resources.

As you will see shortly, "performance" has many different aspects.

Some "-ilities" are easier to achieve than others. This one is often difficult.

![](_page_89_Picture_24.jpeg)

#### scalability

How well the system performs and operates as the number of users or requests increases.

Our Lafter application will definitely need this!

# <span id="page-90-0"></span>Cross-cutting architectural characteristics

As much as we'd like a nice, orderly zoo of architectural characteristics, platypuses still show up! Lots of important characteristics defy categorization.

![](_page_90_Picture_3.jpeg)

#### security

How secure the system is, holistically. Does the data need to be encrypted in the database? How about for network communication between internal systems? What type of authentication needs to be in place for remote user access?

This is one of those architectural characteristics that are always present. It also concern.

![](_page_90_Picture_7.jpeg)

![](_page_90_Picture_8.jpeg)

#### legal

How well the system complies with local laws about data protection and about how the application should be built or deployed.

![](_page_90_Picture_11.jpeg)

security.

Authentication

are aspects of

and authorization

#### authentication/authorization

How well the system ensures users are who they say they are and makes sure they can access only certain functions within the application (by use case, subsystem, web page, business rule, field level, etc.).

![](_page_90_Picture_14.jpeg)

#### privacy

How well the system hides and encrypts transactions so that internal employees like data operators, architects, and developers cannot see them.

Many government agencies around the world require a baseline level of accessibility.

![](_page_90_Picture_18.jpeg)

## accessibility

How easy is it for all your users to access the system, including those with disabilities, like colorblindness or hearing loss.

![](_page_90_Picture_21.jpeg)

This is a great example of how ambiguous architectural characteristics can be: "usability" can also refer to user experience design.

Many countries and regions

have strict laws governing

for international

applications tricky.

privacy, making consistency

## usability

How easy is it for users to achieve their goals. Is training required? Usability requirements need to be treated as seriously as any other architectural issue.

# Who Does What

<span id="page-91-0"></span>So many architectural characteristics! We had a nice database that listed the ones that are most important for Lafter, along with their definitions, but somehow the index became corrupted and we lost the linkage. Can you help restore them by drawing a line from each architectural characteristic to its definition?

| scalability     | Describes how well the components in the system create well-defined<br>groupings and boundaries between components.          |
|-----------------|------------------------------------------------------------------------------------------------------------------------------|
| deployability   | The system's ability to recover from problems such as a power, internet<br>connection, or hardware failure.                  |
| modularity      | How easy is it for all users to access the system, including those with disabilities<br>like colorblindness or hearing loss. |
| robustness      | How easy it is for architects and developers to apply changes to enhance the<br>system and/or fix bugs.                      |
| accessibility   | Describes how well the system handles a large number of<br>concurrent<br>users while maintaining reasonable performance.     |
| maintainability | Describes the cadence, efficiency, and reproducibility of<br>deployments.                                                    |

**Solution on page 74**

# there are no Dumb Questions

## Q: **Where can I find a standard list of architectural characteristics?**

A: No standard list really exists (despite several futile efforts) because the software development ecosystem constantly shifts and changes. Anyone trying to create a standard list is trying to hit a moving target.

# Q:**Isn't security required for every application?**

A: It depends! While it's a common concern, if you design a free intra-office lunch-ordering system, the only security concern lies with others finding out that you order an egg salad sandwich every day.

# Q:**Doesn't every application require availabilty?**

A: You guessed it—it depends! Again, availability is a common concern for most applications, but if the mythical sandwichordering system mentioned above fails, the only real downside is that everyone has to get their own lunch.

## Q:**Can I choose any combination of architectural characteristics for my application?**

A: Some architectural characteristics oppose one another. For example, architects find it challenging to design for both high performance and scalability. Determining the most important architectural characteristics for a system is only part of the design process. Combining them with logical component design will point you to an appropriate architectural style.

## Q:**What does it mean if you don't choose an architectural characteristic like availability in your requirements?**

A: The architectural characteristics you choose provide a guideline for the appropriate architectural style. If an architect doesn't choose availability, it doesn't mean they will purposefully design the system to have poor availability. Rather, it's an indication of priority: trading off one architectural characteristic for another.

<span id="page-93-0"></span>![](_page_93_Picture_1.jpeg)

# **Exercise**

Welcome to "Take It or Leave It!" The rules of this game are simple—we'll give you a business requirement that might come up for the Lafter application, and two architectural characteristics. As you know, everything in architecture is a trade-off, so if you attempt to optimize one, you probably won't do as well with the other. Your job is to tell us which characteristic you rate as a higher priority for that requirement. You'll find our thoughts at the end of the chapter.

"We need to get this to market ASAP!" fault tolerance agility

"Money's tight, folks!" scalability simplicity

"Oh, wow, this conference is going to be our biggest yet." high availability maintainability

"We want to start storing users' credit card information." security recoverability

"This site is going to be very popular upon launch." agility elasticity

**Solution on page 75**

![](_page_93_Picture_10.jpeg)

# **Geek Note**

The software architecture world lacks a standard term for what we call *architectural characteristics*. Here are some of the terms people often use, and why we don't care for them.

Most teams still call them *nonfunctional requirements*, which is misleading because architectural characteristics are indeed functional—they just don't concern the domain. Calling them nonfunctional downplays their importance. Other teams call them *system quality attributes,* which implies an activity that happens at the end of the project rather than the beginning. Another common name is *cross-cutting requirements,* which is the one we dislike the least—but it contains the word *requirement*, which entangles it with domain behaviors, which come from requirements, as opposed to *capabilities*, which are defined by architectural characteristics.

I see that there are lots of architectural characteristics... but how do I know which ones are critical or important to my project?

<span id="page-94-0"></span>![](_page_94_Picture_2.jpeg)

Recall that some architectural characteristics architectural characteristics are "implicit." Many implicit characteristics emerge from these two sources.

**Architectural characteristics don't just appear out of thin air.** In fact, there are three different sources from which you should look to derive them.

# 1 The problem domain

Part of your job is analyzing a problem to determine what architectural characteristics the system requires. Many structural design decisions come directly from the problem domain.

## 2 Environmental awareness

Many requirements come from having a good understanding of the environment in which you're operating. For example, are you working for a fast-moving startup, or a large enterprise with a lot at stake?

## 3 Holistic domain knowledge

Sure, you're working with a particular problem domain—but we can assure you that the domain is a lot bigger than your particular focus. Let's say you're building out a payment system. While understanding what's required of you is important, you'll reveal architectural characteristics if you understand the financial world, finance industry regulations, and customers' habits.

Let's look at each of these sources in turn.

# <span id="page-95-0"></span>Sourcing architectural characteristics from the problem domain

Architects derive many of the necessary architectural characteristics from the problem domain—it is, after all, the motivation for writing the software in the first place. That means you must *translate* the items stated in requirements documents into their corresponding architectural characteristics. For example, the Lafter requirements specify "thousands of users." As an architect, you must dig deeper to more accurately determine how many users are expected (scalability), how many of them will be there at the same time (concurrency), and how rapidly they'll show up (elasticity).

![](_page_95_Picture_3.jpeg)

# **Exercise**

Domain requirements are often a rich source of architectural characteristics. For example, our Lafter application needs to support large numbers of users, so scalability will be one necessary characteristic. Can you uncover more? Here are the requirements again:

**Users:** hundreds of speakers, thousands of users

**Requirements:**

| Users can register for usernames and approve the privacy policy                                             |
|-------------------------------------------------------------------------------------------------------------|
| Users can add new content on Lafter as a “Joke” (long-form post) or “Pun” (short-form post)                 |
| Followers can “HaHa” (indicating strong approval) or “Giggle” (a milder approval message) content they like |
| Speakers at Sillycon Symposia events have a special icon                                                    |
| Speakers can host forums on the platform related to their content                                           |
| Users can post messages of up to 281 characters                                                             |
| Users can also post links to external content                                                               |

**Additional Context:**

| International support                                    |
|----------------------------------------------------------|
| Very small support staff                                 |
| “Bursty” traffic: extremely busy during live conferences |

**Architectural characteristics**

| Scalability         |
|---------------------|
|                     |
|                     |
|                     |
|                     |
|                     |
|                     |
| Solution on page 76 |

# <span id="page-96-0"></span>Sourcing architectural characteristics from environmental awareness

You know a lot about where you work (maybe too much, in some cases!), and that will naturally drive your architectural characteristics analysis. For example, an architect working for a fast-moving startup will prioritize agility whether it is specified or not.

It is important to understand *organizational priorities* so we can make more durable decisions. For example, let's say we must decide how to integrate two subsystems. The choices are a customized but highly suited protocol or an industry-standard protocol that will require a little more effort. In a vacuum, we might choose the first. However, if we know that the organization's goal is to engage heavily in mergers with other companies, that fact could tip our decision toward the more open solution.

Sorry, but this means you're going to have to start paying attention in those business prioritization meetings!

Architects can't make decisions in a vacuum— context is always important.

Some architects stay within particular domains exactly because they have the advantage of domain knowledge.

# Sourcing architectural characteristics from holistic domain knowledge

You have also no doubt absorbed a lot of *domain knowledge*: information that isn't explicitly spelled out in the requirements but that you implicitly understand about important aspects of the domain.

Suppose Lafter has decided to run a promotion at a local university to entice students to sign up (they go to a lot of conferences, and some of them have a sense of humor). We need to design an application that handles signups for the promotion day. To make the math easy, assume that the school has 1,000 students and they have 10 hours to sign up. Should we design the system using a consistent scale, implicitly assuming that the students will distribute themselves evenly during the sign-up process? (Have we *met* any university students?)

Based on real-world experience, we can guess that this won't work. Think about what you know about the target demographic. Some students are hyperdiligent; some tend to procrastinate. Thus, the actual design must handle an elastic burst of students in the first hour (as the Type A individuals rush to get in line), stay mostly idle for the bulk of the day, and then handle another elastic burst just before the sign-up window closes, to accommodate all the stragglers.

Architects must make use of all available information sources to understand the full range of trade-offs inherent in our architectural decisions.

Never underestimate some university students' ability to procrastinate.

One of the most dangerous discoveries in life is how much you can procrastinate and still (mostly) get the job done.

<span id="page-97-0"></span>![](_page_97_Picture_1.jpeg)

#### **Solutions versus requirements**

Customers often come to architects with *solutions* rather than requirements. For example, back in the 1970s, the US Air Force commissioned a fighter jet and included a requirement that it be capable of achieving speeds up to Mach 2.5. The designers

tried, but the technology of the time just wasn't sufficient to meet the requirement. They went back to the Air Force and asked: "Why does it need to go Mach 2.5?" The answer was, "Well, these things are expensive, so we want it to be able to flee a fight if necessary." With that knowledge in mind, they went back and designed the F-16 fighter jet. It had a maximum speed of Mach 2.1, but it was the most maneuverable and fastest-accelerating jet ever created.

When users bring us solutions rather than requirements, it's architects' job to imitate an annoying toddler and keep asking "But why?!?" enough times to uncover the *actual* requirements hidden within the solutions.

![](_page_97_Picture_6.jpeg)

# **Exercise**

It's sometimes difficult to distinguish requirements from solutions. Here are some responses you might get when you ask "why?" that could indicate something might be one or the other. Can you identify which indicate requirements and which solutions?

requirements and which solutions?"We need a system to track user preferences and customizations, then save them between sessions."

| requirement | solution |
|-------------|----------|
|-------------|----------|

"Do we really need to build our own survey service? Surely we can find one that does what we need."

| requirement | solution |
|-------------|----------|
|-------------|----------|

"An enterprise service bus would solve some of our current problems (albeit with some changes and work-arounds) and it offers extreme extensibility."

| requirement | solution |
|-------------|----------|
|-------------|----------|

"According to the friendly sales rep, this software package does all the things accounting needs, now and in the near future."

| requirement | solution |
|-------------|----------|
|-------------|----------|

Solution on page 77

# <span id="page-98-0"></span>Composite architectural characteristics

**Alex:** The business analyst asked if we can make sure the system is "reliable." What do they mean?

**Sam:** Wow, I can think of a lot of ways to define "reliable" for a piece of software.

**Mara:** This happens a lot. A *composite* is a combination of two or more things, and often architectural characteristics combine with each other to create (seemingly) new ones. We call these *composite architectural characteristics*.

What does *reliable* mean? We can measure many different aspects of reliability, like how available the system is, how consistent the user interface workflows are, and how well it handles data integrity.

**Alex:** How do I identify these?

**Mara:** To identify composites, ask: "Can I objectively measure this architectural characteristic?" While we often discuss performance as a single value, it's actually a composite—because we have to be more specific to get to something measurable. An example of a measurable architectural characteristic is *first contentful paint*, which measures the time it takes for a web page to load on a mobile device.

Usability

![](_page_98_Picture_8.jpeg)

# <span id="page-99-0"></span>Priorities are contextual

It's impossible to choose the same set of architectural characteristics for every project. The set of architectural characteristics you choose for a particular application, and how you prioritize each one, will differ based on context.

**Sharpen your pencil**

Context matters. At the top, we've listed several architectural characteristics. Below that are three application scenarios. For each scenario, rank each characteristic based on how important it is for that type of application. *Hint: Some applications won't need all of them.*

Scalability
Security
Extensibility
Data integrity
Performance

| Scenario #1                               | Scenario #2                                                  | Scenario #3                                                                           |
|-------------------------------------------|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| An ecommerce site in a competitive market | A system for an enterprise whose goal is to grow via mergers | An application to automate standardized testing and grading for university admissions |

| 1 | 1 | 1 |
|---|---|---|
| 2 | 2 | 2 |
| 3 | 3 | 3 |
| 4 | 4 | 4 |
| 5 | 5 | 5 |

Solution on page 78Wait a minute. None of the Lafter subject matter experts knows what "scalability" and "elasticity" are. How are they going to know to ask for this stuff?

![](_page_100_Picture_2.jpeg)

You're right to be skeptical about how sophisticated an understanding your coworkers have of architectural concepts. That means you have one more job as an architect: translation!

As much as it would be nice for our colleagues to learn our language, architects are generally the ones who have to translate the business's goals into *identifiable and measurable* architectural characteristics.

![](_page_100_Picture_5.jpeg)

#### <span id="page-101-0"></span>Lost in translation

It's not unusual for business experts and analysts to state (or subtly suggest) a requirement without realizing it, hidden in plain English. It's your job, as a software architect, to read between the lines, find the requirements, and translate them into architectural characteristics. Here are a few examples.

When business analysts and

#### subject matter experts say: translate: Good modularity allows for faster Agility change without "Lafter is constantly changing to meet new Modularity rippling side effects. marketplace demands." Extensibility Performance — We must perform well but also recover quickly "Due to new regulatory requirements, we must Recoverability complete end-of-day processing on time." in case of error. Scalability "The ability to update your Résumé-ability \_\_\_ résumé." Many people would "Our plan is to engage heavily in mergers and Integratability rather not work in a place acquisitions in the next three years." Interoperability undergoing constant mergers. Feasibility "We have a very tight time frame and a fixed Simplicity scope and budget for this project." person characteristic. Affordability Of course, no one would Feasibility-evaluating Architects often ever ask for whether something have a unique this impossible is possible—is an perspective of combination ... underutilized what's possible within ahem. architecture "-ility." a given time frame.

**Software architects** 

Not only do my business analysts not understand the technical terms for architectural characteristics, they ask for way too many things!

![](_page_102_Picture_2.jpeg)

#### More requirements are NOT better.

What happens when an architect takes a list of possible architectural characteristics for Lafter to a group of business users and asks them, "Which of these do you want for the system?"

They invariably answer: "All of them!"

As nice as it would be to be able to accommodate that request, it's not a good idea to try.

Remember, architectural characteristics are *synergistic* with each other and with the problem domain. That means **the more architectural characteristics the system must support, the more complex its design must be.**

When undertaking structural design for a system, architects must find a balance between domain priorities and the architectural characteristics necessary for success.

# <span id="page-103-0"></span>Architectural characteristics and logical components

Before we tell you how to go about trying to balance architectural characteristics with each other and the domain, we want to show you how architectural characteristics and logical components are two sides of the same coin. You see, both of them aim to support the problem domain (also known as the reason you are writing software to begin with).

## Architectural characteristics ≈ capabilities

Architectural characteristics describe the *kinds of capabilities* your solution will support, rather than the *behavior* of the application, which is based on requirements.

![](_page_103_Picture_5.jpeg)

#### Logical components = behavior

Logical components, covered in depth in Chapter 4, represent the design of the system you are attempting to implement in software in order to solve the fundamental problem at hand.

# <span id="page-104-0"></span>Balancing domain considerations and architectural characteristics

Architects use architectural characteristics and logical component analysis to determine the appropriate architectural style, and the Lafter application is no exception. You need to strike a balance between the two.

Imagine the left side to be domain considerations and the right side to be architectural characteristics.

![](_page_104_Picture_4.jpeg)

#### No architectural characteristics

Sometimes we don't take the time to analyze architectural characteristics before designing the system, leading to expensive and time-consuming rework as we discover that our system fails to exhibit the necessary architectural characteristics.

Projects that ignore needed architectural characteristics can deliver failure faster.

Remember, architectural characteristics are synergistic with domain <u>and</u> other architectural characteristics.

#### Good balance between...

In this scenario, we have achieved a balance in our design decisions between architectural characteristics and domain considerations.

![](_page_104_Picture_11.jpeg)

# ...architectural characteristics and domain considerations

This allows us to achieve operational and structural goals without overengineering.

#### Too many architectural characteristics

Unfortunately, architects sometimes retreat to an ivory tower and spend too much time analyzing architectural characteristics, or identifying too many of them to be useful. This leads to overengineering, wasting time and effort that could be spent on implementation and ongoing maintenance.

Many systems that try to support too many architectural characteristics end up with too little space left to support the domain.

![](_page_104_Picture_17.jpeg)

# <span id="page-105-0"></span>Limiting architectural characteristics

When the business stakeholders want *all* of the possible architectural characteristics, how can you limit their enthusiasm?

#### The magical number 7

One useful guideline for the conversation between architects and business analysts is to **limit the number of architectural characteristics they can choose to seven**. Why seven? Psychological research indicates that people remember items in chunks of seven (one of the reasons that early phone numbers were seven digits). It's also large enough to provide some variety without creating a paradox of choice by offering too many.

We created a worksheet to help architects work with other stakeholders to arrive at a reasonable number. This is a demo; you'll get to use it on the next page.

"The Magical Number Seven, Plus or Minus Two: Some Limits on Our Capacity for Processing Information" is a famous paper from 1956 by Psychologist George Miller.

Once you've settled on the most important driving characteristics, you get to pick three. Just put 1,2, and 3 next to the ones that matter the most to you.

| Top 3                    | Driving Characteristics | Implicit Characteristics |
|--------------------------|-------------------------|--------------------------|
| <input type="checkbox"/> |                         | feasibility (cost/time)  |
| <input type="checkbox"/> |                         | security                 |
| <input type="checkbox"/> |                         | maintainability          |
| <input type="checkbox"/> |                         | observability            |
| <input type="checkbox"/> |                         |                          |
| <input type="checkbox"/> |                         |                          |
| <input type="checkbox"/> |                         |                          |

Driving characteristics are architectural characteristics that drive important design decisions.Implicit characteristics become driving characteristics if they influence structural decisions.We've found these four to be pretty common implicit characteristics. Feel free to replace these with whatever makes sense for you.Sharpen your pencil

On page 60, you identified architectural characteristics for Sillycon Symposia's social media application, Lafter. To make sure you've achieved a good balance, limit your list to seven characteristics. Then, check the boxes next to the top three most important.

| Top 3                    | Driving Characteristics                                                                                                                         | Implicit Characteristics |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
| <input type="checkbox"/> |                                                                                                                                                 | feasibility (cost/time)  |
| <input type="checkbox"/> |                                                                                                                                                 | security                 |
| <input type="checkbox"/> |                                                                                                                                                 | maintainability          |
| <input type="checkbox"/> |                                                                                                                                                 | observability            |
| <input type="checkbox"/> | These are implied characteristics. Move them to the Driving Characteristics column if you think they are critical to the success of the system. |                          |
| <input type="checkbox"/> |                                                                                                                                                 |                          |

Pick the top three most important ones (in any order).

**Possible Candidate Architectural Characteristics**

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

Solution on page 79

# **Bullet Points**

- *Architectural characteristics* represent one part of the structural analysis that architects use to design software systems. (We'll talk abou the other part, logical components, in Chapter 4.)
- Architectural characteristics describe a system's capabilities.
- Some architectural characteristics overlap with operational concerns (such as availability, scalability, and so on).
- There are many catagories of architectural characteristics. No one can make a comprehensive list, because the software development ecosystem is constantly changing.
- When identifying architectural characteristics, architects look for factors that influence structural design.
- Architects should be careful not to specify too many architectural characteristics, because they are *synergistic*—changing one requires other parts of the system to change.
- Some architectural characteristics are *implicit*: not explicitly stated in requirements, yet part of an architect's design considerations.

- Some architectural characteristics may appear in multiple categories.
- Many architectural characteristics are *cross-cutting*: they interact with other parts of (and decisions in) the organization.
- Architects must derive many architectural characteristics from requirements and other domain design considerations.
- Some architectural characteristics come from *domain and/or environmental knowledge*, outside of the requirements of a specific application.
- Some architectural characteristics are *composites*: they consist of a combination of other architectural characteristics.
- Architects must learn to translate "business speak" into architectural characteristics.
- Architects should limit the number of architectural characteristics they consider to some small number, such as seven.

![](_page_108_Picture_1.jpeg)

# **Characteristics Crossword**

Ready to have some fun and test your knowledge about what you've learned? Try this crossword puzzle about architectural characteristics.

![](_page_108_Picture_4.jpeg)

#### Across

\_\_\_\_\_

| 3. An architectural characteristic that might be implicit |
|-----------------------------------------------------------|
|-----------------------------------------------------------|

- 4. \_\_\_\_\_ engineering is an architectural problem
- 8. Choosing architectural characteristics means assigning each one a \_\_\_\_\_
- 9. Magic number of characteristics to ask for
- 11. A nonfunctional requirement is also called an architectural

| 15. Some architectural characteristics are _______-cutting |
|------------------------------------------------------------|
|------------------------------------------------------------|

- 17. What architects should ask when users suggest solutions instead of requirements
- 18. A system might need to \_\_\_\_\_ up and down to meet demand
- 19. \_\_\_\_\_ tolerance is an architectural demand

#### Down

1. Uneven traffic often comes in \_\_\_\_\_ 2. A Lafter post can be a "joke" or a "\_\_\_\_\_" 3. Architectural characteristics influence the system's \_\_\_\_\_ 5. Architectural characteristics can be explicit or \_\_\_\_\_ 6. \_\_\_\_\_ integrity is an architectural characteristic 7. A site with large numbers of \_\_\_\_\_ users might need to be scalable 10. Many governments regulate data \_\_\_\_\_ 12. An architectural characteristic is critical or important to the system's \_\_\_\_\_ 13. Combining architectural characteristics and logical components gives you an architectural \_\_\_\_\_ 14. The thing you're writing software about 16. Web page loading time is often called "first contentful \_\_\_\_\_"

#### **Solution on page 80**

# Who Does What Solution

<span id="page-109-0"></span>So many architectural characteristics! We had a nice database that listed the ones that are most important for Lafter, along with their definitions, but somehow the index became corrupted and we lost the linkage. Can you help restore them by drawing a line from each architectural characteristic to its definition?

scalability Describes how well the components in the system create well-defined groupings and boundaries between components. deployability The system's ability to recover from problems such as a power, internet connection, or hardware failure. modularity How easy is it for all users to access the system, including those with disabilities like colorblindness or hearing loss. robustness How easy it is for architects and developers to apply changes to enhance the system and/or fix bugs. accessibility Describes how well the system handles a large number of concurrent users while maintaining reasonable performance. maintainability Describes the cadence, efficiency, and reproducibility of deployments.

![](_page_110_Picture_2.jpeg)

Welcome to "Take It or Leave It!" The rules of this game are simple—we'll give you a business requirement that might come up for the Lafter application, and two architectural characteristics. As you know, everything in architecture is a trade-off, so if you attempt to optimize one, you probably won't do as well with the other. Your job is to tell us which characteristic you rate as a higher priority for that requirement.

| "We need to get this to market ASAP!"                      | fault tolerance   | agility         |
|------------------------------------------------------------|-------------------|-----------------|
| "Money's tight, folks!"                                    | scalability       | simplicity      |
| "Oh, wow, this conference is going to be our biggest yet." | high availability | maintainability |
| "We want to start storing users' credit card information." | security          | recoverability  |
| "This site is going to be very popular upon launch."       | agility           | elasticity      |

![](_page_111_Picture_2.jpeg)

Domain requirements are often a rich source of architectural characteristics. For example, our Lafter application needs to support large numbers of users, so scalability will be one necessary characteristic. Can you uncover more? Here's what we came up with.

**Users:** hundreds of speakers, thousands of users **Requirements**: Users can register for usernames and approve the privacy policy Users can add new content on Lafter as a "Joke" (long-form post) or "Pun" (short-form post) Followers can "HaHa" (indicating strong approval) or "Giggle" (a milder approval message) content they like Speakers at Sillycon Symposia events have a special icon Speakers can host forums on the platform related to their content Users can post messages of up to 281 characters Users can also post links to external content **Additional Context**: International support Very small support staff "Bursty" traffic: extremely busy during live conferences Scalability Elasticity Authorization Authentication Internationalization Customizability **Architectural characteristics**

![](_page_112_Picture_2.jpeg)

It's sometimes difficult to distinguish requirements from solutions. Here are some responses you might get when

It's sometimes difficult to distinguish requirements from solutions. Here are some responses you might get when you ask "why?" that indicate something might be one or the other. Can you identify which indicate requirements and which solutions?

| "We need a system to track user preferences and customizations, then save them between sessions."                                                    | <span><span style="text-decoration: overline;">☑</span> requirement</span> <span>☐ solution</span> |
|------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| "Do we really need to build our own survey service? Surely we can find one that does what we need."                                                  | <span><span style="text-decoration: overline;">☑</span> requirement</span> <span>☐ solution</span> |
| "An enterprise service bus would solve some of our current problems (albeit with some changes and workarounds) and it offers extreme extensibility." | <span>☐ requirement</span> <span><span style="text-decoration: overline;">☑</span> solution</span> |
| "According to the friendly sales rep, this software package does all the things accounting needs, now and in the near future."                       | <span>☐ requirement</span> <span><span style="text-decoration: overline;">☑</span> solution</span> |

![](_page_113_Picture_1.jpeg)

Context matters. At the top, we've listed several architectural characteristics. Below that are three application scenarios. For each scenario, rank each characteristic based on how important it is for that type of application. *Hint: Some applications won't need all of them.* Here are our rankings.

| Scalability | Extensibility  | Performance |
|-------------|----------------|-------------|
| Security    | Data integrity |             |

Scenario #1
An ecommerce site in a competitive market

| 1 | Security    |
|---|-------------|
| 2 | Performance |
| 3 | Scalability |
| 4 |             |
| 5 |             |

Scenario #2
A system for an enterprise whose goal is to grow via mergers

| 1 | Extensibility |
|---|---------------|
| 2 | Scalability   |
| 3 |               |
| 4 |               |
| 5 |               |

Scenario #3
An application to automate standardized testing and grading for university admissions

| 1 | Data integrity |
|---|----------------|
| 2 | Security       |
| 3 | Performance    |
| 4 |                |
| 5 |                |

![](_page_114_Picture_2.jpeg)

On page 60, you identified architectural characteristics for the Sillycon Symposia Lafter social media application. To make sure you have achieved a good balance, limit the number to seven. Then, check the boxes next to the top three most important.

| Top 3 Driving Characteristics                                    | Implicit Characteristics                                                                  |
|------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| <span style="text-decoration: overline;">☑</span> Scalability    | feasibility (cost/time)                                                                   |
| <span style="text-decoration: overline;">☑</span> Security       | security                                                                                  |
| ☐Elasticity                                                      | maintainability                                                                           |
| <span style="text-decoration: overline;">☑</span> Responsiveness | observability                                                                             |
| ☐Performance                                                     |                                                                                           |
| ☐Portability                                                     | Remember, no single correct answer exists. The question is: can you justify your choices? |
| ☐Accessibility                                                   |                                                                                           |

Possible Candidate Architectural Characteristics

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

![](_page_115_Picture_1.jpeg)

# **Characteristics Crossword Solution**

**From page 73**

![](_page_115_Figure_4.jpeg)

# the two laws of software architecture **3** Everything's a Trade-Off

![](_page_116_Picture_3.jpeg)

**What happens when there are no "best practices"?** The nice thing about best practices is that they're relatively risk-free ways to achieve certain goals. They're called "best" (not "better" or "good") for a reason—you know they work, so why not just use them? But one thing you'll quickly learn about software architecture is that it has no best practices. You'll have to analyze every situation carefully to make a decision, and you'll need to communicate not just the "what" of the decision, but the "why."

So, how *do* you navigate this new frontier? Fortunately, you have the laws of software architecture to guide you. This chapter shows you how to analyze trade-offs as you make decisions. We'll also show you how to create architectural decision records to capture the "hows" and "whys" of decisions. By the end of this chapter, you'll have the tools to navigate the uncertain territory that is software architecture.

# It starts with a sneaker app

Archana works for Two Many Sneakers, a company with a very successful mobile app where shoe collectors ("sneakerheads") can buy, sell, and trade collectible sneakers. With millions of shoes listed, customers can find the shoes they really want or upload photos to help sell the ones they don't.

The app's initial architecture was a single service as shown below:

![](_page_117_Picture_4.jpeg)

Two Many Sneakers' slogan: You only have two feet, but you can never have too many sneakers!

![](_page_117_Figure_6.jpeg)

The Two Many Sneakers app knows to talk to the trading service to fetch and update data (like a photo of a mint-condition pair of Nikes). The trading service, in turn, fetches data and updates the database.

Business is booming. Sneakerheads are always willing to change up their collections, and Two Many Sneakers' customer base has grown quickly. Now customers are demanding real-time notifications, so they'll know whenever someone lists a pristine pair of those Air Jordans they've been pining for.

<span id="page-118-0"></span>**Security** is always a concern in online sales. Nobody wants knockoffs, and credit card numbers need to be protected. To stay a few steps ahead of any scammers, Two Many Sneakers' management team wants to prioritize improving the app's *fraud detection* capabilities. They plan to use data analytics to help detect fraud by spotting anomalies in user behavior and filtering out bots.

Work has already begun—all the team needs to do now is set up the trading service to notify the new notification and analytics services anytime something of interest happens in the app.

The database is New Air Jordans just still part of the got listed? Inform architecture. We everyone interested just left it out in with an update. this diagram. Notification Service Trading Service Analytics Service Any and all trades need to be sent to the analytics service. Nobody likes being scammed.

Piece of cake! I'll just use messaging to inform the notification and analytics services every time a new pair of shoes is listed on the app.

Genius!

![](_page_118_Picture_5.jpeg)

## What do we know so far?

We need to figure out how these services will communicate with one another. Let's recap what we know (and don't know) so far:

 The current architecture is rather simple—the trading service talks to its own database, and that's that. We need the trading service to send information to the notification service and the analytics service.

![](_page_119_Picture_4.jpeg)

• Word in the office is that there's a chance that the finance department (which is responsible for compliance) will want updates from the trading service. In other words, whatever architecture we come up with will need to be *extensible*.

![](_page_119_Picture_6.jpeg)

• We don't know what data to send the notification and analytics services—do the two services get the same kind of data, or wildly different data? And we don't know where things stand with finance, so that's another unknown.

```
{
    "sellerId": 12345,
    "buyerId": 6789,
    "itemId": 1492092517,
    "price": "$125.00"
}
```

To be clear, there are some things we know and plenty we don't. Welcome to the world of software architecture.

Speaking of architecture, we'll be done, say, next Thursday—right?

As the system's architects, we need to identify its architectural characteristics. (You learned about those in Chapter 2.)

<span id="page-120-0"></span>![](_page_120_Picture_1.jpeg)

# **Exercise**

Which of the following architectural characteristics stand out as important for this particular problem? *Hint: There are no right answers here, because there is a lot we don't know or aren't sure of yet.* Take your best guess—we've provided our solution at the end of this chapter. We'll get you started:

![](_page_120_Picture_4.jpeg)

Lots of downstream services need to know about sneaker trades. This sounds important!

**modularity**

**upgradability**

**low coupling**

**security**

**performance**

**Solution on page 116**

# **Brain Power**

All the characteristics in the previous exercise sound pretty good, right? Seriously, who'd say no to upgradability?

But for each one, ask yourself *is this characteristic critical to the project's success?* Or is it a nice-to-have?

What's more, some characteristics *conflict*. A highly secure application with loads of encryption and secure connections probably won't be highly performant. Go back and see if any of your choices are at odds. If so, you can only pick one.

> Flashback to Chapter 2? You bet it is!

# there are no Dumb Questions

Q: **Even this simple exercise seems to have a lot of moving parts. We know some things, we think we know some other things, and there's a lot that we certainly don't know. How do we go about thinking about architecture?**

A: You're right. In almost all real-life scenarios, your list of architectural characteristics will probably contain a healthy mix of "this is what we want" and "this is something we *might* want." Even your customers can't answer the question of what they will *eventually* want. (Wouldn't that be nice?) This is the "stuff you don't know you don't know," also known as the "unknown unknowns."

It's not unusual for an "unknown unknown" to rear its head midway through a project and derail even the best-laid plans. The solution? *Embrace agility*  and its iterative nature. Realize that nothing, particularly software architecture, remains static. What worked today might prove to be the biggest hurdle to success tomorrow. That's the nature of software architecture: it constantly evolves and changes as you discover more about the problem and as your customers demand more of you.

# <span id="page-121-0"></span>Communicating with downstream services

Our goal is to get the trading system to notify the reporting and analytics systems automatically. For now, let's assume we decide to use messaging. But that presents a dilemma—should our messaging use queues or topics?

Before we go further, let's make sure we're on the same page about the differences between queues and topics. Most messaging platforms offer two models for a *publisher* of a message (in this case, that's the trading service) to communicate with one or more *consumers* (the downstream services).

The first option is a *queue*, or a point-to-point communication protocol. Here, the publisher knows who is receiving the message. To reach multiple consumers, the publisher needs to send a message to one queue for each consumer. If the trading service wants to use queues to tell the analytics service and the reporting service about trades, this is what the setup will look like:

![](_page_121_Picture_5.jpeg)

When using the second option, *topics*, you are signing on for a *broadcasting* model. The publisher simply produces and sends a message. If another service downstream wants to hear from the publisher, it can *subscribe* to the topic to receive messages. The publisher doesn't know (or care) how many services are listening.

It's OK if you don't know much about messaging, queues, or topics. We'll tell you what you need to know.

If it helps, think of queues as being like a group text—you pick everyone you want to inform, type your message, and hit "send."

Topics are similar to posting a picture on your go—to social networking site. Anyone following you will see that picture, since they've "subscribed" to your timeline.

![](_page_121_Figure_10.jpeg)

Both options sound good—so how do we pick? Let's find out.

# <span id="page-122-0"></span>Analyzing trade-offs

You can't have your cake and eat it too. The world is full of compromises—we often optimize for one thing at the cost of another. Want to take and store lots of pictures on your phone? Either get more storage, which costs more, or compress them, which lowers the image quality.

Software architecture is no different. Every choice you make involves significant compromises or, as we like to call them, *trade-offs*. So what exactly does this mean for you?

If you know which architectural characteristics are most important to your project, you can start thinking of solutions that will maximize some of those attributes. But if a solution lets you maximize one characteristic (or more), it will come at the cost of other characteristics. For example, a solution that allows for great scalability might also make deployability or reliability harder.

No matter what solution you come up with, it will come with trade-offs—upsides and downsides.

Your job is twofold: know the trade-offs associated with every solution you come up with, and then pick the solution that best serves the most important architectural characteristics.

![](_page_122_Picture_7.jpeg)

If this sounds familiar, it should be! It was part of our discussion of significant versus less-significant trade-offs in Chapter 1.

Rich Hickey, creator of the Clojure programming language, once said, "Programmers know the benefits of everything and the trade-offs of nothing." We'd like to add: "Architects need to understand both."

You can't have it all. You'll have to decide which architectural characteristics are most important, and choose the solution that best allows for those characteristics.

# <span id="page-123-0"></span>Trade-off analysis: Queue edition

Trade-off analysis isn't just about finding the *benefits* of a particular approach. It's also about seeking out the *negatives* to get the full picture. Let's look at each option in turn, starting with queues.

With queues, for every service that the trading service needs to notify, we need a separate queue. If the notification service and the analytics service need different information, we can send different messages to each queue. The trading service is keenly aware of every system to which it communicates, which makes it harder for another (potentially rogue) service to "listen in." (That's useful if security is high on our priority list, right?) Oh, and since each queue is independent, we can monitor them separately and even scale them independently if needed.

The trading service is *tightly coupled* to its consumers—it knows exactly how many there are. But we're not sure if we'll need to send messages to the compliance service, too. If that happens, we'll have to rework the trading service to start sending messages to a *third* queue. In short, if we choose queues, we're giving up on extensibility.

![](_page_123_Picture_5.jpeg)

![](_page_123_Figure_6.jpeg)

See what we mean when we say "trade-off analysis"?

# <span id="page-124-0"></span>Trade-off analysis: Topic edition

What about using topics? Well, the upside is clear—the trading service only delivers messages to a topic, and anyone interested in listening for a message from the trading service simply *subscribes* to that topic. Compliance wants in? They can simply subscribe: no need to make any changes to the trading service. Low coupling for the win.

But topics have a few downsides, too. For one thing, *you can't customize the message* for any particular service—it's a one-size-fits-all, take-it-or-leave-it proposition. Scaling, too, is one-size-fits-all, since you have only one thing to scale. And anyone can subscribe to the topic without the trading service knowing—which, in some circumstances, is a potential security risk.

![](_page_124_Picture_4.jpeg)

Back to the whiteboard!

![](_page_124_Figure_6.jpeg)

# Sharpen your pencil

Spend a few minutes comparing the results of our trade-off analysis. Notice how both options support some characteristics but trade off on others? Now we're going to present you with some requirements—see if you can decide if you'd pick queues or topics to support each one.

#### Requirements

"Security is important to us."

Queues / Topics

"Different downstream services need different kinds of information."

Queues / Topics

"We'll be adding other downstream services in the future."

Queues / Topics

Solution on page 116

# <span id="page-125-0"></span>The first law of software architecture

Queues or topics? Enough with the suspense already. The answer is—*it depends!* 

What's important to the business? If *security* is paramount, we should probably go with queues. Two Many Sneakers is growing by leaps and bounds and has loads of other services interested in its sneaker trades, so *extensibility* is its biggest priority. That means we should pick the topic option.

*Time* is also a factor: if we need to get to market quickly, we might pick a simpler architecture (simplicity) over one that offers high availability. (Having an application that guarantees three "nines" of uptime only matters if you have customers, right?)

The key takeaway is that in software architecture, you'll always be balancing trade-offs. That leads us to the *First Law of Software Architecture*.

> **THE FIRST LAW OF SOFTWARE ARCHITECTURE: EVERYTHING IN SOFTWARE ARCHITECTURE IS A TRADE-OFF**

In software architecture, nice, clean lines are rare and there are no "best practices." Every choice you make will involve many factors—often conflicting ones. The First Law is an important lesson, so take it to heart. Write it down on a sticky note and put it on your monitor. Get a backwards tattoo of it on your forehead so you'll see it in the mirror! Whatever it takes.

![](_page_125_Picture_8.jpeg)

One of your authors often sports this T-shirt in public. (If you get any printed, please send us one medium and two extra-large!)

If you find a decision in software architecture that doesn't have a trade-off, you haven't looked at it hard enough.

# <span id="page-126-0"></span>**Sharpen your pencil**

This time, we'd like you to do some trade-off analysis on your own. We chose messaging as the communication protocol between our trading service and its consumers. Messaging is asynchronous. Choosing between asynchronous and synchronous forms of communication comes with its own set of trade-offs! We've given you two whiteboards, one for each form of communication, and we've listed a bunch of "-ilities." We'd like you to consider how each architectural characteristic would work in both contexts. Is this characteristic a pro or a con (or neither) in synchronous communications? What about in asynchronous communications? Place each "-ility" in the appropriate column. *Hint: Not all of them apply to this decision.* We put the first pro on the whiteboard for you. When you're done, you can see our answers at the end of the chapter.

![](_page_126_Figure_3.jpeg)

# there are no Dumb Questions

<span id="page-127-0"></span>l've heard of the Architecture Tradeoff Analysis Method (ATAM). Is that what you're talking about?

ATAM is a popular method of trade-off analysis. With ATAM, you start by considering the business drivers, the "-ilities," and the proposed architecture, which you present to the stakeholders. Then, as a group, you run through a bunch of scenarios to produce a "validated architecture." While ATAM offers a good approach, we believe it comes with certain limitations—one being that it assumes the architecture is static and doesn't change.

Rather than focusing on the process of ATAM, we prefer to focus on results. The objective of any trade-off analysis should be to arrive at an architecture that best serves your needs. You'll

probably go through the process several times as you discover more and more about the problem and come up with different scenarios.

Another popular approach is the Cost Benefit Analysis Method (CBAM). In contrast to ATAM, CBAM focuses on the cost of achieving a particular "-ility."

We recommend you look at both methods and perhaps consider combining them—ATAM can help with trade-off analysis, while CBAM can help you get the best return on investment (ROI).

Just remember—the process is not as important as the goal, which is to arrive at an architecture that satisfies the business's needs.

# It always comes back to trade-offs

Some people always pick a particular technique, approach, or tool regardless of the problem at hand. Often they choose something they've had a lot of success with in the past. Sometimes they have what we affectionately call "shiny object syndrome," where they think that some new technology or method will solve all their problems.

Regardless of past achievements or future promises, just remember—*for every upside*, *there's a downside*. The only questions you need to answer are "Will the upsides help you implement a successful application?" and "Can you live with the downsides?"

Whenever someone sings the praises of a certain approach, your response should be:

"What are the trade-offs?"

To be clear, we aren't saying you shouldn't use new tools and techniques. That's progress, right? Just don't forget to consider the trade-offs as you decide.

# <span id="page-128-0"></span>Making an architectural decision

Debating the pros and cons with your team in front of a whiteboard is fun and all, but at some point, you *must* make an *architectural decision*.

We mentioned architectural decisions in Chapter 1, but let's dive a little deeper. As you architect and design systems, you will be making lots of decisions, about everything from the system's overall structure to what tools and technologies to use. So what makes a decision an *architectural* decision?

In most cases, any choice you make that affects the *structure* of your system is an architectural decision. Here are a couple of example decisions:

To jog your memory, picking whether you'd like a one— or two— story house would be an architectural decision.

We will use a cache to reduce the load on the database and improve performance.

Notice how this decision introduces an additional piece of infrastructure. It's also something the implementing team must keep in the back of their minds when accessing or writing data.

We will build the reporting service as a modular monolith.

This one is pretty obvious— it literally describes the structure of a service.

As we put it in Chapter 1:

"Architectural decisions serve as
guideposts to help development teams
understand the constraints and
conditions of the architecture."

Notice how these decisions act as *guides* rather than rules. They aid teams in making choices, without being too specific. Most (but not all) of the architectural decisions you'll make will revolve around the structure of your systems.

You got it: we're talking about the second dimension of software architecture.

![](_page_128_Picture_13.jpeg)

I believe we have a decision—we're going to split the order shipping service apart from the order tracking service.

![](_page_128_Picture_15.jpeg)

## <span id="page-129-0"></span>What else makes a decision architectural?

Usually, architectural decisions affect the *structure* of an architecture—are we going with a monolith, or will we leverage microservices? But every so often, you might decide to maintain a particular architectural characteristic. If security is paramount, for example, Two Many Sneakers might make a decision like this:

We will use queues for asynchronous communication between services.

This decision isn't about structure—it's driven by the need for security. Since there's a queue for every subscriber, we know who the consumers are.

Recall that topics are a broadcasting mechanism, allowing any service to subscribe and listen in on a topic.

At other times, you might decide on a *specific* tool, technology, or process if it affects the architecture or indirectly helps you achieve a particular architectural characteristic. For example:

We will use Node.js as the development framework for the MVP.

MVP stands for "minimum viable product."

Perhaps you need to get to market quickly, or maybe you have a large pool of engineers with expertise in this particular technology stack.

Everything in this chapter so far has led to this important moment—making an architectural decision. You start with a trade-off analysis. Then you consider the pros and cons of each option in light of other constraints, like business and end user needs, architectural characteristics, technical feasibility, time and budgetary constraints, and even development concerns. Then, *finally*, you can make a decision.

Geek Note

Michael Nygard, author of the book *Release It!* (Pragmatic Programmer), defines an architecturally significant decision as "something that has an effect on how the rest of the project will run" or that can "affect the structure, non-functional characteristics, dependencies, interfaces, or construction techniques" of the architecture. To learn more, we recommend reading his blog post, "Documenting Architecture Decisions" (https://www.cognitect.com/blog/2011/11/15/documenting-architecture-decisions).

<span id="page-130-0"></span>Hold up. Whiteboards are great, but there has to be a more permanant way of recording the trade-off analysis, the decision, and most importantly, why that choice was made. Whiteboards seem awfully temporary, no?

![](_page_130_Picture_2.jpeg)

#### You bring up several good points. It's

important to record our decisions in a more permanent way. In addition, trade-off analysis is an involved process. It'd be a real waste if we lost all that work just because someone got a little hasty with the eraser.

But you make another key observation: while the decision itself is important, *why* we made that decision might be even more important. Which leads us to...

# <span id="page-131-0"></span>The second law of software architecture

Making decisions is one of the most important things software architects do.

Let's say you and your team do a trade-off analysis and conclude that you're going to use a cache to improve your application's performance. The result of your analysis is that your system starts using a cache somewhere. The *what* is easy to spot.

That decision is important, but so are the circumstances in which you made the decision, its impact on the team implementing it, and *why*, of all the options available to you, you chose what you did.

This leads us to the *Second Law of Software Architecture*.

![](_page_131_Picture_6.jpeg)

You see, future architects (or even "future you") might be able to discern what you did and even how you did it—but it'll be very hard for them to tell *why* you did it that way. Without knowing that, they might waste time exploring solutions you've already rejected for good reasons, or miss a key factor that swayed your decision.

This is why we have the Second Law. You need to understand *and* record the "why" of each decision so it doesn't get lost in the sands of time.

So how do we go about *capturing* architectural decisions? We'll dive into that next.

## <span id="page-132-0"></span>Architectural decision records (ADRs)

Do you remember everything you did last week? No? Neither do we. This is why it's important to document stuff—especially the important stuff.

Thanks to the Second Law of Software Architecture, we know we need a way to capture not just the decision, but the reason we made it. Architects use architectural We cannot emphasize decision records (ADRs) to record such decisions because it gives us a specific template to work with.

enough how important keeping these records is.

An ADR is a document that describes a specific architectural decision. You write one for every architectural decision you make. Over time, they'll build up into an architectural decision log. Remember that architectural decisions form the second dimension to describe your architecture. ADRs are the documentation that supports this dimension.

![](_page_132_Figure_6.jpeg)

An ADR has seven sections: Title, Status, Context, Decision, Consequences, Governance, and finally Notes. Every aspect of an architectural decision, including the decision itself, is captured in one of these sections. Let's take a look, shall we?

## Cubicle conversation

![](_page_133_Picture_2.jpeg)

**Alex:** Doing the trade-off analysis between queues and topics took it out of me.

**Mara:** Me too. Trade-off analysis can be arduous, but I'm glad we got it done. This is a big architectural decision. It's crucial that we understand the pros and cons of every choice.

**Sam:** Yeah, yeah. So we decided to use queues, right? Now can we get back to programming?

**Mara:** Slow down a second. You're right—we've made a decision. Now we should record our decision in an ADR.

**Sam:** But why? We already know what we're going to do. That seems like a lot of work.

**Alex:** Look, we know why we chose to go with queues. It's the option that best supports the architectural characteristics we want to maximize in the system, right?

**Mara:** Correct. But while we know why we made that decision, what about anyone else who might come along and wonder why we chose queues over topics, like future employees? *That's* why we should record our thinking.

**Sam:** I can see that being useful.

**Alex:** Great! So can we start drafting our ADR?

Guess what? You're going to be helping the team write their ADR. Keep an eye out for those exercises.

# <span id="page-134-0"></span>Writing ADRs: Getting the title right

Every ADR starts with a *title* that describes the decision. Craft this title carefully. It should be meaningful, yet concise. A good title makes it easy to figure out what the ADR is about, which is especially handy when you're frantically searching for an answer!

Let's dive deeper into what a good ADR title looks like. Imagine a team is writing a service that provides surveys to customers. They've done a trade-off analysis and have decided to use a relational database to store survey results. Here's what their ADR title might look like:

![](_page_134_Picture_4.jpeg)

The title should consist mostly of nouns. Keep it terse: you'll have plenty of opportunities to go into detail later. It should *describe* what the ADR is about, much like the headline of a news article or blog post. Get that right, and the rest will follow.

The title should start with a number—we suggest using three digits, with leading zeros where needed. This allows you to number your ADRs *sequentially*, starting with 001 for your first ADR, all the way to 999. Every time you add a new ADR, you increment the number. This makes it easy for anyone reading your records to know which decisions came before others.

![](_page_134_Picture_7.jpeg)

# there are no Dumb Questions

What happens if we end up writing more than 999 ADRs?

A: That's a lot of ADRs! If that were to happen, you'd need to revise a bunch of titles (and potentially filenames). In our experience, a three-digit prefix is plenty.

Can I reuse an ADR number?

A: Every ADR should get a unique identifier. This makes it easier to reference them without confusion.

More about this when we discuss the Status section.

![](_page_134_Picture_14.jpeg)

## Exercise

In the following exercises, you're going to help the team at Two Many Sneakers write an ADR. They've decided to use asynchronous messaging, with queues between the trading service and downstream services. Assume this is the *12th* ADR the team is writing. What title would you give this ADR? Don't forget to number it! Use this space to jot down your thoughts. You can see what we came up with at the end of this chapter.

Solution on page 118

# <span id="page-135-0"></span>Writing APRs: What's your status?

Great! You've settled on a descriptive title. Next, you'll need to decide on the *status* of your ADR. The status communicates where the team stands on the decision itself.

But wait—isn't the point of the ADR to record a *decision*? Well, kinda. But making decisions is a process.

ADRs do record architectural decisions, but they also act as *documentation*, making it easier to share and collaborate. Others might need to look at or even sign off on an ADR. Let's start by considering the different statuses an ADR can have.

![](_page_135_Picture_5.jpeg)

![](_page_135_Picture_6.jpeg)

## Request for Comment (RFC)

Use this status for ADRs that need additional input—perhaps from other teams or some sort of advisory board. Usually, these ADRs affect multiple teams or address a cross-cutting concern like security. An ADR in RFC status is typically a draft, open for commentary and critique from anyone invited to do so. An ADR in RFC status should *always* have a "respond by" deadline.

This is like planning an evening out. You know you'd like to go out and which friends you want to invite, but you hope they'll suggest a restaurant.

You ask everyone to respond I by Tuesday so you can make reservations. (The deadline is important, since Ted can never make up his mind about anything.)

![](_page_135_Picture_11.jpeg)

## **Proposed**

After everyone has a chance to comment, the ADR's status moves to Proposed. This means the ADR is waiting for approvals. You might edit it or even overhaul the decision if you discover a limitation that makes it a no-go. In other words, you still haven't made a decision, but you're getting there.

You have a plan for the evening, but you haven't hit "send" on the invite yet—just in case the weather turns.

![](_page_135_Picture_15.jpeg)

#### **Accepted**

Does exactly what it says on the tin. A decision has been made, and everyone is on board who needs to be. An Accepted status also tells the team tasked with implementing this decision that they can get started.

Oh yeah. Everyone has RSVP'd. Time to find —a cool outfit!

If there's no need for feedback from others, you can set the ADR's status to Accepted as soon as the decision is made. Most ADRs stay at Accepted, but there is one more status to be aware of: Superseded.

# <span id="page-136-0"></span>Writing APRs: What's your status? (continued)

You've arrived at a decision, which you diligently record in an ADR. Signed, sealed, delivered—vou're done.

But then things change.

Maybe the business is growing and the board decides to focus more on scalability than on time to market. Maybe the company is entering international markets and needs to comply with EU data privacy and retention regulations. Whatever the reason, the decision you made is no longer appropriate. What now?

Well, you write another ADR. The old ADR is *superseded* by the new one, and you record it as such. Suppose the customer survey team realizes that a relational database is no longer fulfilling their needs, so they do another trade-off analysis and decide to switch to a document store. Here are the titles and statuses of the old and new ADRs:

![](_page_136_Figure_6.jpeg)

![](_page_136_Figure_7.jpeg)

Note: We'll be showing you ADR O6B for the rest of the chapter, while you help the Two Many Sneakers team with their ADR.

An accepted ADR can move into Superseded status if a future ADR changes the decision it documents. It's important for both ADRs to highlight which ADR did the *superseding* and which ADR has been *superseded*. This bidirectional linking allows anyone looking at a superseded ADR to quickly realize that it's no longer relevant, and tells them exactly where to look for details on the new decision. Anyone looking at the superseding ADR can follow the link back to the superseded ADR to understand everything involved in solving that particular problem.

Linking ADRs is an important part of a project's "memory." It helps everyone remember what has already been tried.

# there are no Dumb Questions

<span id="page-137-0"></span>Q: **All this superseding and numbering seems overly complicated. Why not just edit the original ADR?**

A: We use a three-digit prefix in the ADR title because it helps sequence things. Let's say ADR 007 no longer applies to your situation, but you've made a bunch of architectural decisions in the meantime. The last ADR in your architectural decision log is ADR 013.

Now you need to reevaluate ADR 007. Say you choose to edit it, as opposed to superseding it with ADR 014. What would happen?

Chronologically speaking, you amend ADR 007 *after* accepting ADR 013. But if someone tried to follow the decision process by reading the ADRs, they'd be seeing them in the wrong order!

Readers might think that the new decision came first. It wouldn't convey that you made one decision and then had to change it for some reason. Giving it a new number makes it clear that the old ADR 007 was no longer relevant after ADR 013. Confused yet?

Q: **So you're telling me that an Accepted ADR is**  *immutable***: once accepted, it is not permitted to change. Is that right?**

A: Look at you! That's exactly it. Except for when the status of an ADR goes from Accepted to Superseded, a decision recorded in an ADR is immutable. Sure, you might edit the ADR to include additional information, but for the most part, other than the status, things shouldn't change much.

![](_page_137_Picture_9.jpeg)

# **Exercise**

In the previous exercise, you hashed out the title of Two Many Sneakers' ADR about using queues for messaging. Let's say you get the green light. Write down the title you chose in the space below and give your ADR a status:

| Title:  |  |
|---------|--|
| Status: |  |

**Three months later:**

Whoops! The requirements have changed. Your latest trade-off analysis reveals that topics would be a better fit.
Everyone has signed off on this, so you need to supersede your ADR with a new ADR. This is the 21st ADR your team
has worked on. Write down the title and the new status of the old ADR:

| Title:  |  |
|---------|--|
| Status: |  |

Now write down the title and status of the newly introduced ADR:

| Title:  |  |
|---------|--|
| Status: |  |

Solution on page 118

# <span id="page-138-0"></span>Writing ADRs: What's your status? (recap)

There's a lot going on with ADR statuses, so we've created a handy visualization to help you out.

![](_page_138_Figure_3.jpeg)

# <span id="page-139-0"></span>Writing APRs: Establishing the context

**Context matters.** Every decision you've ever made, you made within a certain context and with certain constraints. When you chose what to have for breakfast this morning, the context might have included how hungry you were, how your body felt, your lunch plans, and whether you're trying to increase your fiber intake. It's no different for software architecture.

The Context section in the ADR template is your place to explain the circumstances that drove you to make the decision the ADR is capturing. It should also capture any and all factors that influenced your decision. While technological reasons will usually find their way onto this list, it's not unusual to include cultural or political factors to help the reader understand where you're coming from.

![](_page_139_Picture_4.jpeg)

Let's continue working on the ADR we started with in the \_\_\_\_ Status section.

#### Context

We need to simplify how we store customer survey responses. The data currently resides in a relational store, and its rigid schema requirements have become challenging as we evolve the surveys (for example, introducing different or extended surveys for our premium customers).

There are various options available to us, like the JSONB data type in PostgreSQL or document stores such as MongoDB.

The Context section answers the question, "Why did we have to make this choice to begin with?"

Note—we aren't describing our decision just yet! We have a whole section for that.

# Sharpen your pencil

Continue building out the ADR for Two Many Sneakers. Use the space below to write a Context section for the team's decision to use queues for communication between the trading service and other services. (Then compare it with our take at the end of this chapter.)

Solution on page 119

# there are no **Dumb Questions**

What about all that time and effort I spent on the whiteboard? Is that part of the context?

A: If you need to document your trade-off analysis, we suggest you introduce a new section called "Alternatives." In it, list all the alternatives you considered, followed by your lists of pros and cons.

Using a separate section to detail the trade-off analysis delineates it cleanly and avoids cluttering the Context section.

# <span id="page-140-0"></span>Writing ADRs: Communicating the decision

We've finally arrived at the actual decision. Let's start by looking at the customer survey team's completed Decision section:

#### **Decision**

Notice the authoritative voice!

#### We will use a document database for the customer survey.

The marketing department requires a faster, more flexible way to make changes to the customer surveys.

Moving to a document database will provide better flexibility and speed, and will better facilitate changes by simplifying the customer survey user interface.

![](_page_140_Picture_8.jpeg)

The Decision section covers the "why" of the decision itself: remember the Second Law?

If this ADR's status is RFC or Proposed, the decision hasn't been made (yet). Even so, the Decision section starts by *clearly expressing the decision being made*. The tone of the writing should reflect that. It's best to use an authoritative voice when stating the decision, with active phrases like "we will use" (as opposed to "we believe" or "we think").

The Decision section is also the place to explain why you're making this decision, paying tribute to the Second Law of Software Architecture: "Why is more important than how." Future you, or anyone else who reads the ADR, will then understand not just the decision but the *justification* for it.

In the Context section, you explained why this decision was on the table. The Decision section, which immediately follows it, explains the decision itself. Together, they allow the reader to frame the decision correctly.

This is also a great place to list others who signed off on this decision. For example, "The marketing department requires..." is an example of CVA.

"Cover Your Assets"! :)

![](_page_140_Picture_15.jpeg)

#### The ADR is not an opinion piece

Remember that the ADR is not a place for anyone's opinions on the state of things. It's easy to slip into that mode, especially when justifying a decision. Even when explaining context, it can sometimes be hard to stay objective.

Treat an ADR like a journalist treats a news article—stick to the facts and keep your tone neutral.

<span id="page-141-0"></span>![](_page_141_Picture_1.jpeg)

# Exercise

It's time for you to write the Decision section of the ADR for Two Many Sneakers. Here are the main factors the team considered when making their decision:

- · Queues allow for heterogeneous messages.
- · Security is an important architectural characteristic for the stakeholders.

We've given you some space to write out a Decision section, including the corresponding justification. This section should answer the question, "Why queues?" Hint: Be sure to focus on the decision and the "why." See the solution at the end of the chapter for our own take.

Feel free to glance back at did earlier in the chapter to refresh your memory.

Solution on page 119

![](_page_141_Picture_8.jpeg)

I'm not entirely clear on the difference between the context and the "justification" we provide in the Decision section. Aren't those the same thing?

A: Maybe an example will help. Say it's your best friend's birthday, and you and a few others decide to go out to a fancy dinner to celebrate. That's the *context*—the circumstances surrounding the decision you have to make.

Before you decide on the details, you might make a list of possible restaurants (the *alternatives* available to you), thinking about how well the cuisines they offer match everyone's preferences. This would be akin to a trade-off analysis.

You pick a pan-Asian bistro: that's the *decision*. You choose that particular restaurant because its menu has vegetarian and gluten-free options, and it allows anyone with dietary restrictions to make substitutions. That's the *justification* for your decision.

# <span id="page-142-0"></span>Writing ADRs: Considering the consequences

Every decision has *consequences*. Did you work out extra hard yesterday? If so, you might be sore this morning. (But maybe a little bit proud of yourself, too!)

It's important to realize the consequences—good and bad—of architectural decisions and document them. This increases *transparency* by ensuring that everyone understands what the decision entails, including the team(s) affected by it. Most importantly, it allows everyone to assess whether the decision's positive consequences will outweigh its negative consequences.

The consequences of an ADR can be limited in scope or have huge ramifications. Architectural decisions can affect all kinds of things—teams, infrastructure, budgets, even the implementation of the ADR itself. Here's an incomplete list of questions to ask:

- How does this ADR affect the implementing team? For instance, does it change the algorithms? Does it make testing harder or easier? How will we know when we're "done" implementing it?
- Does this ADR introduce or decommission infrastructure? What does that entail?
- Are cross-cutting concerns like security or observability affected? If so, what effects will that have across the organization?
- How will the decision affect your time and budget? Does it introduce costs or save money? Will it take arduous effort to implement or make things easier?
- Does the ADR introduce any one-way paths? (For example, using queues means we can't control the order of messages.) If so, elaborate on this.

**Collaborating with others** is a great way to make sure your assessment is thorough. No matter how hard you think through the consequences of the ADR, you're likely to miss a few things; multiple perspectives will reveal more potential consequences. Here's a sample Consequences section:

Title
Status
Context
Decision
Consequences
Governance
Notes

Time and money are big—be sure to think this one through!

Of course, the ADR might make things simpler and more cost-effective. If so, that's definitely worth highlighting.

Highlight the consequences of the decision for the implementation team.

#### Consequences

Since we will be using a single representation for all surveys, multiple documents will need to be changed when a common survey question is updated, added, or removed.

The IT team will need to shut down survey functionality during the data migration from the relational database to the document database, causing downtime.

It's important to note consequences that might affect customers or users.

<span id="page-143-0"></span>![](_page_143_Picture_1.jpeg)

# Sharpen your pencil

Help the Two Many Sneakers team iron out the Consequences section of their ADR. Here are a few things to think about:

- > A gueue introduces a new piece of infrastructure.
- > The queues themselves will probably need to be highly available.
- Queues mean a higher degree of coupling between services.

There are no right or wrong answers, but if you'd like to see how we approached this, glance at the solution at the end of the chapter.

Solution on page 120

# Brain Power

Think about an architectural decision made in your current project, or one you've worked on in the past. It might be programming language used, the application's structure, or even the choice of database. Can you think of at least two intended consequences and two unintended consequences of that decision?

# <span id="page-144-0"></span>Writing APRs: Ensuring governance

Have you ever made a New Year's resolution that fizzled out before the end of February? Maybe you joined a gym, only to end up paying but never working out? Us too. A decision is only good if you act on it, and if you don't accidentally stray away from it in the future.

Sure, you and your team spent a bunch of time analyzing trade-offs and writing an ADR to record the decision. Now what? How do you ensure that the decision is correctly implemented—and that it stays that way?

This is the role of the Governance section, which is vital in any ADR. Here, you outline how you'll ensure that your organization doesn't deviate from the decision—now or in the future. You could use manual techniques like pair programming or code reviews, or automated means like specialized testing frameworks.

oesn't deviate from the decision—ques like pair programming or testing frameworks.

If the word

"governance" conjures
up ideas of

regulatory compliance,

well, this isn't that.

![](_page_144_Picture_6.jpeg)

One of your authors has written a book called "Building - Evolutionary Architectures" that shows you how to use "fitness functions" for architectural governance. Be sure to pick up a copy. (After you're done with this book, of course!)

These two sections aren't part of the standard ADR template, but we think they add a lot of value.

Title Status

Context

Consequences

Governance

Notes

# Writing APRs: Closing notes

The Notes section contains metadata about the ADR itself. Here's a list of fields we like to include in our ADRs:

- Original author
- Approval date
- Approved by
- Superseded date
- · Last modified date
- · Modified by
- Last modification

This section is handy even if the tool you use to store your ADRs automatically records things like creation and modification dates. Yes, including this information may be repetitive, but making it part of the ADR makes it easier to discover.

![](_page_145_Picture_1.jpeg)

# Exercise

Let's bring it all together! You've been working piecemeal on the ADR for the Two Many Sneakers team. We'd like you to flip back to the past few exercises and copy your ADR sections onto this page to create a full ADR. We've given you the section titles—all you have to do is fill 'em out. (Assume the status to be "Accepted.") You can find our version at the end of the chapter.

| <b>Title</b>        |  |
|---------------------|--|
| <b>Status</b>       |  |
| <b>Context</b>      |  |
| <b>Decision</b>     |  |
| <b>Consequences</b> |  |

And there you have it: a complete ADR in its full glory.

We'll skip Governance and Notes here since they're not part of the standard template.

They grow up so quickly! :') We're so proud of you all.

——► Solution on page 121

# there are no Dumb Questions

## <span id="page-146-0"></span>Q: **I really like the ADR template. But where am I supposed to store my ADRs?**

A: There are lots of options—it all depends on what you and your team are comfortable with, and who else might be interested in reading or contributing to the ADRs.

One option is to store ADRs in plain-text files (or maybe Markdown or AsciiDoc files) in a version-control system like Git. This way, there's a commit history showing any changes to the ADRs. The downside is that nondevelopers don't always know how to access version-controlled documents. If you do choose to store your ADRs this way, we recommend keeping them in a separate repository (as opposed to stuffing them in with your source code). You'll thank us later.

Alternatively, you could use a wiki. Most wikis use a WYSIWYG ("what you see is what you get") editor, so they're accessible to more people. Just be sure that your choice of wiki can track changes. You wouldn't want someone to edit an ADR accidentally without everyone knowing.

Whatever you choose, make sure it's easy to add, edit, and search for ADRs. We've seen too many honest efforts at recording ADRs die just because no one could find the ADRs again if their lives depended on it.

## Q: **My whole team loves Markdown. (Plain text for the win!) Any advice on file naming conventions?**

A: Recall that ADR titles have a three-digit prefix, followed by a very succinct description of the ADR. If you store your ADRs as plain-text files, we recommend using the title as your filename, including the prefix. For example, an ADR with the title "042: Use queues between the trading and downstream services" should be stored in a file named *042-use-queues-between-the-tradingand-downstream-services.md*. We like using all lowercase letters, which avoids any confusion between different operating systems. Replace spaces with hyphens to avoid whitespace.

This forces you to come up with good titles! And the three-digit prefix means you can simply sort the files in a folder by name to put them in the right order.

## Q: **Can you recommend any tools that make it easier to write and manage ADRs?**

A: Oh, sure! There are many options, from command-line tools to language-specific tools that allow you to record ADRs directly in your source code. You can see a list of available tools at *https://adr. github.io/#decision-capturing-tools*.

Most third-party tools make assumptions about the format of the ADR—perhaps they generate Markdown files or store the files in a specific directory structure. Test-drive a tool a few times to get a feel for it.

Finally, some age-old advice: keep it simple, silly. We suggest you start by writing out ADRs without any complicated tooling or automation. Get a sense of what works best for your team. Then, as your needs grow, go find a tool that fits those needs.

#### Q: **Do ADRs always belong to a single project, or can they affect multiple projects and teams? How about the whole organization?**

A: Yes, yes, and yes. ADRs can be as narrow or as broad as you'd like them to be. Some ADRs are project-specific, affecting only one team. Other ADRs affect many or all teams in an organization. At the online retailer Amazon, there's an ADR affectionately referred to as "the Jeff Bezos API mandate." It records a decision that company founder Jeff Bezos once made: that all services within Amazon can only talk to other services via an API. Naturally, this affected the entire organization—no small feat, given Amazon's size.

Most cross-project or cross-team ADRs require a lot of collaboration, and often the blessing of a central architecture review board. Such ADRs tend to affect cross-cutting concerns, like how services should communicate with one another or which data transfer protocol to use. ADRs related to security or regulatory compliance often cut across multiple teams or a whole organization.

## <span id="page-147-0"></span>The benefits of APRs

We hope we've convinced you by now that recording your decisions in ADRs need not be a long, arduous process. We really like the format we've shown you in this chapter, but feel free to tweak or modify it.

Is recording architectural decisions really that important? We certainly think so! There are tons of benefits to recording these decisions—not just for you and your team, but for your entire organization. Let's quickly recap.

![](_page_147_Figure_4.jpeg)

#### Keep the ADR process as frictionless as possible

It's tempting to add sections to the ADR template in the hope of being comprehensive.
While that's a noble goal, it adds work. If you keep "feeding the beast," the documentation process gets harder. That can discourage people, and some might stop writing ADRs altogether.

Focus on concision and brevity. Keep it simple. You'll thank us later.

# Two Many Sneakers is a success

The team at Two Many Sneakers is ecstatic. Their customers *love* getting real-time notifications about new offerings in the app, and the improved analytics are giving the security team the information they need to sniff out any and all sneaker scams from a mile away.

Learning about the two laws of software architecture sure made this easy. Not only do we know we've made the right decision, but we've also captured it in an ADR. I feel so much better. Just got the email from the finance team: they want the trading service to keep the compliance service in the know. That should be an easy change.

> Grokking the two laws of software architecture will serve you well. Now you know that there are no "best practices" in software architecture—just trade-offs. It's up to you (and your team) to find the most viable and best-fitting option. And don't forget to record your decision in an ADR!

Onward and upward.

# <span id="page-149-0"></span>**Bullet Points**

- There is nothing "static" about architecture. It's constantly changing and evolving.
- Requirements and circumstances change. It's up to you to modify your architecture to meet new goals.
- For every decision, you will be faced with multiple solutions. To find the best (or least worst), do a *trade-off analysis*. This collaborative exercise helps you identify the pros and cons of every possible option.
- The *First Law of Software Architecture* is: Everything in software architecture is a trade-off.
- The answer to every question in software architecture is "it depends." To learn which solutions are best for your situation, you'll need to identify the top *priorities and goals*. What are the requirements? What's most important to your stakeholders and customers? Are you in a rush to get to market, or hoping to get things stable in growth mode?
- The product of a trade-off analysis is an *architectural decision*: one of the four dimensions needed to describe any architecture.
- An *architectural decision* involves looking at the pros and cons of every choice in light of other constraints such as cultural, technical, business, and customer needs—and choosing the option that serves these constraints best.
- Making an architectural decision isn't just about choosing; it's also about *why* you're choosing that particular option.
- The *Second Law of Software Architecture* is: Why is more important than how.
- To formalize the process of capturing architectural decisions, use *architectural decision records* (ADRs). These documents have seven sections: Title, Status, Context, Decision, Consequences, Governance, and Notes.

- Over time, your ADRs will build into a *log* of architectural decisions that will serve as the memory store of your project.
- An ADR's *title* should consist of a three-digit numerical prefix and a noun-heavy, succinct description of the decision being made.
- An ADR can be assigned one of many *statuses*, depending on the kind of ADR and its place in the decision workflow.
- Once all parties involved in the decision sign off on the ADR, its status becomes Accepted.
- If a future decision supplants an Accepted ADR, you should write a new ADR. The supplanted ADR's status is marked as Superseded and the new ADR becomes Accepted.
- The *Context* section of an ADR explains why the decision needed to be made to begin with.
- The *Decision* section documents and justifies the actual decision being made. It always includes the "why."
- The *Consequences* section describes the decision's expected impact, good and bad. This helps ensure that the good outweighs the bad, and aids the team(s) implementing the ADR.
- The *Governance* section lists ways to ensure that the decision is implemented correctly and that future actions do not stray away from the decision.
- The final section is *Notes*, which mostly records metadata about the the ADR itself—like its author and when it was created, approved, and last modified.
- ADRs are important tools for abiding by the Second Law of Software Architecture, because they capture the "why" along with the "what."
- ADRs are necessary for building institutional knowledge and helping teams learn from one another.

![](_page_150_Picture_1.jpeg)

# **"Two Laws" Crossword**

Think you've mastered the two laws of software architecture? Why don't you document your knowledge by completing this crossword?

![](_page_150_Picture_4.jpeg)

#### Across

2. Two Many \_\_\_\_\_ 4. Topics use a fire-and-\_\_\_\_\_ system 5. A new ADR can \_\_\_\_\_ an old one 7. You can list pros and cons on a \_\_\_\_\_board 8. You should record every architectural \_\_\_\_\_ you make 10. Documents made up of seven sections (abbr.) 11. Heterogeneous 13. Important architectural characteristic for a fast-growing business 15. "Everything in software architecture is a trade-off " is the \_\_\_\_\_ \_\_\_\_\_ of software architecture (two words) 18. Examples of messaging mechanisms include queues and \_\_\_\_\_

20. If you're too excited about a new tool, you might have

19. Best tone to use when writing an ADR

\_\_\_\_\_ Object Syndrome

#### Down

- 1. Topics can be independently \_\_\_\_\_
- 3. An architectural characteristic that's especially important for financial transactions
- 5. Architects are responsible for making architecturally \_\_\_\_\_ decisions
- 6. ADR section that tells you why a decision needed to be made
- 9. High or low interdependence
- 12. Short way to say "not at the same time"
- 14. Two Many Sneakers' mobile app communicates with the trading \_\_\_\_\_
- 16. More important than how, according to the Second Law
- 17. The \_\_\_\_\_ of an ADR might be Accepted

![](_page_151_Figure_1.jpeg)

Which of the following architectural characteristics stand out as important for this particular problem? *Hint: There are no right answers here, because there is a lot we don't know or aren't sure of yet.* Take your best guess—here are our thoughts:

Since business is booming, this could extensibility be something to look out for.

Lots of downstream services need to know about sneaker trades. This sounds important!

modularity

upgradability

low coupling

performance

security

Sharpen your pencil

From page 89

Spend a few minutes comparing the results of our trade-off analysis. Notice how both options support some characteristics but trade off on others? Now we're going to present you with some requirements—see if you can decide if you'd pick queues or topics to support each one. Here are our answers:

#### Requirements

"Security is important to us."

Queues/Topics

"Different downstream services need different kinds of information."

Queues/ Topics

"We'll be adding other downstream services in the future."

Queues / Topics

# **Solution Sharpen your pencil**

This time, we'd like you to do some trade-off analysis on your own. We chose messaging as the communication protocol between our trading service and its consumers. Messaging is asynchronous. Choosing between asynchronous and synchronous forms of communication comes with its own set of trade-offs! We've given you two whiteboards, one for each form of communication, and we've listed a bunch of "-ilities." We'd like you to consider how each architectural characteristic would work in both contexts. Is this characteristic a pro or a con (or neither) in synchronous communications? What about in asynchronous communications? Place each "-ility" in the appropriate column. *Hint: Not all of them apply to this decision.* You'll find our answers below:

![](_page_152_Figure_4.jpeg)

![](_page_153_Picture_1.jpeg)

In the following exercises, you're going to help the team at Two Many Sneakers write an ADR. They've decided to use asynchronous messaging, with queues between the trading service and downstream services. Assume this is the **12th** ADR the team is writing. What title would you give this ADR? Don't forget to number it! Here's what we came up with:

012: Use of queues for asynchronous messaging between order and downstream services

![](_page_153_Picture_5.jpeg)

# **Exercise Solution**

**From page 102**

In the previous exercise, you hashed out the title of Two Many Sneakers' ADR about using queues for messaging. Let's say you get the green light. Write down the title you chose in the space below and give it a status. Here's ours:

 Title: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 012: Use of queues for asynchronous messaging between order and downstream services

 Status: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ Accepted

#### *Three months later:*

Whoops! The requirements have changed. Your latest trade-off analysis reveals that topics would be a better fit. Everyone has signed off on this, so you need to supersede your ADR with a new ADR. This is the 21st ADR your team has worked on. Write down the title and the new status of the old ADR:

 Title: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 012: Use of queues for asynchronous messaging between order and downstream services

Status: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ Superseded by 021

Now write down the title and status of the newly introduced ADR. Here's ours:

 Title: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ 021: Use of topics for asynchronous messaging between order and downstream services

 Status: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ Accepted, Supersedes 012

<span id="page-154-0"></span>![](_page_154_Picture_1.jpeg)

Continue building out the ADR for Two Many Sneakers.

Use the space below to write a Context section for the team's decision to use queues for communication between the trading service and other services. Here's our take:

The trading service must inform downstream services (namely the notification and analytics services, for now) about new items available for sale and about all transactions. This can be done through synchronous messaging (using REST) or asynchronous messaging (using queues or topics).

![](_page_154_Picture_5.jpeg)

From page 106

It's time for you to write the Decision section of the ADR for Two Many Sneakers. Here are the main factors the team considered when making their decision:

- · Queues allow for heterogeneous messages.
- · Security is an important architectural characteristic for the stakeholders.

We've given you some space to write out a Decision section, including the corresponding justification. This section should answer the question, "Why queues?" *Hint: Be sure to focus on the decision and the "why."* There are no right answers, but here's what we came up with:

We will use queues for asynchronous messaging between the trading and downstream services.

Using queues makes the system more extensible, since each queue can deliver a different kind of message. Furthermore, since the trading service is acutely aware of any and all subscribers, adding a new consumer involves modifying it—which improves the security of the system.

<span id="page-155-0"></span>![](_page_155_Picture_2.jpeg)

# **Solution Sharpen your pencil From page 108**

Help the Two Many Sneakers team iron out the Consequences section of their ADR. Here are a few things to think about:

- ¾ A queue introduces a new piece of infrastructure.
- ¾ The queues themselves will probably need to be highly available.
- ¾ How do queues affect coupling between components?

Queues mean a higher degree of coupling between services.

We will need to provision queuing infrastructure. It will require clustering to provide for high availability.

If additional downstream services (in addition to the ones we know about) need to be notified, we will have to make modifications to the trading service.

![](_page_155_Picture_11.jpeg)

![](_page_156_Picture_1.jpeg)

Let's bring it all together! You've been working piecemeal on the ADR for the Two Many Sneakers team. We'd like you to flip back over the past few exercises and copy your ADR sections onto this page to create a full ADR. We've given you the section titles—all you have to do is fill 'em out. (Assume the status to be "Accepted.") Here's our version:

| - |    |              |
|---|----|--------------|
|   | 17 | $\mathbf{n}$ |
|   |    |              |

012: Use of queues for asynchronous messaging between order and downstream services

#### **Status**

Accepted

#### Context

The trading service must inform downstream services (namely the notification and analytics services, for now) about new items available for sale and about all transactions. This can be done through synchronous messaging (using REST) or asynchronous messaging (using queues or topics).

#### Decision

We will use queues for asynchronous messaging between the trading and downstream services.

Using queues makes the system more extensible, since each queue can deliver a different kind of message. Furthermore, since the trading service is acutely aware of any and all subscribers, adding a new consumer involves modifying it—which improves the security of the system.

#### Consequences

Queues mean a higher degree of coupling between services.

We will need to provision queuing infrastructure. It will require clustering to provide for high availability.

If additional downstream services (in addition to the ones we know about) need to be notified, we will have to make modifications to the trading service.

And there you have it! A complete ADR in its full glory.

![](_page_157_Picture_1.jpeg)

# **"Two Laws" Crossword Solution**

**From page 115**

![](_page_157_Figure_4.jpeg)

**4**

# logical components

# The Building Blocks

![](_page_158_Picture_3.jpeg)

**Ready to start creating an architecture?** It's not as easy as it sounds—and if you don't do it correctly, your software system could come crumbling to the ground, just like a poorly designed skyscraper or bridge.

In this chapter we'll show you several approaches for identifying and creating *logical components*, the functional building blocks of a system that describe how its pieces all fit together. Using the techniques described in this chapter will help you to create a solid architecture—a foundation upon which you can build a successful software system.

Put on your hard hat and gloves, get your tools ready, and let's get started.

# <span id="page-159-0"></span>Logical components revisited

![](_page_159_Figure_2.jpeg)

<span id="page-160-0"></span>![](_page_160_Picture_1.jpeg)

# Exercise

# Name that component

It's your first week on the job as the new architect, and you've been assigned to an existing project to build a trouble ticket system. You want to understand the logical components of the architecture, but your team doesn't know anything about logical components—they just started coding. To determine the logical architecture, you have to look at the existing directory structure. How many individual logical components can you identify from the codebase below?

![](_page_160_Figure_5.jpeg)

# Adventurous Auctions goes online

Want to go on a safari in Tanzania? Observe wildlife in the Galapagos Islands? Hike to the base camp of Mount Everest? Adventurous Auctions is here to help!

You've probably seen our ads or attended some of our live auctions around the country. These kinds of adventures are hard to come by and can take years to reserve; our company auctions them off at a significant cost savings.

We want more people around the world to be able to access these great trips, so we're taking our adventurous auctions online (in addition to our in-person auctions).

That's where you come in: we need a new system to support the online auctions of our adventurous trips.

![](_page_161_Picture_6.jpeg)

![](_page_161_Picture_7.jpeg)

## Here's what the new system needs to do:

- Scale up to meet demand, so hundreds or even thousands of people can participate in each auction.
- Include both in-person and online bids in every auction.
- Allow online users to register with Adventurous Auctions and provide us with their credit card details so they can pay if they win a trip.
- Allow online users to view live video streams of in-person auctions, as well as all bids placed so far, both in person and online.
- Allow online users to bid on trips, just like the people in the room.
- Determine which online bidder bids the asking price first (this is called "winning the bid"). If an online bidder bids at the same time as an in-person bidder, the auctioneer then determines who bid first.
- When the auctioneer announces an online user as the winner, the system charges the winner's credit card, notifies the winner, then moves on to the next trip in the auction.

Pay attention, because we're going to show you how to create a logical architecture for this system.

# <span id="page-162-0"></span>Logical versus physical architecture

A *logical architecture* shows all of the logical building blocks of a system and how they interact with each other (known as *coupling*). A *physical architecture*, on the other hand, shows things like the architectural style, services, protocols, databases, user interfaces, API gateways, and so on.

We're going to be talking a lot in this chapter.

The logical architecture of a system is independent of the physical architecture—meaning the logical architecture doesn't care about databases, services, protocols, and so on. Let's look at an example of what we mean by a logical architecture.

![](_page_162_Figure_5.jpeg)

This physical architecture shows some of the services and databases.

See how the logical architecture *doesn't* include the various components of physical architecture mentioned above? It's a different view of the system. To see what we mean, compare the diagram above with the following physical architecture diagram. Notice how the physical architecture associates services with components from the logical architecture, and also shows the services and databases for the system.

![](_page_162_Figure_8.jpeg)

# Who Does What

<span id="page-163-0"></span>We had our logical and physical architecture responsibilities all figured out, but somehow they got all mixed up. Can you help us figure out who does what? Be careful—some responsibilities may not have a match (they aren't part of a logical or physical architecture).

*Be sure to check the answers (located at the end of this chapter) before moving on.*

Shows which programming language is used for each component

Logical architecture Physical architecture Maps components to services Shows how many databases there are in the system and which services access them Shows communication between services and the protocol they use (like REST) Shows the components and their interactions within the user interface Shows the API gateways and load balancers used in the system Shows the logical components within the system and how they communicate with each other Shows the source code files used to implement a component We did this one for you. **Solution on page 157**

# <span id="page-164-0"></span>Creating a logical architecture

Identifying logical components isn't as easy as it sounds. To help, we've created this flowchart. Don't worry—we'll be covering all of these steps in detail in the following pages.

![](_page_164_Figure_3.jpeg)

![](_page_164_Picture_4.jpeg)

#### This flow continues as long as the system is alive.

This flowchart shows a series of steps to begin *greenfield applications* (new systems created from scratch) and perform ongoing maintenance on existing ones.

Ever wonder why it's so common for a well-designed system to end up as an unmaintainable mess in no time? It's because teams don't pay enough attention to the logical architecture of their systems.

Anytime you make a change or add a new feature to the system, you should always go through each of these steps to ensure that the logical components are the right size and are doing what they are meant to do.

![](_page_164_Picture_9.jpeg)

# <span id="page-165-0"></span>Step 1: Identifying initial core components

The first step in creating a logical architecture is identifying the *initial* Step 1: Identify initial core components core components. Many times this is purely a guessing game, and you'll likely refactor the components you initially identify into others. So don't spend a lot of time worrying about how big or small your components are—we'll get to that. First, let's show you what we mean by a "guessing" Step 4: Analyze architectural characteristics Step 3: Analyze the role and responsibility game." This roadmap shows which step you're on. This is Frank, the ClO of Adventurous Auctions. The auction flow is pretty simple. Participants join 0 a live auction, view the auction, and bid on a trip they are interested in. Given this simple description, you can start out by creating three logical components, one for each of the three major things the system does. Live Auction Bid Video Session Streamer Capture This component is responsible for capturing bids. This component represents This component is a live auction taking Place and allows Participants to join the auction. responsible for streaming the live auction to online

participants.

These components aren't really doing anything yet. You see, we've identified the initial components, but we haven't assigned them any responsibility vet. You could think of them as empty jars. They represent our initial best guess, based on a major action that takes place in the system. That's why we call them initial core components. This jar exists but is empty, just like the initial core components you identify. Live Auction Session

<span id="page-166-0"></span>Creating a logical architecture is all a "guessing game"? That's the most ridiculous thing I've ever heard. Isn't there some way to take the guesswork out of identifying logical components?

0

![](_page_166_Picture_3.jpeg)

# Yes, there is! In fact, you can use several approaches to remove some of the guesswork.

You don't know a lot of details about the system or its requirements yet, and the components you initially identify are likely to change as you learn more. That's why we say it's a guessing game at this stage—and that's perfectly okay!

We'll show you two common approaches for identifying initial core components: the *workflow approach* and the *actor/action approach*.

There are other approaches that may seem like good ideas initially but that can lead you down a very bad path. We'll discuss those after we show you the good stuff.

# <span id="page-167-0"></span>Workflow approach

The *workflow approach* is an effective way to identify an initial set of core components by thinking about the major workflows of the system—in other words, the journey a user might take through the system. Don't worry about capturing every step; start out with the major processing steps, and then work your way down to more details.

You can model different more initial components.

Let's use the workflow approach to identify some initial core components for the Adventurous Auctions architecture.

![](_page_167_Figure_5.jpeg)

there are no **Dumb Questions** 

You identified "Video Streamer" as a logical component, but what if our team decides to use a third-party library or service to stream the auction?

A: Great question! Even though you might not develop the functionality yourself, it's still part of the logical architecture.

ls each step in a workflow always mapped to a single logical component?

A: Not always. You might have several steps in a workflow that point to the same logical component, particularly if their functionalities are closely related.

#### Names matter.

Pay close attention to how you name your initial core components. A good name should *succinctly describe* what that component does.

![](_page_167_Figure_13.jpeg)

# Sharpen your pencil

![](_page_168_Picture_2.jpeg)

Your company wants a new system to assign workers to construction sites, and it's your job as the software architect to identify its initial core components. Using the workflow approach, identify as many core components as you can, matching each to its associated workflow step. Remember, a workflow step can have multiple components, and not every workflow step has to have a unique component.

- Step 1: Maintain a list of all construction workers, their skills, and their locations
- Step 2: Create a new construction project and specify the work site
- Step 3: Create a schedule for when various construction projects start and end
- Step 4: When a new project starts, assign workers based on their skills and locations
- Step 5: When the project completes, free up workers so they can be reassigned

Draw your logical components in this space. Remember to give them good descriptive names.

Solution on page 158

# <span id="page-169-0"></span>Actor/action approach

The *actorlaction approach* is particularly helpful if you have multiple actors (users) in the system. You start by identifying the various actors. Then, you identify some of the primary actions they might take and assign each action to a new or existing component.

![](_page_169_Figure_3.jpeg)

<span id="page-170-0"></span>![](_page_170_Picture_1.jpeg)

## Exercise

You have a bakery that is ready to expand operations, and you would like a new system that lets customers view, order, and pay for bakery items online for pickup. Orders are sent to the bakery coordinator, who purchases ingredients and schedules orders. The baker receives the schedule of items to bake each morning and tells the system when the items are baked. The system then emails the customers to let them know their items are ready for pickup.

Using the actor/action approach, identify what actions each actor might take. Then draw as many logical components as you can for the new bakery system, matching the actions you identified to the components.

![](_page_170_Figure_5.jpeg)

# <span id="page-171-0"></span>The entity trap

![](_page_171_Picture_2.jpeg)

Okay, so if I identify lots of actions that have to do with bids, then should I put all of them together in a single component called the Bid Manager?

#### Welcome to the entity trap.

We call this approach the *entity trap* because it's very easy to fall into it when identifying the initial core logical components, and you'll run into lots of issues if you do this.

First of all, the name "Bid Manager" is too vague. Can you tell what the component does just by looking at the name? Neither can we. A name like this doesn't tell us enough about the component's role and responsibilities.

Second, the component has too many responsibilities. All too often, components in the entity trap become convenient dumping grounds for all functionality related to those entities. As a result, they take on too much responsibility and become too big and difficult to maintain, scale, and make fault tolerant.

# This component will be hard to scale because it's doing too much.

Bid Manager

These are all the things the component does.

- —Accept a bid
- Display all winning bids
- Track bids for auditing purposes
- Determine bid winner
- Notify auctioneer of online bid
- Generate bid reports

# qit oyg

![](_page_171_Picture_18.jpeg)

Watch out for words like *manager* or *supervisor* when naming your logical components—those are good indicators that you might be in the entity trap.

# Sharpen your pencil

What other words besides *manager* can you list that, if they appeared in a component name, might indicate that you've fallen into the entity trap?

We did this supervisor one for you.

Solution on page 160

<span id="page-172-0"></span>**Exercise**

Can you select the most appropriate approach to identifying initial core components in the following scenarios? In some cases, more than one approach may be appropriate.

| The system has only one type of user      | <input type="checkbox"/> Workflow <input type="checkbox"/> Actor/Action |
|-------------------------------------------|-------------------------------------------------------------------------|
| The system has well-defined entities      | <input type="checkbox"/> Workflow <input type="checkbox"/> Actor/Action |
| You have minimal functional requirements  | <input type="checkbox"/> Workflow <input type="checkbox"/> Actor/Action |
| The system has many complex user journeys | <input type="checkbox"/> Workflow <input type="checkbox"/> Actor/Action |
| The system has many types of users        | <input type="checkbox"/> Workflow <input type="checkbox"/> Actor/Action |

Solution on page 160

# there are no Dumb Questions

Q: **The actor/action approach reminds me a lot of event storming. Are they the same thing?**

A: Great observation, and we're glad you saw the similarities. Event storming is a workshop-based approach that is part of *domain-driven design* (DDD). With this approach, you analyze the business domain to identify domain events. While both approaches have the final goal of identifying actions performed within the system, event storming takes identifying components much further than the actor/action approach does. You could say that the actor/ action approach identifies the *domain event* and *actor* elements of event storming, but doesn't continue with other elements such as *command*, *aggregate*, and *view*. You can learn more about event storming at *https://en.wikipedia.org/wiki/Event\_storming*.

Q: **Can you combine the workflow approach and actor/ action approach, or do you have to choose between them?**

A: You can combine them, and in most cases this is a good idea**.** If you start with the actor/action approach to identify actions, you can then use the workflow approach to arrange them in the order in which they are likely to occur.

Q: **Are you telling me I should never use the words**  *manager***,** *supervisor***, and so on as part of my component names?**

A: Not necessarily—there is no hard and fast rule to the entity trap. Sometimes it's hard to come up with a name for something that does a general task. Take, for example, a component that manages all of the reference data in your application—name/ value pairs like country codes, store codes, color codes, and so on. A good name for such a component would be "Reference Data Manager." However, names like "Order Manager" or "Response Handler" are too broad and don't describe what those components actually do.

Q: **When using the actor/action approach, how many actions should you identify for each actor?**

A: That's a tough question. The purpose of identifying actions is to tease out likely logical components and what they might be responsible for. We usually look at the *primary* actions an actor might take, rather than diving into too many details.

# <span id="page-173-0"></span>Step 2: Assign requirements

Once you've identified some initial core components, it's time to move on to the next step: *assigning requirements* to those logical components.

In this step, you'll take functional user stories or requirements and figure out which component should be responsible for each one. Remember, each component is represented by a directory structure. Your source code resides in that directory, so it contains that requirement.

Step 1: Martify initial core components 

Step 2: Assign requirements to components

Step 3: Assign to components

Step 4: Analyze the role and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and responsibility and re

Let's go back to the initial set of components we defined based on what Frank (the CIO) said about the basic workflow of Adventurous Auctions. Now it's time to assign some responsibilities to these components. Represents the live auction currently taking place Display the current trip up for bid during the auction Live Auction Since the Live Auction Session component is responsible for Session controlling the auction currently taking place, it makes sense to assign this requirement to it. Responsible for receiving and storing bids from Mark a trip as sold and move to the next trip Bid the bidders. This requirement also has to do with controlling the flow of the Capture auction session, so let's assign it to the Live Auction Session component. Responsible for showing the video feed from Send each online bid to the live auctioneer the auction Video as it's placed, so they can call out the bid Streamer Since the Bid Capture component receives the bid from the bidder for a trip, it makes sense to have this component also forward that bid to the live auctioneer. This is a new component we added to satisfy the Record the live video stream for later playback last requirement in case a bid is contested The Video Streamer component already has the video feed, so it makes sense to have it record the video feed as well. Trip Viewer Allow bidders to view details about the current trip up for bid Creating new components is known as Wait—it doesn't make sense for any of the other components evolving the architecture. we identified earlier to take on this responsibility. Let's create a new component to handle it.

<span id="page-174-0"></span>![](_page_174_Picture_1.jpeg)

Your company, Going Green Corporation, wants a system to support its new electronics recycling program, where customers can send in their old electronic devices (like cell phones) and get money. We've already identified some of the initial core components. Your job is to figure out which component should be responsible for each of the functionalities listed below, or if a new component is needed. You'll also need to come up with names for any new

customers can send in their old electronic devices (like cell phones) and get money. We've already identified some of the initial core components. Your job is to figure out which component should be responsible for each of the functionalities listed below, or if a new component is needed. You'll also need to come up with names for any new components.

|                  | Physically receive the device from the customer. | Assess the device's condition | Recycle or resell the old device. |
|------------------|--------------------------------------------------|-------------------------------|-----------------------------------|
| Device Receiving | Device Assessment                                | Device Recycling              |                                   |

| Locate the nearest safe disposal facility for destroying the device                | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
|------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Capture and store customer information (name, address, etc.)                       | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
| Post the device on a third-party site to resell it on the secondary market         | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
| Pay the customer for their recycled device                                         | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
| Record that the device has been received and is ready for assessment and valuation | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
| Determine the value (if any) of the recycled device                                | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
| Determine the monthly profit and loss for recycled and resold devices              | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling <input type="checkbox"/> Other: __________ |
|                                                                                    | <i>Going Green Corp. needs to make a profit, after all.</i>                                                                                                               |

Solution on page 161

# <span id="page-175-0"></span>Step 3: Analyze roles and responsibilities

As you start assigning *functionality* (in other words, user stories or requirements) to logical components, the roles and responsibilities of each component will start to naturally grow. The purpose of this step is to make sure that the component to which you are assigning functionality *should* actually be responsible for that functionality and that it doesn't end up doing too much.

Step 2: Assign requirements to components

Step 2: Assign requirements to components

Step 2: Assign requirements to components

Step 3: Assign requirements to components

Step 4: Assign requirements to components

Step 4: Assign requirements to components

Step 4: Assign requirements to components

Step 4: Assign requirements to components

Step 4: Assign requirements to components

Step 5: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 6: Assign requirements to components

Step 7: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements to components

Step 8: Assign requirements

Step 8: Assign requirements

Step 8: As

Let's say we create a component called *Live Auction Session* that has the following responsibilities during a live auction:

![](_page_175_Figure_5.jpeg)

- 1. Start and stop the auction
- 2. Show the current trip up for bid
- 3. Mark a trip as sold and move to the next trip

This is a well-designed component and has just the right amount of responsibility. However, as iterations move forward, the development team adds some new requirements to the Live Auction Session component:

- 4. Display the details of each trip in this auction
- 5. Keep track of all the bidders currently in the auction
- 6. Keep track of each winning bidder for the auction
- 7. Notify the bidder that they won the trip

tey, component, can you wash my car too?

If you've ever had too much on your plate at work, you likely gave some of that work to others. Do the same with components—offload some of the responsibility to someone else.

With this added functionality, this component is now taking on too much responsibility. This is a common situation, so don't be surprised if it happens to you. When it does, don't panic—that's what this step is here for. Let's see if we can fix this situation by moving some of the responsibility of the Live Auction Session component to other components.

![](_page_175_Picture_17.jpeg)

# Geek Note

Have you ever created a class file called Utility? What did it do? Chances are it contained a bunch of unrelated functions that you'd had a hard time placing. The same thing can happen with logical components within software architecture. Try to avoid components that contain lots of unrelated functions.

# <span id="page-176-0"></span>Sticking to cohesion

When you analyze a component's role and responsibility statement or set of operations, check to see if the functionality is closely related. This is known as *cohesion*: the degree and manner to which the operations of a component are interrelated. Cohesion is a useful tool for making sure a component has the right responsibilities.

When analyzing the role and responsibilities of a component, it's common to find an *outlier* (an odd piece of functionality) or a component that is doing too much. In these cases, it's usually a good idea to shift some of the responsibility to other components.

Now it's your turn to fix the Live Auction Session component.

![](_page_176_Picture_5.jpeg)

![](_page_176_Picture_6.jpeg)

Component functions should all be relatedbut if they're not, don't get frustrated. Just start to break the component apart, and you'll be considered very smart.

![](_page_176_Picture_8.jpeg)

## Exercise

See if you can offload some of the responsibility of the Live Auction Session component to others by creating new components to handle the additional functionality. Keep the first three original requirements associated with the Live Auction Session.

We did this one for you.

Live Auction
Session

- 1. Start and stop the auction
- 2. Show the current trip up for bid
- 3. Mark a trip as sold and move to the next trip

Draw your new components in this space here.

- 4. Display the details of each trip in this auction
- 5. Keep track of all the bidders currently in the auction
- 6. Keep track of each winning bidder for the auction
- 7. Notify the bidder that they won the trip

Hint: You might consider combining a few of these requirements when creating new components.

Solution on page 162

# <span id="page-177-0"></span>Step 4: Analyze characteristics

The final step in identifying initial core components is to verify that each component aligns with the *driving architectural characteristics* that are critical for success. In most cases this involves breaking apart a component for better scalability, elasticity, or availability, but it could also involve putting components together if their functionalities are tightly coupled.

Let's look once again at our Adventurous Auctions example. We previously identified a Bid Capture component that is responsible for *accepting bids*, *storing all bids in a Bid Tracker database*, and *forwarding the highest bid to the auctioneer*. Here is the overall flow for the Bid Capture component:

![](_page_177_Figure_4.jpeg)

![](_page_177_Figure_5.jpeg)

This architecture looks good, but just to be sure, we should make sure the Bid Capture component supports the system's critical architectural characteristics (those that are important for success).

These are all important to the success of Adventurous Auctions.

We know the system has to support thousands of bidders per second—that's *scalability*. We also know the system must be up and running while auctions are taking place—that's *availability*. Finally, the system must accept a bid and get it to the auctioneer as fast as possible—that's *performance*.

Now it's your turn to analyze the Bid Capture component against these critical architectural characteristics.

BE the architect

Your job is to play architect and analyze the Bid Capture component on the previous page to see if it should be modified based on the critical architectural characteristics we identified. Our solution is on the next page.

# These are the critical architectural characteristics for Adventurous Auctions:

**Scalability:** The system has to support

thousands of bidders per second

Availability: The system must be up and running

while the auctions are taking place

Performance: The system must accept a bid and

get it to the auctioneer as fast as

possible.

#### Hints (things to consider):

- What if the database goes down?
- Can the database keep up with the volume of inserts based on the bids coming in?
- Will inserts into the database be fast enough to get the bids to the auctioneer?
- Consider the actions the Bid Capture component has to take upon receiving a bid.

Use this area to draw how you might change the Bid Capture component based on the critical architectural characteristics and considerations above.

![](_page_178_Picture_17.jpeg)

# <span id="page-179-0"></span>The Bid Capture component

Let's work through this exercise by reviewing the current responsibilities of the Bid Capture component:

- 1. Accept bids from online bidders and from the auctioneer for live bidders.
- 2. Determine which online bid is the highest.
- 3. Write all bids to a Bid Tracker database for tracking purposes.
- 4. Notify the auctioneer of the highest bid.

It makes sense for the Bid Capture component to write the bids to the database, since it has them. But database connections and throughput are limited, so having Bid Capture do this significantly impacts *scalability*. It also impacts *performance* by adding wait time for writing the data to the database, as well as *availability* if the database were ever to go down.

This is what we mean by analyzing characteristics.

If we assign the last requirement to a *new* component called Bid Tracker, we can significantly increase the scalability, performance, and availability of the Bid Capture component. That lets the system process more bids faster and get the highest bid to the auctioneer as quickly as possible. The Bid Capture component can send the bids to the Bid Tracker and won't have to wait for the bid to be written to the database.

You might break apart or combine components in this step, based on the architectural characteristics needed.

![](_page_179_Figure_11.jpeg)

# Component coupling

![](_page_180_Picture_2.jpeg)

I should probably start thinking about how the logical components interact with and depend on each other, right?

#### Yes, and this is the right time to do it.

As you identify the initial core components, it's important to determine how they interact. This is known as *component coupling*: the degree to which components know about and rely on each other. The more the components interact, the more tightly coupled the system is and the harder it will be to maintain.

![](_page_180_Picture_6.jpeg)

Remember this diagram from several pages ago? It's called a "big ball of mud" because there are so many component interactions and dependencies that the diagram starts to look like a ball of mud (or maybe like a bowl of spaghetti).

That's why it's so important to pay attention to how components interact and what dependencies exist between them.

You need to be concerned about two types of coupling when creating logical components: *afferent coupling* and *efferent coupling*. Don't be concerned if you've never heard these formal terms before—we're going to explain them in the following pages.

# <span id="page-181-0"></span>Afferent coupling

Children depend on their parents for a lot of things, like making sure they have plenty of food to eat and a safe place to live, driving them to soccer practice, or even giving them an allowance so they can buy candy or a really cool comic book. As it turns out, parents are *afferently* coupled to their children, and even to the family dog, because all of them depend on the parents for something.

**Afferent coupling** is the degree and manner to which other components are dependent on some target component (in this case, Mom). It's sometimes referred to as *fan-in*, or *incoming*, coupling. In most code analysis tools, it's simply denoted as *CA*.

![](_page_181_Figure_4.jpeg)

![](_page_181_Picture_5.jpeg)

To see how afferent coupling works, look at the interaction between three of the logical components within the Adventurous Auctions logical architecture on the left.

Both the Auction Registration component and the Automatic Payment component depend on the Bidder Profile component to return bidder profile information. In this scenario, the Bidder Profile component has an afferent coupling level of 2, because two components depend on it to complete their work.

![](_page_181_Picture_8.jpeg)

# Geek Note

Did you know that the odd-sounding word *afferent* means "carrying toward"? It gets its roots from the Latin words *ad* (meaning "to" or "toward") and *ferre* ("to carry"). In the medical field, the word *afferent* refers to nerves that carry impulses to the brain (your *afferent nerves*).

<span id="page-182-0"></span>![](_page_182_Picture_1.jpeg)

# Efferent coupling

Now let's look at things from a young child's point of view. As a child, you might have been dependent not only on your parents, but also your teachers, friends, classmates, and so on. Being dependent on others is known as *efferent coupling*.

Efferent coupling is exactly the opposite of afferent coupling, and it's measured by the number of components on which a target component depends. It's also known as *fan-out coupling* or *outgoing coupling*. In static source code analysis tools, it's usually denoted as *CE*.

So, what does efferent coupling look like with logical components? Let's take a look at Adventurous Auctions again, this time considering the process of accepting a bid from Kate for a trip.

![](_page_182_Figure_6.jpeg)

Because the Bid Capture component depends on the Bid Streamer and Bid Tracker components to process a bid, it is *efferently coupled* to these components. It has an efferent coupling level of 2 (in other words, it's dependent on two other components).

You can use this

information to track

getting more or less

whether things are

coupled over time.

# <span id="page-183-0"></span>Measuring coupling

You can measure a particular component's amount of coupling in three ways: by considering its total afferent coupling (CA), its total efferent coupling (CE), and its *total coupling* (CT), or the sum of the total afferent and efferent coupling. These measurements tell you which components have the highest and lowest coupling, as well as the entire system's overall coupling level.

![](_page_183_Figure_3.jpeg)

This logical

architecture has

a total coupling

Sharpen your pencil

Given the components below, can you identify the total afferent coupling (CA), total efferent coupling (CE), and total coupling (CT) for each component? Also, what is the total coupling level for this logical architecture? Does the CT for this architecture seem high or low to you?

![](_page_183_Figure_6.jpeg)

<span id="page-184-0"></span>![](_page_184_Picture_1.jpeg)

Okay, now I get coupling and how to measure it. But how do I reduce component coupling to create loosely coupled systems?

Great question. Developers are taught to strive for loosely coupled systems, but not *how* to do it. We'll show you how by introducing a technique called the *Law of Demeter*.

The Law of Demeter, also known as the Principle of Least Knowledge, is named after Demeter, the Greek goddess of agriculture. She produced all grain for mortals to use, but she had no knowledge of what they did with the grain. Because of this, Demeter was *loosely coupled* to the mortal world.

Logical components work in the same way. The more knowledge a component has about other components and what needs to happen in the system, the more coupled it is to those components. By reducing its *knowledge* of other components, we reduce that component's level of coupling.

On the next few pages, we'll show you more about the Law of Demeter and how it can be used to decouple systems.

# <span id="page-185-0"></span>A tightly coupled system

Let's see how the Law of Demeter can be used to decouple systems by taking a The components in this look at the logical architecture of a typical order entry system. architecture are well defined in terms of their individual responsibilities. The Order Placement CA=1 component sure does know a CE=4 lot about placing an order. CT=1 CT=5 Decrement inventory Inventory **Order** Place an order Management Placement Stock low? Order more Notify the Stock customer low? CT=1 Raise CT=1 the price Now that's Supplier CT=1 not nice. Ordering Email **Notification** Item Pricina **Total System Coupling = 9** 

# Brain Power

What possible issues do you see with the logical architecture above? We've provided some (but not all) potential problems. Check off the ones you think might be an issue, and write down any other possible issues you see with this logical architecture.

| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/> The customer might not be available to get their email when it's sent.</div>                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/> The supplier might not have stock on hand.</div>                                                 |
| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/> The Order Placement component knows too much about the steps involved in placing an order.</div> |
| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/></div>                                                                                            |
| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/></div>                                                                                            |
| <div style="display:inline-flex; align-items:center;"><input type="checkbox"/></div>                                                                                            |

# Applying the Law of Pemeter

The total system coupling level didn't bother us that much. What *does* bother us is how tightly coupled the Order Placement component is (CT=5), how unbalanced the component coupling is, and how much knowledge the Order Placement component has about the order placement process.

Let's apply the Law of Demeter to fix these problems by moving the "low stock" knowledge to the Inventory Management component.

![](_page_186_Picture_4.jpeg)

![](_page_186_Figure_5.jpeg)

By moving the *knowledge of actions to take for a* "low stock" condition to Inventory Management, we reduced the amount of knowledge about the system, and hence the coupling, of the Order Placement component However, we *increased* the knowledge of the Inventory Management component, and thus increased its coupling. This is what the Law of Demeter is all about—less knowledge, less coupling; more knowledge, more coupling.

Coupling is all about how much knowledge components have about the rest of the system.

![](_page_186_Figure_8.jpeg)

Did you notice that while we reduced the coupling of the Order Placement component, the total system coupling level remained the same? That's because we didn't *remove* the knowledge from the system, we just *moved* it to another component—Inventory Management.

Total System Coupling = 9

<span id="page-187-0"></span>![](_page_187_Picture_1.jpeg)

# **Test Drive**

Now it's time to take the Law of Demeter for a test drive to see if you can decouple a logical architecture. Below is a logical architecture for a system where customers who have purchased a support plan with an electronic item can submit a trouble ticket and have an expert come out to fix the item. Here's how it currently works:

- A customer creates a ticket. 1
- The ticket gets assigned to an available expert in the field. 2
- The ticket is uploaded to an app on the expert's mobile device (that's Ticket Routing). 3
- The customer is notified that the expert is on their way to fix the problem. 4
- Once the expert fixes the problem, they mark the ticket as completed. 5

Keeping the components the same, how can you make this architecture more loosely coupled?

![](_page_187_Figure_10.jpeg)

**Solution on page 164**

# <span id="page-188-0"></span>A balancing act

Do you remember the *First Law of Software Architecture*? Here it is again (because it's so important):

#### *Everything in software architecture is a trade-off.*

Loose coupling is no exception. Let's compare the two architectures we've just seen and analyze their trade-offs.

![](_page_188_Picture_5.jpeg)

## **Tightly coupled**

![](_page_188_Figure_7.jpeg)

Centralized workflow, but more risk with each change

With the *tightly* coupled architecture, if you want to know what happens when a customer places an order, you only have to look at the Order Placement component to understand the workflow.

However, in this case, the Order Placement component is dependent on four other components. If any one of those components changes, it could break the Order Placement component.

These are the trade-offs for tight coupling.

![](_page_188_Picture_12.jpeg)

With *loose* coupling, you distribute the knowledge about what needs to happen, so that no one component knows all the steps. If you want to understand the workflow of placing an order, you have to go to multiple components to get the full picture.

However, changing the Item Pricing and Supplier Ordering components will no longer affect the Order Placement component.

#### **Loosely coupled**

![](_page_188_Figure_16.jpeg)

Distributed workflow, but less risk with each change

These are the trade-offs for tight coupling.

This is a good rule to remember.

->

*Two components are* **coupled** *if a change in one component might cause a change in the other component.*

# <span id="page-189-0"></span>Some final words about components

Congratulations! Now that you can identify logical components and the dependencies between them, you're on your way to creating a software architecture. We know this was a long chapter, but it's also an important one. Thinking about a system as a collection of logical components helps you, as an architect, better understand its overall structure and how it works.

In the next part of your software architectural journey, you'll be focusing on the technical details of the system—things like architecture styles, services, databases, and communication protocols. But before you go, review the following bullet points to make sure you fully understand everything about logical components.

# **Bullet Points**

- *Logical components* are the functional building blocks of a system.
- A logical component is represented by a *directory structure*—the folder where you put your source code.
- When naming a component, be sure to provide a descriptive name to clearly identify what the component does.
- Creating a logical architecture involves four continuous steps: identify components, assign requirements, analyze component responsibilities, and analyze architectural characteristics.
- You can use the *workflow approach* to identify initial core logical components by assigning the steps in a primary customer journey to components.
- You can use the *actor/action approach* to identify initial core logical components by identifying the actors in the system and assigning their actions to components.
- The *entity trap* is an approach that models components after major entities in the system. Avoid using this approach, because it creates ambiguous components that are too large and have too much responsibility.
- When assigning requirements to components, review each component's role and responsibilities to make sure it should be performing that function.

- *Coupling* happens when components depend on one other to perform a business function.
- *Afferent coupling*, also known as incoming coupling, occurs when other components are dependent on a target component.
- *Efferent coupling*, also known as outgoing coupling, occurs when a target component is dependent on other components.
- Components having too much knowledge about what needs to happen in the system increases component coupling.
- The *Law of Demeter* states that services or components should have limited knowledge of other services or components. This law is useful for creating loosely coupled systems.
- While loose coupling reduces dependencies between components, it also distributes workflow *knowledge*, making it harder to manage and control that knowledge.
- Determining the total coupling (CT) of a logical architecture involves adding the afferent and efferent coupling levels for each component (CA + CE).

![](_page_190_Picture_1.jpeg)

# **Logical Components Crossword**

Now's your chance to have a little fun and see how much knowledge you've gained. See if you can fill in this crossword puzzle with clues about logical components.

![](_page_190_Picture_4.jpeg)

#### Across

| 3. Each component performs a                                     |                                                |
|------------------------------------------------------------------|------------------------------------------------|
| 4. ________ gateways appear in a physical architecture but not a |                                                |
| logical one                                                      |                                                |
| 6. A physical architecture associates                            | with components                                |
| 7. One system component might be a live video                    |                                                |
| 9. Avoid building a big ball of                                  |                                                |
| 11. Be sure to avoid the                                         | trap                                           |
| 12. Coupling might be                                            | or efferent                                    |
| 13. Logical                                                      | are the functional building blocks of a system |
| 16. Early on, you'll identify                                    | core components                                |
| 19. A user's journey through the system is called their          |                                                |
| 20. Each logical component has a                                 | and a responsibility                           |

| Down |
|------|
|------|

| 1. A component's __________ is about how interrelated its operations are       |
|--------------------------------------------------------------------------------|
| 2. Give each component a descriptive __________                                |
| 5. Afferent and efferent coupling are both forms of __________ coupling        |
| 8. The Principle of Least Knowledge is also called the Law of __________       |
| 10. A good place to look for components is the codebase's __________ structure |
| 12. Step 2 is to __________ requirements to logical components                 |
| 14. An architecture diagram can show the logical or __________ architecture    |
| 15. Adventurous Auctions lets users __________ on trips                        |
| 17. You can identify components with an __________/action approach             |
| 18. Identifying logical components may involve taking your best __________     |

Solution on page 165

![](_page_191_Picture_2.jpeg)

# Name that component

It's your first week on the job as the new architect, and you've been assigned to an existing project to build a trouble ticket system. You want to understand the logical components of the architecture, but your team doesn't know anything about logical components—they just started coding. To determine the logical architecture, you have to look at the existing directory structure. How many individual logical components can you identify from the codebase below? Here are our answers.

![](_page_191_Figure_5.jpeg)

# Who Does What Solution

**From page 128**

<span id="page-192-0"></span>We had our logical and physical architecture responsibilities all figured out, but somehow they got all mixed up. Can you help us figure out who does what? Be careful—some responsibilities may not have a match (they aren't part of a logical or physical architecture).

Logical architecture Physical architecture Shows which programming language is used for each component Maps components to services Shows how many databases there are in the system and which services access them Shows communication between services and the protocol they use (like REST) Shows the components and their interactions within the user interface Shows the API gateways and load balancers used Shows the logical components within the system and how they communicate with each other Shows the source code files used to implement a component This is part of implementation, not architecture.

in the system

# Sharpen your pencil Solution

![](_page_193_Picture_3.jpeg)

Your company wants a new system to assign workers to construction sites, and it's your job as the software architect to identify its initial core components. Using the workflow approach, identify as many core components as you can, matching each to its associated workflow step. Remember, a workflow step can have multiple components, and not every workflow step has to have a unique component.

- Step 1: Maintain a list of all construction workers, their skills, and their locations
- Step 2: Create a new construction project and specify the work site
- Step 3: Create a schedule for when various construction projects start and end
- Step 4: When a new project starts, assign workers based on their skills and locations
- Step 5: When the project completes, free up workers so they can be reassigned

Draw your logical components in this space. Remember to give them good descriptive names.

![](_page_193_Figure_11.jpeg)

It makes sense to have two components because the profile is relatively static, whereas the location changes a lot.

component can handle both assigning contractors (step 4) and unassigning them (step 5).

![](_page_194_Picture_2.jpeg)

You have a bakery that is ready to expand operations, and you would like a new system that lets customers view, order, and pay for bakery items online for pickup. Orders are sent to the bakery coordinator, who purchases ingredients and schedules orders. The baker receives the schedule of items to bake each morning, and tells the system when the items are baked. The system then emails the customers to let them know their items are ready for pickup.

Using the actor/action approach, identify what actions each actor might take, then draw as many logical components as you can for the new bakery system, matching the actions you identified to the components.

![](_page_194_Figure_5.jpeg)

![](_page_195_Figure_1.jpeg)

![](_page_195_Figure_2.jpeg)

**Exercise Solution**

From page 137

Can you select the most appropriate approach to identifying initial core components in the following scenarios? In some cases, more than one approach may be appropriate.

| The system has only one type of user      | <span>✔</span> Workflow <span>□</span> Actor/Action |
|-------------------------------------------|-----------------------------------------------------|
| The system has well-defined entities      | <span>✔</span> Workflow <span>✔</span> Actor/Action |
| You have minimal functional requirements  | <span>✔</span> Workflow <span>✔</span> Actor/Action |
| The system has many complex user journeys | <span>✔</span> Workflow <span>□</span> Actor/Action |
| The system has many types of users        | <span>□</span> Workflow <span>✔</span> Actor/Action |

Neither approach requires lots of functionality to create initial logical components.

*Remember to avoid the entity trap, even if the system has well-defined entities.*

![](_page_196_Picture_2.jpeg)

Your company, Going Green Corporation, wants a system to support its new electronics recycling program, where customers can send in their old electronic devices (like cell phones) and get money. We've already identified some of the initial core components. Your job is to figure out which component should be responsible for each of the functionalities listed below, or if a new component is needed. You'll also need to come up with names for any new

components.

Device Receiving
Physically receive the device from the customer.Device Assessment
Assess the device's conditionDevice Recycling
Recycle or resell the old device.

| Locate the nearest safe disposal facility for destroying the device                | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input checked="" type="checkbox"/> Device Recycling             Other: <input type="text"/>                  |
|------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Capture and store the customer information (name, address, etc.)                   | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling             Other: <input type="text" value="Customer Profile"/>    |
| Post the device on a third-party site to resell it on the secondary market         | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input checked="" type="checkbox"/> Device Recycling             Other: <input type="text"/>                  |
| Pay the customer for their recycled device                                         | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling             Other: <input type="text" value="Accounts Payable"/>    |
| Record that the device has been received and is ready for assessment and valuation | <input checked="" type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling             Other: <input type="text"/>                  |
| Determine the value (if any) of the recycled device                                | <input type="checkbox"/> Device Receiving <input checked="" type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling             Other: <input type="text"/>                  |
| Determine the monthly profit and loss for recycled and resold devices              | <input type="checkbox"/> Device Receiving <input type="checkbox"/> Device Assessment <input type="checkbox"/> Device Recycling             Other: <input type="text" value="Financial Reporting"/> |

Going Green Corp. needs to make a profit, after all.

![](_page_197_Figure_1.jpeg)

See if you can offload some of the responsibility of the Live Auction Session component to others by creating new components to handle the additional functionality. Keep the first three original requirements associated with the Live Auction Session.

![](_page_197_Figure_4.jpeg)

# Sharpen your pencil Solution

Given the components below, can you identify the total afferent coupling (CA), total efferent coupling (CE), and total coupling (CT) for each component? Also, what is the total coupling level for this logical architecture? Does the CT for this architecture seem high or low to you?

![](_page_198_Figure_4.jpeg)

![](_page_199_Picture_2.jpeg)

# Test Drive Solution

It's time to take the Law of Demeter for a test drive to see if you can decouple a logical architecture. Below is a logical architecture for a system where customers who have purchased a support plan with an electronic item can submit a trouble ticket and have an expert come out to fix the item. Here's how it currently works:

- A customer creates a ticket.
- 2 The ticket gets assigned to an available expert in the field.
- 3 The ticket is uploaded to an app on the expert's mobile device (that's Ticket Routing).
- 4 The customer is notified that the expert is on their way to fix the problem.
- **6** Once the expert fixes the problem, they mark the ticket as completed.

Keeping the components the same, how can you make this architecture more loosely coupled?

![](_page_199_Figure_11.jpeg)

![](_page_200_Picture_1.jpeg)

![](_page_200_Figure_3.jpeg)

![](_page_202_Picture_0.jpeg)

# architectural styles **5** Categorization and Philosophies

![](_page_202_Picture_3.jpeg)

**There are lots of different architectural styles out there.** Each one exists for a reason and has its own philosophy about how and when it should be used. Understanding a style's philosophy will help you judge whether it's the right one for your domain. This chapter gives you a framework for the different kinds of architectural styles (which we'll be diving into for the remainder of this book), to help you make sense of these and all the other architectural styles you'll encounter as a software architect.

Let's fill in that final piece of the puzzle, shall we?

# <span id="page-203-0"></span>There are lots of architectural styles

You've learned a lot about software architecture so far, but there's *one* thing we still haven't talked about: *architectural styles*. That's what we'll do in this chapter—in fact, the *rest* of this book is dedicated to architectural styles!

Before we get started: look around your neighborhood, then watch a show or movie set in a different part of the world. How many styles of homes do you see? There are literally hundreds—all influenced by the locale, weather, and the owners' personal preferences. New styles are created every day.

![](_page_203_Picture_4.jpeg)

![](_page_203_Picture_5.jpeg)

![](_page_203_Picture_6.jpeg)

That's true for architectural styles in software, too. There are so many out there that even in a book this big, try as we might, we'll barely scratch the surface of all the available styles.

This chapter will give you a framework for thinking about architecture and architectural styles in general. Then, in the chapters that follow, we'll dive deep into a handful of specific architectural styles and examine their philosophies, using what you learn in this chapter. Understanding a few crucial styles will leave you with a good foundation to understand others as you encounter them.

Let's do this.

![](_page_203_Picture_10.jpeg)

And there's our missing piece! -

# <span id="page-204-0"></span>The world of architectural styles

If you've done software development for any length of time, you may have heard about different architectural styles, like monoliths and microservices. To help us think systematically about them, we place them into two categories. The first deals with how the code is divided: either by technical concerns or by domain (business) concerns. The second category is about how the system is deployed: is all the code in the system delivered as one unit, or as multiple units?

Recall from Chapter
2 that the domain is
"the thing you're writing
software about."

![](_page_204_Figure_4.jpeg)

As you can see, there are multiple ways to slice and dice architectural styles. This doesn't cover everything, of course—there are domain-specific architectures that are built explictly for certain problems—but a book can only be so long.

Each category reveals some of the architectural characteristics of its styles. For example, architectural styles delivered as one unit are easier to understand, but those delivered as multiple units tend to scale better.

Let's examine each category.

We won't spend time on domain-specific architectures in this book. Let's just say they don't appeal to a broad audience.

# <span id="page-205-0"></span>Partitioning: Technical versus domain

Think back to the last time you had dinner at a fancy restaurant. When you walked in, a *host* probably greeted you and escorted you to a table. A *server* offered you drinks and menus and explained the specials. The *chef* and other cooks prepared your food for you. When you finished your meal, a *busser* cleaned and reset the table.

These restaurant workers' duties are separated by *technical concern*. A busser's role isn't to welcome you, and you probably don't want the server cooking your food.

Now, think back to the last application you worked on. Did it have a controller layer? Did it have services? How about a persistence tier? If so, congratulations: you've already worked on a technically partitioned architecture.

In a *technically partitioned architecture*, code is divvied up by technical concerns—there might be a presentation tier, a business (services) layer, and so on. The principle at play here is separation by concern—which most people think about in horizontal layers.

Another analogy that might help is a burger, with two halves of a bun, condiments, veggies, and a patty—each layer has a distinct and separate role.

![](_page_205_Picture_7.jpeg)

On the other hand, imagine a food court. It has lots of restaurants, each specializing in a particular kind of food: pizza, salads, stir-fry, burgers. In other words, each restaurant has a specific *domain*.

In *domain-partitioned architectures*, the structure of the system is aligned with the domain. Rather than by roles, the code (and systems) are separated in ways that align with the problem you're attempting to solve.

Each of these restaurants might have servers and bussers. But at a high level, the restaurant specializes in a particular kind of food.

We'll dive into a lot of these details in future chapters.

![](_page_205_Figure_12.jpeg)

# there are no Dumb Questions

<span id="page-206-0"></span>Q: **In a domain-partitioned architecture, where do the presentation and services layers reside?**

A: In a domain-partitioned architecture, you are making the domain the "first-class citizen," leaving the technical implementation as just that: implementation. The logical components that make up your architecture are organized around the *domain*, as opposed to the role they perform.

A technically partitioned architecture's components might be organized in namespaces like app.presentation. customer or app.services.customer. Note how the customer domain appears *within* the technical partition. However, in a domain-partitioned architecture, you'll have namespaces like app.customer.presentation and app.customer. services.

Q: **Domain partitioning is pretty logical. Frankly, it sounds better. So why would anyone use technical partitioning?**

A: We prefer not to use value judgments such as "better" and "best" when discussing architectural styles. (You're going to get tired of us saying this!) Your choice of architectural style will always be driven by a variety of factors, as you know, including the domain and the required architectural characteristics.

Technical partitioning is great if your teams tend to specialize say, if you have teams of frontend experts, backend developers, and database administrators. But domain partitioning better aligns your system with the actual problem at hand.

![](_page_206_Picture_8.jpeg)

# **Exercise**

A short-order cook pretty much does everything. They can cook everything on the menu, from fries to sandwiches, as well as blending smoothies and plating desserts. Often, they also serve food, take payments, and even clean tables after customers leave. Would you categorize a short-order cook's work as partitioned technically or by domain? Why? Jot down your thoughts here.

**Solution on page 182**

# <span id="page-207-0"></span>Peployment model: Monolithic versus distributed

Let's play a game—we say a word, and you respond with the first thing that pops into your mind. Ready? *Monolith*.

We don't know about you, but this word makes us think of something like a boulder or a glacier—something *big*. That's exactly what monolithic architectures represent.

In a *monolithic architecture*, you deploy all the logical components that make up your application as *one unit*. This also means that your entire applications runs as one process.

This would be like packaging and deploying your entire application as a single WAR or JAR file in the Java ecosystem, or as an executable in the .NET world.

![](_page_207_Figure_6.jpeg)

Recall that architectural characteristics influence the structure of the application.

In a *distributed architecture*, by contrast, you split up the logical components that make up the application across many (usually smaller) units. These units each run in their own process and communicate with each other over the network.

Shipping

![](_page_207_Picture_10.jpeg)

There's a lot to this distinction, so let's talk about the pros and cons of both types.

<span id="page-208-0"></span>![](_page_208_Picture_1.jpeg)

Take a moment and consider your smartphone. It does it all—it lets you take pictures and videos, browse the web, post to your favorite social networking site, track your fitness activity, and navigate via GPS. And somewhere, embedded deep within the settings, there's even a phone! As you can see, your phone is a monolithic system. We'd like you to jot down the pros and cons of such a system. Think in terms of architectural characteristics, like availability, upgradability, cost, and ease of use.

|      | Monolithic |
|------|------------|
| Pros | Cons       |
|      |            |
|      |            |
|      |            |
|      |            |
|      |            |
|      |            |

Just a few years ago, people used separate devices for all those functions your phone performs today. Phones were, well, just *phones*, maybe with text messaging. We used laptop or desktop computers to browse the web and post to social networking sites; we could buy fitness trackers to help track workouts and GPS devices to install in cars for navigation help. Each of these "services" was deployed separately.

Just like you did above, jot down the pros and cons of such a system. Again, think in terms of architectural characteristics.

|      | Distributed |      |
|------|-------------|------|
| Pros |             | Cons |

# <span id="page-209-0"></span>Monolithic deployment models: The pros

In Chapter 2, you learned that architectural characteristics always influence some *structural aspect* of the design. Monoliths support some characteristics better than distributed systems, and knowing where they shine can help you decide when to use them.

Because monolithic systems run in one process, they make development easier at least initially. And since they're deployed as one unit, tracing errors is a lot easier.

Let's take a look at the pros and cons of both deployment models, starting with monoliths. Here are the pros:

![](_page_209_Picture_5.jpeg)

#### **simplicity**

Typically, monolithic applications have a single codebase, which makes them easier to develop and to understand.

![](_page_209_Picture_8.jpeg)

## **feasibility**

Rushing to market? Monoliths are simple and relatively cheap, freeing you to experiment and deliver systems faster.

![](_page_209_Picture_11.jpeg)

#### **cost**

Monoliths are cheaper to build and operate because they tend to be simpler and require less

![](_page_209_Picture_14.jpeg)

![](_page_209_Picture_15.jpeg)

## **debuggability**

If you spot a bug or get an error stack trace, debugging is easy, since all the code is in one place.

![](_page_209_Picture_18.jpeg)

## **reliability**

A monolith is an island. It makes few or no network calls, which usually means more reliable applications.

Keep an eye out for this point when we discuss cons on the next page.

Now for the cons...

## <span id="page-210-0"></span>Monolithic: The cons

Some of monoliths' strengths can become problematic as an application grows. Many of the operational characteristics we discussed in Chapter 2, like scalability and reliability, suffer as a monolithic application grows bigger and more complex.

![](_page_210_Picture_3.jpeg)

#### scalability

If you ever need to scale one part of the application independently of the others, well, you're in trouble. It's all or nothing with monoliths.

![](_page_210_Picture_6.jpeg)

![](_page_210_Picture_7.jpeg)

As monolithic applications grow, making changes becomes harder. Furthermore, since the whole application is one codebase, you can't adapt different technology stacks to different domains if you need to.

![](_page_210_Picture_9.jpeg)

## reliability

Because monolithic applications deploy as a single unit, any bug that degrades the service will affect the whole monolith.

Next, we'll look at the pros and cons of distributed architectures.

There's reliability again!

![](_page_210_Picture_13.jpeg)

## deployability

Implementing any change will require redeploying the whole application, which could introduce a lot of risk.

Brain

Spend a few minutes thinking about your industry. Does your organization have any special regulatory, security, or compliance needs? How might using a monolithic architecture help or hurt its ability to achieve the architectural characteristics that address those needs? List any ways you can think of here:

Pros Cons

Hint: Think about things like auditability, reportability, the "right to be forgotten," etc.

# <span id="page-211-0"></span>Distributed deployment models: The pros

With distributed architectures, you deploy your logical components as separate units. This makes it easy to scale some parts of your application separately from others. And since logical components are physically separate, distributed architectures encourage *low coupling*.

So, what architectural characteristics are distributed architectures good for? Here's a sampling:

![](_page_211_Picture_4.jpeg)

## scalability

Distributed architectures deploy different logical components separately from one another. Need to scale one? Go ahead!

![](_page_211_Picture_7.jpeg)

## testability

Each deployment only serves a select group of logical components. This makes testing a lot easier—even as the application grows.

Distributed architectures are a lot more testable than monolithic applications.

![](_page_211_Picture_11.jpeg)

#### fault tolerance

Even if one piece of the system fails, the rest of the system can continue functioning.

![](_page_211_Picture_14.jpeg)

## modularity

Distributed architectures encourage a high degree of modularity because their logical components must be loosely coupled.

![](_page_211_Picture_17.jpeg)

## deployability

Distributed architectures encourage lots of small units. They evolved after modern engineering principles like continuous integration, continuous deployments, and automated testing became the norm.

Having lots of small units with good testability reduces the risk associated with deploying changes.

As you might have noticed, distributed architectures do better on many of monolithic architectures' weak points. But is the opposite true? Let's find out.

# <span id="page-212-0"></span>Distributed deployment models: The cons

Can't have pros without cons. Trade-offs, right? It's all about trade-offs.

![](_page_212_Picture_3.jpeg)

#### performance

Distributed architectures involve lots of small services that communicate with each other over the network to do their work. This can affect performance, and although there are ways to improve this, it's certainly something you should keep in mind.

![](_page_212_Picture_6.jpeg)

#### cost

Deploying multiple units means more servers. Not to mention, these services need to talk to one another—which entails setting up and maintaining network infrastructure.

Debugging distributed systems involves thinking deeply about logging, and usually requires

aggregating logs. This also

adds to the cost.

![](_page_212_Picture_9.jpeg)

#### simplicity

Distributed systems are the *opposite* of simple. Everything from understanding how they work to debugging errors becomes challenging.

We cannot emphasize enough how complex distributed architectures can be!

![](_page_212_Picture_13.jpeg)

#### **debuggability**

Errors could happen in any service involved in servicing a request. Since logical components are deployed in separate units, tracing errors can get very tricky.

Distributed architectures make some things easy, while making others very hard.

![](_page_212_Picture_17.jpeg)

#### It's easy to underestimate how hard distributed computing is!

For all their benefits, distributed architectures depend on the network. Software architects often underestimate the complexities that arise from this dependency. Look up "The Fallacies of Distributed Computing," a list compiled in the 1990s by L. Peter Deutsch and others at Sun Microsystems, to get a sense of what to watch out for.

<span id="page-213-0"></span>![](_page_213_Picture_1.jpeg)

Let's repeat the exercise you did earlier, this time for distributed architecture. Does your organization have any special regulatory, security, or compliance needs? How might using a distributed architecture help or hurt your organization's ability to achieve the architectural characteristics that address those needs? List any ways you can think of here:

**Pros Cons**

![](_page_213_Picture_4.jpeg)

# **Fireside Chats**

Tonight's talk: **Monolithic and distributed** architectures answer the question: **"Who's more relevant?"**

#### **Monolithic Architecture Distributed Architecture**

It's a good thing I'm still around. Boy, do you make things complicated.

I might be simple, but I'm also faster to develop. I can't imagine anyone building a minimum viable product with you—they'd never launch!

Oh! And I'm way cheaper. You realize that most businesses don't want to waste money, right? I can't imagine anyone using you to create a proof of concept. I don't like that attitude. Sure, you might be "simpler" to develop, but you can't keep up. Businesses need to move fast, and you just don't deliver the goods.

I might give you that—but I'll make sure they make it to the finish line. And if their product is a smash hit, will you help or just get in the way? I can ensure success even at scale.

#### <span id="page-214-0"></span>**Monolithic Architecture Distributed Architecture**

It's a good thing you can be tested easily—ever seen a useful error stack trace? Of course you haven't. You're all

At least when I get an error, you get a nice, clear stack trace.

an error actually happened.

over the place. Good luck trying to trace why and where

At least I'm just one process. No unnecessary network traffic here. You're all talk, man—so *much* chatter. All your services are constantly talking to one another.

And that's only if the network is always reliable, because without it, you have nothing! Heaven help you if the network should fail.

Plus, with me, you don't need a whole bunch of network infrastructure. Do you know how expensive that stuff is to maintain?!

What? Are you saying I'm old news? Well, the next time a team needs to get to market quickly, don't call me—and then we'll see how tough you really are.

Businesses also like *making* money. Once their applications grow, you're just a money pit. I personify agility—I help teams and organizations scale as they grow.

I also make testing easier, while *you* just rack up the technical debt.

*Riiiight.* And when you fail, you just topple over. I provide a high degree of fault tolerance. Need a service to scale? Just scale that service. Scaling *you* is arduous.

Hey, that's the cost of doing business at scale. Teams might *start* with you, but if they want to keep growing, they'll come to me—and leave you in the rearview mirror.

Feeling's mutual, bud. Don't call *me* when your team's minimum viable product is a success and their architecture can't handle all the attention.

# <span id="page-215-0"></span>And that's a wrap!

Now you know how to categorize the tons of architectural styles out there. Having a framework can help you make sense of them. And remember each quadrant of the framework represents both the pros *and* cons of those architectural styles.

In the next chapter, we'll start our deep dive into individual styles.

# **Bullet Points**

- There are a lot of architectural styles—in fact, too many to count.
- There are multiple ways to categorize architectural styles. One is by their *partitioning style*. Architectural styles can be either technically partitioned or domain partitioned.
- In *technically partitioned* architectural styles, the code is split up by technical concern. For example, there might be a presentation layer and a services layer.
- In *domain-partitioned* architectural styles, the code is instead split up by problem domain.
- Another way to categorize architectural styles is by their *deployment model*. *Monolithic* architectural styles deploy all the logical components that make up an application as a single unit. *Distributed* architectural styles deploy the logical components separately from one another, as multiple units.
- Monolithic architectures are easier to understand and debug and are often cheaper to build (at least initially). This makes them great candidates if there is a rush to bring a product to market.

- As monolithic applications grow, scaling them up can become arduous. It's an all-or-nothing scenario: you either scale up the whole application or nothing at all.
- Monolithic applications can also be unreliable—a bug can make the entire application unusable.
- Distributed architectures are highly scalable since their logical components are deployed separately, allowing different parts of the application to scale independently of one another.
- Distributed architectures encourage a high degree of modularity, which means testing them is easier.
- Distributed architectures are extremely expensive to develop, maintain, and debug.
- Distributed architectures use the network so that different services can talk to one another to complete work. This introduces even more complexity.

![](_page_216_Picture_1.jpeg)

# **Stylin' Architectures Crossword**

Now that you can make sense of architectural styles, see if you can make sense of this crossword.

![](_page_216_Picture_4.jpeg)

#### Across

| 2. You can                                         | systems technically or by domain                        |
|----------------------------------------------------|---------------------------------------------------------|
| 3. L. Peter                                        | helped compile “The Fallacies of Distributed Computing” |
| 7. Monoliths are good for creating a               |                                                         |
| 10. Regardless of the physical architecture, a     | system provides more confidence in correct outcomes     |
| 14. Distributed and monolithic are both deployment |                                                         |
| 15. Minimum viable                                 |                                                         |
| 17. Monolithic systems are easier to               |                                                         |
| 18. Monolithic architectures have                  | deployment units                                        |

#### **Solution on page 184**

#### Down

| 1. Layers are separated by                                        |                              |
|-------------------------------------------------------------------|------------------------------|
| 2. Each architectural style has its own                           |                              |
| 4. Monolithic architectures tend to have a fast                   | to market                    |
| 5. A system deployed as one big unit                              |                              |
| 6. If you change anything in a monolith, you'll need to           |                              |
| 8. An architecture's organization is reflected in its             | spaces                       |
| 9. Services in a distributed architecture use this to communicate |                              |
| 11. Distributed systems consist of many                           | deployment units             |
| 12. Nothing about distributed deployment models is                |                              |
| 13. Architectures often have more than one                        |                              |
| 16. Distributed systems usually                                   | more than monolithic ones do |

![](_page_217_Picture_1.jpeg)

A short-order cook pretty much does everything. They can cook everything on the menu, from fries to sandwiches, as well as blending smoothies and plating desserts. Often, they also serve food, take payments, and even clean tables after customers leave. Would you categorize a short-order cook's work as partitioned technically or by domain? Why? Jot down your thoughts here.

Because a short-order cook does everything needed to get customers their meals, from setting the tables to prepping and cooking to cleaning up, they own the whole "domain" of food preparation. This makes their job domain-partitioned.

![](_page_218_Picture_1.jpeg)

![](_page_218_Picture_2.jpeg)

Take a moment and consider your smartphone. It does it all—it lets you take pictures and videos, browse the web, post to your favorite social networking site, track your fitness activity, and navigate via GPS. And somewhere, embedded deep within the settings, there's even a phone! As you can see, your phone is a monolithic system. We'd like you to jot down the pros and cons of such a system. Think in terms of architectural characteristics, like availability, upgradability, cost, and ease of use.

#### **Monolithic**

#### **Pros Cons**

Convenience—I only need to carry one device.

Upgradability—I don't have to deal with patching and upgrading multiple devices.

Ease of use—If I'm in a rush or going on a trip, I only need to carry one device.

Availability—If my phone dies or is damaged, I can't do any of these functions.

Cost—Smartphones can be expensive to replace.

Portability—I can only use apps that work on my <sup>p</sup>hone's operating system.

Just a few years ago, people used separate devices for all those functions your phone performs today. Phones were, well, just *phones*, maybe with text messaging. We used laptop or desktop computers to browse the web and post to social networking sites; we could buy fitness trackers to help track workouts and GPS devices to install in cars for navigation help. Each of these "services" was deployed separately.

Just like you did above, jot down the pros and cons of such a system. Again, think in terms of architectural characteristics.

#### **Distributed**

#### **Pros Cons**

Coupling—If my phone's camera breaks, I can still make calls or track my workout.

Modularity—Each device does one thing and one thing only, so it's easier to test.

Evolvability—I can buy an SLR camera if I want to take really nice pictures.

Upgradability—Everything has to be managed separately, like upgrading.

Complexity—There's much more to manage (I need multiple batteries, chargers, and so on).

Reliability—Network connectivity can be unreliable; devices might drop connections or have spotty connections.

# **Stylin' Architectures Crossword Solution**

**From page 181**

![](_page_219_Figure_3.jpeg)

6

# layered architecture **<sup>6</sup>** Separating Concerns

![](_page_220_Picture_3.jpeg)

**What if your problem is simple and time is of the essence?** Should you even bother with architecture? It depends on how long you want to keep what you build. If it's disposable, throw caution to the wind. If not, then choose the simplest architecture that still provides some measurable organization and benefit, without imposing many constraints on speed of delivery. The *layered architecture* has become that architecture because it's easy to understand and implement, leveraging design patterns developers already know. Let's peel back the layers of this architecture.

# Naan & Pop: Gathering requirements

Sangita likes simple meals, so she created an Indian-inspired mom-andpop restaurant called Naan & Pop, specializing in flatbread sandwiches and sodas.

The restaurant needs a website where customers can place orders online. Since Naan & Pop is a startup with a small budget, it needs to be simple and created quickly.

Sangita has some specific requirements.

![](_page_221_Picture_5.jpeg)

#### **Time to market**

The restaurant is already open. The faster they can get the site online, the faster they can start making money. The site should be simple.

![](_page_221_Picture_8.jpeg)

![](_page_221_Picture_9.jpeg)

#### **Separation of responsibilities**

The company has part-time help with specialized skills, such as user interface (UI) specialists and database administrators (DBAs). Thus, it would help to keep each part of the system separate.

![](_page_221_Picture_12.jpeg)

#### **Simple, yet extensible**

While this is Sangita's first foray into software architecture, she would like to keep building on the company's online presence and find ways to extend and reuse parts of the system.

Sangita has some software development experience and realizes that many of these goals require a good separation of responsibilities. She passes these requirements to the development team she's hired for this project. You're a part of that team, so pay close attention.

# Cubicle conversation

![](_page_222_Picture_2.jpeg)

**Alex:** Our project manager just sent the requirements and goals for Naan & Pop's web application. It's so simple. Couldn't we just find an existing framework or library to handle most of it?

**Mara:** That would solve the simplicity goal. But Sangita also wants extensibility, and existing frameworks tend to be a bit rigid.

**Sam:** What kind of extensibility does she want?

**Mara:** If the restaurant is a success, we might want the site to support different kinds of user interfaces, or we could build integration points for delivery services.

**Alex:** Yeah—existing simple applications might not handle the separation of responsibilities Sangita would need for that kind of extensibility.

**Sam:** But we don't have time to build a fancy architecture!

**Alex:** This seems impossible—how can we build a proper architecture with specializations under these time constraints?

**Sam:** Fortunately, we've already worked with other team members to define the architectural characteristics (for the application's capabilities) and domain design (for its behavior). We just need to choose the appropriate architecture.

**Mara:** Those are some serious trade-offs and conflicting goals. We need a simple architectural style that lets us separate responsibilities around technical areas, such as user interface, data, business logic, and so on. That way, adding a new user interface will only affect one layer.

**Alex:** "Separate responsibilities..." I just read that phrase in the book *Head First Design Patterns*! I was reading about the Model-View-Controller design pattern.

**Sam:** Yeah, but that's a design pattern—how would you translate that to architecture?

**Mara:** Lots of design patterns end up in architecture, because often their goals overlap. But, while design patterns can focus just on design elements, architecture has to account for real-world constraints. Let's crack open the book and see if we can map Model-View-Controller into architecture.

# <span id="page-223-0"></span>Design patterns redux

To illustrate the concept of design patterns, the influential book *Head First Design Patterns* uses the *Model-View-Controller* (MVC) design pattern, which separates capabilities based on their purpose.

In MVC, the *model* represents business logic and entities in the application; the *view* represents the user interface; and the *controller* handles the workflow, stitching model elements together to provide the application's functionality, as shown here:

A "design pattern" is a contextualized solution to a common problem in software design.

Patterns
Building Extensible
& Maintainable
Object-Oriented
Software

Eric Preeman & Elinabeth Rosson
with Knowy Surve & Bert Brown

You can learn more about design patterns from this book.

![](_page_223_Figure_7.jpeg)

The controller represents the workflow of the application, combining model elements and facilitating their translation into view elements.

The user interacts with the application through the user interface, using the workflow defined by the controller to manipulate the model elements

Brain Power

The MVC design pattern separates *logical* responsibilities, but software architecture must also deal with *physical* systems, like browsers and databases. How would you split the responsibilities covered by MVC within the constraints of software architecture, while maintaining the overall goal of separating responsibilities and concerns?

# <span id="page-224-0"></span>Layering MVC

Design patterns represent logical solutions to problems, but architecture must deal with real-world constraints like databases, user interfaces, and other implementation details.

# Presentation Workflow Persistence

Typical layered architecture

Like most layers, this one is optional, depending on the application's requirements.

# Layered Monolith

"Monolith" implies

deployment unit.

the monolith. That this is a single

box represents

The monolithic deployment model, discussed in Chapter 5, is often combined with layered architectures. While it's common for different teams to work on the code and on the database, a monolithic architecture releases both database and code changes together.

#### Presentation 🚳

![](_page_224_Picture_8.jpeg)

The V for "view" in MVC concerns the UI and how the user interacts with the system. In a layered architecture, UI elements appear in the presentation layer.

## Workflow 🖏 🚣

![](_page_224_Picture_11.jpeg)

The workflow laver contains most of the application's code. Business logic, workflows, validations, and other domain activities reside in this layer.

#### Persistence

![](_page_224_Picture_14.jpeg)

Many teams use a special persistence layer in their architecture to map code-based hierarchies (such as objectoriented languages) into setbased relational databases

## Database 🚣

![](_page_224_Picture_17.jpeg)

While it's optional, the "model" from MVC usually maps to a database or other persistence mechanism.

> Not all applications use a database, but they may persist information elsewhere: a file system, the cloud, and so on.

![](_page_225_Picture_1.jpeg)

**Head First:** Welcome, Layer, to our luxurious studio. I know you have a busy schedule, so thanks for making the time.

**Layer:** You're welcome. As you say, I'm a pretty big deal. They even named an architecture after me!

**Head First:** Let's dig into that, Layer. Why base a whole architecture on you?

**Layer:** Great question. I make everything nice and understandable in an application's architecture, since each layer has a specific responsibility.

**Head First:** So, this architecture is just for neat freaks?

**Layer:** No! Putting all the similar functionality in separate layers makes it easier to find it again to make changes. For example, if the team needs to add a different database, they only have to change the persistence layer.

**Head First:** Ah. So organizing everything allows for easier discovery and updating. Seems like a good reason for an architecture.

**Layer:** While unified organization is nice, it's not the only reason to base an architecture on me.

**Head First:** What do you mean?

**Layer:** I hate to brag, but us layers are quite flexible—we can be used for all sorts of things!

**Head First:** Well, I know you often show up for user interfaces and provide a place to put all the business logic.

**Layer:** Sure, we do the heavy lifting for those. But teams can mold us into all kinds of UIs. For instance, a services layer can provide an interface to other applications that need to interact with this one.

**Head First:** Do you have a good example of how teams have leveraged you, Layer?

**Layer:** You bet! I worked with a team that handled loyalty programs for a hotel. Every purchase a user made could qualify for bonus points, depending on their membership status, years of membership, and a bunch of other complicated stuff. The team successfully used a bonus layer to keep all the calculations in a single place.

**Head First:** OK, that sounds useful. Can you address the recent controversy about your chilly relationship with Domain-Driven Design?

**Layer:** What kind of interview is this? There's no credence to those rumors that we can't get along. Well, as you know, I specialize in *technical* separation. My friend DDD focuses more on *domain* or business separation. I'm happy to host a domain in my architecture, but it'll likely have to split across the layers.

**Head First:** Isn't it true that you're older than other architectural styles?

**Layer:** The idea of layers in architecture predates just about any other concept. And is that really surprising? When architects start thinking about how to organize things, I just make sense.

**Head First:** We're nearly out of time, but can you tell us about your cozy relationship with the monolith? You seem to be hosted by it a lot.

**Layer:** No comment.

<span id="page-226-0"></span>![](_page_226_Picture_1.jpeg)

But I still don't
understand how it
works. How does a user
request fit into the
layered structure we've
been building?

# Great question. Requests and responses flow through the layers.

In a layered monolithic architecture, when a user asks the system to do something, the user interface initiates the request. Then that request flows through each layer in the architecture. If the database is involved in persisting something, then the request goes from top to bottom and back.

![](_page_226_Figure_5.jpeg)

# <span id="page-227-0"></span>Layering it on

For an application like the Naan & Pop site, your team will build logical components to match the problem. But how will you implement those components?

Layers, in this type of architecture, are created with packages or namespaces, just like domain components. However, to maintain the separation of concerns, the layers' package structures typically reflect their place within the partitioning:

```
com.naanpop.orderapp.presentation

com.naanpop.orderapp.workflow

com.naanpop.orderapp.model

com.naanpop.orderapp.persistence

The fully qualified names of these layers will appear as packages in Java, namespaces in NET, or whatever namespacing mechanism your language of choice uses.
```

Like the logical components, the architectural layers use the component implementation of the underlying platform, which often maps to the underlying filesystem:

![](_page_227_Figure_6.jpeg)

# <span id="page-228-0"></span>Translating layers into code

Once your team has built the component packages (or namespaces), you'll need to assist the developers in implementing the architecture. Here's an example in Python-like pseudocode to illustrate how the layers translate to code.

![](_page_228_Picture_3.jpeg)

The *user interface layer*, or *presentation layer*, is the topmost layer. It's responsible for interacting with the user, serving the same purpose as the *view* part of MVC.

```
def UI_layer(request):
 data = request.get_data()
 return business_logic_layer(data)
                                 Get the request 
                                 from the user.
                            Pass the request to 
                            the workflow layer.
```

![](_page_228_Picture_6.jpeg)

The *workflow layer* (sometimes called the *business rules layer*) is responsible for processing each request from the UI layer and returning a response.

```
def business_logic_layer(data):
 processed_data = process_data(data)
 return data_access_layer(processed_data)
                                     Process the data 
                                     from the UI layer.
                          Pass the processed data to 
                          the data access layer.
```

![](_page_228_Picture_9.jpeg)

The *persistence layer* (or *data access layer*) is responsible for accessing the data from the database and returning it to the workflow layer.

```
def data_access_layer(data):
 retrieved_data = retrieve_data(data)
 return retrieved_data
                                       Access the data in 
                                       the database.
            Return the retrieved data to
```

the workflow layer.

# there are no Dumb Questions

Q: **You said in Chapter 5 that every architectural style has a category and a philosophy. Where does the layered architecture fit in?**

A: We're glad you're thinking about that. As we said in Chapter 5, understanding the categories reveals a lot about what characteristics a particular architectural style will support.

The layered architecture is a *technically partitioned* architectural style, typically deployed as a *monolith.* (We say *typically* because we'll discuss some variations on this model soon.)

![](_page_229_Picture_1.jpeg)

Wait. We went through
a logical component analysis to
determine the application's behavior.
Where do those components reside
within the layers of this architecture?

# This is an important point—the domain behavior lives *across* the layers in this architecture.

The *domain*, as you'll recall, represents logical components based on the problem you're trying to solve. However, the layers in this architecture represent *technical* capabilities—user interface, business logic, and so on.

The domain maps onto the layered architecture, sometimes spreading between layers.

# there are no Dumb Questions

# • Why these particular layers—presentation, workflow, and persistence?

These are common layers, but they are by no means required. Most applications have at least some of this separation: for instance, the UI is often distinct from the core logic of the system, which in turn is separate from the database development.

# Was the layered architecture inspired by the Model-View-Controller design pattern?

The opposite is likely true. Layered architectures, which have existed as long as people have been building software from different parts, may well have inspired the design pattern. Design patterns are often harvested from observations of common occurrences, and the layered architecture has been around for quite some time in many forms.

# <span id="page-230-0"></span>Domains, components, and layers

In a simple restaurant ordering system like Naan & Pop's, we might come up with the following components based on the problem domain:

![](_page_230_Figure_3.jpeg)

But there's a problem. These components are based on the logical *behavior* of the domain, but the layered architecture splits things by *capabilities*. So, we need to separate the logical components (which include workflows and entities) into components that match what we need for the layered architecture:

![](_page_230_Figure_5.jpeg)

Once we've split the logical components into workflow and entities, we can overlay the components over the layers in this architecture:

![](_page_230_Figure_7.jpeg)

## <span id="page-231-0"></span>Sharpen your pencil Naan & Pop's lead architects have designed a layered architecture. Today, though, they're off at a daylong breadmaking seminar to learn more about their problem domain, leaving you to sort out which components go where. Can you decide in which layer (or layers) each component should reside? Draw the components below on the layer(s) to which they should map. tint: Some components may end up in several layers. Components **Pelivery** Sales Billing Promotion Address Address Frequent **Blacklisted** Diner Customers Rewards Presentation **Employee** Workflow Information Persistence We did one for you. Employee The typical implementation of information, like drivers' details, this architecture assumes that may be needed by workflows and anything in the persistence persisted, yet not be part of layer ends up in the database. the presentation layer.

Solution on page 210

![](_page_232_Picture_1.jpeg)

It seems like every architecture provides some benefits but also imposes some restrictions. If only I could have an architecture that maps perfectly to my problem domain, without any pesky trade-offs! But that's only a dream...

# there are no Dumb Questions

Q: **Why go to the trouble of identifying logical components if we have to break them apart to fit them into this architecture?**

A: The logical components represent the problem you're trying to solve. Mapping that to any architecture means applying realworld constraints (and trade-offs). We'll show you a more direct domain-to-architecture mapping in the next chapter, but it has trade-offs, too.

Q: **Why is the layered architecture so popular?**

A: This architecture shows up a lot. First, it's simple, without many moving parts. Second, as you've seen, it maps closely to the MVC design pattern, making it easy to understand. Third, it's so common that teams can build simple projects quickly in this style. Fourth, many companies separate their employees by skill set, which facilitates an architecture with similar partitions.

# <span id="page-233-0"></span>**Privers for layered architecture**

We've put together a list of the things the layered architecture is really good at—that is, the things that might drive us toward picking this particular architectural style.

![](_page_233_Picture_3.jpeg)

#### **Specialization**

Using a layered architecture allows organizations to split teams into specialists, sharing their capabilities between different projects.

The ability to specialize — makes this architecture popular in organizations that need to share special skills across multiple projects.

![](_page_233_Picture_7.jpeg)

#### Ease of (technical) reuse

Splitting the architecture by technical capabilities allows better opportunities to reuse code. For example, if all persistence code resides in a single layer, it's easier for developers to find, update, and reuse it.

The ability to reuse components within a layer is one of the key advantages of this architecture for many organizations.

![](_page_233_Picture_11.jpeg)

## Matches physical separation

The layered architecture typically separates the logical components to match the physical separation. For example, it's common for teams to implement different layers in different technology stacks (such as JavaScript, Java, and MySQL).

Often, the real world prevents architects from designing what they want, instead forcing them to design with what they have.

![](_page_233_Picture_15.jpeg)

## Conceptual twin of MVC

Simplicity and concerns about feasibility are driving forces in many architectures. Developers find it easier to understand and work within an architecture that matches familiar design patterns, such as MVC.

Feasibility and simplicity for the win!

# <span id="page-234-0"></span>Layers, meet the real world: Physical architectures

The layered monolith describes a logical architecture, but architects may implement that logical architecture in a variety of physical architectures.

![](_page_234_Figure_3.jpeg)

![](_page_234_Figure_4.jpeg)

#### Embedded/Mobile

Often, because of physical constraints, all the logical layers end up in a single physical deployment. This physical architecture commonly appears in embedded systems and mobile applications, where a network connection may not be consistent or even possible.

Examples: a mobile game or soda-machine software

# <span id="page-235-0"></span>Physical architecture trade-offs

Which physical architecture should you choose? Well, they all have tradeoffs, like everything in software architecture.

![](_page_235_Picture_3.jpeg)

#### Pros

- Rich user interface
- High performance
- Simple <

These architectures are simple because everything can typically be implemented as a single project.

#### Two-Tier

![](_page_235_Picture_10.jpeg)

#### Cons

- Medium scalability
- Becomes complex when it gets big
- **Medium reliability**

Reliability is only medium, because this architecture relies on the network for data

#### Three-Tier

#### Pros

- **Detached UI** (typically web)
- **Highest scalability**
- **Distributed** architecture benefits <sup>N</sup>

Distributed architectures offer higher scalability and similar benefits.

![](_page_235_Figure_23.jpeg)

#### Cons

- Least reliability
- More complex

More complex because it has the most moving parts

**Distributed** architecture headaches

Distributed architectures are more complex, with more moving parts and failure modes.

While a single stack is nice, it isn't always portable to other platforms.

#### Pros

Self-contained Single tech stack

> Highly tunable to hardware devices

#### Embedded/Mobile

![](_page_235_Picture_35.jpeg)

#### Cons

- Least scalable
- Resourceconstrained
- Often tied to implementation platform

#### 200

A single tech

stack can be an

advantage for

simplicity.

![](_page_236_Picture_1.jpeg)

Generic trade-offs are one thing, but software architecture is always based on a real system. The architects at Naan & Pop need some help evaluating the trade-offs for each physical architecture as they decide which one to use. Can you help them figure out which specific trade-offs the Naan & Pop application will face for each physical architecture?

Two-Tier

| Pros | Simplicity  |
|------|-------------|
| Cons | Scalability |

We'll help you get started.

Three-Tier

| Pros |  |
|------|--|
| Cons |  |

Embedded/Mobile

| Pros |  |
|------|--|
| Cons |  |

Solution on page 211

## <span id="page-237-0"></span>Cubicle conversation

**Alex:** Is Naan & Pop generic enough to only use the standard layers? When do teams add layers?

**Sam:** Why add layers to the architecture?

**Mara:** Each layer in a layered architecture has a specific responsibility within the system, so when they're needed, we add layers.

**Sam:** What kinds of layers?

**Alex:** It's common to add a *services layer*, which provides access for business-to-business integration, or *integration layers* for other internal systems. Each request goes through each layer, so layers need to be things that happen to every request.

![](_page_237_Picture_7.jpeg)

![](_page_237_Figure_8.jpeg)

No need to be stingy with layers—you can have as many as you need, as long as each layer applies to each request.

**Mara:** That's right—architects can add whatever layers we need to support some new behavior. For example, the site needs integration with third-party delivery services, so maybe we should add an integration layer. Here, let me draw what I have in mind for our layered architecture on the whiteboard...

![](_page_237_Figure_11.jpeg)

The integration layers allow interaction with third-party delivery services.

**Alex:** Adding an integration layer for our delivery hooks would make things easier, wouldn't it? It looks like all the code pertaining to that integration lives in the same place, which would make it easy to find and update.

**Mara:** Yes, and that's true for the user interface layer, too. In fact, one of the next requirements we have to implement is an additional UI to support mobile.

**Sam:** So, if we add a separate mobile UI, we'd only have to change one layer?

Mara: That's one of the best things about layered architecture!

![](_page_237_Figure_17.jpeg)

# <span id="page-238-0"></span>One final caveat about domain changes

One of the primary advantages of a layered architecture is that it lets us group similar technical things together. For example, in the Naan & Pop application, separating the UI into its own set of components allows the team to add new UI types without affecting the other layers.

Let's pause for a second and think about this—what about changes to the problem domain? If Naan & Pop wanted to add something other than sandwiches to the menu, like pizza, would *every layer* have to change?

The power to change things in isolation is the layered architecture's superpower, but it's not a silver bullet. This architectural style's big trade-off is that *the problem domain is smeared across the layers* in the architecture. For example, the *Place Order* logical component in the Naan & Pop architecture requires a UI (presentation), code to implement the workflow (workflow), and a data schema (persistence).

That means that *technical* capabilities are easy to change and enhance, but *domain* changes can create side effects that ripple through the layers.

We alluded to this earlier in the chapter.

# Layered architectures facilitate technical changes but make domain changes more difficult.

So, what to do? Well, there's a reason why we started this book by showing you how to identify the architectural characteristics your application needs to support. If *continual, significant domain changes* are expected or suddenly become a higher priority, there are other architectural styles to consider.

All that said, let's quickly summarize the good and bad of the layered architecture.

Take a deep breath. The next chapter will introduce you to an architectural style that is better suited to accommodating domain changes. Oh, the suspense!

![](_page_238_Picture_11.jpeg)

That's a rather large caveat. Why would I even consider the layered architectural style?

Remember the First Law of Software Architecture—everything's a trade-off. Sure, other architectural styles might allow for easier changes to the domain, but they have their own caveats. Align the strengths and weaknesses of every architectural style with your requirements, and then choose. There's no one right choice, just the choice that works best for *your* particular set of circumstances.

# <span id="page-239-0"></span>Layered architecture superpowers

Layered architectures have been demonstrating their powers for many, many years—this is one of the oldest recognizable architectural styles.

![](_page_239_Picture_3.jpeg)

If your whole company runs on investment dollars, feasibility is especially important.

#### **Feasibility**

If time and budget are overwhelmingly important, the simplicity of this architecture is quite appealing.

![](_page_239_Picture_7.jpeg)

#### **Technical partitioning**

Architects design components around technical capabilities, making it easier for them to reuse common capabilities. For example, if several teams need the same data functionality, they could implement it once in a persistence layer and then share it across teams.

![](_page_239_Picture_10.jpeg)

Systems that do a lot of data-level processing may benefit from a layered architecture because it isolates data processing in a single database that's optimized for the task.

system needs to access data over the network, the more efficient it. can be.

![](_page_239_Picture_13.jpeg)

![](_page_239_Picture_14.jpeg)

## **Performance**

Well-designed layered monoliths can demonstrate high performance—making no network calls and processing data in a single place (the monolithic database) means there's no need for network calls that could decrease performance.

#### **Quick to build**

Simplicity plus a single work/deployment unit means that teams can build small systems quite rapidly.

# Lean and mean

Keeping these systems small helps avoid some of the kryptonite on the next page.

<span id="page-240-0"></span>![](_page_240_Figure_1.jpeg)

# Layered architecture kryptonite

This architecture is pervasive and popular, but it can be overused and even abused. While feasibility may be a superpower, many teams default to this architecture because of its simplicity, long history, and widespread use, without considering if it's really the most suitable option.

## Scalability

Probably the biggest problem with monoliths is that when you only have one bucket and you keep adding things to it, it will eventually fill up. The same is true for monoliths generally, which eventually become constrained by some resource (memory bandwidth, and so on).

#### **Elasticity**

A single process has a harder time dealing with sudden bursts of users.

## **Deployability**

As monolithic systems get bigger, deployments tend to become more complex—especially when developers keep adding behavior.

![](_page_240_Picture_10.jpeg)

## **Testability**

High coupling and a large codebase make testing harder and harder over time.

#### Big ball of mud

Because everything is connected to everything else, this architecture can become a highly coupled mess without careful governance.

![](_page_240_Picture_15.jpeg)

# <span id="page-241-0"></span>Layered architecture star ratings

The Naan & Pop architecture team decides to use a rating chart they found in the book *Fundamentals of Software Architecture* (O'Reilly), written by two of your authors, that describes the layered architecture in a convenient way. One star means that the architectural characteristic is not well supported; five stars means the architectural characteristic is very well supported.

Just like movie reviews.

![](_page_241_Figure_4.jpeg)

![](_page_242_Picture_1.jpeg)

# **Exercise**

Which of the following systems might be well suited for the layered monolithic architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the nature of the system.*

| An online auction system where users can bid on items<br>Why?                                                                                     | Well suited for layered monolith<br>Might be a fit for layered monolith<br>Not well suited for layered monolith |
|---------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why?                                    | Well suited for layered monolith<br>Might be a fit for layered monolith<br>Not well suited for layered monolith |
| A company entering a new line of business that<br>expects constant changes to its system<br>Why?                                                  | Well suited for layered monolith<br>Might be a fit for layered monolith<br>Not well suited for layered monolith |
| A small bakery that wants to start taking online orders<br>Why?                                                                                   | Well suited for layered monolith<br>Might be a fit for layered monolith<br>Not well suited for layered monolith |
| A trouble ticket system for electronics purchased<br>with a support plan, in which field technicians<br>come to customers to fix problems<br>Why? | Well suited for layered monolith<br>Might be a fit for layered monolith<br>Not well suited for layered monolith |
|                                                                                                                                                   | Solution on page 212                                                                                            |

# <span id="page-243-0"></span>Wrapping it up

Congratulations! The Naan & Pop team looked at several architectural styles, but after considering the business's priorities, you chose a layered architecture. This paid off handsomely, allowing the business to grow without any problems.

# **Bullet Points**

- A layered architecture is *monolithic*: the entire system (code and database) is deployed as a single unit.
- The layers are separated by technical capabilities. Typical layers in this architecture include *presentation* (for the user interface), *business rules* (for the workflow and logic of the application), and *persistence* (facilities to support databases for systems that need persistent data).
- The layered architecture supports feasibility well; it is easy to understand and it lets you build simple systems fast.
- The layered architecture supports excellent separation of technical concerns, making it easy to add new capabilities like user interfaces or databases.
- The layered architecture mimics some of the same concerns as the Model-View-Controller design pattern, but translated into physical layers and subject to realworld constraints.
- User requests flow through the user interface and through each layer before a response is returned to the user.

- Each request in this architecture goes through each layer.
- A layered architecture's capabilities degrade over time if teams continue to add functionality due to eventual resource limits (for example, they run out of capacity).
- The layered architecture provides excellent support for specialization (user interface designers, coders, database experts, and so on).
- Logical components represent the problem domain, yet layers focus on technical capabilities, requiring translation between the domain and architecture layers.
- A layered architecture may manifest in several physical architectures, including *two-tier* (also known as *client/ server*), *three-tier* (web), and *embedded/mobile*.
- Changing and adding to the technical capabilities represented in layers is easy; the layered architecture facilitates this.
- Changing the problem domain requires coordination across the layers of the architecture, making domain changes more difficult.

![](_page_244_Picture_1.jpeg)

# **Layered Architecture Crossword**

Ready to add learning on top of learning by solving the layers of this crossword?

![](_page_244_Figure_4.jpeg)

#### Across

- 3. Layered architectures use familiar design \_\_\_\_\_
- 5. Kind of layered architecture often found in smartphone apps
- 6. Type of architecture covered in this chapter
- 8. \_\_\_\_\_ can be confined to one layer
- 9. Namespaces and packages correspond to the directory \_\_\_\_\_
- 11. Too much coupling can lead to a big ball of \_\_\_\_\_
- 14. Layer that maps object models to relational models for databases
- 17. Depending on the network for data access makes an architecture \_\_\_\_\_ reliable
- 19. Kind of database often used for persistence
- 21. Layered architectures might have two or more \_\_\_\_\_

#### **Solution on page 213**

#### Down

1. The integration layer lets the system \_\_\_\_\_ with third parties 2. Layered architectures facilitate \_\_\_\_\_ 4. The \_\_\_\_\_ domain spreads across all of the layers 7. Logical and \_\_\_\_\_ components are usually separated in the same way 10. Logical \_\_\_\_\_ reside in layers 12. Domain-driven \_\_\_\_\_ 13. Layer that applies business rules 15. The user \_\_\_\_\_ is part of the presentation layer 16. The MVC pattern and layered architecture both \_\_\_\_\_ responsibilities 18. A user's request and its response \_\_\_\_\_ through the layers 20. Model-\_\_\_\_\_-Controller design pattern

![](_page_245_Figure_1.jpeg)

# Sharpen your pencil Solution

Naan & Pop's lead architects have designed a layered architecture. Today, though, they're off at a daylong breadmaking seminar to learn more about their problem domain, leaving you to sort out which components go where. Can you decide in which layer (or layers) each component should reside? Draw the components below on the layer(s) to which they should map.

Hint: Some components may end up in several layers.

#### **Components**

Pelivery Address

Billing Address

Sales Promotion

Blacklisted Customers

Frequent Diner Rewards

![](_page_245_Figure_11.jpeg)

![](_page_246_Picture_1.jpeg)

Generic trade-offs are one thing, but software architecture is always based on a real system. The architects at Naan & Pop need some help evaluating the trade-offs for each physical architecture as they decide which one to use. Can you help them figure out which specific trade-offs the Naan & Pop application will face for each physical architecture?

![](_page_246_Figure_4.jpeg)

**Exercise Solution From page 207**

From page 207

Which of the following systems might be well suited for the layered monolithic architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the nature of the system.*

| An online auction system where users can bid on items                                                                                                                               |                                                                                                                                                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Why? An online auction will require more scalability and performance than most layered architectures can support.                                                                   | <div><input type="checkbox"/> Well suited for layered monolith</div> <div><input type="checkbox"/> Might be a fit for layered monolith</div> <div><input checked="" type="checkbox"/> Not well suited for layered monolith</div> |
| A large backend financial system for processing and settling international wire transfers overnight                                                                                 |                                                                                                                                                                                                                                  |
| Why? This system requires high throughput and high availability, both difficult for layered monoliths.                                                                              | <div><input type="checkbox"/> Well suited for layered monolith</div> <div><input type="checkbox"/> Might be a fit for layered monolith</div> <div><input checked="" type="checkbox"/> Not well suited for layered monolith</div> |
| A company entering a new line of business that expects constant changes to its system                                                                                               |                                                                                                                                                                                                                                  |
| Why? Layered architectures separate concerns by technical capabilities, making some changes easier.                                                                                 | <div><input type="checkbox"/> Well suited for layered monolith</div> <div><input checked="" type="checkbox"/> Might be a fit for layered monolith</div> <div><input type="checkbox"/> Not well suited for layered monolith</div> |
| A small bakery that wants to start taking online orders                                                                                                                             |                                                                                                                                                                                                                                  |
| Why? A small bakery has a simple problem and small scale, well suited for a simple architecture.                                                                                    | <div><input checked="" type="checkbox"/> Well suited for layered monolith</div> <div><input type="checkbox"/> Might be a fit for layered monolith</div> <div><input type="checkbox"/> Not well suited for layered monolith</div> |
| A trouble ticket system for electronics purchased with a support plan, in which field technicians come to customers to fix problems                                                 |                                                                                                                                                                                                                                  |
| Why? A trouble ticket system will need to support different architectural characteristics (for users and technicians, for example), which is difficult in monolithic architectures. | <div><input type="checkbox"/> Well suited for layered monolith</div> <div><input type="checkbox"/> Might be a fit for layered monolith</div> <div><input checked="" type="checkbox"/> Not well suited for layered monolith</div> |

# **Layered Architecture Crossword Solution**

**From page 209**

![](_page_248_Figure_3.jpeg)

# **7** modular monoliths

# Driven by the Domain

![](_page_250_Picture_2.jpeg)

**There's more than one way to build a monolith.** So far, you've encountered the layered architecture, which aligns things *technically*. You can go a long way with a layered monolith, but when changes begin to involve lots of communication and coordination between different teams, you might need a little more horsepower under the hood—and perhaps even a different architectural style.

This chapter looks at the *modular monolith* architectural style, which divides applications up by *business concerns* as opposed to technical concerns. You'll learn what this means, what to look out for, and all the trade-offs associated with this style. Let's take the modular monolith for a spin, shall we?

![](_page_251_Figure_1.jpeg)

As a reminder, Naan & Pop's sandwich shop has a small development team, and its requirements haven't changed a whole lot since the team built their layered application in Chapter 6. The competition is stiff, and time to market remains a concern. The system should remain simple.

> Be sure to review Chapter 6 if you need to refresh your memory.

![](_page_252_Picture_1.jpeg)

# **Exercise**

Cast your mind back to the layered architecture we built for Naan & Pop in Chapter 6. The following diagram shows its layers and logical components. Adding a new category to the menu (say, pizza) means changing a bunch of moving parts. Grab a marker and put a triangle ( ) next to everything this new requirement will affect.

![](_page_252_Figure_4.jpeg)

down your thoughts.

**Solution on page 240**

# Cubicle conversation

![](_page_253_Picture_2.jpeg)

**Alex:** Pfft! This is *easy*. We've already delivered a working and extensible system. Let's get to it.

**Mara:** Hold your horses. This might be our first rodeo with such a change, but I doubt it'll be our last.

**Sam:** So what? We've built an extensible system. Why are you being so reticent?

**Mara:** Let's think this through—we have to add pizzas to the menu. Not only will we have to add new recipes and ingredients, but we'll also need to allow patrons to order pizzas online. So where will we have to make changes?

**Sam:** Lots of places! It'll at least affect ordering and recipe management. I still don't see a concern.

**Alex:** I think I do. We've built a layered architecture, and we have specialists working on each layer. A change like this means coordinating changes across *all* of those folks.

**Mara:** Bingo! The layered architecture *smears* the domain across all the layers. So, implementing anything that changes the domain can be arduous.

**Alex:** You're telling me that choosing the layered architecture was a mistake?

**Mara:** The layered architecture was simple and quick to build. It allowed us to launch quickly. But now we need to think about *maturing* the architecture to support modularity, so changes like these will be easier in the future.

**Alex:** So where do we start?

**Mara:** Allow me to introduce you to the modular monolith. Rather than partitioning by technical concern, we'll partition by *business domain*, using modules—hence the word *modular*. I'll show you what this looks like as I explain it.

**Sam:** Ooh, I'm so excited. Let's do it!

## <span id="page-254-0"></span>Modular monolith?

A modular monolithic architecture, like a layered architecture, is deployed as a single unit, usually with its own database.

![](_page_254_Figure_3.jpeg)

Think back to Chapter 5.
Architectural styles can be separated by how the code is partitioned and by deployment model.

That's where the similarity ends. In a modular monolith, rather than partitioning your application by technical concerns, you partition it by *functionality*. Every business operates within a certain domain—like banking, education, or retail. Online stores usually have several *subdomains*, like Order Placement, Payment, and Inventory Management. Together, they make up the Online Store domain. You organize your application according to these subdomains, separating them into modules.

teads up—you'll find the terms domain and subdomain used interchangeably. As long as you understand that both terms represent business concerns, you're good.

![](_page_254_Figure_7.jpeg)

What is a *module*? At a high level, it's just how you organize your code. In some languages, you might have support like packages or namespaces. But it doesn't start or stop there.

Partitioning your code using modules has implications for how you'll go about separating concerns between modules and how modules will interact with each other. We have a lot more to say about this, so stay tuned. For now, we just want you to be able to distinguish between the layered and modular monolith architectural styles.

# there are no Dumb Questions

<span id="page-255-0"></span>Q: **Can you explain more about what you mean when you say** *module***?**

A:<sup>A</sup>*module* is a software design element representing an independent unit that fulfills one piece of functionality. Technically, every layer in a layered architecture is a module—these modules just happen to be divided by technical concern.

In a modular monolith, on the other hand, each module represents a particular piece of the domain—that is, a *subdomain*. Each module contains all the business functionality needed for that particular subdomain.

# Who Does What

Identifying which components should belong to a particular module can be tricky. In this game of "Who Does What?"—or rather, "What Goes Where?"—we'd like you to match each component to the module where it fits best. Multiple

| Shopping Cart               | Order    |
|-----------------------------|----------|
| Credit Card Form            | Payment  |
| Primary Email<br>Preference | Customer |
| Fulfillment<br>Workflow     |          |
| Order History               |          |

# Domain pains changes

![](_page_256_Figure_2.jpeg)

Introducing a new menu category primarily affects the Order domain. The menu needs to allow customers to order pizzas and customize their toppings. That might require changing or adding new business rules to support customization and perhaps delivery, since pizzas need to be delivered hot. It could also change how the system stores orders (since customers may ask for customizations.)

As you can see, introducing new menu items can affect multiple components across multiple layers. This is because, as mentioned in the previous chapter, in a technically partitioned architecture the business domain gets "smeared" across multiple layers. This is great if you're implementing a technical change, like changing the view technology or swapping out the database. But it's not so great if the change affects the domain—you'll have to round up folks from multiple teams to figure out how to implement it.

No one ever woke up and said, "How can I add yet another meeting to my calendar?"

This is where modular monoliths can really help.

![](_page_256_Picture_7.jpeg)

# Geek Note

It's not unusual for teams to start with a layered architecture, then refactor it into a modular monolith over time as the application grows.

# <span id="page-257-0"></span>Why modular monoliths?

When you eat a burger (or a veggie burger!), do you take a bite of the top bun first, then bite into the gooey cheese, then take a bite of the patty? Or do you take one bite that slices vertically through every layer of the burger? The latter, right?

That's exactly how you can think of a modular monolith. You don't organize the application in horizontal layers separated by technical concern, but in vertical slices scoped by business concern. Each vertical slice aligns with a piece of the domain and is encapsulated in a module. Every module contains a set of business functions—for example, order placement, order completion, and order delivery would all be part of the Order Placement module.

Every layer in a burger serves a specific purpose—
so it tastes best if you bite through all the layers together.

Yum

Individual domains make up the modules of your application **Order** Inventory Recipe domain domain domain Inventory management Receipe management Order placement Presentation Presentation Presentation **Business** rules **Business** rules **Business** rules Persistence Persistence Persistence These "slices" represent a particular set of business functions within a domain.

What does this mean? Changes to the domain that affect many or all layers require lots of coordination between different teams. You'll need to ensure that everybody's changes work with everybody else's.

Now, rather than having teams that specialize in the presentation layer or the persistence layer, you have *cross-functional teams*, each specializing in a *domain*. The result? It's far easier to coordinate domain changes when one team takes full ownership.

This isn't business—word bingo! It's not always easy to build out cross—functional teams that work in multiple different technical stacks.

Hold up. I still see layers in each module. Is this some kind of Jedi mind trick? How is this any different from a layered architecture?

<span id="page-258-0"></span>![](_page_258_Picture_2.jpeg)

**How astute of you!** You're absolutely right that each module here still consists of layers—but they don't have to. The important thing is that your application is organized by domain.

Your system still needs to process and respond to each request, though. So you'll need an entry point (presentation layer), some business processing (workflow layer), and maybe a data store to write to (persistence layer). Even within a modular architecture, it makes sense to separate those responsibilities, much like the layered architecture does.

However, if you zoom out and look at the whole architecture, you'll see that the application is carved up into subdomains. The fact that each module is composed of a bunch of technically partioned layers becomes an implementation detail, as opposed to an architectural concern. In other words, *how a module is laid out internally isn't how the architecture is partitioned*. Modular monoliths are domain-partitioned.

Let's get a bit more concrete by seeing what this looks like in code.

## <span id="page-259-0"></span>Show me the code!

You've probably recognized that modular monoliths solve the problem you are working on differently from a layered architecture, by organizing applications by domain rather than technical concern. But how does this translate to your code?

Let's first talk about the modules themselves. They represent parts of the domain. Naan & Pop's namespaces look like this:

```
Flip back to page 192 in the previous chapter and compare these to the namespaces for the layered architecture.
```

Remember, we're still working with a monolith—that is, it's still one deployment. Typically, one deployment would translate to one codebase, with the code organized in different namespaces. Each namespace represents a separate module, like so:

![](_page_259_Figure_6.jpeg)

![](_page_259_Picture_7.jpeg)

![](_page_260_Picture_1.jpeg)

# **Exercise**

A critical piece of successfully developing modular monoliths is understanding the domain well enough that you can break it into individual modules. One way to do that (and there are many) is to really *listen* to your business experts.

Say you are working for a startup that's creating an expense-tracking app for small to medium-sized businesses. Here are the business requirements:

- There are users and auditors. Users add expenses, and auditors review expense reports to ensure they align with policy guidelines.
- When a user adds an expense, it is recorded in the database for that user.
- The app creates an audit trail that the auditors can use to ensure that everything is in order.

Can you identify the subdomains that should make up this application? *Hint: Not everything your business users say will translate into a module.*

**Solution on page 242**

# Cubicle conversation, continued...

![](_page_261_Picture_2.jpeg)

**Alex:** I get it. We're increasing the modularity of the codebase because our application is divided up by modules.

**Sam:** That sounds great in theory, but it's not like they can all work independently of each other. Doesn't the ordering side of things need to know what ingredients we have in our inventory? God forbid the kitchen should run out of mushrooms!

**Mara:** You're both right. Splitting the application up by business concern means we're increasing its modularity. But on the flip side, different parts of the application might also need to talk to each other.

**Alex:** But it's one codebase. I can just have the ordering side make an API call to the inventory module, right?

**Sam:** Oh, brilliant. I can already see the big ball of mud forming! Soon every module will be talking to every other module, and then there goes our modularity.

**Mara:** Right. If you just start making calls between modules willy-nilly, soon enough there won't be *any* boundaries left. Everything will just start referencing everything else. And that would be, well, a big ball of mud.

**Alex:** So how do we maintain separate modules, but still have them talk to one another?

**Mara:** Let me show you.

# <span id="page-262-0"></span>Keeping modules modular

Modular monoliths are, well, monoliths, so they're generally contained in one codebase. That makes it easy for someone working in one module to inadvertently reach into another module and end up coupling the two modules together.

These arrows represent calls

The auto-import feature in your IDE is not your friend here! It's way too easy to accidentally reference another module without realizing it.

![](_page_262_Figure_4.jpeg)

with the other modules' code, and their boundaries start to disappear.

The *philosophy* of the modular monolith centers on *partitioning by domain within a monolithic deployment model*. Your objective should be to create loosely coupled modules so that changing one doesn't affect others. So how do you avoid the big ball of mud? Read on.

You got it! Callback to Chapter 5.

# Brain Power

Can you think of any mechanisms to help you ensure that one part of your application won't accidentally access another? For example, does your favorite programming language provide any support at compile time to keep modules separate? Jot down any ideas that come to mind here. You can see some of our ideas at the end of the chapter.

Solution on page 242

# Keeping modules modular (continued)

From a code design perspective, it's best to *think of each module as a separate service*. Just to be clear, though, they aren't *really* separate—they all still constitute one monolithic deployment. Each "service" exposes a public API while shielding its internal implementation from the other modules.

![](_page_263_Picture_3.jpeg)

As long as modules *only* talk to one another through their public APIs, you can safely change one module without affecting others—thereby reducing their coupling.

Of course, this sounds like a great idea *in theory*. But how can you maintain module boundaries so well that you can sleep peacefully at night? Let's look at a few possibilities.

# there are no Dumb Questions

Q: **Dividing my application into modules sure seems like a lot of trouble. Are modular monoliths really the better option?**

A: We've said this before, and we'll say it again—we don't like words like *better*. It's always about trade-offs. So far, we've tried to highlight some of the benefits of modular monoliths (and we aren't done yet), while also pointing out some of the challenges.

Do modular monoliths require more thought and discipline, and maybe even more tooling (as we'll see in a minute)? Absolutely.

But the trade-off is a much more modular architecture that allows cross-functional teams to work independently and thus move faster.

# <span id="page-264-0"></span>Keeping modules modular (last time!)

Keeping your modules modular isn't as easy as it seems, but don't lose hope just yet. You have options, depending on your technical stack—especially if you apply some creative thinking and elbow grease.

![](_page_264_Picture_3.jpeg)

Some languages, like Java, have built-in support to build modules. The Java Platform Module System (JPMS) allows you to build modules that are isolated from one another. The .NET platform, meanwhile, offers namespaces that use the internal keyword for this purpose.

Gradle, the Java build tool, supports subprojects.

Another approach is to break up your project code so that each module is a separate folder in your repository. These *subprojects* (or, as many build systems call them, *multimodule projects*) force isolation by virtue of being different projects. You might even consider creating different repositories to contain individual modules, then stitching the complete application together at build time.

Of course, you are still deploying a monolith, so you'll probably need to bring all the modules together using your build tool of choice. A monolithic deployment model doesn't have to mean a monolithic codebase!

![](_page_264_Picture_8.jpeg)

Architectural governance tools, like ArchUnit for Java projects and ArchUnitNET for the .NET platform, can help maintain module boundaries as a project grows.

![](_page_264_Picture_10.jpeg)

And none of these options needs to stand alone: you can use one or more together.

![](_page_264_Picture_12.jpeg)

Q: **Am I way off base here, or could these techniques be useful even for layered architectures?**

A: Give us a moment to wipe away the tears—you've grown up so fast! Absolutely; they can be useful whether your project is partitioned technically or by domain. It's a great idea to use tools (like ArchUnit) and language features (like JPMS) to enforce module boundaries, regardless of architectural style.

You've given me some great ideas for how to modularize the code by business concern. But if all modules share the same database, aren't they still coupled at the data level? Should I think about modularizing the database too?

![](_page_265_Picture_2.jpeg)

#### **That would be the logical end of modularization, wouldn't it?** Modularizing the

code may not be enough. If all your data is still intertwined, then you've just moved your ball of mud into the database!

Before we go further, a caveat: most developers are not used to thinking vertically along business concern lines or breaking up their code into separate modules. Extending that modularity all the way to the database sounds like a great idea—*it is*—but it may be too much to take on all at once. Feel free to evolve your architecture over time when needed, rather than trying to get it all right the first time around.

Put all the lessons you've learned in this book at work. Do your architectural characteristics push you to pick the modular monolith architecture? If so, start by modularizing your code first. Once your team gets the hang of thinking modularly, then see if it helps to take that approach all the way into the database.

Next, let's see what modularizing your database might look like.

# <span id="page-266-0"></span>Taking modularity all the way to the database

The modular monolith is still a monolithic deployment, typically with a monolithic database backing it. There is a lot of power here: having a single database can make things a *lot* simpler. You don't have to worry about transactions or eventual consistency, and most developers are very comfortable working with just one database. However, if you intend to maintain modularity at all levels, then you should consider modularizing your data.

The rule is simple: every module should access only its own tables. Here's how you'd accomplish this for Naan & Pop:

![](_page_266_Figure_4.jpeg)

For every module in your application, you define a schema and a set of tables. Any and all data that belongs to a particular module will reside *only* in the tables for that module.

As you can see, you can extend modularity all the way to the database by separating data that belongs to different modules into different tables (and maybe even different schemas).

![](_page_266_Picture_7.jpeg)

![](_page_267_Picture_1.jpeg)

# <span id="page-268-0"></span>Beware of joins

Keeping different tables, perhaps even in different schemas, does partition the data belonging to different modules—but it's easy to slip up and accidentally perform a SQL join across tables that belong to different modules. Then you're back to tight coupling!

It's OK to store the IDs of records that belong to one module in another module's tables. For example, the Naan & Pop Order domain is allowed to store "recipe item" IDs in its tables within the order\_schema. If it ever needs more information about a particular item, it calls the Recipe module's API and provides it with the recipe item's ID.

Read that again!

This is not a foreign key reference.

![](_page_268_Figure_5.jpeg)

And there you have it. Now, as we've done before, we'll show you some of the strengths and weaknesses of modular monoliths, followed by our star rating chart.

# <span id="page-269-0"></span>Modular monolith superpowers

Here are some good reasons to use modular monoliths:

![](_page_269_Picture_3.jpeg)

## **Domain partitioning**

Architects can design components around domain concerns, then build teams that specialize in one or more of these domains (as opposed to a technical specialization). Domain partitioning is the key superpower of this architectural style.

![](_page_269_Picture_6.jpeg)

# **Domain-based alignment**

Modular monoliths encourage crossfunctional teams, which are better aligned with the domain than the technically partitioned teams used in layered architectures.

![](_page_269_Picture_9.jpeg)

## **Maintainability**

Modular monoliths separate business concerns from one another, with cross-functional teams each specializing in a subdomain. This makes it easier to maintain the code, as long as changes don't cross into other domains.

![](_page_269_Picture_12.jpeg)

Since the scope of changes is limited to one module, testing is much easier. And since a cross-functional team's members understand their subdomain really well, they can build out an entire testing suite, including integration, smoke, and end-to-end tests.

# Performance

Performance is usually very good, like for most monolithic architectures. There are no network calls between modules, and all data processing happens in a single place.

![](_page_269_Picture_16.jpeg)

# Modular monolith kryptonite

<span id="page-270-0"></span>![](_page_270_Picture_2.jpeg)

Of course, there are always trade-offs. Here are some reasons not to use a modular monolith architecture:

#### Hard to reuse

Modular organization makes it hard to reuse logic and utilities across modules. For example, you can't share common functionality between modules without extracting it as a dependency, increasing the coupling between the modules.

![](_page_270_Picture_6.jpeg)

# (Still) a single set of architectural characteristics

Even though modular monoliths are organized by modules, you still get a single set of architectural characteristics for the entire application—even if one business concern has a different set of needs than others.

## Modularity can be fragile

It's easy to dilute module boundaries accidentally. Avoiding the big ball of mud takes a lot of governance—and the database is even harder to govern.

It's particularly hard to avoid joins in SQL via tooling.

#### Operational characteristics

Despite its focus on business concerns, a modular monolith is still, well, a monolith. And as with any monolith, operational characteristics like elasticity and fault tolerance tend to be hard to attain.

![](_page_270_Picture_15.jpeg)

# <span id="page-271-0"></span>Modular monolith star ratings

We've created a star rating chart for modular monoliths, just like the one we showed you for layered architectures in the previous chapter. One star means that the architectural characteristic is not well supported; five stars means it's very well supported.

![](_page_271_Picture_3.jpeg)

| Architectural Characteristic | Star Rating |
|------------------------------|-------------|
| Maintainability              | ★ ★ ★       |
| Testability                  | ★ ★ ★       |
| Deployability                | ★ ★ ★       |
| Simplicity                   | ★ ★ ★ ★     |
| Evolvability                 | ★ ★ ★       |
| Performance                  | ★ ★ ★       |
| Scalability                  | ★           |
| Elasticity                   | ★           |
| Fault Tolerance              | ★           |
| Overall Cost                 | \$ \$       |

You'll notice that our ratings for modular monoliths' operational characteristics aren't all that different from those for layered architectures. From a process perspective (that is, in terms of maintainability, testability, and deployability), however, the modular monolith does a lot better than the layered architecture. That's because changes to a particular module only affect *that* module and can be tested in isolation, which reduces the risks involved in deploying software.

Modular monoliths cost a little more than layered architectures because they require the team to be vigilant. They also involve additional governance and tooling to maintain module boundaries.

long-term maintainance.

![](_page_272_Picture_1.jpeg)

Which of the following systems might be well suited for the modular monolith architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the problem domain.*

| An online auction system where users can bid on items<br>Why?                                                                                     | Well suited for modular monoliths<br>Might be a fit for modular monoliths<br>Not well suited for modular monoliths |
|---------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why?                                    | Well suited for modular monoliths<br>Might be a fit for modular monoliths<br>Not well suited for modular monoliths |
| A company entering a new line of business that<br>expects constant changes to its system<br>Why?                                                  | Well suited for modular monoliths<br>Might be a fit for modular monoliths<br>Not well suited for modular monoliths |
| A small bakery that wants to start taking online orders<br>Why?                                                                                   | Well suited for modular monoliths<br>Might be a fit for modular monoliths<br>Not well suited for modular monoliths |
| A trouble ticket system for electronics purchased<br>with a support plan, in which field technicians<br>come to customers to fix problems<br>Why? | Well suited for modular monoliths<br>Might be a fit for modular monoliths<br>Not well suited for modular monoliths |
|                                                                                                                                                   | Solution on page 244                                                                                               |

# <span id="page-273-0"></span>Naan & Pop is delivering pizza!

The development team has finally grokked modular monoliths! With a modular codebase *and* a modular database, they now feel ready for any other big changes to Naan & Pop's menu. Rumor has it that the owners plan to introduce a full Mediterranean menu next. We can't wait, and we wish them a lot of luck!

![](_page_273_Picture_3.jpeg)

# **Bullet Points**

- A *modular monolith* is a monolithic architectural style that is partitioned by domains and subdomains that reflect business concerns, not technical concerns.
- Each *subdomain* makes up one *module* of the application. Each module can contain multiple business use cases.
- Each module can be made up of layers to provide better organization. A module may be technically partitioned as a means to organize its functionality.
- Avoid having code in one module directly access any functionality in other modules. Allowing this can reduce or eliminate the boundaries between modules.
- Each module should have a public API that communicates with other modules while shielding the module's internal implementation from the rest of the world.
- Avoiding intermodule communication allows modules to change internally without affecting other modules.
- It takes time and effort to ensure that the modules in a modular monolith remain separate and distinct.

- You can govern a modular monolith using a variety of techniques. Some languages have built-in support for building modules.
- Another approach is to physically break up the codebase into separate subprojects or even different repositories. This usually involves using a build tool to bring all the modules back together when you build the monolith.
- Third-party tools can also help with architectural governance.
- You may choose to use several techniques in combination to ensure the boundaries of individual modules are maintained.
- You can extend modularity all the way to the database, keeping the data for each module separate.
- Watch that you don't accidentally couple modules when inserting or fetching data (for example, when using a SQL join statement across tables that belong to different modules).

![](_page_274_Picture_1.jpeg)

# **Modular Monolith Crossword**

Modular monoliths are about separating business concerns. Take a look at these separate clues and test your knowledge about this architectural style.

![](_page_274_Picture_4.jpeg)

#### Across

| 1. Java                                                          | Module System                             |
|------------------------------------------------------------------|-------------------------------------------|
| 6.                                                               | to one module don't require to the others |
| 8. The Recipes                                                   | interface is part of the Recipes domain   |
| 9. Each module exposes a public                                  |                                           |
| 10. Modular monoliths are good when many teams need to           |                                           |
|                                                                  | their work                                |
| 13. Monoliths generally have one big                             | base                                      |
| 15. Highly rated characteristic in most monolithic architectures |                                           |
| 18. Each domain in this style represents a                       | concern                                   |
| 19. With a modular monolith,                                     | are often cross-functional                |
| 20. Smaller bits of functionality can reside in their own        |                                           |
|                                                                  | domains                                   |
| 21. It's important to maintain                                   | between modules                           |
| 22. Style of monolithic architecture first used in this system   |                                           |
| 23. Databases can show modularity by representing an entity via  |                                           |
| a                                                                |                                           |

#### Down

| 1. The latest addition to Naan and Pop's menu                                                                |
|--------------------------------------------------------------------------------------------------------------|
| 2. In a domain-partitioned architecture, each domain gets its own __________                                 |
| 3. If something is an implementation __________, it's not an architectural concern                           |
| 4. If technical concerns are like horizontal “slices” of a monolith, business concerns are __________ slices |
| 5. “Spaghetti code” is too closely __________                                                                |
| 7. This system is for __________ & Pop                                                                       |
| 11. A challenging kind of architectural characteristic for monoliths                                         |
| 12. Modules use ID references in __________ to look things up                                                |
| 14. Monolithic and distributed are two kinds of deployment __________                                        |
| 16. Example of a language that supports creating modules                                                     |
| 17. Modules communicate indirectly, through their __________ APIs                                            |
| 19. Databases build schemas from related __________                                                          |

![](_page_275_Picture_1.jpeg)

Cast your mind back to the layered architecture we built for Naan & Pop in Chapter 6. The following diagram shows its layers and logical components. Adding a new category to the menu (say, pizza) means changing a bunch of moving parts. Grab a marker and put a triangle ( ) next to everything this new requirement will affect.

![](_page_275_Figure_4.jpeg)

Here's some space for you to explain your thought process:

Offering pizzas probably means the menu will need a new listing. We might need to allow for customized toppings, which would affect the presentation layer and the associated pricing and could introduce new rules. There might be time constraints on deliveries (no one wants a cold pizza). The customizations might also affect how we persist pizza orders (as opposed to other kinds of orders).

However, the recipe and inventory domains won't be affected. A recipe is a recipe is a recipe—a list of ingredients with a set of steps to follow. And while there may be new ingredients, the inventory domain will manage them just like it would any other ingredients.

# Who Does What Solution

**From page 220**

Identifying which components should belong to a particular module can be tricky. In this game of "Who Does What?"—or rather, "What Goes Where?"—we'd like you to match each component to the module where it fits best. Multiple components can belong to one module.

![](_page_276_Picture_4.jpeg)

![](_page_277_Picture_1.jpeg)

A critical piece of successfully developing modular monoliths is understanding the domain well enough that you can break it into individual modules. One way to do that (and there are many) is to really *listen* to your business experts.

Say you are working for a startup that's creating an expense-tracking app for small to medium-sized businesses. Here are the business requirements:

- There are users and auditors. Users add expenses, and auditors review expense reports to ensure they align with policy guidelines.
- When a user adds an expense, it is recorded in the database for that user.
- The app creates an audit trail that the auditors can use to ensure that everything is in order.

Can you identify the subdomains that should make up this application? *Hint: Not everything your business users say will translate into a module.* 

![](_page_277_Figure_9.jpeg)

![](_page_277_Picture_10.jpeg)

From page 227

Can you think of any mechanisms to help you ensure that one part of your application won't accidentally access another? For example, does your favorite programming language provide any support at compile time to keep modules separate? Jot down any ideas that come to mind here.

- <insert your favorite programming language> feature
- Repository structure
- · Build tool capabilities
- · Third-party libraries and governance frameworks

![](_page_278_Picture_2.jpeg)

![](_page_279_Picture_1.jpeg)

Which of the following systems might be well suited for the modular monolith architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the problem domain.*

Which of the following systems might be well suited for the modular monolith architectural style, and why? Hint: Take into account its superpowers, its kryptonite, and the problem domain.

| An online auction system where users can bid on items<br>Why? This system probably needs high degrees<br>of scaling and elasticity. Monoliths aren't<br>ideal for such systems.                                                                      | <label><input type="checkbox"/> Well suited for modular monoliths</label><br><label><input type="checkbox"/> Might be a fit for modular monoliths</label><br><label><input checked="checked" type="checkbox"/> Not well suited for modular monoliths</label> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why? Financial systems have rich domains;<br>scalability and elasticity don't sound like<br>concerns here.                                 | <label><input checked="checked" type="checkbox"/> Well suited for modular monoliths</label><br><label><input type="checkbox"/> Might be a fit for modular monoliths</label><br><label><input type="checkbox"/> Not well suited for modular monoliths</label> |
| A company entering a new line of business that<br>expects constant changes to its system<br>Why? A high degree of modularity is good for<br>handling changes, but it certainly depends<br>on what kinds of changes are expected.                     | <label><input type="checkbox"/> Well suited for modular monoliths</label><br><label><input checked="checked" type="checkbox"/> Might be a fit for modular monoliths</label><br><label><input type="checkbox"/> Not well suited for modular monoliths</label> |
| A small bakery that wants to start taking online orders<br>Why? Ha! We kinda gave this one away, didn't we?                                                                                                                                          | <label><input checked="checked" type="checkbox"/> Well suited for modular monoliths</label><br><label><input type="checkbox"/> Might be a fit for modular monoliths</label><br><label><input type="checkbox"/> Not well suited for modular monoliths</label> |
| A trouble ticket system for electronics purchased<br>with a support plan, in which field technicians<br>come to customers to fix problems<br>Why? Lots of moving parts; this system probably<br>needs high degrees of elasticity and<br>scalability. | <label><input type="checkbox"/> Well suited for modular monoliths</label><br><label><input type="checkbox"/> Might be a fit for modular monoliths</label><br><label><input checked="checked" type="checkbox"/> Not well suited for modular monoliths</label> |

# **Modular Monolith Crossword Solution**

**From page 239**

![](_page_280_Figure_3.jpeg)

# microkernel architecture

# Crafting Customizations

![](_page_282_Picture_3.jpeg)

#### You can craft custom experiences, one capability at a

**time.** Some architectural styles are particularly well suited for some capabilities, and the microkernel architecture is the world champion at customization. But it's also useful for a bewildering range of applications. Once you understand this architectural style, you'll start seeing it everywhere!

Let's dig into an architecture that lets your users have it their way.

# <span id="page-283-0"></span>The benefits of Going Green

What does everyone have lying around? Old electronics! Going Green is a fast-moving startup that plans to capitalize on the market for buying and recycling old cell phones, music players, and other small electronics.

After analyzing the architectural characteristics required, the architects have designed a three-part system, and each part of which needs different capabilities. They'd like your help. Ready? Here's the system so far:

![](_page_283_Figure_4.jpeg)

![](_page_284_Picture_1.jpeg)

Architects just can't stop analyzing stuff. Can you determine three important architectural characteristics for each of the three services in the new Going Green architecture?

| Public user interfaces |  |
|------------------------|--|
|------------------------|--|

| Architectural characteristics | Scalability |
|-------------------------------|-------------|
|-------------------------------|-------------|

Fill in some architectural characteristics for each service.

| Architectural characteristics |  |
|-------------------------------|--|
|-------------------------------|--|

| Device assessment |  |
|-------------------|--|
|-------------------|--|

| Architectural characteristics |  |
|-------------------------------|--|
|-------------------------------|--|

| Recycling/accounting |  |
|----------------------|--|
|----------------------|--|

| Architectural characteristics |  |
|-------------------------------|--|
|-------------------------------|--|

→ Solution on page272

![](_page_285_Picture_1.jpeg)

**Mara:** We need to split up the architecture work for the Going Green application. Mara, you and Alex should work on the device assessment service.

**Alex:** Great! That's the service that assesses the devices users send us to determine value, right? Seems like one of the more interesting parts of the application.

**Sam:** How often will we need to add new device configurations to the assessment service?

**Mara:** At least a few times a month, sometimes even a few times a week. This is especially important, because how fast we can update the device assessment service directly affects the company's profitability.

**Sam:** Why such a direct connection?

**Mara:** Going Green makes a profit when it resells the highest-value electronics it receives. Generally, newer devices are in better shape and are worth more. The faster we can add new device assessments, the more money the company makes.

**Alex:** Wow, so rapid change is a BIG deal for this service.

**Mara:** It is! And don't forget, we have to make sure that supporting new devices won't affect the system's support for the existing ones. Are y'all up for it?

**Sam and Alex:** You bet!

**Mara:** I think we should consider using a microkernel architecture. That style makes it easier to design and add new capabilities using plugins.

# <span id="page-286-0"></span>The two parts of microkernel architectures

The *microkernel* architecture derives its name from operating system design. The *kernel*, or core, of an operating system is very small, offering only the most basic capabilities. A microkernel architecture consists of two primary parts: its *core* and its *plugins* (any number of them).

![](_page_286_Figure_3.jpeg)

# Q: **Is the microkernel architecture technically or domain-partitioned?**

A: Flashback to Chapter 5! Most microkernel architectures are technically partitioned. You *could* divide the core into layers—perhaps one for presentation, another for business or workflow logic, and so on. However, microkernel is one of those strange architectural styles that can also be domain-partitioned, depending on how you design your plugins.

As for deployment models, microkernel architectures are usually monolithic. As you'll see in this chapter, however, in some scenarios a distributed model might make more sense.

Wait a minute. Just about all the software I use supports plugins one way or another. Are you telling me that **all** those systems use the microkernel architectural style?

<span id="page-287-0"></span>![](_page_287_Picture_2.jpeg)

#### Not quite. Every microkernel has plugins, but not all plugins belong to microkernels.

Unfortunately, there is no definitive dividing line between microkernel systems and systems that support plugins. Mostly, we evaluate how "microkernel-y" an architecture is (let's call that "microkern-ality") by how functional its core is without any plugins and how *volatile* its core is (how often it needs to change).

# <span id="page-288-0"></span>The spectrum of "microkern-ality"

Lots of software supports plugins: IDEs, web browsers, build tools, you name it. But simply supporting plugins doesn't make a system a microkernel—it's all about the core. In extreme microkernels, the core can do very little useful work without plugins installed.

A browser is perfectly useful without any plugins, so it's not much of a microkernel.

#### Eclipse IDE

The Eclipse IDE is desgined as a "pure" microkernel, facilitating different languages and tools via plugins.

#### Insurance application

An insurance application has standard rules for each policy yet allows customization for unique local rules and regulations, so it has a medium level of functionality without plugins.

#### Web browser

Web browsers support plugins but don't rely on them to function.

#### less functional

# Pegree of "microkern-ality"

Functionality/volatility of core

# functional

more

#### Linter

**Linters** are tools that use plugins to parse source code and apply style and syntax rules to it. Most programming languages have linters; for example, JavaScript has esLint.

#### Continuous integration tool (like Jenkins)

Jenkins works as a standalone continuous integration (CI) tool, but it supports a number of plugins for extensibility.

#### Insurance claims processing system

These systems are a common example of customization. They usually handle most claims in a standard way but allow developers to build custom rules for specific situations.

#### there are no Dumb Questions

#### ls every system that supports plugins a microkernel?

A: Not at all. Lots of systems support plugins. How much of a microkernel it is (and no one is actually grading you on this) depends on the volatility and functionality of its core

#### ls this architectural style only useful for software development tools?

A: A lot of development tools use this architecture because it lets them offer programmatic customization, but many business and other applications use it too. It works for any problem domain that requires customization and in which each change acts in isolation.

#### Are microkernel and microservices the same thing?

No, the similarity in the names is just a coincidence. Microkernel's name comes from operating system design, whereas microservices is named for its relatively small and separate deployment units in a distributed architecture.

![](_page_289_Picture_1.jpeg)

## Exercise

The microkernel architectural style shows up in lots of places. See if you can place the specific tools and categories below in the correct place on the spectrum, by determining how much of a microkernel each one is. *Hint: Each system's degree of "microkern-ality" depends on how useful it is* without *plugins*.

![](_page_289_Figure_4.jpeg)

#### <span id="page-290-0"></span>Device assessment service core

You and your team all agree to use a microkernel architecture for the new device assessment service.

The core system includes the criteria needed to assess a device, like its age, condition, and model number. For each type of device, it defers to a device-specific plugin that executes the rules to determine how the system will assess the device's resale value.

![](_page_290_Figure_4.jpeg)

You decide to use a distributed physical architecture for the plugins, for better scalability. This also gives Going Green the option to add plugins in other languages in the future.

Finally, you decide on synchronous communication, because the service is sufficiently responsive that there's no need to add the complexity of asynchronous communication.

Let's dig into those decisions a little further.

<span id="page-291-0"></span>![](_page_291_Picture_1.jpeg)

I can see that it's common to implement plugins as components within a monolithic architecture. But doesn't having everything in one deployment make it harder to hot-deploy plugins? It would be easier if they were distributed. Could we build distributed plugins?

# Yes, we could! The architecture's capabilities determine whether to encapsulate or distribute the plugins.

Some microkernel architectures include both the core system and the plugins in a single monolithic architecture; others are distributed, as you might recall from Chapter 5.

The microkernel style exists in the shadowy netherworld between monolithic and distributed architectures. Architects can implement it with either deployment model.

# there are no Dumb Questions

# O: Does a microkernel architecture's core system have to be a monolith?

Not necessarily—microkernels often feature in hybrid architectures. When it makes sense (such as for a desktop application), you might implement the core as a single system; other times, you might distribute parts of the core as well as the plugins.

#### How do I implement plugins?

A: You can implement your own plugin designs using interfaces, but virtually all platforms and technology stacks have libraries and frameworks to help out.

Can I implement plugins in different tech stacks than the stack in which the core is written?

A: One of the advantages of using distributed plugins is that you can write them using any platform you can call via a network connection.

# <span id="page-292-0"></span>Encapsulated versus distributed plugins

The core system in a microkernel is where the plugins, well, plug in. Generally, we implement that connection via an *interface*. The plugin implements the interface, while the core system supports that component via that interface.

If we design a microkernel as a monolithic architecture, we'll implement each plugin as a component that connects to the core through the interface.

![](_page_292_Figure_4.jpeg)

In other implementations of microkernel architectures, plugins are distributed: web endpoints, event queues, and so on. In addition, we can decide whether to call the plugins synchronously or asynchronously. (We'll cover this in much more depth in Chapter 11.)

![](_page_292_Figure_6.jpeg)

<span id="page-293-0"></span>![](_page_293_Picture_1.jpeg)

# Exercise

The assessment service team at Going Green must decide whether the microkernel's physical architecture should be *monolithic* (core and plugins in the same deployment unit) or *distributed* (plugins deployed separately from the core). They need your help with the trade-off analysis. Can you list some pros and cons for each option? We'll get you started. *Hint: Consider how each option would affect things like architectural characteristics.* 

![](_page_293_Figure_4.jpeg)

# <span id="page-294-0"></span>Plugin communication

To be useful, plugins must communicate with the core system. For example, the core will call a method (based on an interface) and utilize the results. This communication can be implemented in a couple of different ways, based on factors like physical architecture.

![](_page_294_Figure_3.jpeg)

How the actual call happens between the core and a plugin depends on the physical architecture you use to implement the plugins. In monolithic architectures, we implement plugins in the same technology stack as the core and deploy them as native components for the platform (like JAR files for Java, DLLs for .NET, or GEMs for Ruby).

As for distributed plugins, the core can call them with synchronous or asynchronous calls. Developers aren't restricted to the core's implementation platform, either—they can write plugins in a variety of languages.

![](_page_294_Figure_6.jpeg)

![](_page_295_Figure_1.jpeg)

**Head First:** Let's see... let me get my microphone plugged in. Testing, testing... OK, welcome, Plugin!

**Plugin:** How appropriate! All *sorts* of things use me to function. I'm happy to be here—and excited to clear up some controversies.

**Head First:** Everyone says you're the star of the microkernel architecture, yet the core gets more press time and attention. Is that fair?

**Plugin:** Well, that may be true, but what good is the core without me? It may be bigger, but without me, the core is *boring*.

**Head First:** You certainly show up in lots of places. What about your controversial role in non-microkernel architectures? Lots of systems support plugins that aren't microkernels...

**Plugin:** I'm happy wherever I appear. To be truthful, though, I prefer microkernels. For other architectures, plugins are just condiments—we're not necessary, but we add some nice flavors. In a microkernel, though, I'm the main course! The whole architecture is based on me. I appreciate that level of importance.

**Head First:** Let's dig into something that seems to appear in trade-off analyses all the time. Your distributed version has some performance issues, no?

**Plugin:** Hey, you can't say bad things about all plugins just because we have some trade-offs! Yes, it's true that when we use network calls to communicate, performance does take a hit. But you know what else? Those distributed plugins can scale better, *and* you can write them in a variety of languages. Different strokes for different folks, right? And different plugin physical architectures for different trade-offs.

**Head First:** OK, fair enough. But let's talk about working with overly volatile cores.

**Plugin:** Alas, that's one of the downsides to starring in a microkernel architecture—when the core decides to change all the time. Change is *my* job! The more the core changes, the more it's likely to interfere with what I'm doing. I strive for professionalism, so I prefer to work with nice, stable cores with no drama.

**Head First:** You get a lot of press because of your ability to handle customization, but do you have other roles? What else you can handle?

**Plugin:** Thanks for asking, Head First. It's always annoying to be pigeonholed into my best-known role. I can handle customizations without ugly, long switch statements, using an elegant architectural style, without even batting an eye. We plugins can be used for all kinds of things—really, anything that needs good isolation. For example, I show up all the time in A/B testing. The architects keep the old behavior in PluginA, add the new behavior in PluginB, and decide which to call. I also have starring roles in integration hubs, developer tools, and lots of other places.

**Head First:** Before we finish up, is there anything you'd like to plug?

**Plugin:** You bet! Look for me in an architecture near you, either as an integral part of a monolith or as an endpoint for a distributed microkernel.

# Cubicle conversation

![](_page_296_Picture_2.jpeg)

**Mara:** Hi, all. Just stopping by to take a look at your trade-off analysis for the Going Green assessment service. Have you decided yet between a monolithic and a distributed physical architecture?

**Sam:** We're working on it. I did the trade-off analysis for the distributed version, and personally, I'm a big fan. Here's our summary:

![](_page_296_Figure_5.jpeg)

**Mara:** Can you explain how you arrived at these conclusions?

**Alex:** Sure. For the distributed version, we don't have to restart the core system to add new devices. That gives us better *availability* than the monolithic version, since that requires a restart to load new device plugins. Also, it's simpler to deploy a single plugin than to redeploy the whole assessment service. Since the plugins don't run in the same process as the core, we can make the whole system more *scalable*. But that would take a toll on its *performance*—after all, network calls take a lot longer than in-process ones.

**Mara:** That sounds like a good trade-off. The business agrees that scalability is very important for the new system.

# there are no Dumb Questions

## <span id="page-297-0"></span>Q: **Where is the user interface in a microkernel architecture?**

A: It depends! If the system is monolithic, architects commonly include the UI as part of the core system. However, when you design a service in a distributed architecture as a microkernel, other parts of the system typically handle the UI.

# Q: **Can the UI utilize a microkernel?**

A: You bet it can. In fact, lots of UI patterns (like the BFF pattern we mentioned earlier) use the microkernel structure to handle customized UI endpoints such as iOS, Android, and web browsers.

#### Q: **Isn't a microkernel really just the Decorator design pattern?**

A: Good catch! While their purposes are mostly the same, the microkernel architecture is one way to *implement* the Decorator design pattern. Compared to design patterns, architecture requires more thought about physical limitations and possibilities. For example, design patterns don't account for capabilities like scalability.

## Q: **Is the microkernel style the only way to handle customization?**

A: Not at all. It's one of many ways. A microkernel architecture is useful when the structure of your system—its core capabilities that rarely change—requires discrete customization via plugins. For systems without that kind of structure, other architectural styles may be more appropriate.

## Q: **What's the internal structure of the core system? Is it just one big logical component?**

A: In the microkernel style, we design the core system based on how we want to organize the logical components in the system. For example, if we want to separate capabilities within the core, we might choose to implement the core via layers, as we would in the layered architectural style. On the other hand, we might follow DDD and design the core around a bounded context, as in the modular monolith style. The microkernel style is often used in hybrid architectures where customizability is a driving characteristic.

I'm thinking it would be a bad idea to allow plugins to talk to one another. Am I right?

![](_page_298_Picture_2.jpeg)

# Plugins can talk to one another in a microkernel through the core system. But should they?

Plugins typically communicate with the core system by implementing an interface that the core supports. That makes it possible for plugins to communicate with each other "through" the core system. For example, the Eclipse IDE, which supports multiple languages, allows language-based tools (like compilers and debuggers) to interact with each other in this way.

Be cautious about allowing inter-plugin communication, though! It has some serious negative trade-offs. First, it requires consistent *contracts* between the core and the plugins, which eventually involves versioning. (More about contracts on the next page.) For example, one thing that makes Eclipse complex is the transitive dependencies between its components, which can cause versioning headaches. Second, dependencies between plugins create availability issues, because you must guarantee that all necessary plugins are present at runtime.

To understand the problems with letting plugins chat amongst themselves, we have to look at the two ways the core communicates with plugins.

# <span id="page-299-0"></span>Plugin contracts

When architects implement microkernel architectures, we usually ensure that the core calls plugins using a *contract* (another word for *interface*). That communication is *solely between the plugin and the core*, not between plugins. If you allow communication between plugins, the core has to act as their intermediary.

In the example system below, PluginA doesn't know or care about other plugins; it communicates only with the core. However, PluginX needs to communicate with PluginY, and that communication must be mediated by the core system.

![](_page_299_Figure_4.jpeg)

Brain Power

You know you have to worry about intermediary communication through the core system, but consider this: what happens when you update PluginY in a way that changes the contract between PluginX and PluginY? If you don't want to change PluginX when you change PluginY, how could you manage that communication?

## Going Green goes green

After considering how best to implement the plugin interaction with the core, the team decides to define an interface (called *DeviceInterface*) for each plugin to implement. Now Going Green can add new devices just by implementing the interface and customizing the valuation process for that specific device.

![](_page_300_Figure_3.jpeg)

Your device assessment engine is a success. Well done!

To wrap up, let's quickly summarize the strong and weak points of this style of architecture.

# <span id="page-301-0"></span>Microkernel superpowers

The microkernel is a common architectural style. It's also one of the most common styles you'll find within hybrid architectures that require customization.

![](_page_301_Picture_3.jpeg)

Who you gonna call to customize part of your application?
Microkernel to the rescue!

## **Custom behavior**

The microkernel is "shaped" in the best way to handle customizations.

![](_page_301_Picture_7.jpeg)

# Adaptability as an arc

Adaptability, as an architectural characteristic, implies the ability to keep existing functionalities and continue adding more. A microkernel supports this well; you can keep old plugins as you implement new ones.

![](_page_301_Picture_10.jpeg)

#### **Evolvability**

Evolvability, as an architectural characteristic, means that architects can make fundamental underlying changes that gradually evolve the system away from its old behaviors. Unlike adaptable architectures, evolvable architectures only support the old behaviors for a short time. Plugins offer an excellent way to implement this capability.

## **Partitioning**

In a microkernel, you can handle customization with design or with architecture. However, if you use design, the developers must be very diligent about following the design correctly. If the system is structured around plugins, the distinction is clearer.

The microkernel is a great example of an architectural approach to customization.

Simplicity for the win!

# Simple structure

A microkernel has two basic moving parts (the core and plugins), making it easy for developers to understand and implement.

![](_page_301_Picture_19.jpeg)

<span id="page-302-0"></span>![](_page_302_Figure_1.jpeg)

# Microkernel kryptonite

The microkernel architecture's weaknesses mostly appear when architects use it improperly: for example, when the core changes too much or when plugins must communicate heavily with one another.

# Misaligned volatility

In a microkernel, the core system should change very little once it is implemented. If it changes a lot, that is likely a sign that this is not the ideal architectural solution or you have made the wrong things plugins.

One of the most common mistakes in a microkernel is a too-volatile core, due to frequent domain changes.

![](_page_302_Picture_7.jpeg)

# Sharing between plugins

While it's often tempting, sharing dependencies (such as shared libraries) between plugins is generally a bad idea because it creates headaches around coupling and deployment.

To keep a microkernel from devolving into a big ball of mud, keep an close eye on coupling via sharing.

#### **Performance**

When using distributed plugins for a physical architecture, you might notice an impact on performance, depending on the communication protocols and how much information passes between the core and the plugins.

![](_page_302_Picture_13.jpeg)

## **Chatty plugins**

Allowing plugins to interact may be tempting, but it comes with a host of difficult trade-offs. Successful systems that use this approach (for example, Eclipse) do so at the cost of high complexity.

![](_page_302_Picture_16.jpeg)

# <span id="page-303-0"></span>Microkernel star ratings

We've created a chart of star ratings, like the ones we showed you for layered and modular monolith architectures, to indicate how well microkernel architectures do with each of the architectural characteristics listed. One star means that the architectural characteristic is not well supported; five stars means it's very well supported.

Just like movie reviews.

![](_page_303_Figure_4.jpeg)

![](_page_304_Picture_1.jpeg)

Which of the following systems might be well suited for the microkernel architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the nature of each system.* An online auction system where users can bid on items **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A large backend financial system for processing and settling international wire transfers overnight **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A company entering a new line of business that expects constant changes to its system **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A small bakery that wants to start taking online orders **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A trouble ticket system for electronics purchased with a support plan, in which field technicians come to customers to fix problems **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** Why? Why? Why? Why? Why?

**Solution on page 275**

# <span id="page-305-0"></span>Wrapping it up

Thanks to your efforts, Going Green is assessing devices quickly and accurately, and profitability has never been better. This case shows just how useful microkernel architectures can be. For problems that need a customizable, stable system, a microkernel is hard to beat.

# **Bullet Points**

- The *microkernel* architectural style provides a structured way to handle customizations via plugins.
- Microkernel architectures consist of two main parts: the *core* and one or more *plugins*.
- The core system in a microkernel contains minimal functionality and has low volatility.
- Architects design plugins to customize and/or add behaviors to a system.
- Generally, plugins only communicate with the core system, not with each other.
- If plugins do need to communicate with each other, the core must mediate the communication and handle issues like versions and dependencies. It essentially serves as an integration layer.
- Microkernel architectures can be monolithic architectures or can be implemented as services in a distributed architecture.
- When built as a monolithic architecture, the core and plugins must be written in the same language.
- Plugin calls may be synchronous (for example, using REST in a distributed architecture) or asynchronous (using threads in a monolithic architecture or messaging in a distributed one). Whether remote calls are synchronous or asynchronous, architects can implement the plugins in a variety of technology stacks.

- Monolithic plugins generally offer better *performance* because calls take place in the same process.
- Monolithic microkernels suffer from the typical limitations of all monoliths, including limited operational capabilities such as scalability and elasticity.
- Microkernels that use distributed plugins may offer better scalability, because they use multiple processes and offer scalable communications (events).
- Microkernel architectures are best suited for problems with distinct categories of volatility.
- If a microkernel's core system changes often, its architects may have chosen the wrong architectural style or may have partitioned the work incorrectly.
- The microkernel style shows up in lots of places: IDEs, text processing tools, build and deployment tools, integrations, translation layers, insurance applications, and electronics recycling applications, just to name a few.

![](_page_306_Picture_1.jpeg)

Ready to see how much you've learned about microkernel architecture? Plug into this crossword puzzle!

![](_page_306_Picture_3.jpeg)

#### Across

- 3. Design pattern often used to implement microkernel architectures
- 6. With inter-plugin communication, the core serves as an integration \_\_\_\_\_
- 9. You can add new capabilities to a system by using these 10. Microkernel architectures can \_\_\_\_\_ to include new functionalities
- 11. Abbr. for a tool used to write code
- 13. Monolithic architectures \_\_\_\_\_ both plugins and core
- 14. Plugins are usually \_\_\_\_\_ independently from each other
- 16. A microkernel is great for creating systems with \_\_\_\_\_ rules and behaviors
- 17. You can use plugins written in more than one tech \_\_\_\_\_

#### Down

\_\_\_\_\_

\_\_\_\_\_

- 1. When plugins can talk to each other, their dependencies are
- 2. Example of an IDE that uses interacting plugins
- 4. \_\_\_\_\_ plugins provide better performance
- 5. Number of primary component types in a microkernel architecture
- 7. Constantly changing
- 8. Microkernel architectures often support several programming
- 12. When most monoliths load plugins
- 15. A tool that applies style and syntax rules to code
- 16. Plugins make \_\_\_\_\_ to talk to the core
- 18. What plugins are plugged into

**Solution on page 276**

BE the architect Solution

From page 249

Architects just can't stop analyzing stuff. Can you determine a few important architectural characteristics for each of the three services in the new Going Green architecture?

| Public user interfaces |
|------------------------|
|------------------------|

#### **Architectural characteristics**

Scalability
Availability

#### **Architectural characteristics**

Agility (deployability, testability, etc.)

Maintainability

device assessments

Pevice assessment

Going Green needs to test and deploy new device assessments quickly, without breaking existing ones.

#### **Architectural characteristics**

Recycling/accounting

Security
Data integrity
Auditability

![](_page_308_Picture_1.jpeg)

The microkernel architectural style shows up in lots of places. See if you can place the specific tools and categories below in the correct place on the spectrum, by determining how much of a microkernel each one is. *Hint: Each system's degree of "microkern-ality" depends on how useful it is* without *plugins.*

![](_page_308_Figure_4.jpeg)

<span id="page-309-0"></span>![](_page_309_Picture_1.jpeg)

The assessment service team at Going Green must decide whether the microkernel's physical architecture should be *monolithic* (core and plugins in the same deployment unit) or *distributed* (plugins deployed separately from the core). They need your help with the trade-off analysis. Can you list some pros and cons for each option? *Hint: Consider how each option would affect things like architectural characteristics*.

![](_page_309_Figure_4.jpeg)

![](_page_310_Picture_1.jpeg)

![](_page_310_Picture_2.jpeg)

An online auction system where users can bid on items **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A large backend financial system for processing and settling international wire transfers overnight **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A company entering a new line of business that expects constant changes to its system **Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel** A small bakery that wants to start taking online orders **Well suited for microkernel** Why? Why? Why? This system requires high scalability but not a lot of customization, making it less suitable for a microkernel architecture. Rules for wire transfers are likely to differ by country of origin. A microkernel is one way to address this problem. (However, scalability may be a concern for a monolithic microkernel.) If the company can partition changes to plugins and avoid having a volatile core, a microkernel will allow it to bring out new features in isolation. Which of the following systems might be well suited for the microkernel architectural style, and why? *Hint: Take into account its superpowers, its kryptonite, and the nature of each system.*

A trouble ticket system for electronics purchased with a support plan, in which field technicians come to customers to fix problems

terrific fit here.

Why?

Why? If customers, devices, or other parts of the system require customizations, a microkernel is one way to implement them.

With no compelling reason for customization and a simple problem, a microkernel isn't a

**Might be a fit for microkernel Not well suited for microkernel**

**Well suited for microkernel Might be a fit for microkernel Not well suited for microkernel**

![](_page_311_Picture_1.jpeg)

![](_page_311_Figure_3.jpeg)

# do it yourself **9**

# The TripEZ Travel App

![](_page_312_Picture_2.jpeg)

**Ready to extend your journey into software architecture?** In this chapter, you're the software architect. You'll be determining architectural characteristics, building a logical architecture, making architectural decisions, and deciding whether to use a layered, modular, or microkernel architecture. The exercises in this chapter will give you an end-to-end view of what a software architect does and show you how much you've learned. Get ready to create an architecture for a startup company building a travel integration convenience site. *Bon voyage*—we hope you have a good trip building your architecture.

# <span id="page-313-0"></span>Making travel easier

You've just been hired as a software architect by an exciting new startup called TripEZ (pronounced like "trapeze") that wants to make travel easier, especially for "road warriors" who travel frequently. The TripEZ app will be an online trip management dashboard that allows travelers to see all of their existing reservations organized by trip, through either a web browser or their mobile devices.

#### TripEZ requirements document ☐ The system should continually poll the user's email account for travel-related emails. $\Box$ The system must interface with the systems of travel partners (like travel agencies, booking apps, airlines, hotels, and car rental companies) to update travel details. These include delays, cancellations, updates, and gate changes. To beat the competition, updates must appear in the app within five minutes. $\square$ Users should be able to add, update, or delete existing reservations manually. ☐ Users should be able to group items in the dashboard by trip. Once the trip is complete, the items should automatically be removed from the dashboard. ☐ Users should be able to share their trip information by interfacing with standard social media sites and by sharing it with specific people. ☐ The system should have the richest user interface possible, across all deployment platforms. ☐ The system should provide end-of-year summary reports with a wide range of metrics about users' ☐ TripEZ should gather analytical data—such as travel trends, locations, airline and hotel vendor preferences, and cancellation and update frequency—from users' trips for various purposes. $\Box$ The company would like to ship TripEZ in six months, to coincide with an important trade show.

![](_page_313_Picture_4.jpeg)

Meet Travis, former pilot and consultant to TripEZ. He has a few more important requirements for the system.

Pay attention, because

"TripEZ must integrate seamlessly with the existing standard interface systems these things are important. used across the travel industry, including internationally.

> It must integrate with the user's preferred travel agency (if any) to resolve problems quickly.

Finally, users must be able to access the system at all times. Unplanned downtime should be limited to a maximum of five minutes per month."

# <span id="page-314-0"></span>TripEZ's user workflow

Now that we have the requirements, let's get a better understanding of them by looking at the primary workflow for travelers using TripEZ.

![](_page_314_Figure_3.jpeg)

# Sharpen your pencil Given the requirements for TripEZ, list some challenges that you will need to address when creating an architectural solution. Solution on page 294

# <span id="page-315-0"></span>Planning the architecture

I've given you
the requirements, so
what's the big delay? Why
aren't you developing the
system? We only have six
months!

0

![](_page_315_Picture_3.jpeg)

Even though Travis is impatient to see some progress, don't let that stop you from creating a solid, well—thought—out architecture.

#### We have to create an architecture first. $\angle$

As you've learned, architecture is a critical and necessary part of any software system. Without it, the system will likely fail to achieve any of its goals.

Before we start developing code, we have to create an architecture. This means going back to Chapter 1, where you learned about the four dimensions of software architecture.

Don't worry—we'll get the system done. But first, it's important to know what we're building.

# <span id="page-316-0"></span>The architects' roadmap

Let's get the TripEZ architecture started. You'll use the steps you've learned in previous chapters to translate the requirements into an architecture.

![](_page_316_Figure_3.jpeg)

This diagram will serve as your roadmap as you make your way through each of the exercises, so get used to seeing it. The next few pages will walk you through each of these steps.

Good luck on your journey—TripEZ is counting on you.

# <span id="page-317-0"></span>Step 1: Identify architectural characteristics

![](_page_317_Figure_2.jpeg)

"TripEZ must integrate seamlessly with the existing standard interface systems used across the travel industry, including internationally.

It must integrate with the user's preferred travel agency (if any) to resolve problems quickly.

Finally, users must be able to access the system at all times. Unplanned downtime should be limited to a maximum of five minutes per month."

We copied the requirements here to make it easier for you to use them to identify the driving architectural characteristics.

# TripEZ requirements document

- ☐ The system should continually poll the user's email account for travel-related emails. ☐ The system must interface with the interface systems of travel partners (like travel agencies, booking apps, airlines, hotels, and car rental companies) to update travel details. These include delays, cancellations, updates, and gate changes. To beat the competition, updates must appear in the app
- within five minutes.  $\square$  Users should be able to add, update, or delete existing reservations manually.
- $\square$  Users should be able to group items in the dashboard by trip. Once the trip is complete, the items should automatically be removed from the dashboard.
- ☐ Users should be able to share their trip information by interfacing with standard social media sites and by sharing it with specific people.
- ☐ The system should have the richest user interface possible, across all deployment platforms.
- ☐ The system should provide end-of-year summary reports with a wide range of metrics about users'
- ☐ TripEZ should gather analytical data—such as travel trends, locations, airline and hotel vendor preferences, and cancellation and update frequency—from users' trips for various purposes.
- ☐ The company would like to ship TripEZ in six months, to coincide with an important trade show.

<span id="page-318-0"></span>Exercise

In Chapter 2, we showed you how to use this template to limit the number of architectural characteristics. Flip back to page 70 if you need a refresher on how to use it.

| Top 3 Driving Characteristics | Implicit Characteristics |
|-------------------------------|--------------------------|
|                               | feasibility (cost/time)  |
|                               | security                 |
|                               | maintainability          |
|                               | observability            |

*Pick the top three most important ones (in any order).*

These are implied characteristics. Move them to the Driving Characteristics column if you think they are critical to the success of the system.

Go back to Chapter 2 if you need a refresher on the definitions of these common architectural characteristics.

**Common Candidate Architectural Characteristics**

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

Solution on page 293

# <span id="page-319-0"></span>Step 2: Identify logical components

Good job! Now that you've identified the critical architectural characteristics for TripEZ, it's time to apply what you've learned to create logical components.

Referring to the requirements and primary workflow on the previous pages, use the actor/action approach described in Chapter 4 to identify actors and their actions. Then identify as many logical components as you can on the next page.

![](_page_319_Figure_4.jpeg)

Here's some additional information you might find useful for this exercise:

- When users sign up for TripEZ, they provide credentials to allow the different travel services to provide up-to-date status reports on delays, cancellations, and so on.
- If a travel partner's integration point won't supply updates within the required fiveminute window, the system should query the vendor.
- Updates, especially to the mobile application, should use as little data as possible to accommodate potentially spotty cell signals in remote places.
- TripEZ can't be held responsible for integration point availability; if the call fails, the system must return an error rather than failing silently (which would mislead the user into thinking no update was sent).

This allows the system to work with travel partners that can't meet its agreed—upon thresholds.

![](_page_319_Figure_11.jpeg)

<span id="page-320-0"></span>![](_page_320_Picture_1.jpeg)

Using the space below, draw your logical components and their interactions.

![](_page_320_Figure_3.jpeg)

**Solution on page 295**

# <span id="page-321-0"></span>Step 3: Choose an architectural style

Leveraging what you've learned about the layered, modular monolith, and microkernel architectural styles, use the next page to analyze their pros and cons with respect to the TripEZ system. You'll also need to refer to the requirements, your logical architecture, and the star rating charts for each architectural style (we've added those below for you). Choose an architectural style based on your analysis.

![](_page_321_Figure_3.jpeg)

#### Layered

#### **Modular Monolith**

#### **Microkernel**

| Architectural Characteristic | Star Rating | Architectural Characteristic | Star Rating | Architectural Characteristic | Star Rating |
|------------------------------|-------------|------------------------------|-------------|------------------------------|-------------|
| Maintainability              | ★           | Maintainability              | ★★★         | Maintainability              | ★★★         |
| Testability                  | ★★          | Testability                  | ★★★         | Testability                  | ★★★         |
| Deployability                | ★           | Deployability                | ★★★         | Deployability                | ★★★         |
| Simplicity                   | ★★★★        | Simplicity                   | ★★★★        | Simplicity                   | ★★★★★       |
| Evolvability                 | ★           | Evolvability                 | ★★★         | Evolvability                 | ★★★         |
| Performance                  | ★★★         | Performance                  | ★★★         | Performance                  | ★★★         |
| Scalability                  | ★           | Scalability                  | ★           | Scalability                  | ★           |
| Elasticity                   | ★           | Elasticity                   | ★           | Elasticity                   | ★           |
| Fault Tolerance              | ★           | Fault Tolerance              | ★           | Fault Tolerance              | ★           |
| Overall Cost                 | \$          | Overall Cost                 | \$\$        | Overall Cost                 | \$          |

The more stars, the better that characteristic is supported.

Apologies for the tiny font, but remember—you can always flip back to individual chapters to see the star ratings for a particular style.

Here are some considerations that might help you decide which architectural style would be better suited for TripEZ:

- Go back to your logical architecture diagram and see if you can identify distinct technical or business concerns. If so, a layered or modular monolith architecture might be a good choice.
- Think about different points of integration. If there are many, each with specific logic, then a microkernel architecture might be a good fit.

<span id="page-322-0"></span>![](_page_322_Picture_1.jpeg)

Outline the pros and cons of each architectural style to help you make a choice about which one might be most

Outline the pros and cons of each architectural style to help you make a choice about which one might be most appropriate for TripEZ.

|      | Layered Monolith Architecture Analysis |      |
|------|----------------------------------------|------|
| Pros |                                        | Cons |
|      | Modular Monolith Architecture Analysis |      |
| Pros |                                        | Cons |
|      | Microkernel Architecture Analysis      |      |
| Pros |                                        | Cons |

List your winning choice here: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_, Solution on page 296

# <span id="page-323-0"></span>Step 4: Pocument your decision

Congratulations on choosing which architectural style to use for TripEZ. Now's your chance to explain *why* you made the choice you did and document your architectural decision.

As you learned in Chapter 3, an *architectural decision record*, or ADR, is an effective way to document your architectural decisions. Use the ADR on the next page to document your architectural style decision. Assume this is your 11th architectural decision.

Revisit Chapter 3 if you need a refresher on architectural decision records.

![](_page_323_Picture_5.jpeg)

![](_page_323_Picture_6.jpeg)

What should I put in the Consequences section of my ADR if my architectural decision doesn't have any consequences?

# Every architectural decision has consequences.

Maybe it's about cost, or maybe it's sacrificing a little bit of performance to have better security. Regardless, *every* architectural decision has consequences.

Think about the trade-off analysis you just did. Each one of those trade-offs implies a consequence—something you were willing to give up (or accept) to get something better. The Consequences section of an ADR is a great place to document your trade-off analysis and the corresponding consequences of your decision.

If you can't find any consequences in your architectural decision, keep looking, because they're there.

<span id="page-324-0"></span>![](_page_324_Picture_1.jpeg)

# **Exercise**

Architectural Decision Record

| Title:        |                                                                                 |
|---------------|---------------------------------------------------------------------------------|
| Status:       | Proposed                                                                        |
| Context:      |                                                                                 |
| Decision:     |                                                                                 |
| Consequences: | What is the impact of your decision? What trade-offs are you willing to accept? |

Solutions on pages 297-299

# <span id="page-325-0"></span>Step 5: Diagram your architecture

Now it's time to combine all four dimensions of software architecture and show us your vision of the TripEZ architecture. In this last exercise, you'll diagram your architecture on the following page using the key on this page.

We didn't give you a lot of room to diagram your architecture, and that's on purpose. While many architecture diagrams are very detailed, what we're asking you to do here is to sketch out a *high-level physical view* of the user interfaces, databases, and components that make up your architecture and how they all connect to each other.

![](_page_325_Figure_4.jpeg)

#### **Physical Architecture Key**

User Interface

![](_page_325_Picture_7.jpeg)

Draw a computer screen to represent the *user interface* and indicate which types of *users* are interacting with it. For example, if you have separate user interfaces for desktops and mobile devices, show two computer screens.

Feel free to annotate your diagram to clarify points or describe things.

![](_page_325_Picture_10.jpeg)

Use a rounded box to represent a *component*. These should match the logical components you identified in the previous exercise. Be sure to give your components a meaningful and descriptive names.

Layer

Use a box to a represent a *layer* (if your architecture needs layers). Again, be sure to give each layer a meaningful name.

**Patabase** 

![](_page_325_Picture_15.jpeg)

![](_page_325_Picture_16.jpeg)

Arrows represent communication to and from the user interface and database.

<span id="page-326-0"></span>![](_page_326_Picture_1.jpeg)

# <span id="page-327-0"></span>There are no right (or wrong) answers

Congratulations—you've just created an architecture!

What we're about to show you are the exercise "solutions." We've used quotes there because the solutions we present here are just some of *many* possible solutions. You see, there are no right or wrong answers in software architecture: it's all about analyzing trade-offs and being able to justify your decisions.

Compare your answers with the ones we're about to show you to see how your solutions differ. You can think about what you might have done differently, or confirm that you made what seems to you to be the most appropriate choice. We'll show you our TripEZ architectures for layered, modular monolith, *and* microkernel architectures, since all of these styles are viable options.

Software architecture is *always* a learning process. Each new problem brings a whole new set of conditions, constraints, and business and technical concerns. There is no one-size-fits-all architecture—it's up to you, the architect, to come up with the most appropriate architecture for your situation.

# **Bullet Points**

- When analyzing requirements for a business problem, always gather additional information from the business stakeholders or project sponsor.
- While there's no "checklist" for creating an architecture, the four dimensions of software architecture (introduced in Chapter 1) provide a good roadmap.
- Identifying driving architectural characteristics requires you to analyze the business requirements and technical constraints.
- Implicit architectural characteristics become *driving characteristics* if they are critical or important to the success of the system.
- Make sure you can tie each driving characteristic back to some sort of requirement or business need.
- When identifying logical components and creating a corresponding logical architecture, try to avoid adding physical details such as services, databases, queues, and user interfaces—those artifacts go into the *physical architecture*.

- When choosing an architectural style, make sure you consider the characteristics of the architectural style, the problem domain, and the driving architectural characteristics you identified.
- *Hybrid architectures* (those combining two or more different architectural styles) are very common. If you use one, be sure to verify that it addresses your critical architectural characteristics.
- *Architectural decision records* (ADRs) are a great way to document your choices. They communicate the reasons for your architectural decisions as well as your trade-off analyses.
- When diagramming your physical architecture, be sure to include all the components you identified in your logical architecture.
- Remember, there are no right or wrong answers in software architecture. As long as you can provide a reasonable justification for your architectural decisions, you're on the right track.

| Exercise |
|----------|
| Solution |

In Chapter 2, we showed you how to use this template to limit the number of architectural characteristics. Flip back to page 70 if you need a refresher on how to use it.

|                                     | <b>Driving Characteristics</b>                                                |  | <b>Implicit Characteristics</b>                                                           |
|-------------------------------------|-------------------------------------------------------------------------------|--|-------------------------------------------------------------------------------------------|
| <input type="checkbox"/>            | feasibility <span style="font-size: smaller;">We only have six months.</span> |  | feasibility (cost/time)                                                                   |
| <input checked="" type="checkbox"/> | performance                                                                   |  | security                                                                                  |
| <input checked="" type="checkbox"/> | scalability                                                                   |  | maintainability                                                                           |
| <input type="checkbox"/>            | elasticity                                                                    |  | observability                                                                             |
| <input checked="" type="checkbox"/> | extensible/evolvable                                                          |  | TripEZ is going to need lots of integrations with email providers and social media sites. |
| <input type="checkbox"/>            | availability                                                                  |  |                                                                                           |
| <input type="checkbox"/>            |                                                                               |  |                                                                                           |

**Common Candidate Architectural Characteristics**

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

![](_page_329_Picture_2.jpeg)

# Sharpen your pencil Solution

Given the requirements for TripEZ, list some challenges that you will need to address when creating an architectural solution.

- · Making sure that we can deliver alerts in time
- · Supporting a sufficient number of users
- · Finding a way to manage all the different integration points
- · Integrating with social media accounts

![](_page_329_Picture_9.jpeg)

# Sharpen your pencil Solution

From page 284

Using the actor/action approach, identify actions for each of the actors below.

![](_page_329_Figure_13.jpeg)

Receive alerts

![](_page_329_Figure_14.jpeg)

![](_page_329_Figure_15.jpeg)

![](_page_329_Figure_16.jpeg)

![](_page_330_Figure_1.jpeg)

<span id="page-331-0"></span>![](_page_331_Picture_1.jpeg)

Outline the pros and cons of each architectural style to help you make a choice about which one might be most appropriate for TripEZ.

#### **Layered Monolith Architecture Analysis**

#### Pros

A layered architecture, being a monolith, is fairly simple, so it provides a high degree of feasibility.

Partitioning by technical concerns makes adding third-party integrations easier.

Monolithic architectures lend themselves to better performance, which is one of TripEZ's priorities.

#### Cons

Making changes to the domain in a layered architecture can be cumbersome because the domain is smeared across multiple layers.

As TripEZ grows, the system will need to be monitored continuously to ensure that it can scale.

#### **Modular Monolith Architecture Analysis**

#### **Pros**

A modular monolith architecture, being a monolith, is fairly simple, so it provides a high degree of feasibility.

Partitioning by domains fits better here, because it eliminates the need to split domain parts out by their technical capabilities.

Monolithic architectures lend themselves to better performance, which is one of TripEZ's priorities.

#### Cons

Adding more integration partners may require changes to a large number of domains.

As TripEZ grows, the system will need to be monitored continuously to ensure that it can scale.

#### **Microkernel Architecture Analysis**

#### Pros

A monolithic microkernel architecture is fairly simple, so it provides a high degree of feasibility.

A microkernel is well suited to the job, given TripEZ's need for integration flexibility.

Monolithic microkernel architectures lend themselves to better performance, which is one of TripEZ's priorities.

#### Cons

Any changes that affect the core must be considered carefully.

As TripEZ grows, the system will need to be monitored continuously to ensure that it can scale.

Turns out any of these would work;
List your winning choice here: they'd just have different trade-offs.

We're going to
show you ADRs and
architecture diagrams
for all three!

List your winning choice nere

<span id="page-332-0"></span>![](_page_332_Picture_2.jpeg)

#### **Architectural Decision Record**

Title: Oll: Use of the layered monolith architectural style for the TripEZ system

Status: Proposed

#### Context:

TripEZ is a fast-growing startup that requires a simple architecture to ensure feasibility. Additionally, the company needs to ensure extensibility to accommodate multiple third-party integrations.

#### **Decision:**

We will use the layered monolith architectural style. Since TripEZ doesn't need separate architectural characteristics for different parts of its system, a layered monolith will suffice for the required architectural characteristics. The main constraint is scalability.

Additionally, separating the system by technical capabilities makes extensibility easier.

#### Consequences:

Because we chose a monolithic architecture, scalability may eventually grow to be a concern.

Building a layered architecture makes some domain-centric changes harder because the effort will affect multiple layers.

Architects will be able to change technical capabilities (such as adding support for new user interfaces) easily thanks to this architectural style's technical partitioning.

#### **Architectural Decision Record**

<span id="page-333-0"></span>**Title:** 011: Use of the modular monolith architectural style for the TripEZ system

**Status:** Proposed

#### **Context:**

TripEZ is a fast-growing startup that wants to make sure to model its architecture in a way that allows for the easiest possible migration to a distributed architecture, while still being simple enough to build on a tight schedule.

#### **Decision:**

We will use the modular monolith architectural style. We've chosen a development process that aligns well with the domain partitioning exhibited by this architecture.

Keeping each bounded context within a component boundary helps developers understand the system's organization. Additionally, the system can grow in a similar way to the problem domain.

Our organization has adopted domain-driven design, and this architectural style aligns nicely with that approach.

#### **Consequences:**

Because we've chosen a monolithic architecture, scalability may eventually grow to be a concern.

Holistic changes to technical capabilities (such as user interfaces) are more difficult in this architecture, since the UI is handled by a part of each bounded context.

<span id="page-334-0"></span>![](_page_334_Picture_2.jpeg)

#### **Architectural Decision Record**

Title: Oll: Use of the microkernel architectural style for the TripEZ system.

Status: Proposed

Context:

You may have noticed that the context is slightly different, even though it's the same system. This reflects differing team priorities.

TripEZ is essentially an integration architecture, managing similar information from a variety of integration partners. This architecture will easily facilitate both isolation and customization for each integration point via plugins.

#### **Decision:**

We will use the microkernel architectural style.

Time to market and extensibility are important to the company, so modeling the architecture around a simple core with plugins for future additional integration partners will make it easy for developers to understand and implement.

We decided that the simplicity of a monolithic system outweighed the benefits (but added complexity) of distributed plugins.

#### Consequences:

In a monolithic architecture, scalability may eventually grow to be a concern. The team may consider distributing the plugins in the future, but we decided that it would be overengineering for now.

The core can be split so that the UI is handled by another microkernel, with different plugins for different UI types.

We should avoid adding fast-changing requirements to the core. It should be as stable as possible.

<span id="page-335-0"></span>![](_page_335_Figure_1.jpeg)

Use this space and refer to the key on page 290 to sketch your physical architecture for TripEZ.

# Layered monolithic architecture diagram

![](_page_335_Figure_5.jpeg)

<span id="page-336-0"></span>![](_page_336_Figure_1.jpeg)

Use this space and refer to the key on the page 290 to sketch your physical architecture for TripEZ.

# Modular monolithic architecture diagram

![](_page_336_Figure_5.jpeg)

<span id="page-337-0"></span>![](_page_337_Figure_1.jpeg)

Use this space and refer to the key on the prior page to sketch your physical architecture for TripEZ.

# Microkernel architecture diagram

![](_page_337_Figure_5.jpeg)

![](_page_338_Picture_0.jpeg)

**How do you make an architecture easier to change?** Business is changing faster than ever, and software architectures need to keep up. In this chapter you'll learn how to create a flexible architecture that can change as your business changes, scale as your business grows, and remain operational even when system failures occur. Intrigued? We hope so, because in this chapter we're going to show you *microservices*—an architectural style that solves all of these problems and more. Let's get started on our journey through microservices, bit by bit.

# <span id="page-339-0"></span>Are you feeling okay?

StayHealthy, Inc., is a company that specializes in medical monitoring systems for patients in hospitals. Using its systems, doctors and nurses can monitor a patient's heart rate, oxygen levels, body temperature, blood sugar levels, and more, and even determine whether the patient is sleeping or awake. If something goes wrong, a doctor or nurse is notified right away.

Recent advances in medicine have given rise to a new set of needs for medical monitoring. As a result, StayHealthy plans to leverage newer technology to replace its current patient medical monitoring software with a new system called MonitorMe. Guess what? You're the architect they chose for the new project.

Below are the requirements for the new system. You'll need to figure out what kind of architecture would be best suited for the job.

![](_page_339_Picture_5.jpeg)

# StayHealthy MonitorMe requirements document ☐ The system reads inputs from StayHealthy's patient monitoring equipment and sends the results to a single monitoring screen. ☐ MonitorMe must analyze each patient's vital signs and alert a medical professional if it detects a change that reaches a preset threshold. ☐ For each vital sign, the system must record all readings and measurements for the past five minutes. A medical professional should be able to review this five-minute history. ☐ Medical professionals select how they'd like to be notified if something goes wrong. Notifications can be sent to an assigned nurse or doctor's cell phone or to a central nurses' station. ☐ MonitorMe reads inputs from eight different input sources. It is vital that if any of these fails, the other inputs will still be monitored and recorded. ☐ The vital signs monitored by the MonitorMe system include heart rate, blood pressure, oxygen level, blood sugar, respiration rate, electrocardiogram (ECG), body temperature, and sleep status (sleep or awake). ☐ The system can measure the vital signs of multiple patients (up to 500) within a single hospital, meaning each physical hospital location has its own copy of the complete system (including the data).

<span id="page-340-0"></span>

| Sharpen your pencil                                                                                                                                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Based on the problem domain and requirements document on the previous page, check off the top five<br>architectural characteristics you think are critical to the MonitorMe architecture and indicate why you think they<br>are critical. |
| Testability (the ease and completeness of testing)                                                                                                                                                                                        |
| Reason:                                                                                                                                                                                                                                   |
| Responsiveness (the time it takes to get a response to the medical professional)                                                                                                                                                          |
| Reason:                                                                                                                                                                                                                                   |
| Deployability (the difficulty and ceremony involved in releasing changes)                                                                                                                                                                 |
| Reason:                                                                                                                                                                                                                                   |
| Abstraction (the level of isolation and knowledge between parts of the system)                                                                                                                                                            |
| Reason:                                                                                                                                                                                                                                   |
| Scalability (the system's ability to grow to accommodate more users or patients)                                                                                                                                                          |
| Reason:                                                                                                                                                                                                                                   |
| Fault tolerance (the system's ability to continue operating when parts of the system fail)                                                                                                                                                |
| Reason:                                                                                                                                                                                                                                   |
| Data integrity (the data is consistent and correct across the system and there is no data loss)                                                                                                                                           |
| Reason:                                                                                                                                                                                                                                   |
| Workflow (the system's ability to handle complex business workflows)                                                                                                                                                                      |
| Reason:                                                                                                                                                                                                                                   |
| Concurrency (the system's ability to process concurrent requests or operations)                                                                                                                                                           |
| Reason:                                                                                                                                                                                                                                   |

**Solution on page 338**

## <span id="page-341-0"></span>**Cubicle conversation**

![](_page_341_Picture_2.jpeg)

**Sam:** I think we can all agree that microservices is a perfect fit for the new MonitorMe system.

**Mara:** Hold on—what brought you to that conclusion so quickly?

**Sam:** It's obvious, isn't it? From a domain perspective, we have independent monitoring functions, and we need high fault tolerance and comprehensive testability. Microservices does all this and more.

**Alex:** Slow down a second. I'm not familiar with microservices, and I have no idea how it supports all the things you say it does.

**Mara:** I agree with Alex. I know that we need a distributed architecture, so microservices might be a fit here. But let's back up and take a closer look before we jump to any conclusions.

**Sam:** Okay, I see your point—what might seem obvious to me might not be obvious to you. It's important that you both understand what microservices is all about, and then *together* we can decide if it's the right fit for MonitorMe. So let's get started.

Assumptions like this are a common trap. We'll show you how to avoid it by better understanding the microservices architectural style and its trade-offs.

## <span id="page-342-0"></span>What's a microservice?

What's in a name? When it comes to microservices, plenty. We'll show you what a microservice is and how it differs from other types of services.

![](_page_342_Picture_3.jpeg)

Generally, a *service* is a separately deployed unit of software that performs some business or infrastructure process. For example, a single Monitor All Vital Signs service in MonitorMe might perform a lot of functions, including monitoring the patient's heart rate, blood pressure, temperature, and so on. This service does quite a bit, but we still call it a *service*.

This large service monitors all of a patient's vital signs.

The prefix *micro*- in microservice refers not to physical size, but to *what the service does*. For example, a Monitor Heart Rate service is single-purpose and does one thing really well—it monitors a heart rate. That's the idea behind microservices. By contrast, the larger Monitor All Vital Signs service performs many vital sign monitoring functions.

![](_page_342_Picture_7.jpeg)

# A microservice is a single-purpose, separately deployed unit of software that does one thing really well.

**Exercise**

We're having trouble determining what *single-purpose* means. Can you help us by checking off all the functions below that you would consider single-purpose and therefore possible microservices?

| <input type="checkbox"/> | Add a movie to your personal "to watch" list                                   |
|--------------------------|--------------------------------------------------------------------------------|
| <input type="checkbox"/> | Pay for an order using your credit card                                        |
| <input type="checkbox"/> | Generate sales-forecasting and financial-performance reports                   |
| <input type="checkbox"/> | Submit and process a loan application to get that new car you've always wanted |
| <input type="checkbox"/> | Determining the shipping cost for an online order                              |

Solution on page 339

## <span id="page-343-0"></span>It's my data, not yours

Another feature that makes microservices special is that they own their own data. In other words, each microservice is the only one that can directly access its data.

![](_page_343_Figure_3.jpeg)

Why? The primary reason is to *manage change control*. Say you have 50 microservices, all sharing the same data. If one microservice changes the structure of its data, which the other 49 microservices are *also* accessing, *all* of those other services will need to change *at the same time*. (Is your head exploding yet?)

Physically associating a microservice with its data is known as creating a *physical bounded context*. Physical bounded contexts help manage change and coupling. If other microservices need access to data they don't own, they must ask the owning service for it.

A physical bounded context includes the microservice and all of its data.

![](_page_343_Figure_7.jpeg)

In the example above, the Monitor Heart Rate microservice is asking for the data rather than directly accessing the data. This way, even if the Sleep Status data structures change, the Monitor Heart Rate microservice doesn't have to. This is the whole idea behind physical bounded contexts.

context.

#### <span id="page-344-0"></span>Sharpen your pencil We created the following services for an ecommerce site, but we need your help in figuring out the data ownership and bounded contexts. Can you associate the database tables below with the corresponding microservices that should own the data? This is a microservice. Customer Customer Product Inventory **Order** Wishlist Profile Catalog Control Shipping This is a database table. We did this one for you. Used to shipping costs Contains all Pricina Address ltem **Petail** Contains items a customer may want to buy later and payment Wishlist Items Inventory Contains the warehouse in which Contains all Phone number shipping details each product is Name located for an order Location Manifest Solution on page 340

## <span id="page-345-0"></span>How micro is "micro"?

Figuring out how big or small a microservice should be is hard. By now you know that *a microservice is a single-purpose service that's separately deployed*. But how do you determine the scope of that single purpose?

As an example, let's take a look at the MonitorMe functionality for blood pressure. Monitoring a vital sign involves capturing the input from the medical device attached to the patient, recording the input, analyzing the measurements, and alerting a nurse or doctor if something is wrong. We can model this functionality in one of three ways:

- **Option 1:** Create a single monitoring microservice that performs all monitoring and alerting functions.
- **Option 2:** Create two separate microservices—one that captures and records vital signs data, and one that analyzes the data and alerts staff if necessary.

Option 3: Create four separate microservices, each one performing a specific blood pressure monitoring function.

"Single—purpose" here means <u>analyzing</u> the blood pressure data and <u>alerting</u> staff if something is wrong.

![](_page_345_Figure_8.jpeg)

<span id="page-346-0"></span>![](_page_346_Picture_1.jpeg)

Okay, so how am I supposed to know which of those options to use for monitoring blood pressure? Is this another one of those "guessing games," like with logical components?

#### No, granularity is not a guessing game.

Granularity—the scope of what a microservice does—is an important factor when identifying microservices. Microservices that are too fine-grained tend to communicate more with each other to complete business functions, leading to high levels of coupling, poor performance, and overall reliability issues. This is commonly referred to as the *Grains of Sand* antipattern, in which services are *so* small that they start to resemble sand on a beach. However, microservices that are too *coarse*-grained are harder and more expensive to maintain, test, and scale (which defeats the whole purpose of using microservices).

So how do you determine the most appropriate level of granularity for a microservice? By applying forces called granularity disintegrators and granularity integrators. *Granularity disintegrators* are forces that tell you to make your service smaller (meaning it's doing less work), whereas *granularity integrators* are forces that tell you to make the service bigger (meaning it's doing more work). Let's see how these forces work.

![](_page_346_Figure_6.jpeg)

# Granularity disintegrators

*Granularity disintegrators* are forces that help you decide whether you should break a service apart into several smaller ones. To show you how these forces can influence your decision to break a service apart, we'll take a look at MonitorMe's Monitor Basic Vital Signs functionality.

The three *basic* vital signs are blood pressure, temperature, and heart rate. Since they're all related, we could put them all in the same microservice *or* create separate microservices, one for each basic vital sign.

Granularity disintegrator forces make services smaller.

![](_page_347_Figure_5.jpeg)

Let's analyze each of these forces to see how it might help you decide whether to break the monitoring functionality into separate microservices.

# <span id="page-348-0"></span>Why should you make microservices smaller?

![](_page_348_Picture_2.jpeg)

#### **Cohesion**

A single-purpose microservice has functionality that is highly *cohesive* meaning all the things it does are closely related to each other. If the functionalities of a microservice lack cohesion, then it might be a good idea to break that microservice apart.

![](_page_348_Picture_5.jpeg)

#### **Fault tolerance and availability**

Do certain functions in a microservice frequently produce fatal errors? In larger microservices, *all* functionalities become unavailable when a *part* of the microservice fails. However, if the faulty functionality is in its own separate microservice, it won't affect other functions.

![](_page_348_Picture_8.jpeg)

## **Access control**

The larger the service, the more difficult it is to control access to sensitive information. For example, a Patient Profile microservice containing functionality to access medical history might inadvertently allow unauthorized staff to access this sensitive (and protected) information.

Moving sensitive functionalities (like access to medical history) into their own microservices *isolates* them, making it easier to control access to that information.

![](_page_348_Picture_12.jpeg)

![](_page_348_Picture_13.jpeg)

#### **Code volatility**

Does one part of the microservice change faster than others? Constant changes to one part of a large microservice mean you have to test the *entire* microservice, including functionalities you didn't change. That's a lot of extra work.

Moving a frequently changing function into its own separate microservice isolates those changes from other functions, making it much easier to maintain and test functionality.

![](_page_348_Picture_17.jpeg)

#### **Scalability and throughput**

Do some parts of the microservice need more scalability than others? If so, breaking the service apart allows better control over which portions need to scale and which do not.

For example, suppose the heart rate monitoring function accepts sensor readings every second, but the temperature monitoring function accepts sensor readings once every 5 minutes. Separating these monitoring functions into distinct services allows each one to accommodate a different throughput rate.

Smaller microservices start up much faster than larger ones, making much-needed functionality available to the user sooner.

# <span id="page-349-0"></span>Granularity integrators

**Granularity integrators** work in the opposite direction from disintegrators—they help you decide when to make services *bigger* and combine their functionalities. We'll use the same Monitor Basic Vital Signs microservice we broke apart earlier to illustrate why you might want to consider combining separate microservices into one larger microservice.

![](_page_349_Figure_3.jpeg)

Let's analyze each of these forces to see how they might help you determine whether you should put all this monitoring functionality into a single larger microservice.

# <span id="page-350-0"></span>Why should you make microservices bigger?

![](_page_350_Picture_2.jpeg)

#### **Database transactions**

When requests involve multiple microservices, you can't perform a single database commit or rollback for all updates. Since each microservice update is in its own separate transaction, it must instead be committed or rolled back separately.

If *data consistency and integrity* are more important than any of the disintegrator forces, then it makes sense to combine the functionality into a single microservice so that operations take place in a single database transaction.

![](_page_350_Picture_6.jpeg)

![](_page_350_Picture_7.jpeg)

## **Data dependencies**

When you break a microservice apart, you also have to break its *data* apart. However, if the data is *highly coupled*, it will be very difficult to break it apart and form new physical bounded contexts.

An example of data coupling is when one database table refers to the key of another database table (known as a *foreign key constraint*). Another example of data coupling is when an entity (like *customer information*) is spread across multiple tables.

If your data is highly coupled and functions in the microservice need to share that data, it makes sense to keep the microservice large and combine the functions.

![](_page_350_Picture_12.jpeg)

# Workflow and choreography

If a single business request requires separate microservices to communicate with each other, that's *coupling*. Too much coupling between microservices can have many negative effects on the system.

For example, *performance* is affected by network, security, and data latency. *Scalability* is affected because each microservice in the call chain must scale as the other microservices scale (something that is hard to coordinate). *Fault tolerance* is affected because if one of the microservices in the chain becomes unresponsive or unavailable, the request cannot be processed.

If your workflow involves a lot of coordination between your microservices and these characteristics are important to you, consider combining them.

Too much communication between microservices can make an architecture look like spaghetti.

![](_page_350_Picture_18.jpeg)

## <span id="page-351-0"></span>It's all about balance

Determining the appropriate level of granularity for a microservice isn't easy. You have to balance the trade-offs associated with each granularity disintegrator and integrator, and determine which trade-offs are more important. This usually involves collaborating with your product owner or business stakeholder, particularly if the trade-offs are significant.

You guessed it—there are tradeoffs between these two forces, which is why you have to find the right balance between them.

# Make it Stick

![](_page_351_Picture_5.jpeg)

How small should a microservice be?
Use this tip and you will see.
Keep them coarse-grained when you begin,
Then move to fine-grained for the win!

#### Granularity disintegrators

When should you consider making your services smaller and separating functionalities?

![](_page_351_Picture_9.jpeg)

#### Granularity integrators

When should you consider making your services bigger and combining functionalities?

Making our microservices smaller would give us better scalability, which is important to us.

Making our
microservices bigger
would give us better
data integrity, which is
important to us.

Good job! The next step is figuring out which is more important: scalability or data integrity. As the saying goes, you can't have your cake and eat it too.

![](_page_351_Picture_15.jpeg)

![](_page_351_Picture_16.jpeg)

<span id="page-352-0"></span>![](_page_352_Picture_1.jpeg)

# Exercise

Now it's your turn to apply granularity disintegrators and granularity integrators to decide whether to implement the Monitor Basic Vital Signs functionality (which covers blood pressure, temperature, and heart rate) as a single microservice or three separate services. Here is some additional information:

- \* A patient's heart rate and blood pressure are the two most critical basic vital signs to monitor. If something should go wrong with temperature monitoring, heart rate and blood pressure monitoring must continue to work.
- \* All three basic vital signs share an alert functionality to notify medical professionals if something goes wrong.
- \* The heart rate monitoring functionality accepts sensor readings once a second, whereas the temperature and blood pressure monitoring functions only accept sensor readings once every 5 minutes.
- \* Each basic vital sign's data is recorded and stored separately, as simple JSON name/value pairs in a single document database. For example, the heart rate readings are stored as follows:

![](_page_352_Figure_8.jpeg)

Solution on page 341

<span id="page-353-0"></span>If microservices is all about breaking business functionalities into separate services, what do you do with shared functionalities like logging, authorization, and date utilities?

![](_page_353_Picture_2.jpeg)

*Code reuse* is a necessary part of software development. Without it, you would have duplicate functionality almost everywhere in your system. Functions like logging, metrics streaming, user authorization, and basic utilities like transforming date formats are common in most (if not all) systems.

In monolithic systems, this is easy—you write the common functionality once and use it everywhere in the system, because it's all compiled together as one unit. But in *distributed* architectures like microservices, it's not that easy. That's because each microservice is a separately deployed unit of software.

So where does all that common functionality go in microservices? Usually into either a *shared library* or a *shared service*. In the following pages, we'll show you the trade-offs between these choices.

![](_page_353_Picture_6.jpeg)

# Sharing functionality

All of MonitorMe's vital-sign monitoring microservices have shared functionality to alert a medical professional if something is wrong with the patient. Let's look at the code:

```
package monitorme.common;

Temperature

public class AlertNurse {
    public static void sendAlert(AlertType type, String data) {
        ...
    }

"41 degrees Celsius"
```

Let's say we create three separate microservices for monitoring blood pressure, temperature, and heart rate. Each one needs this common alert functionality.

![](_page_354_Figure_5.jpeg)

Where should the source code for the common alert functionality go? We *could* replicate the code in each microservice, but that would lead to issues if anyone changed it to fix a bug or add new functionality. That leaves us with two choices for where to put the code: in a shared service or in a shared library. Let's look at both options.

"Replication" means that each microservice has its own copy of the source code. This is only useful for truly static source code.

# Sharpen your pencil Besides alerting a medical professional, can you list other common functionalities that the MonitorMe services might need? Solution on page 342

# <span id="page-355-0"></span>Code reuse with a shared service

A *shared service* is a separate microservice that contains a shared functionality that other microservices can call remotely.

If we put the MonitorMe alert functionality in its own separate shared service, each monitoring microservice will need to call that shared service if it detects something wrong with the patient.

![](_page_355_Figure_4.jpeg)

Changing common code in a shared service doesn't require changing other microservices.

The shared service can be written in any language and on any platform, which is handy when you have microservices implemented in multiple languages.

> This is another one of those bad coupling problems.

Changing a shared service is risky because it can immediately affect other microservices that call it.

Because the shared functionality is remote, network latency can slow its performance.

If the shared service is unavailable, microservices that need the shared functions cannot operate.

The shared service must scale whenever other microservices that call it scale.

# <span id="page-356-0"></span>Code reuse with a shared library

A more common approach to shared functionality is to put it in a custom shared library. A **shared library** is an independent artifact (like a JAR file in Java or a DLL in C#) that is included with each microservice at compile time. This means that once the microservice is deployed, *each* microservice has *all* of the shared functionality available to it.

Most platforms and programming languages have their own shared-library file formats.

Let's see how the shared MonitorMe alerting functionality might look if we were to use a shared library rather than a shared service.

![](_page_356_Picture_5.jpeg)

This service no longer has to call a remote microservice to alert the nurse. Cool!

Do you see how the shared alert functionality is included as part of each microservice's deployment unit? This means each microservice can simply use the shared code to alert a medical professional, without having to make a remote call to a separate service.

Pros

![](_page_356_Picture_9.jpeg)

Cons

Performance, availability, and scalability are better because the shared functionality is not remote. Instead, it's bound at compile time to each microservice.

Changing code in a shared library is less risky, because shared libraries can be versioned to provide agility and backward compatibility.

Because shared libraries can be versioned, you don't have to do this all at once.

You'll need multiple shared libraries if your microservices are written in different programming languages or use different platforms.

Managing dependencies between microservices and shared libraries can become difficult if you have a lot of microservices (which is typical in this architectural style).

If you change a shared functionality, you must retest and redeploy the microservices that use it.

<span id="page-357-0"></span>![](_page_357_Picture_1.jpeg)

# **Fireside Chats**

Tonight's talk: **A shared service and a shared library answer the question: "Who's cooler?"**

#### **Shared Service**

Hey there, "old school." You still around?

Not a chance, bud. Don't you get it? In the distributed architecture world, I'm king. *Everything* is services including me, the shared functionality. Need to reauthorize a user? Need to alert a nurse that the patient is having issues? Just call me. What could be easier?

Fine, you got me there. But when I have to change, I just do it. No one else has to be involved. When you change, every service you're attached to has to retest and redeploy. How disruptive you are!

At least *I'm* not a conformist. Face it—for every programming language in your environment, you have to replicate yourself. I, on the other hand, am independent. I can be implemented in *any* language or platform because I don't have the same attachment problem you have.

Whatever. Later, conformist—I'm gonna go find someone to hang out with who appreciates me.

#### **Shared Library**

"Old school?" Let me tell you something—not only am I still around, I'll outlive you by a long shot.

Right. And when you aren't around, what then? You see, unlike you, I'm *always* around, right by each microservice's side.

Oh please! I can clone myself into multiple versions. That makes me a lot safer to change. You, on the other hand, are full of risk—you can break the entire system when you redeploy! You really like to live dangerously, don't you?

Attachment problem? Really? Listen—my attachment to services means I'm faster, more available, more scalable, and more reliable than you.

And... now you're not available. See what I mean?

![](_page_358_Picture_1.jpeg)

Now that you've seen the two main options for sharing functionality in the microservices architectural style, it's your turn to decide—should the alert functionality in MonitorMe be a shared library or a shared service? Make sure you consider external forces (like the problem domain) in addition to the pros and cons of each option, and justify your choice.

#### **Option 1: Shared service**

**Option 2: Shared library** 

![](_page_358_Figure_5.jpeg)

Put your decision and reasoning here.

|  | Option 1: Shared service |
|--|--------------------------|
|  | Option 2: Shared library |

Reason:

Solution on page 343

<span id="page-359-0"></span>![](_page_359_Figure_1.jpeg)

Q: **If I make a request involving a workflow that needs multiple microservices to give me an answer, why break those microservices apart? Wouldn't it be better to make a single service and avoid workflows in the first place?** 

A: Great question. Remember the granularity disintegrators from several pages ago? Some of those factors—like scalability, fault tolerance, code volatility, and better, more secure access control—might be important enough to warrant keeping the microservices separate, even if it means you'll have to add a bit of complexity later to tie those services together with a workflow.

# <span id="page-360-0"></span>Managing workflows

A *workflow* is required when two or more microservices are needed to complete a single business request. The request might be a nurse (say, Juan) asking "How is the patient doing today?" To answer, the system must gather information about the patient's temperature, heart rate, and blood pressure. This means calling multiple microservices, one for each vital sign.

However, Juan doesn't want to make three separate requests to the MonitorMe system. He would like to make *a single request* to get all the vital signs information. This means the three monitoring microservices need to be coordinated in a workflow.

Let's look at how to make this happen in microservices by using either *orchestration* (centralized workflow management) or *choreography* (decentralized workflow management).

Juan is in charge of the patient today.

Let's see how the patient is doing today...

Juan wants to get this data with a single request.

Monitor Blood Pressure

Blood Pressure

Blood Pressure

Juan needs information from all three microservices, which means they need to be in a workflow.

Monitor Heart Rate Heart Rate

Monitor Temperature Temperature

Exercise

Can you think of any workflows involving multiple microservices that might exist for the MonitorMe patient vital signs monitoring system? List them in the space below.

We did this one for you.

Get the status of a patient's basic vital signs (temperature, blood pressure, and heart rate).

Solution on page 344

# <span id="page-361-0"></span>Orchestration: Conducting microservices

When you go to a symphony concert, who do you see in the front, leading all the musicians? The conductor, of course. This is a great way to think about orchestration in microservices.

*Orchestration* is about coordinating all the microservices needed for a workflow. A centralized microservice—the *orchestrator*—does this, very much like a conductor coordinates all the musicians performing in a symphony orchestra.

An *orchestration service* is a separate microservice that is responsible for calling all the microservices involved in the workflow. It also handles errors and passes consolidated data back to the caller (usually the user interface).

![](_page_361_Picture_5.jpeg)

![](_page_361_Figure_6.jpeg)

![](_page_361_Picture_7.jpeg)

## Job Posting: Microservices Orchestrator

Looking for a microservices orchestrator to manage monitoring a patient's basic vital signs. Duties and responsibilities include:

- Call the right microservices in the right order.
- Always know the current state of the workflow and what happens next.
- Consolidate all the data from each microservice.
- Handle errors if any of the microservices fails.

<span id="page-362-0"></span>Like everything, orchestration has trade-offs. Let's be positive and start with the good.

#### The good...

![](_page_362_Picture_3.jpeg)

Sort of like a GPS—it always knows where you are.

#### Centralized workflow

Request workflows are centralized and well understood. You only need to go to the orchestrator to understand the complete workflow.

#### Workflow state

Since the orchestrator always knows where the request is in the workflow, if there's a failure, restarting the request where the workflow left off is much easier.

#### **Error handling**

Error handling is consolidated into the orchestrator, so each microservice doesn't need to worry about what to do if an error occurs—the orchestrator handles it.

#### Workflow changes

It's easy to change the workflow because all changes occur in one central place.

#### Performance

Orchestration tends to be slowed by communication between the orchestrator and the microservices, and because the orchestrator typically saves the workflow state to a database each time something changes.

#### **Scalability**

The central orchestrator can become a bottleneck as requests increase, because every request must go through it before reaching any microservices.

#### **Tight coupling**

Because the orchestrator and microservices need to communicate constantly, orchestration tends to be highly coupled.

#### **Availability**

If the conductor leaves the orchestra, the concert is over. Similarly, if the orchestration microservice is unavailable, the request cannot be processed. This single point of failure is usually addressed by creating multiple instances of the orchestrator.

#### The bad...

![](_page_362_Picture_22.jpeg)

Sort of like having an understudy conductor backstage in case the conductor gets sick.

# <span id="page-363-0"></span>Choreography: Let's dance

Whereas orchestras are conducted, dances are *choreographed*. Rarely do you see a conductor leading a group of classical or modern dancers—instead, the dancers learn their parts and then communicate with each other. This is a great way to think about choreography in microservices.

Let's say the MonitorMe system's blood pressure monitoring functionality is separated into four separate microservices, which communicate to complete the workflow of the monitoring operation.

![](_page_363_Picture_4.jpeg)

![](_page_363_Figure_5.jpeg)

![](_page_363_Figure_6.jpeg)

#### Don't lead the dancers!

*When using choreography, make sure you don't fall into the trap of turning one of the microservices into an orchestrator. This is known as the* Front Controller *pattern. This* **Watch it!** *pattern is useful for orchestration, but not for choreography.*

![](_page_363_Figure_9.jpeg)

<span id="page-364-0"></span>Guess what? Choreography has trade-offs as well.

#### The good...

![](_page_364_Picture_3.jpeg)

#### Responsiveness

Since there's no central orchestrator to communicate with continually, responsiveness and performance tend to be better.

#### Loose coupling

Since microservices don't depend on a central orchestration service to direct them, the system tends to be less coupled.

#### **Scalability**

Each microservice can scale to meet its throughput demands, independent of other microservices in the workflow.

Fast, scalable systems usually use choreography. However, watch out for the trade-offs

#### Error handling

Each microservice is responsible for managing the error workflow if an error occurs. This can lead to too much communication between services.

#### Recoverability

When a user retries a request that has failed or is still in progress, it's really hard for the system to know where to restart. That's because no single service is responsible for directing the request to a specific microservice in the workflow—each one only sends it to the next microservice in the call chain.

#### State management

It's hard to know what state the workflow is in when using choreography, because there's no central conductor controlling the workflow. Usually, one of the microservices (typically the first one in the call chain) is designated the **state owner**, and other microservices send it their state.

![](_page_364_Picture_17.jpeg)

#### The bad...

![](_page_364_Picture_19.jpeg)

# **Exercise**

StayHealthy, Inc., stands behind MonitorMe and its monitoring devices and display screens. If a problem occurs with any software or physical hardware, someone from the medical facility can go online and create a trouble ticket. A field technician will receive the trouble ticket on their mobile phone, come to the medical facility, fix the problem, and mark the ticket as fixed.

It's up to you: Would you manage the microservices for the trouble ticket system workflow using orchestration or choreography? Be sure to include the reasons for your choice.

![](_page_365_Figure_4.jpeg)

The microservices architectural style seems overly complex to me. There are so many hard decisions to make. Why would I ever bother to use microservices?

<span id="page-366-0"></span>![](_page_366_Picture_2.jpeg)

# You're right—the microservices architectural style *is* complex. But it's also powerful.

Using microservices helps us address complex business problems. Not only does this architectural style excel at supporting operational characteristics such as scalability, reliability, availability, and fault tolerance, but it also allows the system to respond quickly to changes in both business and technology (known as *agility*).

That said, the microservices architectural style may not be a fit for every system. In the next few pages we'll show you some of the superpowers of microservices as well as its weaknesses.

# <span id="page-367-0"></span>Microservices architecture superpowers

Every architectural style has its superpowers. Here are some reasons to use the microservices architectural style.

![](_page_367_Picture_3.jpeg)

## **Maintainability**

Because microservices are single-purpose and separately deployed, you can more easily locate code that needs to change for a particular function.

![](_page_367_Picture_6.jpeg)

A microservice's testing scope is much smaller than that of a larger monolithic application or a system with large services. This limited scope makes it easier to fully test a microservice's functionality.

![](_page_367_Picture_8.jpeg)

## **Deployability**

Because microservices are deployed as separate units of software, there are fewer risks involved with releasing a microservice than with large monolithic systems. You can also deploy microservices more frequently—sometimes daily.

![](_page_367_Picture_11.jpeg)

## **Evolvability**

It's relatively easy to add functionality to a microservices architecture: you create a new service, test it, and deploy it alongside other existing microservices in your system.

## **Scalability**

Microservices scale at a *function* level rather than a *system* level. This means that you scale only the functionalities you need to meet increased user load and demand, saving resources and lowering costs.

#### Fault tolerance

If a particular microservice fails, it doesn't bring down the entire system—only that function.
Users can continue to use other functions.

![](_page_367_Picture_18.jpeg)

<span id="page-368-0"></span>![](_page_368_Picture_1.jpeg)

# Microservices architecture kryptonite

Are there reasons *not* to use the microservices architectural style? You bet there are. Just like kryptonite diminishes a superhero's powers, certain business and architectural characteristics diminish the case for using microservices. Watch out for them!

![](_page_368_Picture_4.jpeg)

#### Complexity

Microservices is one of the most complex architectural styles. It involves so many hard decisions—about granularity, transactions, workflow, contracts, shared code, communication protocols, team topologies, and deployment strategies, just to name a few.

# Performance

The more microservices communicate with each other, the worse their performance will be. They may have to wait for the network, undergo additional security checks, and make extra database calls.

![](_page_368_Picture_9.jpeg)

## **Complex workflows**

Workflows occur when you need to call multiple microservices for a single business request. If the functionality of your system is too tightly coupled, breaking it into separately deployed services will only result in a big ball of distributed mud. Yuck!

#### Monolithic databases

Each microservice must own its own data and form a physical bounded context. If your *data* can't be broken apart for whatever reason, stay away from this architectural style.

![](_page_368_Picture_14.jpeg)

![](_page_368_Picture_15.jpeg)

# Technically partitioned teams

Does your organization consist of siloed teams of user interface developers, backend developers, and database people? If so, microservices won't work for you (a reflection of Conway's Law). Microservices architecture requires cross-functional teams. Each team owns its own group of microservices, all the way from the user interface to the database.

# <span id="page-369-0"></span>Microservices star ratings

Below is a useful chart for understanding what microservices architecture is good at and what it's not so good at. One star means that the architectural characteristic is not well supported; five stars means the characteristic is very well supported.

![](_page_369_Picture_3.jpeg)

![](_page_369_Figure_4.jpeg)

*latency* (since each microservice makes its own database calls).

![](_page_370_Picture_1.jpeg)

Which of the following systems might be well suited for the microservices architectural style, and why? *Hint: Take into account microservices' superpowers, its kryptonite, and the problem domain.*

| An online auction system where users can bid on items<br>Why?                                                                                     | Well suited for microservices<br>Might be a fit for microservices<br>Not well suited for microservices |
|---------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why?                                    | Well suited for microservices<br>Might be a fit for microservices<br>Not well suited for microservices |
| A company entering a new line of business that<br>expects constant changes to its system<br>Why?                                                  | Well suited for microservices<br>Might be a fit for microservices<br>Not well suited for microservices |
| A small bakery that wants to start taking online orders<br>Why?                                                                                   | Well suited for microservices<br>Might be a fit for microservices<br>Not well suited for microservices |
| A trouble ticket system for electronics purchased<br>with a support plan, in which field technicians<br>come to customers to fix problems<br>Why? | Well suited for microservices<br>Might be a fit for microservices<br>Not well suited for microservices |
|                                                                                                                                                   | Solution on page 346                                                                                   |

# <span id="page-371-0"></span>Wrapping it up

Congratulations! The MonitorMe system is up and running, and it's a success. It's all thanks to your understanding of microservices and what types of systems this approach is good for.

You've learned that while microservices can be a complicated architectural style, it also has superpowers that can help solve complex business problems (like the MonitorMe system we've been working on). Let's close this chapter by reviewing some key points about microservices.

# **Bullet Points**

- A *microservice* is a single-purpose, separately deployed unit of software that does one thing really well.
- A *physical bounded context* means that a microservice owns its own data and is the only microservice that can access that data. If a microservice needs data that is owned by another microservice, it must ask for it.
- The *granularity* of a microservice is a measure of its size—not physically, but the scope of what it does.
- Forces that guide you to make your microservices smaller are called *granularity disintegrators*.
- Forces that guide you to make your microservices bigger are called *granularity integrators*.
- Balance granularity disintegrators and integrators to find the most appropriate level of granularity for a microservice.
- You can make microservices coarse-grained to start with, then finer-grained as you learn more about them.
- Two techniques for sharing functionality in microservices are *shared services* and *shared libraries*.
- A *shared service* is a microservice that contains a functionality shared by multiple microservices. It's deployed separately and each microservice calls it remotely. Shared services are more agile overall and are good for heterogeneous environments. However, they are not good for scalability, fault tolerance, or performance.

- A *shared library* is an independent artifact (like a JAR or DLL file) that is bound to a microservice at compile time. Shared libraries offer better operational characteristics, like scalability, performance, and fault tolerance, but make it harder to manage dependencies and control changes.
- A *workflow* is when multiple microservices are needed for a single business request or business process.
- Workflows that use *orchestration* require a central orchestrator microservice, which works like a conductor in a symphony orchestra.
- In workflows that use *choreography,* the services talk to each other, like dancers performing together.
- Scalability, fault tolerance, evolvability, and overall agility (maintainability, testability, and deployability) are the superpowers of the microservices architectural style.
- Performance, complexity, cost, monolithic databases that can't be broken apart, and high semantic coupling are kryptonite to microservices.
- Microservices should be as independent as possible; too much communication between them will degrade the benefits of this architectural style.

![](_page_372_Picture_1.jpeg)

# **Microservices Crossword**

Ready to have some fun and test your knowledge about what you've learned?

![](_page_372_Figure_4.jpeg)

#### Across

- 1. Microservices make it easier for a system to do this
- 5. When you make a service smaller, you make it more \_\_\_\_\_
- 7. Each microservice \_\_\_\_\_ its own data
- 11. Workflow where microservices communicate with each other
- 14. A \_\_\_\_\_service does one thing really well
- 15. Microservices is this type of architecture
- 17. \_\_\_\_\_ tolerance keeps a problem from bringing down the whole system
- 18. Microservices are \_\_\_\_\_-purpose
- 19. When you need more than one microservice to do the job, it's

a \_\_\_\_\_

#### Down

- 1. \_\_\_\_\_ handling is part of an orchestrator's job
- 2. Kind of component found within a microservice
- 3. Kind of force that pushes you to make a microservice bigger
- 4. Watch out for the \_\_\_\_\_ Controller pattern
- 6. Each microservice is a separately deployed \_\_\_\_\_ of software
- 8. Code resource that's often shared
- 9. A context that restricts data access
- 10. Workflow where one microservice rules all the others
- 12. Type of bounded context or architecture diagram
- 13. Good security includes restricting \_\_\_\_\_ to data
- 16. A bad design pattern is an \_\_\_\_\_pattern

# **Solution Sharpen your pencil**

Based on the problem domain and requirements document on page 304, check off the *top five* architectural

Based on the problem domain and requirements document on page 304, check off the top five architectural characteristics you think are critical to the MonitorMe architecture and indicate why you think they are critical.

| <span style="font-family: sans-serif;">☑</span> Testability (the ease of and completeness of testing)                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------------|
| Reason: Because this is a critical medical system, we can't let bugs get into the system (completeness)                                         |
| <span style="font-family: sans-serif;">☑</span> Responsiveness (the time it takes to get a response to the medical professional)                |
| Reason: A patient's life could depend on how fast the medical professional is notified of a problem                                             |
| <span style="font-family: sans-serif;">☐</span> Deployability (the frequency and ceremony involved with releasing changes)                      |
| Reason: Not critical—there are no requirements stating there will be many changes in the system                                                 |
| <span style="font-family: sans-serif;">☐</span> Abstraction (the level of isolation and knowledge between parts of the system)                  |
| Reason: Not critical—there are no requirements regarding abstraction                                                                            |
| <span style="font-family: sans-serif;">☐</span> Scalability (the system's ability to grow to accommodate more users or patients)                |
| Reason: Not critical—the system is scoped to a single hospital only (hospital beds are the limiting factor)                                     |
| <span style="font-family: sans-serif;">☑</span> Fault tolerance (the system's ability to continue operating when parts of the system fail)      |
| Reason: One vital sign monitoring failure can't stop the other vital signs functions from monitoring the patient                                |
| <span style="font-family: sans-serif;">☑</span> Data integrity (the data is consistent and correct across the system and there is no data loss) |
| Reason: The data about a patient's health must be as accurate as possible                                                                       |
| <span style="font-family: sans-serif;">☐</span> Workflow (the system's ability to handle complex business workflows)                            |
| Reason: Not critical—each vital sign is monitored separately and no complex workflows are required                                              |
| <span style="font-family: sans-serif;">☑</span> Concurrency (the system's ability to process concurrent requests or operations)                 |
| Reason: The system must be able to monitor many different vital signs at the exact same time                                                    |

![](_page_374_Picture_1.jpeg)

**Solution**

We're having trouble determining what single-purpose means. Can you help us by checking off all the functions below that you would consider single-purpose and therefore possible microservices?

| <span style="font-family: sans-serif;"> <span style="text-decoration: line-through;">☑</span> Add a movie to your personal “to watch” list     </span>      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span style="font-family: sans-serif;"> <span style="text-decoration: line-through;">☑</span> Pay for an order using your credit card     </span>           |
| <span style="font-family: sans-serif;">□ Generate sales forecasting and financial performance reports</span>                                                |
| <span style="font-family: sans-serif;">□ Submit and process a loan application to get that new car you've always wanted</span>                              |
| <span style="font-family: sans-serif;"> <span style="text-decoration: line-through;">☑</span> Determining the shipping cost for an online order     </span> |

These are complex processes with lots of different functions.

![](_page_375_Figure_2.jpeg)

![](_page_376_Picture_1.jpeg)

![](_page_376_Picture_2.jpeg)

Now it's your turn to apply granularity disintegrators and granularity integrators to decide whether to implement the Monitor Basic Vital Signs functionality (which covers blood pressure, temperature, and heart rate) as a single microservice or three separate services. Here is some additional information:

- \* A patient's heart rate and blood pressure are the two most critical basic vital signs to monitor. If something should go wrong with temperature monitoring, heart rate and blood pressure monitoring must continue to work.
- \* All three basic vital signs share an alert functionality to notify medical professionals if something goes wrong.
- \* The heart rate monitoring functionality accepts sensor readings once a second, whereas the temperature and blood pressure monitoring functions only accept sensor readings once every 5 minutes.

Each basic vital sign's data is recorded and stored separately, as simple JSON name/value pairs in a single document database. For example, the heart rate readings are stored as follows:

![](_page_376_Figure_8.jpeg)

Having separate services provides better fault tolerance in case one of the monitoring functions causes the service to go down. Also, data is recorded and stored separately, which works well with physical bounded

as needed based on the varying input rates (once a second for heart rate, every 5 minutes for others).

![](_page_377_Picture_1.jpeg)

# **Solution Sharpen your pencil**

**From page 319**

Besides alerting a medical professional, can you list other common functionalities that the MonitorMe services might need?

Observability—streaming service response times, errors, uptime, and other metrics and measurements

Logging—reporting on errors and other service functionality alerts

Auditing—recording when an alert was sent and which medical professional received it

Security—restricting access to a monitoring service to authorized medical professionals only

**Option 2: Shared library** 

<span id="page-378-0"></span>![](_page_378_Picture_2.jpeg)

Now that you've seen the two main options for sharing functionality in the microservices architectural style, it's your turn to decide—should the alert functionality in MonitorMe be a shared library or a shared service? Make sure you consider external forces (like the problem domain) in addition to the pros and cons of each option, and justify your choice.

#### **Option 1: Shared service**

![](_page_378_Figure_5.jpeg)

This is our decision and reasoning.

Option 1: Shared service

Option 2: Shared library

Reason: We chose option 2 (shared library) because it provides:

-better performance (the medical professional will be alerted faster)

-better reliability and fault tolerance (if the Alert Staff shared service went down, the

system couldn't alert the medical professional)

-better concurrency (if multiple problems occur at the same time)

![](_page_379_Picture_1.jpeg)

Can you think of any workflows involving multiple microservices that might exist for the MonitorMe patient vital signs monitoring system? Here are our ideas.

Get the status of a patient's basic vital signs (temperature, blood pressure, and heart rate)

Find out which vital signs are being monitored for a given patient (requires queries to multiple monitoring services)

Register a new patient to be monitored—lots of different information is gathered, like name, identity, demographics, medical history, and so on, all of which could be separate microservices

<span id="page-380-0"></span>![](_page_380_Picture_2.jpeg)

StayHealthy, Inc., stands behind MonitorMe and its monitoring devices and display screens. If a problem occurs with any software or physical hardware, someone from the medical facility can go online and create a trouble ticket. A field technician will receive the trouble ticket on their mobile phone, come to the medical facility, fix the problem, and mark the ticket as fixed.

It's up to you: would you manage the microservices for the trouble ticket system workflow using orchestration or choreography? Be sure to include the reasons for your choice.

![](_page_380_Figure_5.jpeg)

![](_page_381_Picture_2.jpeg)

Which of the following systems might be well suited for the microservices architectural style, and why? *Hint: Take into account microservices' superpowers, its kryptonite, and the problem domain.* Here are our answers.

| An online auction system where users can bid on items<br>Why? High scalability and elasticity needs; high<br>concurrency; independent functions |
|-------------------------------------------------------------------------------------------------------------------------------------------------|
|-------------------------------------------------------------------------------------------------------------------------------------------------|

| <span style="text-decoration: line-through;">☑</span> Well suited for microservices |
|-------------------------------------------------------------------------------------|
| ☐ Might be a fit for microservices                                                  |
| ☐ Not well suited for microservices                                                 |

| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why? Microservices' superpowers aren't needed<br>in this kind of complex system |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

| ☐ Well suited for microservices                                                         |
|-----------------------------------------------------------------------------------------|
| ☐ Might be a fit for microservices                                                      |
| <span style="text-decoration: line-through;">☑</span> Not well suited for microservices |

| A company entering a new line of business that<br>expects constant changes to its system<br>Why? High agility and evolvability mean<br>microservices could fit, but we need more info |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

| ☐ Well suited for microservices                                                        |
|----------------------------------------------------------------------------------------|
| <span style="text-decoration: line-through;">☑</span> Might be a fit for microservices |
| ☐ Not well suited for microservices                                                    |

| A small bakery that wants to start taking online orders<br>Why? The high cost and complexity of microservices<br>would be too much for a small bakery |
|-------------------------------------------------------------------------------------------------------------------------------------------------------|
|-------------------------------------------------------------------------------------------------------------------------------------------------------|

| ☐ Well suited for microservices                                                         |
|-----------------------------------------------------------------------------------------|
| ☐ Might be a fit for microservices                                                      |
| <span style="text-decoration: line-through;">☑</span> Not well suited for microservices |

| A trouble ticket system for electronics purchased<br>with a support plan, in which field technicians<br>come to customers to fix problems<br>Why? Independent functions; good scalability<br>and elasticity; simple workflows |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

| <span style="text-decoration: line-through;">☑</span> Well suited for microservices |
|-------------------------------------------------------------------------------------|
| ☐ Might be a fit for microservices                                                  |
| ☐ Not well suited for microservices                                                 |

# **Microservices Crossword Solution**

**From page 337**

![](_page_382_Figure_3.jpeg)

**11**

# event-driven architecture

# Asynchronous Adventures

![](_page_384_Picture_3.jpeg)

#### **What if your architecture could do lots of things at the same time?** As

businesses grow and become more successful, they need to be able to handle more and more users, without slowing down or crashing systems. In this chapter, you'll learn how to design high-performance systems that can scale as a business grows. Get ready for *event-driven architecture*, a highly popular distributed architectural style. It's very fast, highly scalable, and easy to extend—but it's also quite complex. You'll be learning about lots of new concepts in this chapter, including things like events, messages, and asynchronous communication, so you can create an architecture that can do many things at once. Fasten your seatbelt, and let's go on an asynchronous adventure through event-driven architecture.

# Too slow

Imagine going to your favorite diner to order their famous grilled cheese sandwich, crispy fries, and a chocolate milkshake. Sounds easy, right? But what if the person taking your order had to make all of those things one at a time, without any help? Not only would everything take longer, but the diner wouldn't be able to serve as many customers. Let's visualize that workflow:

![](_page_385_Picture_3.jpeg)

- 1. Take the next customer's lunch order (1 minute)
- 2. Accept payment from the customer (1 minute)
- 3. Cook the grilled cheese sandwich (4 minutes)
- 4. Cook the french fries (5 minutes)
- 5. Make the chocolate milkshake (4 minutes)
- 6. Plate the food and serve the customer

![](_page_385_Picture_10.jpeg)

![](_page_385_Picture_11.jpeg)

Each order takes 15 minutes, meaning the diner can only serve four customers during the lunch—hour rush.

This is no way to run a diner! Let's see if we can make things go a little faster so they can serve more customers.

![](_page_385_Picture_14.jpeg)

![](_page_385_Figure_15.jpeg)

Pretend you are a customer of this diner. How would you suggest they speed things up?

Write your ideas here.

# <span id="page-386-0"></span>Speeding things up

This is a service

Lunch

**Order** 

Service

that triggers

an event.

If the diner hires three more workers (one to make the sandwiches, one to cook the french fries, and one to make milkshakes) and they prepare all parts of the meal at once, completing orders will take half as long. That effectively doubles the number of customers the diner can serve during the lunch hour.

![](_page_386_Picture_3.jpeg)

![](_page_386_Figure_4.jpeg)

Lunch Order

Placed

Doing all three activities at the same time significantly reduces customers' wait time (we'll call that *responsiveness*). Because meals can be made faster, the server taking orders can now handle more customers (we'll call that *scalability*).

This is the fundamental concept behind **event-driven architecture (EDA)**— thankfully, we don't breaking up processing into separate services, with each of those services performing its function at the same time by responding to an **event** (something that just happened). In EDA, services communicate asynchronously through an **event channel**, meaning they don't wait for responses from other services to complete their work.

This is the event

Note: we'll be referring to event-driven architecture as EDA going forward, because we're cool like that (and, thankfully, we don't get paid by the word).

![](_page_386_Figure_8.jpeg)

We know this is a lot to take in at once, so we'll take it step by step. But before we jump in, let us introduce you to Der Nile, a large German online-ordering company that is having growing pains and needs your help.

This is the event channel

where the event is sent.

# Der Nile flows faster than ever

Der Nile is Germany's largest online retailer, selling everything from diapers to hair-growth supplements.

Business is booming—so much, as a matter of fact, that the company's online ordering system is stressed to the breaking point. Der Nile's customers demand fast systems and quick order fulfillment, and the current system simply can't handle the volume of orders coming in. Processing orders takes too long, and fulfillment times are increasing.

Der Nile would like to create a new ordering system from scratch to handle this growth—and needs your help in designing it.

Here is the basic flow of the legacy online-ordering system currently in place:

![](_page_387_Picture_6.jpeg)

![](_page_387_Figure_7.jpeg)

![](_page_388_Picture_1.jpeg)

# **Exercise**

As the architect, how can you modify the current workflow (shown on the previous page) to speed things up a bit? Draw your ideas for a new workflow in the space below. *Hint: What can you do at the same time?*

![](_page_388_Picture_4.jpeg)

The customer submits an order and waits

Start here.

**Solution on page 391**

## <span id="page-389-0"></span>What is an event?

Back in the late 1950s, a journalist asked Prime Minister Harold Macmillan of the United Kingdom what troubled him the most. "Events, my dear boy, events," was his famous reply. Events may have troubled Harold Macmillan, but they can be a lot of help to us in solving complex business problems.

An *event* is something that happens, especially something of importance. Things like the World Cup, musical concerts, big promotions at work, weddings, and birthday celebrations are all important events.

Publishing this book was an important event for the authors.

In software systems, certain user actions trigger events—things that happen, like placing a bid for an item up for auction, filing an insurance claim, or making a purchase.

![](_page_389_Figure_6.jpeg)

Events are a way for a service to let the rest of the system know that something important has just happened. In EDA, events are the means of passing information to other services.

An event usually contains data, like *all* the details of an online order. On occasion, it might only have *key* information (like the order ID). In the latter case, services that must do something when they receive the event will have go to a data store to get additional information about it.

The data inside an event is referred to as its payload.

Friendly reminder: EDA is event-driven architecture.

# Order Submitted Order ID: 123

This event only passes along the order ID.

This event passes along all the information about the order that was just submitted.

# Order Submitted

Order ID: 123 Customer ID: 99876 Date Placed: 22 May Item List: [Items] Street: 123 Main St City: Anytown

<span id="page-390-0"></span>![](_page_390_Picture_1.jpeg)

Hold on—in Chapter 3 you talked about using **messages** to pass information from one service to another. Now you're talking about using **events**. Is an event is the same thing as a message?

No, an event is not the same thing as a message. Although they both deliver information to other parts of the system, there are some important differences between them.

An *event* is used to *broadcast* some action that a service just performed to other services in the system. For example, a service might tell the rest of the system: *A customer just placed an order.* A service sending an event **never waits** for a response. The service generally has no knowledge about what other services (if any) are listening for that event, or what they'll do with that information if they respond to it.

A *message*, on the other hand, is a *command*, such as *Apply the payment for this order*, or a *request*, like *Give me shipping options for this customer*. Because messages are only meant to reach one other service, the other services in the system are unaware of the message. Services sometimes stop and wait for a response (for instance, if they are sending a request for information). Other times, the service might just issue a command and trust that the receiving service will do its job.

Turn the page to see more differences between an event and a message.

# <span id="page-391-0"></span>Events versus messages

Here are two really important differences between events and messages:

1. Events are broadcast to other services using topics, whereas messages are sent to a single service using queues.

![](_page_391_Figure_4.jpeg)

2. Events always broadcast something that has already happened, whereas messages request something that needs to be done.

![](_page_391_Figure_6.jpeg)

<span id="page-392-0"></span>Sharpen your pencil

It's time to test your knowledge about events and messages. For each of the quotes below, mark whether it is more likely an event or a message, and indicate why.

| "Adventurous Air flight 12, turn left, heading 230 degrees."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <input type="checkbox"/> Event <input type="checkbox"/> Message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Reason:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________ |

Reason:

**Solution on page 392**

# Initiating and derived events

Events that originate from a customer or end user are called *initiating events*. These are a special type of event that kicks off a business process.

Once a service responds to an initiating event, it might in turn broadcast what it did to the rest of the system, within the scope of that initiating event. These events are called *derived events* because they are internal events generated in response to the initiating event.

![](_page_393_Figure_4.jpeg)

Did you notice that the Payment service generates two different derived events? This is typical in EDA. Anything a service generates or causes to happen can be a derived event.

![](_page_394_Picture_1.jpeg)

Based on the *Credit Card Charged* initiating event and the corresponding processing below, can you identify what the derived events should be for each service? Think of as many possible outcomes as you can.

![](_page_394_Figure_3.jpeg)

# Is anyone listening?

When you post something on social media, you often get a reaction—someone liking or commenting on your post. But how many times have you posted something only to get no reaction? Maybe you wondered: Did anyone see my post? Did anyone care?

In EDA, any action a service performs should trigger a derived event. However, of the architectural there is a chance that no one cares about certain events. So why publish those events? Because this provides *architectural extensibility*—the ability to extend the system to add new functionality.

Extensibility is one characteristics you learned about in Chapter 2.

Let's say customers in the Der Nile online ordering system get notified when an order is shipped and also when it has been delivered. The Email Notification service handles this by sending the customer an email. That event in turn triggers a Customer Notified derived event.

![](_page_395_Picture_6.jpeg)

Now let's suppose Der Nile wants to do some analytics to learn what times of the day the system sends the most customer notification emails. Since the Customer Notified derived event is already being published, you can simply create a new Notification Analytics service and tell it to listen for that event. You don't need to modify any other parts of the system.

![](_page_395_Figure_8.jpeg)

This new service can simply subscribe to the existing Customer

# <span id="page-396-0"></span>Asynchronous communication

I thought you said this architecture was really fast. How is this any faster than microservices?

# Event-driven architecture is fast because it uses mostly asynchronous (or "async" for short) communication.

You're probably most familiar with communication styles such as REST or HTTP, particularly when you need to call an API or another service. These are forms of *synchronous communication*. With synchronous (or "sync") communication, when a service sends information, it must sit and wait for a response from the receiving service before doing anything else (even if it's just acknowledging receipt of the information). This slows systems down and makes them less scalable. It's like calling a friend—you have to wait for your phone to make a connection to your friend's phone, let it ring, and wait for your friend to answer before you can talk.

Asynchronous communication is a fancy way of saying that services don't wait for a response or acknowledgment from other services when sending them information. This creates systems that are highly decoupled and very fast. It's one of the unique features of event-driven architecture. It's like sending your friend a text—you can do other things while you wait for their response.

![](_page_396_Picture_6.jpeg)

![](_page_396_Picture_7.jpeg)

<span id="page-397-0"></span>![](_page_397_Picture_1.jpeg)

# **Fireside Chats**

Tonight's talk: **Asynchronous and synchronous communication debate: Who's more useful?**

#### **Asynchronous Communication**

#### **Synchronous Communication**

Well, it's about time you showed up.

Yeah, I've noticed. You're as slow as a herd of snails traveling through peanut butter.

Wait? You want me to *wait?* That's your whole problem—you're always waiting around for answers. No one has to wait when I'm around. And that makes

I trust others to get the job done, unlike you. You need verification for *everything*, all the time.

I don't. I can't be responsible for everyone, you know. I let others deal with their own issues.

Oh, I'm sorry—did you say something? I wasn't listening.

Sorry—I wasn't paying attention. What was that?

Sorry I'm late. I can't seem to multitask, so everything I do takes *such* a long time.

Now, wait just one minute!

me fast—*really* fast. That may be so, but your problem is that you never know what's going on. You ask others to do things, but you never find out whether those things actually got done or not.

> Yeah, right. Tell me: when an error occurs downstream, how do you deal with it?

And what if you need information from someone else before you can finish your work? What do you do then?

That's exactly my point! You never listen to anyone else. I may be slow, but at least I pay attention to what's going on and communicate with others.

Sigh...

# <span id="page-398-0"></span>Fire-and-forget

Asynchronous communication is one of the foundations of event-driven architecture. When a service broadcasts information to other services, it doesn't wait for a response, nor does it care whether the services are available or not. This is known as *fire-and-forget* communication—the event is sent (that's the *fire* part), and the service moves on to do other things (that's the *forget* part). Architects usually use a dotted line to represent async communication between services.

![](_page_398_Figure_3.jpeg)

Synchronous communication, on the other hand, means that the sending service must stop and wait for a response from the service it's calling before continuing its work. This means that the service being called *must* be available to respond, or an error occurs. Architects usually represent synchronous communication using a solid line.

![](_page_398_Figure_5.jpeg)

Event-driven architecture relies on asynchronous communication when sending and receiving events.

**Sharpen your pencil**

For each of these tasks, would you use asynchronous or synchronous communication?

| Give me the shipping options for this order.                                            |                                                     |                                                               |
|-----------------------------------------------------------------------------------------|-----------------------------------------------------|---------------------------------------------------------------|
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Apply payment for this order and let me know if the payment goes through.               |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Fulfill this order for me by picking the items off the shelf and packing them in a box. |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Give me the current status of this order.                                               |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Our inventory of this item is getting low—please order more stock.                      |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Tell the customer that their order has been shipped and is on its way.                  |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Update the customer's profile picture.                                                  |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |
| Post a customer's review on the product page.                                           |                                                     |                                                               |
| <label><input type="checkbox"/> Asynchronous</label>                                    | <label><input type="checkbox"/> Synchronous</label> | <label><input type="checkbox"/> Either one would work</label> |

Solution on page 394

# <span id="page-400-0"></span>Asynchronous for the win

Communicating between services asynchronously has a lot of advantages. The first is better *responsiveness*—in async, it takes less time to complete a request.

Suppose a customer places an online order in Der Nile. It takes 600 milliseconds (ms), or just over half a second, for the Order Placement service to validate and place the order, and 1,200 ms for the Payment service to apply the payment. With async, the customer would wait 600 ms to get a response. With sync, however, they would have to wait 1,800 ms (just shy of 2 seconds). That's a big difference in response times.

![](_page_400_Figure_4.jpeg)

# <span id="page-401-0"></span>Asynchronous for the win (continued)

The other big advantage of async is *availability*. Let's see what happens with async and sync if the Payment service is unavailable or becomes unresponsive.

![](_page_401_Figure_3.jpeg)

Have we convinced you that asynchronous communication is great? Let's take a look at its trade-offs next.

Remember the First
Law-everything in
software architecture is
a trade-off.

# <span id="page-402-0"></span>Synchronous for the win

The main disadvantage of async communication is *error handling*. With sync communication, if there's a problem with the payment method, the customer knows right away and has a chance to fix it and resubmit the order. However, with async, the customer thinks everything is fine because the system hasn't told them otherwise—but the Order Placement service can't process the order until the customer corrects the payment problem. This makes error handling much more complex.

![](_page_402_Figure_3.jpeg)

# Sharpen your pencil

Now's your chance to test what you've learned so far about event-driven architecture, events, and asynchronous processing. Der Nile's inventory occasionally gets out of sync, as shown below. When this happens, the order cannot be fulfilled and goes into a back-order state. Der Nile never makes a customer pay for items that are back-ordered, and the customer can choose whether to wait or cancel the order.

As the architect for Der Nile, what additional events and services would you create to address this situation?

![](_page_403_Figure_4.jpeg)

# <span id="page-404-0"></span>Database topologies

Hang on. All you've talked about so far are events and services. Data matters too, ya know. When are you going to start talking about databases in eventdriven architecture?

![](_page_404_Picture_3.jpeg)

#### We're glad you brought that up.

Data can be a complex topic in EDA. Because EDA is so asynchronous, services are highly *decoupled* from *one another*. However, if all the services share a single database, then they end up being highly *coupled* to the *database*. On the other hand, if each service owns its own data, like with microservices (discussed in the previous chapter), then services become highly coupled to each other because they need to synchronously ask each other for the data. In either case, data forms a coupling point—something we try to avoid in EDA.

In the next couple of pages we're going to show you various ways for dealing with databases in EDA: *monolithic databases*, *domain-partitioned databases*, and the *database-per-service* pattern. We'll talk about their trade-offs to help you decide which one is most appropriate for your situation.

## <span id="page-405-0"></span>Monolithic database

In the *monolithic database* topology, *all services share a single database*. The main advantage is that when services need data they don't own, they can go directly to the database. This means they don't have to make synchronous calls to other services to get data. For example, if the Order Placement service needs the current inventory and shipping options for a customer's order, it can simply query that information from the database.

![](_page_405_Figure_3.jpeg)

What's more, the shared database becomes a single point of failure, and one that may not be able to scale as the system grows.

are difficult to maintain.

# <span id="page-406-0"></span>Monolithic database topology scorecard

Here's a scorecard for the monolithic database topology.

Monolithic databases are not necessarily good or bad—it all depends on what's important to you.

| Monolithic Database Topology Scorecard                            |                                                                                                                                                                                                                                       |     |      |
|-------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----|------|
| <span style="font-weight: bold;">Service coupling:</span><br>GOOD | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>Services are highly decoupled because they don't need to synchronously communicate with each other to get data.</p>                                                         | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |
| <span style="font-weight: bold;">Performance:</span><br>GOOD      | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>Data retrieval is fast because services are accessing the database directly, not through synchronous remote calls to other services.</p>                                    | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |
| <span style="font-weight: bold;">Simplicity:</span><br>GOOD       | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>The monolithic database is a simple topology. Complex joins and queries are done in the database rather than in the services.</p>                                           | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |
| <span style="font-weight: bold;">Ease of change:</span><br>BAD    | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>Changing the structure of a database table can affect lots of distributed services, making systems hard to test.</p>                                                        | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |
| <span style="font-weight: bold;">Fault tolerance:</span><br>BAD   | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>If the single monolithic database goes down, the entire system goes down, impacting overall fault tolerance and availability.</p>                                           | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |
| <span style="font-weight: bold;">Scalability:</span><br>BAD       | <table> <tr> <td>Low</td> <td>High</td> </tr> </table> <p>It's harder to scale and provide elasticity because the database must scale along with the services, and because services could run out of connections to the database.</p> | Low | High |
| Low                                                               | High                                                                                                                                                                                                                                  |     |      |

# <span id="page-407-0"></span>**Pomain-partitioned databases**

With *domain-partitioned* databases, each *domain* in the system has its own database. This means any service that belongs to a particular domain will share the database for that domain. For example, the Order Placement, Payment, and Inventory services are all part of the *Order Placement* domain, so they all share the same physical database.

However, since each domain forms its own broad physical bounded context, a service in one domain can't directly access a database to get data from another domain. This means it must make a synchronous call to another service to get the data—and now these services are coupled.

See Chapter 10 for a review of the physical bounded context.

The Order Placement service must synchronously call the Shipping service to get the shipping options.

![](_page_407_Figure_6.jpeg)

event-driven architecture.

their domain's

database directly.

# <span id="page-408-0"></span>Domain-partitioned databases topology scorecard

Here's a scorecard for the domain-partitioned databases topology.

The domain-partitioned databases topology provides a good balance.

**Domain-Partitioned Databases Topology Scorecard**

|      | Service coupling:                                                                                                                                                                                                     | Low | High |
|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----|------|
| BAD  | While services <i>within</i> a domain are still highly decoupled because of shared data, services must make synchronous calls to other services to get data from <i>outside</i> their domain.                         |     |      |
|      | Performance:                                                                                                                                                                                                          | Low | High |
| GOOD | Data retrieval is fast for services <i>within</i> a domain because they are accessing the database directly. However, performance becomes slower when services access data synchronously <i>outside</i> their domain. |     |      |
|      | Simplicity:                                                                                                                                                                                                           | Low | High |
| GOOD | Since most data is naturally partitioned by domain, this topology is not overly complex (but it's still not as simple as a monolithic topology).                                                                      |     |      |
|      | Ease of change:                                                                                                                                                                                                       | Low | High |
| BAD  | Changing the structure of a database table only affects services within the domain, limiting the number of services impacted.                                                                                         |     |      |
|      | Fault tolerance:                                                                                                                                                                                                      | Low | High |
| BAD  | Database failures only affect services within the domain, making this topology a little more fault tolerant than the monolithic topology.                                                                             |     |      |
|      | Scalability:                                                                                                                                                                                                          | Low | High |
| BAD  | While still a con, scalability is a little better here than in the monolithic topology. Databases only need to scale at the domain level, rather than across the entire system.                                       |     |      |

# <span id="page-409-0"></span>Database-per-service

Remember the *database-per-service* pattern from Chapter 10? It isn't just for microservices—you can use it for EDA as well.

The database-per-service pattern is just what it sounds like. Every service has its own database, forming an even tighter physical bounded context than with the domain-partitioned topology. Here, making database changes is a breeze, because the only service affected is the one that owns the data (that is, does writes to the database). You get better fault tolerance and better scalability, too. What's not to like?

We hope you have plenty of money! This can get expensive.

Unfortunately, plenty. You see, whenever services need additional data they don't have, they have to *ask* for that data from the service that owns it using synchronous calls. That results in a lot of coupling and communication between services, not to mention much slower performance.

![](_page_409_Figure_6.jpeg)

# <span id="page-410-0"></span>Database-per-service topology scorecard

Here's a scorecard for the database-per-service topology.

This topology is the exact opposite of the monolithic topology, from a pros-and-cons perspective.

|      |                   | Database-Per-Service Topology Scorecard                                                                                                                                                                         |      |
|------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|
|      | Service coupling: | Low                                                                                                                                                                                                             | High |
| BAD  |                   | Since services only have access to data they own, they must make<br>synchronous calls to other services to get additional data. This highly<br>couples services in a highly decoupled architecture. That's bad. |      |
|      | Performance:      | Low                                                                                                                                                                                                             | High |
| BAD  |                   | Because services must make synchronous calls to retrieve other data,<br>performance becomes much slower than in the other topologies.                                                                           |      |
|      | Simplicity:       | Low                                                                                                                                                                                                             | High |
| BAD  |                   | Breaking data apart into small physical bounded contexts is very<br>hard, due to coupling between data tables and artifacts (such as<br>foreign keys, triggers, views, and stored procedures).                  |      |
|      | Ease of change:   | Low                                                                                                                                                                                                             | High |
| GOOD |                   | Changing the structure of a database table only affects a single<br>service within the physical bounded context, making database<br>changes much easier than in other topologies.                               |      |
|      | Fault tolerance:  | Low                                                                                                                                                                                                             | High |
| GOOD |                   | Database failures only affect the owning service, making this the<br>most fault tolerant of the three topologies.                                                                                               |      |
|      | Scalability:      | Low                                                                                                                                                                                                             | High |
| GOOD |                   | Databases scale at the service level, making this a great topology for<br>high scalability and elasticity needs.                                                                                                |      |

# **Exercise**

For each of these business needs, select which topologies you would consider. You can select more than one

For each of these business needs, select which topologies you would consider. You can select more than one topology.

| We expect anywhere between 20 and 300,000 customers to be on the system at once.               | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |
|------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| The system must be as fast as possible.                                                        | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |
| This medical monitoring system can never completely fail—parts of it must always stay running. | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |
| We're anticipating changing the database a lot in this new line of business.                   | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |
| We have to get the new system up and running as soon as possible.                              | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |
| Our data model is extremely large and complex, with lots of interrelated data.                 | <label><input type="checkbox"/> Monolithic Database</label> <label><input type="checkbox"/> Domain-Partitioned Databases</label> <label><input type="checkbox"/> Database-Per-Service</label> |

Solution on page 396Event-driven architecture using the database-per-service topology looks a lot like microservices to me. What's the difference? 0 Even though they may appear simliar, EDA and microservices are very different. We're glad you noticed some similarities between the two architectural styles. Both are distributed architectures good for scalability, agility, elasticity, and fault tolerance. Over the next few pages, we'll show you some important differences. But before we move on, how about trying the short exercise below to see if you can spot any vourself? If you don't know, that's okay—keep reading! Sharpen your pencil List any differences you can think of between event-driven architecture and microservices. Solution on page 397

## <span id="page-413-0"></span>EDA versus microservices

Welcome to the EDA versus microservices Top Six Differences countdown! Over the next few pages, we're going to count down six important differences between these architectural styles, starting with number 6. Ready? Let's go!

# It's time for the Head First differences countdown

#### Number 6: Performance

The first difference in our countdown, at number 6, is *performance*.

In their book *Fundamentals of Software Architecture* (O'Reilly), two of your authors created star ratings for each architectural style. We gave microservices only two stars out of five for performance, but we gave EDA five stars. Why?

Well, EDA combines asynchronous processing with the ability to do multiple things at once, creating very fast systems. Microservices, however, because of their bounded contexts and fine-grained nature, frequently need to communicate *synchronously*. This creates a lot of latency, which slows the system down considerably.

| Architectural Characteristic | Star Rating |
|------------------------------|-------------|
| Performance                  |             |

**Event-Driven Architecture** 

| Architectural Characteristic | Star Rating |
|------------------------------|-------------|
| Performance                  | ★★          |

Microservices Architecture

These services and their data are each in a physical

#### Number 5: Physical bounded contexts

Coming in at number 5 in our countdown is *physical bounded contexts*. Microservices won't work without these.

In EDA, however, while a physical bounded context is nice to have, it's certainly not foundational (or even required). Because data sharing is pretty typical in EDA, this architecture doesn't restrict data ownership as strictly as microservices does.

![](_page_413_Figure_15.jpeg)

**Event-Driven Architecture** 

**Microservices Architecture** 

#### <span id="page-414-0"></span>Number 4: Data granularity

Another constraint with microservices that doesn't exist in EDA is *data* granularity.

By definition, a microservices architecture requires each service to own its own data. This means you have to break apart your data into fine-grained databases or database *schemas*—collections of tables that a service owns (writes to). But in EDA, you can choose a single monolithic database, domain-partitioned databases, *or* the database-per-service pattern.

You can refresh your memory of this restriction and why it exists by going back to Chapter 10.

![](_page_414_Picture_5.jpeg)

**Event-Driven Architecture** 

Event

Processor

![](_page_414_Picture_7.jpeg)

Microservices Architecture

#### **Number 3: Service granularity**

Event

**Processor** 

Event Processor

Number 3 in our differences countdown has to do with *service granularity*. Recall from Chapter 10 that a microservice is a single-purpose service that does one thing really well. As a result, microservices tend to be fine-grained.

EDA has no such restrictions. Services in an event-driven architecture (formally called *event processors*) can be whatever size they need to be—fine-grained, coarse-grained, it doesn't matter.

![](_page_414_Picture_12.jpeg)

**Event-Driven Architecture** Microservices Architecture

Event

**Processor** 

These services are all required

to be single-purpose-hence

#### <span id="page-415-0"></span>Number 2: Event versus request processing

We're almost there. Coming in at number 2 is another fundamental difference: *event processing versus request processing*. Event-driven architecture is built on *event processing*—responding to something that has happened, and in turn triggering more events. Microservices architecture, on the other hand, is built on *request processing*—responding to something that needs to happen, like a command or a request, and processing that request.

![](_page_415_Figure_3.jpeg)

#### **Number 1: Communication style**

And finally, coming in at number 1 is the most fundamental difference between EDA and microservices: *communication style*. EDA typically uses asynchronous communication between services, whereas microservices typically rely on synchronous communication using REST. EDA can occasionally use synchronous calls for things like retrieving data it doesn't have access to, and microservices can use asynchronous communication when commands don't require a response. But those are exceptions rather than the rule.

In microservices, communication is usually done using REST, which needs a response to continue processing.

Sync

Payment
Service

This is something

Order
Placement
Service

Async
Payment
Service

**Event-Driven Architecture** 

Microservices Architecture

**Order** 

Placement

Service

# Who Does What

Oh dear! We tried to organize these facts , but got them all mixed up. Can you help us figure out which statements are about EDA and which are about microservices? Careful—some facts apply to both.

I require a bounded context.

I can use the database-per-service pattern.

Event-Driven Architecture I create systems that can scale.

I mostly use synchronous communication.

I create high-performance systems.

I save you money because I don't cost a lot.

I rely mainly on asynchronous communication.

I communicate to services using events.

I'm really good at fault tolerance.

I can use a monolithic database.

**Solution on page 398**

We did this one for you.

Microservices Architecture

# <span id="page-417-0"></span>Hybrids: Event-driven microservices

Even with all the differences between EDA and microservices, there's no reason you can't combine them. Doing this creates a *hybrid* architecture called *event-driven microservices*.

You might have observed that the EDA database-per-service pattern for Der Nile looks a lot like microservices. However, just using the database-per-service pattern doesn't make it event-driven microservices. To see what we mean, take a look at this EDA.

![](_page_417_Picture_4.jpeg)

![](_page_417_Figure_5.jpeg)

# The above architecture is an acceptable and well-formed EDA, but *not* a well-formed microservices architecture. Two fundamental principles are missing that would make it event-driven microservices. Can you list what those two missing things are? 1. \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

<span id="page-418-0"></span>To make this architecture an event-driven microservices hybrid, we have to apply two very important principles of microservices: single-purpose services and physical bounded contexts.

The Order Submission service has to accept an order, validate it, apply the payment, and adjust the inventory. It's certainly *not* a single-purpose service. That's perfectly acceptable in EDA, but not in microservices. The same is true of the Order Fulfillment service. To make this an event-driven *microservices* architecture, we'd have to split these services into separate *single-purpose* services, each triggering its own events.

This is a physical bounded context, meaning no one else can access the payment data directly.

![](_page_418_Figure_4.jpeg)

You might have noticed on the previous page that the Email service is accessing the Order Submission database directly. In microservices, this isn't allowed because of the physical bounded context. In the new hybrid architecture, to retrieve the order data, the Email service needs to call the Order Submission service (now the Order Placement service, since we broke that service up). The implementation of tight physical bounded contexts isolates data access to the owning service.

# <span id="page-419-0"></span>Event-driven architecture superpowers

It's time to check out the superpowers of the EDA style.

#### **Maintainability**

Services in EDA are highly decoupled, making them fairly independent and therefore easier to maintain.

![](_page_419_Picture_5.jpeg)

![](_page_419_Picture_6.jpeg)

#### **Performance**

Because EDA mostly uses asynchronous communication and can multitask, it's very fast. **Evolvability**

![](_page_419_Picture_9.jpeg)

EDA services always trigger derived events, onto which we can easily add functionality. This makes EDA highly evolvable.

![](_page_419_Picture_12.jpeg)

## **Scalability**

Event-driven architectures are highly scalable because of asynchronous processing and service decoupling. Each service can scale independently of others, with the event channels acting as pressure release valves if bottlenecks occur.

#### **Fault tolerance**

Because services are highly decoupled in EDA, if one service goes down, it doesn't bring down other services in the workflow.

<span id="page-420-0"></span>![](_page_420_Picture_1.jpeg)

# Event-driven architecture kryptonite

Kryptonite diminishes a superhero's powers, just like these system features and characteristics diminish the power of EDA. Watch out for them!

![](_page_420_Picture_4.jpeg)

#### Complexity

EDA is highly complex because it typically uses asynchronous communication and parallel event processing, and because of its varied database topologies and their trade-offs.

![](_page_420_Picture_7.jpeg)

It's really hard to test asynchronous processing and parallel tasks, making testability a weakness in EDA.

![](_page_420_Picture_9.jpeg)

## Synchronous calls

If you have lots of synchronous calls between services and workflows that require synchronously dependent services, EDA is not for you.

We know you need a database—what we're saying here is that databases can couple an otherwise highly decoupled system.

#### **Databases**

Regardless of the database topology you choose, services are coupled: either to the database or to each other. There are not a lot of good trade-offs here.

![](_page_420_Picture_15.jpeg)

# <span id="page-421-0"></span>Event-driven architecture star ratings

Below is a useful chart for better understanding what EDA is good at and what it's not so good at. One star means that the architectural characteristic is not well supported; five stars means it's very well supported.

Just like movie reviews.

| Architectural Characteristic | Star Rating |
|------------------------------|-------------|
| Maintainability              | ★ ★ ★ ★     |
| Testability                  | ★ ★         |
| Deployability                | ★ ★ ★       |
| Simplicity                   | ★           |
| Evolvability                 | ★ ★ ★ ★     |
| Performance                  | ★ ★ ★ ★     |
| Scalability                  | ★ ★ ★ ★     |
| Elasticity                   | ★ ★ ★       |
| Fault Tolerance              | ★ ★ ★ ★     |
| Overall Cost                 | \$ \$ \$    |

Because most things are asynchronous and decoupled, fault tolerance is really high.

EDA is great for operational characteristics like performance, scalability, elasticity, evolvability, and fault tolerance, but struggles when it comes to simplicity and testing. Asynchronous communication is hard to test, and it's also hard to verify that a change in one service or event hasn't affected other services.

![](_page_422_Picture_1.jpeg)

Which of the following systems might be well suited for the event-driven architectural style, and why? *Hint: Think* 

about EDA's superpowers, its kryptonite, and the problem domain.

| An online auction system where users can bid on items                                               | <input type="checkbox"/> Well suited for event-driven architecture<br><input type="checkbox"/> Might be a fit for event-driven architecture<br><input type="checkbox"/> Not well suited for event-driven architecture |
|-----------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Why?                                                                                                |                                                                                                                                                                                                                       |
| A large backend financial system for processing and settling international wire transfers overnight | <input type="checkbox"/> Well suited for event-driven architecture<br><input type="checkbox"/> Might be a fit for event-driven architecture<br><input type="checkbox"/> Not well suited for event-driven architecture |
| Why?                                                                                                |                                                                                                                                                                                                                       |
| A company entering a new line of business that expects constant changes to its system               | <input type="checkbox"/> Well suited for event-driven architecture<br><input type="checkbox"/> Might be a fit for event-driven architecture<br><input type="checkbox"/> Not well suited for event-driven architecture |
| Why?                                                                                                |                                                                                                                                                                                                                       |
| A small bakery that wants to start taking online orders                                             | <input type="checkbox"/> Well suited for event-driven architecture<br><input type="checkbox"/> Might be a fit for event-driven architecture<br><input type="checkbox"/> Not well suited for event-driven architecture |
| Why?                                                                                                |                                                                                                                                                                                                                       |
| A social media site where users can post and respond to comments                                    | <input type="checkbox"/> Well suited for event-driven architecture<br><input type="checkbox"/> Might be a fit for event-driven architecture<br><input type="checkbox"/> Not well suited for event-driven architecture |
| Why?                                                                                                |                                                                                                                                                                                                                       |

Solution on page 400

# Putting it all together

Now, the part you've been waiting for—the complete picture of the Der Nile online ordering system using event-driven architecture. Since there are lots of database topologies to choose from, we'll focus on the core parts of the system: event processors (services) and events.

![](_page_423_Figure_3.jpeg)

Lots of errors can occur in

# <span id="page-424-0"></span>Wrapping up

Well done! Thanks to your diligent work and EDA knowledge, Der Nile is scaling up and performing to meet its high customer demand, with room to grow even more. Let's close this chapter by reviewing some key points about event-driven architecture.

# **Bullet Points**

- An *event* is something that happens in the system. Events are the fundamental way services communicate with each other in EDA.
- Events are not the same thing as messages—*events* broadcast some action a service just performed to other services in the system, whereas *messages* are commands or requests directed to a single service.
- An *initiating event* originates from a customer or end user and kicks off a business process.
- A *derived event* is generated by a service in response to an initiating event.
- Any action a service performs should trigger a derived event to provide *architectural extensibility*—the ability to extend the system to add new functionality.
- EDA is fast because it generally uses *asynchronous (async) communication*—services don't wait for a response or acknowledgment from other services when sending them information.
- Asynchronous communication is sometimes called *fire-and-forget*.
- Architects usually use a dotted line to represent async communication between services and a solid line to represent sync communication.
- Unlike microservices, event-driven architecture can use a variety of database topologies:
  - With the *monolithic database* topology, all services share a single database.
  - With the *domain-partitioned databases* topology, each domain in the system has its own database, shared by all of the services within that domain.
  - In the *database-per-service pattern*, each service has its own database in a bounded context.

- Event-driven architecture and microservices are very different architectural styles:
  - EDA relies mostly on *asynchronous* communication between services, whereas microservices typically rely on *synchronous* communication using REST.
  - EDA is built on *event processing*—processing things that have already happened. A microservices architecture is built on *request processing*— processing a command or request about something that needs to happen.
  - Microservices are fine-grained and singlepurpose, whereas services in EDA can be any size.
  - Microservices requires each service to own its own data, whereas in EDA services can (and usually do) share data.
- You can combine microservices and EDA to create a hybrid architecture called *event-driven microservices*.
- EDA is very complex because it uses asynchronous communication and parallel event processing, and has varied database topologies.
- It's really hard to test asynchronous processing and parallel tasks, making testability a weakness in EDA.
- Derived events provide *hooks* to add functionality, making EDA highly evolvable.
- EDA is highly scalable because of asynchronous processing and service decoupling.

![](_page_425_Picture_1.jpeg)

# **Event-Driven Crossword**

Ready to have some fun and test your knowledge about events, asynchronous communication, event processors, and multitasking? Try this crossword puzzle about the event-driven architectural style.

![](_page_425_Picture_4.jpeg)

#### Across

- 2. How each part of a process is completed and in what order
- 3. \_\_\_\_\_-and-forget communication
- 5. When you combine a service with a database, you get a physical bounded \_\_\_\_\_
- 6. Reducing users' wait time is the goal of making a system more \_\_\_\_\_
- 8. Async communications don't \_\_\_\_\_ for a response
- 12. Type of communication that requires a response
- 13. Architectural characteristic that deals with speed
- 18. Some architectures are easier to \_\_\_\_\_ with new features
- 19. These communications are sent to a single service using queues
- 20. Certain conditions may \_\_\_\_\_ an event

#### Down

- 1. A way of organizing databases in an architecture
- 4. Something important that happens
- 7. Type of event that kicks off a business process
- 9. Type of event that flows from other events
- 10. Abbr. for an external communication hub that an app may call
- 11. An event is used to \_\_\_\_\_ news that something has happened
- 12. Part of an architecture that performs a function
- 14. \_\_\_\_\_-partitioned databases
- 15. Events are delivered via an event \_\_\_\_\_
- 16. A message can be a command or a \_\_\_\_\_
- 17. Services can \_\_\_\_\_ for event notifications

**Solution on page 401**

![](_page_426_Picture_2.jpeg)

As the architect, how can you modify the current workflow shown on page 352 to speed things up a bit? Draw your ideas for a new workflow in the space below. *Hint: What can you do at the same time?* Here's our solution.

![](_page_426_Figure_4.jpeg)

![](_page_427_Picture_2.jpeg)

It's time to test your knowledge about events and messages. For each of the quotes below, mark whether it is more likely an event or a message, and indicate why.

| "Adventurous Air flight 12, turn left, heading 230 degrees."                                                                      |       |                                               |                                               |
|-----------------------------------------------------------------------------------------------------------------------------------|-------|-----------------------------------------------|-----------------------------------------------|
| <table> <tr> <td></td> <td>Event</td> <td> <div style="text-align:center;">Message</div> </td> </tr> </table>                     |       | Event                                         | <div style="text-align:center;">Message</div> |
|                                                                                                                                   | Event | <div style="text-align:center;">Message</div> |                                               |
| Reason: This is a command sent to only one airplane about something that needs to happen.                                         |       |                                               |                                               |
| "In other news, a winter storm front has just moved into the area."                                                               |       |                                               |                                               |
| <table> <tr> <td>Event</td> <td></td> <td>Message</td> </tr> </table>                                                             | Event |                                               | Message                                       |
| Event                                                                                                                             |       | Message                                       |                                               |
| Reason: This is being broadcast to lots of people about something that has just happened.                                         |       |                                               |                                               |
| <p>Be careful—this</p> <p>one's tricky!</p> "Okay, class, turn to page 42 in your workbooks."                                     |       |                                               |                                               |
| <table> <tr> <td></td> <td>Event</td> <td> <div style="text-align:center;">Message</div> </td> </tr> </table>                     |       | Event                                         | <div style="text-align:center;">Message</div> |
|                                                                                                                                   | Event | <div style="text-align:center;">Message</div> |                                               |
| Reason: Even though this is being broadcast to lots of students, it's a command about something that needs to happen.             |       |                                               |                                               |
| "Hello, everyone! Sorry I'm late."                                                                                                |       |                                               |                                               |
| <table> <tr> <td>Event</td> <td></td> <td>Message</td> </tr> </table>                                                             | Event |                                               | Message                                       |
| Event                                                                                                                             |       | Message                                       |                                               |
| Reason: This is something that happened that is being broadcast to many people. No response is expected.                          |       |                                               |                                               |
| "Oh no! I just missed my train!"                                                                                                  |       |                                               |                                               |
| <table> <tr> <td>Event</td> <td></td> <td>Message</td> </tr> </table>                                                             | Event |                                               | Message                                       |
| Event                                                                                                                             |       | Message                                       |                                               |
| Reason: Even though no one might be listening, this is something that just happened. It isn't directed toward any one individual. |       |                                               |                                               |
| "Excuse me, sir—do you have the time?"                                                                                            |       |                                               |                                               |
| <table> <tr> <td></td> <td>Event</td> <td> <div style="text-align:center;">Message</div> </td> </tr> </table>                     |       | Event                                         | <div style="text-align:center;">Message</div> |
|                                                                                                                                   | Event | <div style="text-align:center;">Message</div> |                                               |
| Reason: This is a request made to a single individual about something that needs to happen.                                       |       |                                               |                                               |

![](_page_428_Picture_2.jpeg)

Based on the *Credit Card Charged* initiating event and the corresponding processing below, can you identify what the derived events should be for each service? Think of as many possible outcomes as you can. Here's our take.

![](_page_428_Figure_4.jpeg)

![](_page_429_Picture_2.jpeg)

For each of these tasks, would you use asynchronous or synchronous communication?

| Give me the shipping options for this order.                                            | <input type="checkbox"/> Asynchronous <input checked="" type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
|-----------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| Apply payment for this order and let me know if the payment goes through.               | <input type="checkbox"/> Asynchronous <input checked="" type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
| Fulfill this order for me by picking the items off the shelf and packing them in a box. | <input checked="" type="checkbox"/> Asynchronous <input type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
| Give me the current status of this order.                                               | <input type="checkbox"/> Asynchronous <input checked="" type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
| Our inventory of this item is getting low—please order more stock.                      | <input checked="" type="checkbox"/> Asynchronous <input type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
| Tell the customer that their order has been shipped and is on its way.                  | <input checked="" type="checkbox"/> Asynchronous <input type="checkbox"/> Synchronous <input type="checkbox"/> Either one would work |
| Update the customer's profile picture.                                                  | <input type="checkbox"/> Asynchronous <input type="checkbox"/> Synchronous <input checked="" type="checkbox"/> Either one would work |
| Post a customer's review on the product page.                                           | <input type="checkbox"/> Asynchronous <input type="checkbox"/> Synchronous <input checked="" type="checkbox"/> Either one would work |

# Sharpen your pencil Solution

Now's your chance to test what you've learned so far about event-driven architecture, events, and asynchronous processing. Der Nile's inventory occasionally gets out of sync, as shown below. When this happens, the order cannot be fulfilled and goes into a back-order state. Der Nile never makes a customer pay for items that are back-ordered, and the customer can choose whether to wait or cancel the order.

As the architect for Der Nile, what additional events and services would you create to address this situation?

![](_page_430_Figure_5.jpeg)

![](_page_431_Picture_2.jpeg)

For each of these business needs, select which topologies you would consider. You can select more than one topology.

opology.

| We expect anywhere between 20 and 300,000 customers to be on the system at once. |
|----------------------------------------------------------------------------------|
|----------------------------------------------------------------------------------|

| <input type="checkbox"/> Monolithic Database | <input checked="checked" type="checkbox"/> Domain-Partitioned Databases | <input checked="checked" type="checkbox"/> Database-Per-Service |
|----------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------|
|----------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------|

| The system must be as fast as possible. |
|-----------------------------------------|
|-----------------------------------------|

| <input checked="checked" type="checkbox"/> Monolithic Database | <input checked="checked" type="checkbox"/> Domain-Partitioned Databases | <input type="checkbox"/> Database-Per-Service |
|----------------------------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------|
|----------------------------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------|

| This medical monitoring system can never completely fail—parts of it must always stay running. |
|------------------------------------------------------------------------------------------------|
|------------------------------------------------------------------------------------------------|

| <input type="checkbox"/> Monolithic Database | <input type="checkbox"/> Domain-Partitioned Database | <input checked="checked" type="checkbox"/> Database-Per-Service |
|----------------------------------------------|------------------------------------------------------|-----------------------------------------------------------------|
|----------------------------------------------|------------------------------------------------------|-----------------------------------------------------------------|

| We're anticipating changing the database a lot in this new line of business. |
|------------------------------------------------------------------------------|
|------------------------------------------------------------------------------|

| <input type="checkbox"/> Monolithic Database | <input checked="checked" type="checkbox"/> Domain-Partitioned Databases | <input checked="checked" type="checkbox"/> Database-Per-Service |
|----------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------|
|----------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------|

| We have to get the new system up and running as soon as possible. |
|-------------------------------------------------------------------|
|-------------------------------------------------------------------|

| <input checked="checked" type="checkbox"/> Monolithic Database | <input checked="checked" type="checkbox"/> Domain-Partitioned Databases | <input type="checkbox"/> Database-Per-Service |
|----------------------------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------|
|----------------------------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------------|

| Our data model is extremely large and complex, with lots of interrelated data. |
|--------------------------------------------------------------------------------|
|--------------------------------------------------------------------------------|

| <input checked="checked" type="checkbox"/> Monolithic Database | <input type="checkbox"/> Domain-Partitioned Databases | <input type="checkbox"/> Database-Per-Service |
|----------------------------------------------------------------|-------------------------------------------------------|-----------------------------------------------|
|----------------------------------------------------------------|-------------------------------------------------------|-----------------------------------------------|

![](_page_432_Picture_2.jpeg)

List any differences you can think of between event-driven architecture and microservices.

Performance

Physical bounded contexts

Data granularity

Service granularity

Event vs. request processing

Asynchronous versus synchronous processing

These are some of the ones we came up with.

# Who Does What ? Solution

Oh dear! We tried to organize these facts, but got them all mixed up. Can you help us figure out which statements are about EDA and which are about microservices? Careful—some facts apply to both.

![](_page_433_Figure_4.jpeg)

![](_page_434_Picture_2.jpeg)

The architecture on page 382 is an acceptable and well-formed EDA, but *not* a well-formed microservices architecture. Two fundamental principles are missing that would make it event-driven microservices. Can you list what those two missing things are?

| 1. Single-purpose services                   |
|----------------------------------------------|
| 2. Physical bounded context (data ownership) |

![](_page_435_Picture_2.jpeg)

Which of the following systems might be well suited for the event-driven architectural style, and why? *Hint: Think about EDA's superpowers, its kryptonite, and the problem domain.*

| An online auction system where users can bid on items<br>Why? The problem domain fits EDA, and this system<br>needs high levels of scalability, elasticity, and<br>responsiveness. | <div style="display:flex; align-items:center;"><img alt="checked" src=""/>Well suited for event-driven architecture</div> <div><img alt="unchecked" src=""/>Might be a fit for event-driven architecture</div> <div><img alt="unchecked" src=""/>Not well suited for event-driven architecture</div> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A large backend financial system for processing and<br>settling international wire transfers overnight<br>Why? None of EDA's superpowers are needed for<br>this problem.           | <div><img alt="unchecked" src=""/>Well suited for event-driven architecture</div> <div><img alt="unchecked" src=""/>Might be a fit for event-driven architecture</div> <div style="display:flex; align-items:center;"><img alt="checked" src=""/>Not well suited for event-driven architecture</div> |
| A company entering a new line of business that<br>expects constant changes to its system<br>Why? EDA might be a possibility, since it makes<br>change easier.                      | <div><img alt="unchecked" src=""/>Well suited for event-driven architecture</div> <div style="display:flex; align-items:center;"><img alt="checked" src=""/>Might be a fit for event-driven architecture</div> <div><img alt="unchecked" src=""/>Not well suited for event-driven architecture</div> |
| A small bakery that wants to start taking online<br>orders<br>Why? EDA is too complex and expensive for a small<br>bakery.                                                         | <div><img alt="unchecked" src=""/>Well suited for event-driven architecture</div> <div><img alt="unchecked" src=""/>Might be a fit for event-driven architecture</div> <div style="display:flex; align-items:center;"><img alt="checked" src=""/>Not well suited for event-driven architecture</div> |
| A social media site where users can post and respond<br>to comments<br>Why? The async and broadcast capabilities of EDA<br>are a good fit here.                                    | <div style="display:flex; align-items:center;"><img alt="checked" src=""/>Well suited for event-driven architecture</div> <div><img alt="unchecked" src=""/>Might be a fit for event-driven architecture</div> <div><img alt="unchecked" src=""/>Not well suited for event-driven architecture</div> |

# **Event-Driven Crossword Solution**

**From page 390**

![](_page_436_Picture_3.jpeg)

 do it yourself **12**

# Testing Your Knowledge

![](_page_438_Picture_2.jpeg)

#### **Ready to test your skills in creating a distributed architecture?** In this

chapter, you're the software architect. You'll be determining architectural characteristics, building a logical architecture, making architectural decisions, and deciding whether to use microservices or event-driven architecture. The exercises in this chapter will give you an end-to-end view of what a software architect does and show you how much you've learned. Get ready to create an architecture for a student standardized test–taking system called Make the Grade. Good luck—we hope you get an A on your architecture!

# <span id="page-439-0"></span>Welcome to Make the Grade

Congratulations—you've just been hired by Dataville Public Schools to build a new system for standardized testing. All students in a specific grade level will take the same test to determine how well students, teachers, and the schools are doing.

# Make the Grade requirements document

- ☐ Students will take a web-based test in their homeroom, proctored by their homeroom teacher. Because tests are timed (2 hours), the system must present questions as fast as possible.
- ☐ Each student is presented with a multiple-choice question on the screen. Once they answer it, the system captures the answer and delivers the next question. Students may skip questions, but may not go back to prior ones—only moving forward is allowed.
- ☐ Once captured, each answer is automatically graded (correct or incorrect) and the results are stored in a central relational database, which has only 300 database connections available.
- ☐ Anywhere from 20 to 200,000 students could be taking tests at the exact same time.
- ☐ The Dataville Public Schools testing administrator is responsible for scheduling tests and for maintaining tests, answer keys, and the list of students (used when students sign in to the
- ☐ Rita, the head of Dataville Public Schools, uses the system to generate student reports, teacher evaluations, and school reports after all testing is complete.
- ☐ The proctor (teacher) uses the system to find out when tests are scheduled.

Dataville Public Schools Pay attention, because these things are important.

Rita has some other important requirements for the system.

"It's *imperative* that no student answers are lost, even if the system crashes."

"We need this system in place for the start of the next term, which is in six months."

"You absolutely have to make sure that students cannot hack into the system and steal the test answer keys."

"Testing doesn't occur every day. Some days there are only 20 students taking a test; other days there could be 200,000 at the exact same time. Sometimes tests might be staggered throughout the day."

Meet Rita.

head of

# Student testing workflow

Now that you have the requirements, let's take a look at the primary workflow of the Make the Grade system so you can better understand those requirements.

![](_page_440_Figure_3.jpeg)

![](_page_440_Figure_4.jpeg)

# Planning the architecture

![](_page_441_Figure_2.jpeg)

We have to create an architecture first.

As you've learned, architecture is a critical part of any software system. Without it, the system will likely fail to achieve any of its goals.

Before you start developing code, you have to create an architecture. This means going back to what you learned in Chapter 1 about the four dimensions of software architecture.

Don't worry—we'll get the system done. But first, it's important to know what we're building.

# The architects' roadmap

Let's get the Make the Grade architecture started. You'll use the steps you've learned to translate requirements into an architecture.

![](_page_442_Figure_3.jpeg)

This diagram will serve as your roadmap as you make your way through each of the exercises, so get used to seeing it. The next few pages will walk you through these steps.

Good luck on your journey—Dataville Public Schools is counting on you.

# <span id="page-443-0"></span>Step 1: Identify architectural characteristics

In this first step, you'll use the requirements below to identify the architectural characteristics that are critical for the success of the Make the Grade student test-taking system. On the next page, identify *up to seven* driving characteristics. Then select the three you think are the *most critical* for the system to be successful.

Remember, *implicit characteristics* are those that are implied in virtually every software architecture. (Would you ever *not* worry about security?) If you see one you feel is *critical* for the success of the system, move it over to the driving characteristics area.

"It's *imperative* that no student answers are lost, even if the system crashes."

"We need this system in place for the **start of the next term**, which is in six months."

"You absolutely have to make sure that students *cannot* hack into the system and steal the test answer keys."

"Testing doesn't occur every day. Some days there are only 20 students taking a test; other days there could be 200,000 at the exact same time. Sometimes tests might be staggered throughout the day."

![](_page_443_Figure_8.jpeg)

We copied the requirements here to make it easier for you to use them to identify the driving architectural characteristics.

# Make the Grade requirements document

- Students will take a web-based test in their homeroom, proctored by their homeroom teacher.

  Because tests are timed (2 hours), the system must present questions as fast as possible.
- ☐ Each student is presented with a multiple-choice question on the screen. Once they answer it, the system captures the answer and delivers the next question. Students may skip questions, but may not go back to prior ones—only moving forward is allowed.
- ☐ Once captured, each answer is automatically graded (correct or incorrect) and the results are stored in a central relational database, which has only 300 database connections available.
- ☐ Anywhere from 20 to 200,000 students could be taking tests at the exact same time.
- ☐ The Dataville Public Schools testing administrator is responsible for scheduling tests and for maintaining tests, answer keys, and the list of students (used when students sign in to the system)
- ☐ Rita, the head of Dataville Public Schools, uses the system to generate student reports, teacher evaluations, and school reports after *all* testing is complete.
- $\square$  The proctor (teacher) uses the system to find out when tests are scheduled.

![](_page_444_Picture_1.jpeg)

In Chanter 2, we showed you how to use this template to limit the number of architectural characteristics. Flip back to

In Chapter 2, we showed you how to use this template to limit the number of architectural characteristics. Flip back to page 70 if you need a refresher on how to use it.

| Top 3                    | Driving Characteristics                                                                                                                         | Implicit Characteristics |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
| <input type="checkbox"/> |                                                                                                                                                 | feasibility (cost/time)  |
| <input type="checkbox"/> |                                                                                                                                                 | security                 |
| <input type="checkbox"/> |                                                                                                                                                 | maintainability          |
| <input type="checkbox"/> |                                                                                                                                                 | observability            |
| <input type="checkbox"/> | These are implied characteristics. Move them to the Driving Characteristics column if you think they are critical to the success of the system. |                          |
| <input type="checkbox"/> | Go back to Chapter 2 if you need a refresher on the definitions of these common architectural characteristics.                                  |                          |
| <input type="checkbox"/> | Pick the top three most important ones (in any order).                                                                                          |                          |

Possible Candidate Architectural Characteristics

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

Solution on page 421

# <span id="page-445-0"></span>Step 2: Identify logical components

Good job! Now that you've identified the critical architectural characteristics for Make the Grade, it's time to apply what you learned in Chapter 4 to create logical components.

Using the requirements and primary workflow on the previous pages, use the actor/action approach to identify the *users and their actions*. Then identify as many *logical components* as you can on the next page.

Here's some additional information you might find useful for this exercise:

- Students sign in to the system using their student ID. The system will verify the date, student ID, test, and teacher when a student signs in.
- Rita, the head of Dataville Public Schools, will wait at least one day after testing has finished before generating reports.

This gives the system time to record all the answers in the database.

You are here.

- The classroom teacher acts as the *proctor* for the test, watching the students to make sure they don't cheat and providing assistance. The teachers use the system to find out when a test is scheduled for their class.
- When a test is created, the questions and answers are sent to the test administrator, who enters them into the system. The same goes for any modifications to existing tests.

![](_page_445_Figure_10.jpeg)

![](_page_446_Picture_1.jpeg)

# **Exercise**

Using the space below, draw your logical components and their interactions.

![](_page_446_Figure_4.jpeg)

**Solution on page 422**

# <span id="page-447-0"></span>Step 3: Choose an architectural style

We know that this system will have separate parts that require different architectural characteristics, so it makes sense to use a *distributed architecture*, such as microservices or event-driven architecture. Leveraging what you've learned about both styles, use the next page to analyze their pros and cons with respect to the Make the Grade test-taking system. You will also need to go back to the requirements, your logical architecture, and the star rating charts for each architectural style (we've added those for you below). Choose an architectural style based on your analysis.

![](_page_447_Picture_3.jpeg)

#### The more **Microservices** stars, the better that Architectural Characteristic Star Rating characteristic Maintainability \*\*\*\* is supported. \*\*\*\* Testability \*\*\*\* Deployability \* Simplicity \*\*\*\* Evolvability Both of these styles Performance are complex. Scalability \*\*\*\* Welcome to $\star\star\star\star$ Elasticity distributed Fault Tolerance $\star\star\star\star$ architecture. \$ \$ \$ \$ \$ Overall Cost

| Architectural Characteristic | Star Rating |
|------------------------------|-------------|
| Maintainability              | ★★          |
| Testability                  | ★★          |
| Deployability                | ★★★         |
| Simplicity                   | ★           |
| Evolvability                 | ★★★★★       |
| Performance                  | ★★★★★       |
| Scalability                  | ★★★★★       |
| Elasticity                   | ★★★★★       |
| Fault Tolerance              | ★★★★★       |
| Overall Cost                 | \$\$\$\$    |

**Event-Driven Architecture** 

Here are some considerations that might help you decide which architectural style would be better suited for Make the Grade:

- Go back to your logical architecture diagram and count the actions you identified that you would consider events. If you find there aren't many events, event-driven architecture might not be the right choice.
- Think about the nature of the data in the system. If most of the data is shared, then microservices probably isn't the right choice.
- Think about how many actions you identified are synchronous and how many are asynchronous. If you have a lot of synchronous actions, event-driven architecture might not be a good fit.

![](_page_448_Picture_1.jpeg)

Outline the pros and cons of each architectural style to help you make a choice about which one might be most

Outline the pros and cons of each architectural style to help you make a choice about which one might be most appropriate for Make the Grade.

| Pros | Microservices Architecture Analysis | Cons |
|------|-------------------------------------|------|
|      |                                     |      |
|      |                                     |      |
|      |                                     |      |
|      |                                     |      |

| Pros | Event-Driven Architecture Analysis | Cons |
|------|------------------------------------|------|
|      |                                    |      |
|      |                                    |      |
|      |                                    |      |
|      |                                    |      |

List your winning choice here: \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Solution on page 423

# <span id="page-449-0"></span>Step 4: Document your decision

Good work: you've just chosen which architectural style you are going to use for Make the Grade. Now's your chance to explain *why* you made the choice you did and document your architectural decision.

As you learned in Chapter 3, an *architectural decision record*, or ADR, is an effective way to document your architectural decisions. Use the ADR on the next page to document your architectural style decision. Assume that this is your 11th architectural decision.

![](_page_449_Picture_4.jpeg)

Revisit Chapter 3 if you need a refresher on architectural decision records.

![](_page_449_Picture_6.jpeg)

What should I put in the Consequences section of my ADR if my architectural decision doesn't have any consequences?

#### Every architectural decision has consequences.

Maybe it's cost, or maybe it's sacrificing a little bit of performance to have better security. Regardless, *every* architectural decision has consequences.

Think about the trade-off analysis you just did. Each one of those trade-offs implies a consequence—something you were willing to give up (or accept) to get something better. The *Consequences* section of an ADR is a great place to document your trade-off analysis and the corresponding consequences of your decision.

If you can't find any consequences in your architectural decision, keep looking, because they're there.

![](_page_450_Picture_1.jpeg)

Exercise

## Architectural Decision Record

| Title:        |          |
|---------------|----------|
| Status:       | Proposed |
| Context:      |          |
| Decision:     |          |
| Consequences: |          |

We did this one for you.

What is the impact of your decision? What trade-offs are you willing to accept?

Solution on page 424

# <span id="page-451-0"></span>Step 5: Diagram your architecture

Now it's time to combine all four dimensions of software architecture and show us your vision of the Make the Grade architecture. In this last exercise, you'll diagram your architecture on the following page using the key on this page.

There's not a lot of room to diagram your architecture, but that's intentional. While a lot of detail can go into architecture diagrams, what we're asking you to do is sketch out a *high-level* physical view showing the user interfaces, services, databases, communication type (sync or async), and how all of these architectural artifacts connect to each other.

![](_page_451_Figure_4.jpeg)

#### **Physical Architecture Key**

#### User Interface

![](_page_451_Picture_7.jpeg)

Draw a computer screen to represent the *user interface*, and indicate which type(s) of *users* are interacting with it. For example, if you have separate user interfaces for the test administrator and the education department (for generating reports), show two computer screens. If they share a single user interface, show one computer screen with multiple actors interacting with it.

![](_page_451_Picture_9.jpeg)

Use a box to represent a service. Be sure to include the *components* that the services implement, which should match the logical components you identified in the prior exercise. Also, indicate which user interfaces access the service and which other services communicate with the service. Last, give your service a *meaningful* and descriptive name.

Feel free to annotate your diagram to clarify points or describe things.

#### **Database**

![](_page_451_Picture_13.jpeg)

Draw a cylinder to represent each *physical database* in your solution. Your label should indicate what type of data it stores (for example, **Student Answers**). Show which services write to the database and which services are read-only by *drawing arrows* to indicate the data flow to and from the services. (Writes assume reads.)

![](_page_451_Picture_15.jpeg)

Draw dotted lines to represent *asynchronous* communication (such as using a queue, topic, or stream), and solid lines to represent *synchronous* (blocking) communication between services and user interfaces.

![](_page_451_Picture_17.jpeg)

If your architecture uses messages or events, draw a box or an envelope to indicate the *data* being passed (for example, **Student Answer**) or the *event* being triggered (for example, **Answer Submitted**).

![](_page_452_Picture_1.jpeg)

# <span id="page-453-0"></span>There are no right (or wrong) answers!

Congratulations—you've just created an architecture!

What we're about to show you are the exercise "solutions." We've used quotes there because our answers are not the only ones possible. You see, there are no right or wrong answers in software architecture: it's all about analyzing trade-offs and being able to justify your decisions.

Compare your answers with the ones we're about to show you. See how your solutions differ and think about what you might have done differently, or confirm that you made what seems to you to be the most appropriate choice. We'll show you our Make the Grade architectures for microservices *and* event-driven architecture, since both these styles are viable options.

Software architecture is *always* a learning process. Each new problem brings a whole new set of conditions, constraints, and business and technical concerns. There is no one-size-fits-all architecture—it's up to you, the architect, to come up with the most appropriate architecture for your situation.

# **Bullet Points**

- When analyzing requirements for a business problem, always gather additional information from the business stakeholders or project sponsor.
- While there's no "checklist" for creating an architecture, the four dimensions of software architecture (introduced in Chapter 1) provide a good roadmap.
- Identifying driving architectural characteristics requires you to analyze the business requirements and technical constraints.
- Implicit architectural characteristics become *driving characteristics* if they are critical or important to the success of the system.
- Make sure you can tie each driving characteristic back to some sort of requirement or business need.
- When identifying logical components and creating a corresponding logical architecture, try to avoid adding physical details such as services, databases, queues, and user interfaces—those artifacts go into the *physical architecture*.

- When choosing an architectural style, make sure you take into account the characteristics of the architectural style, the problem domain, and the driving architectural characteristics you identified.
- *Hybrid architectures* (those combining two or more different architectural styles) are very common. Just be sure to verify that the hybrid architecture still addresses your critical architectural characteristics.
- *Architectural decision records* (ADRs) are a great way to document your choices. They communicate the reasons for your architectural decisions as well as your trade-off analyses.
- When diagramming your physical architecture, be sure to include all the components you identified in your logical architecture.
- Remember that there are no right or wrong answers in software architecture. As long as you can provide a reasonable justification for your architectural decisions, you are on the right track for success.

![](_page_454_Picture_1.jpeg)

![](_page_454_Picture_2.jpeg)

## **You are well on your way to thinking architecturally!**

We are going to assume that you actually read this book all the way through and didn't just jump to the end. If so, we congratulate you for it! Job well done.

# Congratulations!

You've made it to the end.

Though there is still the appendix.

And the index.

And there's a website...

You aren't getting away that easily!

(Go ahead, you can admit it—you just can't get enough of software architecture, can you?)

![](_page_455_Picture_2.jpeg)

# Sharpen your pencil Solution

Given the requirements for Make the Grade, list some challenges that you will need to address when creating an architectural solution.

- Storing up to 200,000 simultaneous student answers in a relational database that has only 300 connections.
- Delivering the next question to each student as fast as possible while making sure student answers are not lost.
- · Coming up with a viable solution that can be delivered within a six-month time frame.
- Making the system elastic to reduce cost and resource use when testing is not happening or there are only a
  few students taking a test.

![](_page_455_Figure_9.jpeg)

**Exercise Solution**

In Chapter 2, we showed you how to use this template to limit the number of architectural characteristics. Flip back to page 70 if you need a refresher on how to use it.

| Top 3 | Driving Characteristics |                                                                                  | Implicit Characteristics |
|-------|-------------------------|----------------------------------------------------------------------------------|--------------------------|
|       | Feasibility             | We only have six months!                                                         | feasibility (cost/time)  |
|       | Security                | Need to protect the answer key.                                                  | security                 |
|       | Elasticity              | There can be 20 to 200,000 students- the very definition of elasticity.          | maintainability          |
|       | Responsiveness          | We have to deliver the next question right away.                                 | observability            |
|       | Availability            | If the system isn't available, students can't take a test.                       |                          |
|       | Data integrity          | We absolutely cannot lose student answers.                                       |                          |
|       | Recoverability          | We don't want the students to have to start the test over if the system crashes. |                          |

Possible Candidate Architectural Characteristics

| performance     | data integrity   | deployability   |
|-----------------|------------------|-----------------|
| responsiveness  | data consistency | testability     |
| availability    | adaptability     | configurability |
| fault tolerance | extensibility    | customizability |
| scalability     | interoperability | recoverability  |
| elasticity      | concurrency      | auditability    |

![](_page_457_Figure_1.jpeg)

![](_page_458_Picture_2.jpeg)

<span id="page-458-0"></span>Outline the pros and cons of each architectural style to help you make a choice about which one might be most appropriate for Make the Grade.

#### **Microservices Architecture Analysis Pros Cons**

A microservices architecture provides good elasticity, scalability, and fault tolerance—things Make the Grade needs.

Partitioning data, so that each microservice owns its own data, provides a good level of fault tolerance and data access control.

Make the Grade has lots of separate, independent parts—test taking, grading, maintenance, and reporting—so it lends itself well to separately deployed, single-purpose services that don't require much interaction.

Microservices gets a low performance rating, but we could address this by using caching and minimizing communication between services.

The test administrator's functionalities write to a database that other services need to read (for test questions, student sign-on information, answer keys, and so on). This implies that we need to share data, something for which microservices is not well suited. However, this data is fairly static and can be shared through in-memory caching.

#### **Event-Driven Architecture Analysis**

Event-driven architecture (EDA) is highly responsive and provides the elasticity, scalability, and fault tolerance Make the Grade needs.

A student submitting an answer can be considered an event; the responses would be to deliver the next question and automatically grade the answer. However, this is a fairly isolated event—really the only one in the system.

#### **Pros Cons**

The test administrator's functionalities (student and test maintenance and test scheduling and reporting) are not really suited for EDA.

There aren't many events in this system—mostly, requests are being made to the system. The only event we identified was a student submitting an answer, but that event only has one listener (the auto-grading functionality).

> Remember, this isn't the only answer, just our choice based on our analysis.

**List your winning choice here:** Based on our analysis, we selected microservices for Make the Grade.

#### **Architectural Decision Record**

**Title:**  011: Use of the microservices architectural style for the Make the Grade system

**Status:** Proposed

#### **Context:**

Make the Grade is a test-taking system that needs high levels of responsiveness, fault tolerance, elasticity, and data integrity. Because there are separate parts of the system (admin, reporting, grading, and test taking) that require different architectural characteristics, a distributed architecture is appropriate. The two choices are microservices and event-driven architecture.

#### **Decision:**

We will use the microservices architectural style.

Microservices provides the necessary fault tolerance, elasticity, and scalability.

Performance deficiencies and high responsiveness needs are addressed through minimal inter-service communication, caching to minimize data retrieval needs (student information, test questions, and test answer keys), and asynchronous communication for automatic grading and storing students' answers.

Data integrity (preventing data loss) is addressed by using persistent queues between the Capture Answer and Automatic Grading components, along with client acknowledgment mode in the Automatic Grading component, to make sure that each student answer stays on the queue until it is persistent in the Student Answer Database.

The test administration functionality will be a single microservice that combines the test scheduling, test maintenance, and student maintenance functionalities. Reporting will be a single microservice as well.

#### **Consequences:**

Technically partitioned teams will need to be reorganized into cross-functional teams and will work in parallel in order to finish the system in six months.

We will need to use in-memory caching to address the system's performance, elasticity, and data sharing needs.

We will need additional infrastructure to support microservices: specifically, a service orchestrator like Kubernetes and a more effective CI/CD deployment pipeline.

![](_page_460_Figure_1.jpeg)

<span id="page-460-0"></span>![](_page_460_Picture_2.jpeg)

Solution Use this space and refer to the key on the page 416 to sketch your physical architecture for Make the Grade. Microservices Architecture Diagram Once the answer is on the persisted queue, the next question is presented. The data each Student Interface We'll use multiple channels service needs is for elasticity and stored in an inadditional fault tolerance. memory cache. Student Information Sign-in Auto Grader Test Taker **Patabase** Student Automatic Next Test Sign-in Gradina Question Cache Cache Capture Student Answer Student Information Answers Cache Student Maintenance Test Information Test Contains questions, Maintenance answer key, and test schedule. Test Scheduling Student Answer **Database** Test Vatabase **Test Administration** Interface Reporting Proctors use this Test interface to get the Reporting test schedule. Reporting Interface

![](_page_461_Figure_1.jpeg)

**A**

appendix: leftovers

# The Top Six Topics We Didn't Cover

![](_page_462_Picture_3.jpeg)

**There's a lot more to be said about software architecture.** We promise,

you're done with this book. But reading this book is just the first step in your journey to thinking architecturally, and we couldn't in good conscience let you go without a little more preparation. So, we've gathered a few additional juicy bits into this appendix. Each of the topics that follow deserves as much attention as the other topics we've covered. However, our goal here is just to give you a highlevel idea of what they're all about. And yes, this really *is* the end of the book. Except for the index, of course—it's a real page-turner!

# <span id="page-463-0"></span>#1 The coding architect

After reading this book, I'm interested in becoming a software architect—but I also really like writing source code. Can I still do that as an architect?

![](_page_463_Picture_3.jpeg)

Yes! We firmly believe that software architects should still write source code. Not only does it help you maintain your technical skills, but it also shows you how your architectural decisions play out in real life.

However, it's not always easy to balance hands-on coding with software architecture. As you've seen, there's a lot to software architecture. It will take up most (if not all) of your time.

Don't worry though—we'll share some tips and techniques for writing software while being an effective software architect.

<span id="page-464-0"></span>![](_page_464_Picture_1.jpeg)

#### Don't become a bottleneck

Be careful not to take ownership of code that is on the product's critical path. Leave things like the underlying framework code and really complex or crucial parts of the system to your development team. That way, if you get pulled away by architecture-related stuff, you won't hold up your team.

![](_page_464_Picture_4.jpeg)

Here are some more ways to make sure you don't become a bottleneck.

#### Write proof-of-concept code

Having trouble making an architectural decision? How about writing some code to demonstrate each option? Writing proof-of-concept code is a great way to better understand the implications of your architectural decisions while maintaining your technical expertise. A word of advice, however—unless you know for *sure* you're going to throw it away, take the time to write the *best* production-ready code you can. It could very well end up in production.

![](_page_464_Picture_8.jpeg)

#### Pay back some technical debt

![](_page_464_Picture_10.jpeg)

Almost every development team accumulates *technical debt* (needed changes that are deferred to a later time). Help your team out by addressing some of it. They'll appreciate it, and if you get called away, it won't hold them up.

![](_page_464_Picture_12.jpeg)

#### Get involved during production outages

When an outage strikes, step in to assist, if you can. Help your development team identify the root cause and make the code changes needed to get the system back up and running. This also gives you an opportunity to see the detailed implementation of your architecture.

![](_page_464_Picture_15.jpeg)

#### Do lots of code reviews

No one *likes* doing code reviews. But it's a good way to stay involved, and it helps you make sure the source code stays aligned with your architectural decisions.

stay continuously

# #2 Expectations for architects

We've talked a lot in this book about architecture, but not so much about the *role* of a software architect. While the specifics will vary from company to company, here are some things any software architect will be expected to do, regardless of title.

![](_page_465_Picture_3.jpeg)

## **Make architectural decisions**

An architect is expected to define architectural decisions and design principles and use them to guide technology decisions within the team, the

## **Keep current with the latest trends**

To remain relevant (and retain a job!), developers must keep up to date on technical and industry trends. For architects, it's even *more* critical to keep current. Doing so helps you prepare for the future and

## department, and/or across the enterprise. **Continually analyze the architecture**

An architect is expected to always be analyzing the current architecture and technology environment and making recommendations for solutions and improvements. This continuous analysis is a way of checking for *architectural vitality*—that is, how viable the architecture still is, given constant changes in business and technology.

## make correct decisions. **Ensure compliance with the architecture**

Architects should continually verify that the development teams are following the approved architectural decisions and design principles. This is called *architectural governance*. Regardless of how good the architecture is, the system won't work unless everyone adheres to your architectural decisions.

# Cultivate diverse exposures / know a little about a lot of things. and experiences

An architect is expected to be familiar with technologies, frameworks, platforms, and environments of all sorts. This doesn't mean you need to be an expert in all of them, but you should have some knowledge of what's out there.

As an architect, it's important to More about this in a few!

## Possess exceptional interpersonal skills

Having exceptional leadership and interpersonal skills is important. Typically, technologists, developers, and architects prefer to solve technical problems, not *people* problems. But an architect is expected to provide technical guidance to the team and lead them through implementing the architecture. Leadership skills are at least half of what it takes to become an effective software architect, regardless of your role or title.

![](_page_466_Figure_6.jpeg)

The American computer scientist Gerald Weinburg is famous for saying, "No matter how it looks at first, it's always a people problem" (https:// oreilly/wyDB8).

#### **Know the business** domain

Effective software architects understand the business domain of a problem space. Without knowing what the business does and how, it's difficult to understand the problem, goals, and requirements well enough to design an effective architecture.

## Understand and navigate office politics

Many people will challenge your decisions. Product owners, project managers, and business stakeholders may see a solution as too costly or not fast enough to implement. Developers and other architects may challenge your approach if they feel theirs is better. You'll be expected to make a case for what you propose. You must navigate office politics and apply basic negotiation skills to get your decisions approved.

## <span id="page-467-0"></span>#3 The soft skills of architecture

Like we said on the last page, at *least* half of being a software architect is having great people skills. You'll need them to lead and guide your development team, gain the respect of your peers, and get everyone to agree to a common vision and direction.

We call these "soft" skills, but they are hard skills to acquire. Using them effectively requires years of practice and trial and error. Here are some soft skill techniques to help you become a more effective software architect.

![](_page_467_Picture_4.jpeg)

#### Demonstrate, don't discuss

Rather than arguing a point with another architect or development team, *demonstrate* it. Every environment is different, which is why simply Googling never yields correct answers. When you compare the options in a production-like environment and show the results, there's little room for argument.

Say it with us: "Demonstration defeats discussion."

![](_page_467_Figure_8.jpeg)

![](_page_467_Picture_9.jpeg)

#### Know when to fight and when to let go

Choosing your battles wisely is the mark of a great leader and makes you a reasonable person to work with. It gains you respect. Fight to the death for something that's crucial to making the architecture work, but let things go if they're not so important.

Choosing your battles is good advice, even outside of software architecture. You're welcome.

#### Focus on business value

When talking with business stakeholders, describe your decision or solution in terms of its *business value*. Business stakeholders aren't interested in things like fault tolerance or testability—they care about things like time to market, regulatory compliance, and mergers and acquisitions. Translate your technical concerns into business ones and you'll be speaking their language.

![](_page_467_Picture_15.jpeg)

<span id="page-468-0"></span>![](_page_468_Picture_1.jpeg)

#### **Involve developers in your architectural decisions**

We have learned two basic leadership rules over the years:

**Rule Number 1:** If developers don't know *why* you made a decision, they are less likely to agree with it.

**Rule Number 2:** If developers aren't *involved* in a decision, they are less likely to follow it.

Keep your developers involved. Collaborate by asking their opinions about a particular decision, involving them in a risk-storming exercise, or using the Request for Comment status in an ADR. Always justify your architectural decisions—and make sure everyone on the development team understands that justification. This is the ADR

## **Divide and conquer**

In the book *The Art of War*, the ancient Chinese warrior Sun Tzu advises, "If your enemy's forces are united, separate them." You can use this tactic when faced with all-or-nothing situations. Do *all* parts of the system need 400 ms response times or 99.999% availability? Dividing the problem into parts can help you identify what's hard to achieve, which makes negotiation easier.

![](_page_468_Picture_9.jpeg)

![](_page_468_Picture_10.jpeg)

## **Keep things simple, clear, and concise**

Nothing helps an architect gain respect and trust better than being able to explain things in clear, concise terms. It makes you more approachable. People will *want* to ask you things and get you involved. We call this the "four Cs" of architecture—be **C**lear, be **C**oncise, **C**ommunicate, and **C**ollaborate. You need all four to become an effective software architect.

#### **Be available to your development team**

Nothing is more frustrating for a developer or business stakeholder than having a critical question come up when you aren't around to answer it. Make sure not to spread yourself too thin—*be there for your team*.

Blocking out your calendar early in the morning or late in the afternoon is a great way to ensure you don't get cooped up in meetings all day. Use that time to collaborate with your development team and be available to answer their questions. They'll be grateful for it, and you will gain a lot of respect.

![](_page_468_Picture_16.jpeg)

# <span id="page-469-0"></span>**\*4** Piagramming techniques

Back in Chapter 3, we discussed ADRs as the best way to document the analysis process that leads to a decision. Another common method architects use to document architecture is *diagrams*. Architecture diagrams illustrate many important details that team members benefit from visualizing, such as structure, topology, communication, dependencies, and integration points.

This topic can (and does) fill entire books. We're just here to provide some quick tips to make your diagrams better, regardless of how you create them.

![](_page_469_Picture_4.jpeg)

## Keep it simple

Don't try to create comprehensive architecture diagrams that include *every detail*. If you do, your diagrams will suffer from the "hairball effect"—becoming too complex and dense to understand.

#### Always include a title

Most architecture diagrams represent a view or perspective, and your title should make yours explicit.

# Use unidirectional arrows to represent communication

Double-headed arrows are ambiguous. Did the author intend to indicate two-way communications, or is just that the default arrow?

Using *unidirectional arrows* removes all ambiguity and makes documentation more explicit.

![](_page_469_Figure_12.jpeg)

#### Use real labels, not acronyms

Only insiders understand acronyms. *Spell things out* whenever possible to avoid confusion and eliminate the need for extra documentation.

![](_page_469_Figure_15.jpeg)

![](_page_469_Figure_16.jpeg)

Use clear titles for your diagrams.

Single-headed

arrows remove

## <span id="page-470-0"></span>**Use solid lines for sync and dotted for async communication**

Architects need a way to specify whether communication is synchronous (blocking) or asynchronous (nonblocking). A solid line is common shorthand for synchronous communication, and a dotted one represents the asynchronous alternative.

## **Use consistent shapes and colors**

Don't use arbitrary shapes to try to save room; consistent shapes and colors cut down on the visual "noise" created by needless inconsistency.

![](_page_470_Figure_5.jpeg)

![](_page_470_Figure_6.jpeg)

Event handler External system Event handler written and maintained by internal team External system accessed through a standard API Asynchronous call Synchronous call Operational database

## **Always include a key**

Just about the only universal shape in software diagrams is the database cylinder. Pretty much everything else is up for grabs. Don't make your viewers guess! Adding an *explicit key* makes the diagram accessible to a broader audience, with less extra documentation.

# <span id="page-471-0"></span>#5 Knowledge depth versus breadth

The knowledge base of An unexpected thing happens to your brain when you a super-excited junior Stuff become a software architect—the new role *changes the* developer - "I can't you know believe I get paid to kinds of things you seek out and learn. Consider this structure, which categorizes all the information in the Stuff you know world, as far as you know at the beginning of your career. vou don't know

Early in your career, there's a lot you don't know that you'll need to know.

Junior developer knowledge pyramid

Stuff you don't know

vou don't know

![](_page_471_Figure_5.jpeg)

Senior developer/tech lead

Over time, as you gather more expertise and become the go-to person, you start to grow the middle part We can tell you -Stuff of the pyramid—the "stuff you know you don't finding out about you know know." Because you're maintaining your hardcore this stuff is a technical skills as well (the "stuff you know"), it takes pretty humbling a lot of effort to get to this point. Congratulations! Stuff you know experience. you don't know Stuff you don't know you don't know Junior architect

<span id="page-472-0"></span>![](_page_472_Picture_1.jpeg)

Your *technical* **depth** consists of every topic on which you have expertise.

Stuff you Remaining an expert in any technology requires investing time to keep up with constant change.

Thus, maintaining technical depth takes time.

Your *technical* **breadth** includes the areas in which you have expertise, what you know about the existence of other solutions, and what you know about some of these solutions' trade-offs. As an architect, knowing that there are five different ways to solve a problem is better than deeply knowing *one* way to solve it.

New architects' knowledge pyramids start out looking like those of tech leads, but you should make an effort to broaden your experience base. If you have expertise in .NET, for example, see if you can do some work on a Java project, a user interface—heavy Javascript project, or a hard data architecture problem... you get the idea.

![](_page_472_Figure_6.jpeg)

![](_page_472_Figure_7.jpeg)

# <span id="page-473-0"></span>#6 Practicing architecture with katas

The legendary martial artist and actor Bruce Lee once said, "I fear not the man who has practiced 10,000 kicks once, but I fear the man who has practiced one kick 10,000 times." So how do you attain that kind of proficiency with software architecture? Glad you asked! We recommend *architectural katas*.

A *kata* is an individual form of exercise used in many martial arts to practice moves until they're perfected. In the same spirit, architectural katas simulate the process of designing a real architecture.

Architectural katas are intended for several small groups of three to five people. Each group becomes a project team and works on a different kata. (We sometimes get two teams to do each kata, just to see what differences arise.) A moderator keeps track of time and facilitates the exercise.

The moderator assigns each group a project needing development. The team meets for a while, asking questions of the "customer" (the moderator) for clarification. They discuss technology options that could work and sketch out a rough vision of their solution. Then they present their solution to the other project teams and answer challenges (hard but fair questions). Choosing an overall winner is optional.

How do you get better at anything in life? Practice, practice, practice.

![](_page_473_Picture_7.jpeg)

The key to getting better at software architecture is to practice it—even in a simulated exercise.

> Do we have your attention? Keep reading to find out more.

# <span id="page-474-0"></span>How to run katas

Katas are meant to be an adaptable exercise, so follow the rules below *when they make sense* for your organization, context, and needs. Any questions not covered by these rules are the domain of the moderator.

#### Preparation

Gather several teams of three to five people. (We prefer odd numbers, so disputes can be decided by a majority.) Generally, people who work together in the real world should not be on the same teams; this exercise stresses collaborating with other architects you don't already know.

Gather supplies like poster paper or whiteboards. The artifacts you produce may be very low-tech, depending on the time, complexity, and resources you commit.

Speaking of time, a kata exercise could take as little as 45 minutes or last as long as several weeks!

![](_page_474_Picture_7.jpeg)

Your authors have done several katas for real companies that gave teams eight weeks to work out a solution.

![](_page_474_Picture_9.jpeg)

#### Discussion

The teams get together and work through the exact process outlined in this book: analyzing architectural characteristics, determining logical components, choosing an architectural style, and documenting their decisions.

Any technology is fair game, although you should honor reasonable constraints (you won't have an unlimited budget or get to hire new developers). The focus is on architecture and trade-off analysis.

![](_page_474_Picture_13.jpeg)

## Presentation

Each team presents its solution and answers questions.

When you are listening to another project team presenting, your job is to ask questions. Try to keep them constructive. Don't focus on only the good parts of the solution or only the deficiencies. Strive for balanced feedback.

I feel like there's so much more to know. Are there are any other resources I can reach for?

![](_page_475_Picture_1.jpeg)

You don't know about the website? It has updates, interesting links and posts, and much more!

# Don't worry. This isn't goodbye.

Congratulations on reading all the way to the end and doing all the exercises! Job well done.

In case you haven't noticed, you've come a long way in this book—and your software architecture journey is just getting started. We'd like to suggest some next steps.

First, point your browser to <a href="https://www.headfirstsoftwarearchitecture.com">https://www.headfirstsoftwarearchitecture.com</a> to learn what's next! Then check out the books below.

# What's next? So much more!

Start here. While some of the material may seem familiar, it's a worthy successor to this book.

![](_page_475_Figure_9.jpeg)

![](_page_475_Figure_10.jpeg)

This title is most apropos. Dive deep into the really hard parts of software architecture with this book.

# **Index**

| A                                                                                                                                                                                                                                                                                                                                                                                                                       | accessibility 55, 56, 74                                                                                                                                                                                               | architectural style and 43          |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
| Accepted status (ADRs) 100                                                                                                                                                                                                                                                                                                                                                                                              | auditability 44                                                                                                                                                                                                        | balancing 69                        |
| access control 313                                                                                                                                                                                                                                                                                                                                                                                                      | capabilities and 68                                                                                                                                                                                                    | categories 48                       |
| accessibility 55, 56, 74                                                                                                                                                                                                                                                                                                                                                                                                | composite 63                                                                                                                                                                                                           | consistency 44                      |
| actor/action approach to logical architecture 135, 137                                                                                                                                                                                                                                                                                                                                                                  | cross-cutting 55                                                                                                                                                                                                       | data integrity 44                   |
| ADRs (architectural decision records) 97, 114, 292                                                                                                                                                                                                                                                                                                                                                                      | defining 45, 46                                                                                                                                                                                                        | deployability 56, 74                |
| benefits of 112                                                                                                                                                                                                                                                                                                                                                                                                         | domain requirements 60                                                                                                                                                                                                 | domains 44                          |
| collaboration and 107                                                                                                                                                                                                                                                                                                                                                                                                   | driving 292                                                                                                                                                                                                            | explicit 50                         |
| Consequences section 107, 114, 120, 288                                                                                                                                                                                                                                                                                                                                                                                 | from environmental awareness and 6                                                                                                                                                                                     | from holistic domain knowledge 61   |
| Context section 104, 114                                                                                                                                                                                                                                                                                                                                                                                                | from problem domain 60                                                                                                                                                                                                 | implicit 50, 292, 408               |
| context versus justification 106                                                                                                                                                                                                                                                                                                                                                                                        | limiting 48, 70                                                                                                                                                                                                        | maintainability 56, 74              |
| decision-capturing tools 111                                                                                                                                                                                                                                                                                                                                                                                            | modularity 56, 74                                                                                                                                                                                                      | modular monolithic architecture 235 |
| Decision section 105, 114, 119                                                                                                                                                                                                                                                                                                                                                                                          | numbers 69                                                                                                                                                                                                             | operational 54                      |
| documentation and 414                                                                                                                                                                                                                                                                                                                                                                                                   | overengineering and 48                                                                                                                                                                                                 | planning stages 281                 |
| editing 102                                                                                                                                                                                                                                                                                                                                                                                                             | priorities 64                                                                                                                                                                                                          | privacy 55                          |
| exercises 297–299                                                                                                                                                                                                                                                                                                                                                                                                       | process 52                                                                                                                                                                                                             | reliability 44                      |
| file naming 111                                                                                                                                                                                                                                                                                                                                                                                                         | robustness 56, 74                                                                                                                                                                                                      | scalability 44, 56, 74              |
| Governance section 109, 114                                                                                                                                                                                                                                                                                                                                                                                             | security 44                                                                                                                                                                                                            | sources 59                          |
| immutability 102                                                                                                                                                                                                                                                                                                                                                                                                        | structural 53                                                                                                                                                                                                          | synergy 48–49                       |
| multiple projects 111                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                        |                                     |
| Notes section 109, 114                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                        |                                     |
| opinion and 105                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                        |                                     |
| Status section 100–101                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                        |                                     |
| storage 111                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                        |                                     |
| Title section 99, 114                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                        |                                     |
| visualization flowchart 103                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                        |                                     |
| afferent coupling (CA) 146, 154                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                        |                                     |
| measuring 148–149                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                        |                                     |
| agility 52, 85                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                        |                                     |
| architects                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                        |                                     |
| coding architects 428–429                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                        |                                     |
| development team and 433                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                        |                                     |
| soft skills 432                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                        |                                     |
| architectural characteristics 4, 6–7, 27                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                        |                                     |
| abundance 48                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                        |                                     |
| usability 44, 55                                                                                                                                                                                                                                                                                                                                                                                                        | spectrum with design 18–19                                                                                                                                                                                             |                                     |
| zoo metaphor 51                                                                                                                                                                                                                                                                                                                                                                                                         | structure 3                                                                                                                                                                                                            |                                     |
| architectural decision records (ADRs). See ADRs (architectural decision records)                                                                                                                                                                                                                                                                                                                                        | Architecture Tradeoff Analysis Method (ATAM) 9                                                                                                                                                                         |                                     |
| architectural decisions 4–5, 8, 27, 114. See also ADRs (architectural decision records)<br>architecture/design spectrum 20–21<br>as guides versus rules 93                                                                                                                                                                                                                                                              | asynchronous communication 361, 389<br>architecture style selection and 412<br>benefits 365–366<br>diagramming 435<br>EDA and 363                                                                                      |                                     |
| examples 93                                                                                                                                                                                                                                                                                                                                                                                                             | versus synchronous communication 362–366                                                                                                                                                                               |                                     |
| planning stages 281                                                                                                                                                                                                                                                                                                                                                                                                     | ATAM (Architecture Tradeoff Analysis Method) 9                                                                                                                                                                         |                                     |
| Second Law of Software Architecture 96<br>strategic 19                                                                                                                                                                                                                                                                                                                                                                  | authentication 55                                                                                                                                                                                                      |                                     |
| strategic versus tactical 20–21                                                                                                                                                                                                                                                                                                                                                                                         | authorization 55                                                                                                                                                                                                       |                                     |
| tactical 19<br>trade-offs 19, 24                                                                                                                                                                                                                                                                                                                                                                                        | <b>B</b>                                                                                                                                                                                                               |                                     |
| Two Many Sneakers 94                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                        |                                     |
| whys 96                                                                                                                                                                                                                                                                                                                                                                                                                 | behavior of logical components 68                                                                                                                                                                                      |                                     |
| architectural perspective 17                                                                                                                                                                                                                                                                                                                                                                                            | blueprints 3                                                                                                                                                                                                           |                                     |
| architectural styles 4, 12–13, 27, 168                                                                                                                                                                                                                                                                                                                                                                                  | broadcasting model 86                                                                                                                                                                                                  |                                     |
| architectural characteristics and 43                                                                                                                                                                                                                                                                                                                                                                                    | building plans 3                                                                                                                                                                                                       |                                     |
| distributed. See distributed architectures<br>event-driven architecture 12                                                                                                                                                                                                                                                                                                                                              | <b>C</b>                                                                                                                                                                                                               |                                     |
| hybrid 292                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                        |                                     |
| layered architecture 12                                                                                                                                                                                                                                                                                                                                                                                                 | capabilities, architectural characteristics 68                                                                                                                                                                         |                                     |
| logical components and 43                                                                                                                                                                                                                                                                                                                                                                                               | CBAM (Cost Benefit Analysis Method) 92                                                                                                                                                                                 |                                     |
| microkernel 286–287<br>microservices 12, 169                                                                                                                                                                                                                                                                                                                                                                            | choreography 328–331<br>granularity and 314–317                                                                                                                                                                        |                                     |
| monolithic. See monolithic architecture                                                                                                                                                                                                                                                                                                                                                                                 | code                                                                                                                                                                                                                   |                                     |
| planning documentation 288–289                                                                                                                                                                                                                                                                                                                                                                                          | proof-of-concept code 429                                                                                                                                                                                              |                                     |
| planning stages 281                                                                                                                                                                                                                                                                                                                                                                                                     | reviews, coding architects and 429                                                                                                                                                                                     |                                     |
| selecting 13, 286–287, 412                                                                                                                                                                                                                                                                                                                                                                                              | shared libraries 320                                                                                                                                                                                                   |                                     |
| architecture                                                                                                                                                                                                                                                                                                                                                                                                            | shared services 320–321                                                                                                                                                                                                |                                     |
| building plans 3                                                                                                                                                                                                                                                                                                                                                                                                        | volatility, microservices and 313                                                                                                                                                                                      |                                     |
| versus design 15                                                                                                                                                                                                                                                                                                                                                                                                        | code sharing                                                                                                                                                                                                           |                                     |
| distributed 47                                                                                                                                                                                                                                                                                                                                                                                                          | microservices and 318                                                                                                                                                                                                  |                                     |
| gardening exercise 2                                                                                                                                                                                                                                                                                                                                                                                                    | shared libraries 321                                                                                                                                                                                                   |                                     |
| house 2                                                                                                                                                                                                                                                                                                                                                                                                                 | coding architects 428                                                                                                                                                                                                  |                                     |
| interconnectedness 5                                                                                                                                                                                                                                                                                                                                                                                                    | cohesion, microservices and 313                                                                                                                                                                                        |                                     |
| logical versus physical 127–128<br>monolithic 47                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                        |                                     |
| need for 2                                                                                                                                                                                                                                                                                                                                                                                                              | collaboration, ADRs and 107                                                                                                                                                                                            |                                     |
| planning 280–286                                                                                                                                                                                                                                                                                                                                                                                                        | communications, EDA versus microservices 380                                                                                                                                                                           |                                     |
| compliance 55                                                                                                                                                                                                                                                                                                                                                                                                           | design 18                                                                                                                                                                                                              |                                     |
| component coupling 144, 154. See also logical components<br>afferent coupling (CA) 146                                                                                                                                                                                                                                                                                                                                  | spectrum with architecture 18–21<br>versus architecture 15                                                                                                                                                             |                                     |
| choreography 329                                                                                                                                                                                                                                                                                                                                                                                                        | design perspective 16                                                                                                                                                                                                  |                                     |
| efferent coupling (CE) 147, 154                                                                                                                                                                                                                                                                                                                                                                                         | device-assessment service core 255                                                                                                                                                                                     |                                     |
| First Law of Software Architecture and 153                                                                                                                                                                                                                                                                                                                                                                              | diagramming                                                                                                                                                                                                            |                                     |
| Law of Demeter and 148–152<br>measuring 148–149<br>orchestration and 327<br>tightly coupled systems 150–153<br>total coupling (CT) 148<br>composite architectural characteristics 63                                                                                                                                                                                                                                    | asynchronous communications 435<br>communications 434<br>key 435<br>labels 434<br>microservices architecture 425<br>physical architecture 290–291                                                                      |                                     |
| Cost Benefit Analysis Method (CBAM) 92                                                                                                                                                                                                                                                                                                                                                                                  | physical architecture key 416                                                                                                                                                                                          |                                     |
| cross-cutting requirements 58                                                                                                                                                                                                                                                                                                                                                                                           | shapes and colors, consistency 435<br>title 434                                                                                                                                                                        |                                     |
| D                                                                                                                                                                                                                                                                                                                                                                                                                       | dimensions 4, 14                                                                                                                                                                                                       |                                     |
| Database layer 189                                                                                                                                                                                                                                                                                                                                                                                                      | distributed architectures 47, 172, 180                                                                                                                                                                                 |                                     |
| database-per-service pattern 374–375, 389                                                                                                                                                                                                                                                                                                                                                                               | deployment models<br>pros and cons 174, 176–177<br>relevance 178–179                                                                                                                                                   |                                     |
| databases                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                        |                                     |
| diagramming 290<br>domain-partitioned 389<br>EDAs 385<br>foreign keys 315<br>modular monolithic architecture 231<br>topologies 369–374, 389                                                                                                                                                                                                                                                                             | distributed physical architecture<br>plugins 255<br>pros and cons 274<br>distributed plugins 257<br>calls 259<br>documentation 288–289                                                                                 |                                     |
| transactions, granularity and 314–317                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                        |                                     |
| data coupling 315                                                                                                                                                                                                                                                                                                                                                                                                       | domain-based alignment 234                                                                                                                                                                                             |                                     |
| data dependencies 314–317                                                                                                                                                                                                                                                                                                                                                                                               | domain-driven design (DDD) 137                                                                                                                                                                                         |                                     |
| data ownership 308–309                                                                                                                                                                                                                                                                                                                                                                                                  | domain-partitioned architecture 170–171                                                                                                                                                                                |                                     |
| DDD (domain-driven design) 137                                                                                                                                                                                                                                                                                                                                                                                          | domain-partitioned databases 372–373, 389                                                                                                                                                                              |                                     |
| deployability 52, 56, 74<br>layered architecture 205<br>microservices architecture 332<br>deployment models 169, 180<br>distributed systems<br>pros and cons 174, 176–177<br>monolithic architectures<br>pros and cons 174–175                                                                                                                                                                                          | domains 11<br>characteristics 46<br>holistic domain knowledge 61<br>partitioning<br>modular monoliths 234<br>subdomains 238<br>driving characteristics 418<br>implicit characteristics 292                             |                                     |
| derived events 356–357, 389                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                        |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | events                                                                                                                                                                                                                 |                                     |
| E                                                                                                                                                                                                                                                                                                                                                                                                                       | compared to messages 356–357, 389                                                                                                                                                                                      |                                     |
| Eclipse IDE 253                                                                                                                                                                                                                                                                                                                                                                                                         | derived events 356–357, 389                                                                                                                                                                                            |                                     |
| EDA (event-driven architecture) 12, 351                                                                                                                                                                                                                                                                                                                                                                                 | initiating events 356–357, 389                                                                                                                                                                                         |                                     |
| analysis 423                                                                                                                                                                                                                                                                                                                                                                                                            | event storming 137                                                                                                                                                                                                     |                                     |
| asynchronous communication 361, 363, 389                                                                                                                                                                                                                                                                                                                                                                                | evolvability                                                                                                                                                                                                           |                                     |
| complexity 385                                                                                                                                                                                                                                                                                                                                                                                                          | EDAs 384                                                                                                                                                                                                               |                                     |
| databases 385                                                                                                                                                                                                                                                                                                                                                                                                           | microservices architecture 332                                                                                                                                                                                         |                                     |
| drawbacks 385                                                                                                                                                                                                                                                                                                                                                                                                           | explicit architectural characteristics 50                                                                                                                                                                              |                                     |
| events 354, 389                                                                                                                                                                                                                                                                                                                                                                                                         | extensibility 52, 53, 389                                                                                                                                                                                              |                                     |
| evolvability 384                                                                                                                                                                                                                                                                                                                                                                                                        | EDAs 356                                                                                                                                                                                                               |                                     |
| extensibility 356                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                        |                                     |
| fault tolerance 384                                                                                                                                                                                                                                                                                                                                                                                                     | F                                                                                                                                                                                                                      |                                     |
| maintainability 384                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                        |                                     |
| messages, events 355                                                                                                                                                                                                                                                                                                                                                                                                    | fault tolerance                                                                                                                                                                                                        |                                     |
| versus microservices 380–382, 412                                                                                                                                                                                                                                                                                                                                                                                       | EDAs 384                                                                                                                                                                                                               |                                     |
| Notification Analytics 356                                                                                                                                                                                                                                                                                                                                                                                              | microservices and 313                                                                                                                                                                                                  |                                     |
| performance 384                                                                                                                                                                                                                                                                                                                                                                                                         | microservices architecture 332                                                                                                                                                                                         |                                     |
| scalability 384                                                                                                                                                                                                                                                                                                                                                                                                         | file naming, ADRs 111                                                                                                                                                                                                  |                                     |
| star ratings 206, 386                                                                                                                                                                                                                                                                                                                                                                                                   | fire-and-forget 389. See also<br>asynchronous communication                                                                                                                                                            |                                     |
| superpowers 384                                                                                                                                                                                                                                                                                                                                                                                                         | First Law of<br>Software Architecture 90, 114                                                                                                                                                                          |                                     |
| synchronous calls 385                                                                                                                                                                                                                                                                                                                                                                                                   | component coupling and 153                                                                                                                                                                                             |                                     |
| testability 385                                                                                                                                                                                                                                                                                                                                                                                                         | layered architecture and 203                                                                                                                                                                                           |                                     |
| efferent coupling (CE) 147, 154                                                                                                                                                                                                                                                                                                                                                                                         | foreign keys 315                                                                                                                                                                                                       |                                     |
| measuring 148–149                                                                                                                                                                                                                                                                                                                                                                                                       | Fowler, Martin 22                                                                                                                                                                                                      |                                     |
| elasticity, layered architecture 205                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                        |                                     |
| electronics recycling program 139                                                                                                                                                                                                                                                                                                                                                                                       | Front Controller pattern 328                                                                                                                                                                                           |                                     |
| embedded/mobile architecture 199                                                                                                                                                                                                                                                                                                                                                                                        | G                                                                                                                                                                                                                      |                                     |
| encapsulated plugins 257                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                        |                                     |
| encryption 55                                                                                                                                                                                                                                                                                                                                                                                                           | Grains of<br>Sand pattern 311                                                                                                                                                                                          |                                     |
| entity trap 136                                                                                                                                                                                                                                                                                                                                                                                                         | granularity, microservices 311, 336                                                                                                                                                                                    |                                     |
| environmental awareness 61                                                                                                                                                                                                                                                                                                                                                                                              | balance 316, 336                                                                                                                                                                                                       |                                     |
| error handling                                                                                                                                                                                                                                                                                                                                                                                                          | disintegrators 311–313, 316                                                                                                                                                                                            |                                     |
| choreography 329                                                                                                                                                                                                                                                                                                                                                                                                        | integrators 314–317, 336                                                                                                                                                                                               |                                     |
| orchestration and 327                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                        |                                     |
| event-driven architecture (EDA). See<br>EDA (event-driven                                                                                                                                                                                                                                                                                                                                                               | H                                                                                                                                                                                                                      |                                     |
| architecture                                                                                                                                                                                                                                                                                                                                                                                                            | heterogeneous 88                                                                                                                                                                                                       |                                     |
| event-driven microservices 382–383                                                                                                                                                                                                                                                                                                                                                                                      | house architecture 2–13                                                                                                                                                                                                |                                     |
| event processing 389                                                                                                                                                                                                                                                                                                                                                                                                    | hybrid architecture 292, 418                                                                                                                                                                                           |                                     |
| EDA versus microservices 380                                                                                                                                                                                                                                                                                                                                                                                            | event-driven microservices 382–383, 389                                                                                                                                                                                |                                     |
| I                                                                                                                                                                                                                                                                                                                                                                                                                       | Persistence layer 189                                                                                                                                                                                                  |                                     |
| implicit characteristics 50, 408                                                                                                                                                                                                                                                                                                                                                                                        | physical architecture 198-200                                                                                                                                                                                          |                                     |
| driving characteristics 292, 418                                                                                                                                                                                                                                                                                                                                                                                        | Presentation layer 189                                                                                                                                                                                                 |                                     |
| infrastructure, queues and 108                                                                                                                                                                                                                                                                                                                                                                                          | quick builds 204                                                                                                                                                                                                       |                                     |
| initiating events 356-357, 389                                                                                                                                                                                                                                                                                                                                                                                          | reasons for layers 202                                                                                                                                                                                                 |                                     |
| inventory management 26, 124                                                                                                                                                                                                                                                                                                                                                                                            | scalability 205                                                                                                                                                                                                        |                                     |
| iterative approach 43                                                                                                                                                                                                                                                                                                                                                                                                   | specialization 198                                                                                                                                                                                                     |                                     |
| J                                                                                                                                                                                                                                                                                                                                                                                                                       | technically partitioned 193, 204                                                                                                                                                                                       |                                     |
| Jenkins (continuous integration) 253                                                                                                                                                                                                                                                                                                                                                                                    | testability 205                                                                                                                                                                                                        |                                     |
| joins between databases 233                                                                                                                                                                                                                                                                                                                                                                                             | Workflow layer 189                                                                                                                                                                                                     |                                     |
| JPMS (Java Platform Module System) 229                                                                                                                                                                                                                                                                                                                                                                                  | layered monolithic architecture                                                                                                                                                                                        |                                     |
| K                                                                                                                                                                                                                                                                                                                                                                                                                       | analysis 296                                                                                                                                                                                                           |                                     |
| katas 438-439                                                                                                                                                                                                                                                                                                                                                                                                           | planning stage 286-287                                                                                                                                                                                                 |                                     |
| knowledge pyramid 436                                                                                                                                                                                                                                                                                                                                                                                                   | uses 300                                                                                                                                                                                                               |                                     |
| L                                                                                                                                                                                                                                                                                                                                                                                                                       | libraries, shared 321, 322, 336, 343                                                                                                                                                                                   |                                     |
| Law of Demeter 148-152, 154                                                                                                                                                                                                                                                                                                                                                                                             | linters 253                                                                                                                                                                                                            |                                     |
| layered architecture 12                                                                                                                                                                                                                                                                                                                                                                                                 | localization 53                                                                                                                                                                                                        |                                     |
| capabilities, sorting by 195                                                                                                                                                                                                                                                                                                                                                                                            | logical architecture                                                                                                                                                                                                   |                                     |
| component placement 196                                                                                                                                                                                                                                                                                                                                                                                                 | actor/action approach 134-135, 137                                                                                                                                                                                     |                                     |
| components 192                                                                                                                                                                                                                                                                                                                                                                                                          | assigning requirements 138                                                                                                                                                                                             |                                     |
| Database layer 189                                                                                                                                                                                                                                                                                                                                                                                                      | characteristics analysis 142                                                                                                                                                                                           |                                     |
| data-intensiveness 204                                                                                                                                                                                                                                                                                                                                                                                                  | cohesion 141                                                                                                                                                                                                           |                                     |
| deployability 205                                                                                                                                                                                                                                                                                                                                                                                                       | components 127, 130-131, 144-147                                                                                                                                                                                       |                                     |
| diagramming layers 290                                                                                                                                                                                                                                                                                                                                                                                                  | creating 129                                                                                                                                                                                                           |                                     |
| domain changes 203                                                                                                                                                                                                                                                                                                                                                                                                      | entity trap 136                                                                                                                                                                                                        |                                     |
| downsides 205                                                                                                                                                                                                                                                                                                                                                                                                           | roles and responsibilities 140-141                                                                                                                                                                                     |                                     |
| ease of reuse 198                                                                                                                                                                                                                                                                                                                                                                                                       | versus physical architecture 127-128, 157                                                                                                                                                                              |                                     |
| elasticity 205                                                                                                                                                                                                                                                                                                                                                                                                          | workflow approach 132, 137                                                                                                                                                                                             |                                     |
| feasibility 204                                                                                                                                                                                                                                                                                                                                                                                                         | logical components 4, 10-11, 27, 154                                                                                                                                                                                   |                                     |
| First Law of Software Architecture 203                                                                                                                                                                                                                                                                                                                                                                                  | afferent coupling (CA) 146-148                                                                                                                                                                                         |                                     |
| MVC and 188, 198                                                                                                                                                                                                                                                                                                                                                                                                        | architectural style and 43                                                                                                                                                                                             |                                     |
| namespaces 192                                                                                                                                                                                                                                                                                                                                                                                                          | behavior and 68                                                                                                                                                                                                        |                                     |
| packages 192                                                                                                                                                                                                                                                                                                                                                                                                            | characteristics analysis 142                                                                                                                                                                                           |                                     |
| performance 204                                                                                                                                                                                                                                                                                                                                                                                                         | cohesion 141                                                                                                                                                                                                           |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | component coupling 144                                                                                                                                                                                                 |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | design and 45                                                                                                                                                                                                          |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | efferent coupling (CE) 147                                                                                                                                                                                             |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | entity trap and 136, 154                                                                                                                                                                                               |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | identifying 284-285, 410                                                                                                                                                                                               |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | measuring 148                                                                                                                                                                                                          |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | monolithic architectures 172                                                                                                                                                                                           |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                        |                                     |
| planning stages 281                                                                                                                                                                                                                                                                                                                                                                                                     | balance 316, 336                                                                                                                                                                                                       |                                     |
| requirements 138                                                                                                                                                                                                                                                                                                                                                                                                        | choreography 328–331, 345                                                                                                                                                                                              |                                     |
| roles and responsibilities 11                                                                                                                                                                                                                                                                                                                                                                                           | code sharing 318–321                                                                                                                                                                                                   |                                     |
| source code repository directory 124–125                                                                                                                                                                                                                                                                                                                                                                                | common functionality 318                                                                                                                                                                                               |                                     |
| splitting by capability 195                                                                                                                                                                                                                                                                                                                                                                                             | complexity 333                                                                                                                                                                                                         |                                     |
| logical component system 45                                                                                                                                                                                                                                                                                                                                                                                             | data ownership 308–309                                                                                                                                                                                                 |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | deployability 332                                                                                                                                                                                                      |                                     |
| M                                                                                                                                                                                                                                                                                                                                                                                                                       | diagramming 425                                                                                                                                                                                                        |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | drawbacks 333                                                                                                                                                                                                          |                                     |
| maintainability 53, 56, 74                                                                                                                                                                                                                                                                                                                                                                                              | versus EDA 412                                                                                                                                                                                                         |                                     |
| EDAs 384                                                                                                                                                                                                                                                                                                                                                                                                                | evolvability 332                                                                                                                                                                                                       |                                     |
| microservices architecture 332                                                                                                                                                                                                                                                                                                                                                                                          | fault tolerance 332                                                                                                                                                                                                    |                                     |
| microkernel architecture                                                                                                                                                                                                                                                                                                                                                                                                | Grains of Sand pattern 311                                                                                                                                                                                             |                                     |
| adaptability 266                                                                                                                                                                                                                                                                                                                                                                                                        | granularity 311, 336                                                                                                                                                                                                   |                                     |
| analysis 296                                                                                                                                                                                                                                                                                                                                                                                                            | granularity disintegrators 311–313, 336                                                                                                                                                                                |                                     |
| core 251                                                                                                                                                                                                                                                                                                                                                                                                                | granularity integrators 314–315, 336                                                                                                                                                                                   |                                     |
| Decorator design pattern 262                                                                                                                                                                                                                                                                                                                                                                                            | maintainability 332                                                                                                                                                                                                    |                                     |
| device-assessment service core 255                                                                                                                                                                                                                                                                                                                                                                                      | monolithic databases 333                                                                                                                                                                                               |                                     |
| distributed 258                                                                                                                                                                                                                                                                                                                                                                                                         | orchestration 326–327, 336, 345                                                                                                                                                                                        |                                     |
| distributed physical architecture 255, 274                                                                                                                                                                                                                                                                                                                                                                              | performance 333                                                                                                                                                                                                        |                                     |
| drawbacks 267                                                                                                                                                                                                                                                                                                                                                                                                           | physical bounded contexts 308–309                                                                                                                                                                                      |                                     |
| Eclipse IDE 253                                                                                                                                                                                                                                                                                                                                                                                                         | reasons to use 306                                                                                                                                                                                                     |                                     |
| evolvability 266                                                                                                                                                                                                                                                                                                                                                                                                        | scalability 332                                                                                                                                                                                                        |                                     |
| insurance application 253                                                                                                                                                                                                                                                                                                                                                                                               | services 307, 310–311, 316                                                                                                                                                                                             |                                     |
| Jenkins Continuous Integration (CI) tool 253                                                                                                                                                                                                                                                                                                                                                                            | star ratings 334                                                                                                                                                                                                       |                                     |
| linters 253                                                                                                                                                                                                                                                                                                                                                                                                             | superpowers 332                                                                                                                                                                                                        |                                     |
| monoliths 256, 258, 270, 274                                                                                                                                                                                                                                                                                                                                                                                            | technically partitioned teams 333                                                                                                                                                                                      |                                     |
| partitions 266                                                                                                                                                                                                                                                                                                                                                                                                          | testability 332                                                                                                                                                                                                        |                                     |
| performance 267                                                                                                                                                                                                                                                                                                                                                                                                         | workflow 324–325, 333, 336                                                                                                                                                                                             |                                     |
| planning stages 286–287                                                                                                                                                                                                                                                                                                                                                                                                 | modularity 52, 56, 74                                                                                                                                                                                                  |                                     |
| plugins 251–252, 257–259, 267–268                                                                                                                                                                                                                                                                                                                                                                                       | modular monolithic architecture 219, 220, 238                                                                                                                                                                          |                                     |
| simplicity 266                                                                                                                                                                                                                                                                                                                                                                                                          | analysis 296                                                                                                                                                                                                           |                                     |
| star ratings 268                                                                                                                                                                                                                                                                                                                                                                                                        | architectural characteristics 235                                                                                                                                                                                      |                                     |
| synchronous communication 255                                                                                                                                                                                                                                                                                                                                                                                           | databases 231                                                                                                                                                                                                          |                                     |
| user interface 262                                                                                                                                                                                                                                                                                                                                                                                                      | domain-based alignment 234                                                                                                                                                                                             |                                     |
| uses 299, 302                                                                                                                                                                                                                                                                                                                                                                                                           | domain changes and 222–223                                                                                                                                                                                             |                                     |
| volatility 267                                                                                                                                                                                                                                                                                                                                                                                                          | domain partitioning 234                                                                                                                                                                                                |                                     |
| web browsers 253                                                                                                                                                                                                                                                                                                                                                                                                        | drawbacks 235                                                                                                                                                                                                          |                                     |
| microservices 169                                                                                                                                                                                                                                                                                                                                                                                                       | intermodule communication 238                                                                                                                                                                                          |                                     |
| defined 336                                                                                                                                                                                                                                                                                                                                                                                                             | maintainability 234                                                                                                                                                                                                    |                                     |
| versus EDA 378–380                                                                                                                                                                                                                                                                                                                                                                                                      | maintaining modularity 227–229                                                                                                                                                                                         |                                     |
| event-driven microservices 382–383, 389                                                                                                                                                                                                                                                                                                                                                                                 | modularity fragility 235                                                                                                                                                                                               |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | namespaces 224                                                                                                                                                                                                         |                                     |
| microservices architecture 12                                                                                                                                                                                                                                                                                                                                                                                           | operational characteristics 235                                                                                                                                                                                        |                                     |
| analysis 423                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                        |                                     |
| partitioning by technical concerns 219                                                                                                                                                                                                                                                                                                                                                                                  | partitioning 169, 180                                                                                                                                                                                                  |                                     |
| performance 234                                                                                                                                                                                                                                                                                                                                                                                                         | microkernel architecture 251, 266                                                                                                                                                                                      |                                     |
| planning stages 286–287                                                                                                                                                                                                                                                                                                                                                                                                 | modular monolithic architecture 219, 234                                                                                                                                                                               |                                     |
| reasons to use 222–223                                                                                                                                                                                                                                                                                                                                                                                                  | modules 219                                                                                                                                                                                                            |                                     |
| reuse in 235                                                                                                                                                                                                                                                                                                                                                                                                            | technically partitioned teams 333                                                                                                                                                                                      |                                     |
| star ratings 236                                                                                                                                                                                                                                                                                                                                                                                                        | performance 6, 54                                                                                                                                                                                                      |                                     |
| testability 234                                                                                                                                                                                                                                                                                                                                                                                                         | EDAs 384                                                                                                                                                                                                               |                                     |
| uses 298, 301                                                                                                                                                                                                                                                                                                                                                                                                           | EDA versus microservices 378                                                                                                                                                                                           |                                     |
| monolithic architecture 47, 169, 172, 180, 208                                                                                                                                                                                                                                                                                                                                                                          | orchestration and 327                                                                                                                                                                                                  |                                     |
| deployment models 174–175                                                                                                                                                                                                                                                                                                                                                                                               | Persistence layer 189, 193                                                                                                                                                                                             |                                     |
| layered 286–287, 296, 300                                                                                                                                                                                                                                                                                                                                                                                               | physical architecture                                                                                                                                                                                                  |                                     |
| analysis 296 microkernel architecture 256, 274                                                                                                                                                                                                                                                                                                                                                                          | components 127                                                                                                                                                                                                         |                                     |
| modular 298, 301. See modular monolithic architecture                                                                                                                                                                                                                                                                                                                                                                   | diagramming 290–291, 416                                                                                                                                                                                               |                                     |
| analysis 296                                                                                                                                                                                                                                                                                                                                                                                                            | distributed 255                                                                                                                                                                                                        |                                     |
| relevance 178                                                                                                                                                                                                                                                                                                                                                                                                           | pros and cons 274                                                                                                                                                                                                      |                                     |
| smartphone as 173                                                                                                                                                                                                                                                                                                                                                                                                       | embedded/mobile 199–200                                                                                                                                                                                                |                                     |
| monolithic databases 333, 370–371, 389                                                                                                                                                                                                                                                                                                                                                                                  | versus logical architecture 127–128, 157 tiered 199–200                                                                                                                                                                |                                     |
| MVC (Model-View-Controller) pattern 188–189, 193, 198                                                                                                                                                                                                                                                                                                                                                                   | physical bounded context                                                                                                                                                                                               |                                     |
| N                                                                                                                                                                                                                                                                                                                                                                                                                       | EDA versus microservices 378                                                                                                                                                                                           |                                     |
| namespaces 192                                                                                                                                                                                                                                                                                                                                                                                                          | microservices 308–309, 336                                                                                                                                                                                             |                                     |
| modular monolithic architecture 224                                                                                                                                                                                                                                                                                                                                                                                     | planning architecture 280                                                                                                                                                                                              |                                     |
| non-domain design 46                                                                                                                                                                                                                                                                                                                                                                                                    | architectural characteristics 281–283                                                                                                                                                                                  |                                     |
| nonfunctional requirements 43, 58                                                                                                                                                                                                                                                                                                                                                                                       | architectural decisions 281                                                                                                                                                                                            |                                     |
| notifications                                                                                                                                                                                                                                                                                                                                                                                                           | architectural style 281                                                                                                                                                                                                |                                     |
| trade-off analysis 88                                                                                                                                                                                                                                                                                                                                                                                                   | logical components 281                                                                                                                                                                                                 |                                     |
| Two Many Sneakers 83                                                                                                                                                                                                                                                                                                                                                                                                    | stakeholders input 292                                                                                                                                                                                                 |                                     |
| O                                                                                                                                                                                                                                                                                                                                                                                                                       | plugins                                                                                                                                                                                                                |                                     |
| operational architectural characteristics 54                                                                                                                                                                                                                                                                                                                                                                            | as components 256                                                                                                                                                                                                      |                                     |
| orchestration 326–327, 336                                                                                                                                                                                                                                                                                                                                                                                              | calling 259                                                                                                                                                                                                            |                                     |
| outages 429                                                                                                                                                                                                                                                                                                                                                                                                             | communication 259, 267                                                                                                                                                                                                 |                                     |
| overengineering 48                                                                                                                                                                                                                                                                                                                                                                                                      | contracts 264                                                                                                                                                                                                          |                                     |
| P                                                                                                                                                                                                                                                                                                                                                                                                                       | design 270 distributed 257                                                                                                                                                                                             |                                     |
| packages 192                                                                                                                                                                                                                                                                                                                                                                                                            | encapsulated 257                                                                                                                                                                                                       |                                     |
| partitioned architecture domain-partitioned 170–171                                                                                                                                                                                                                                                                                                                                                                     | implementing 256                                                                                                                                                                                                       |                                     |
| technically partitioned 170–171                                                                                                                                                                                                                                                                                                                                                                                         | sharing between 267                                                                                                                                                                                                    |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | portability 53                                                                                                                                                                                                         |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | Presentation layer 189, 193                                                                                                                                                                                            |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | priorities 64                                                                                                                                                                                                          |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | privacy 55                                                                                                                                                                                                             |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | process architectural characteristics 52                                                                                                                                                                               |                                     |
| the index                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                        |                                     |
| proof-of-concept code 429                                                                                                                                                                                                                                                                                                                                                                                               | Second Law of Software Architecture 96, 114                                                                                                                                                                            |                                     |
| Proposed status (ADRs) 100                                                                                                                                                                                                                                                                                                                                                                                              | security 53, 55                                                                                                                                                                                                        |                                     |
| Q                                                                                                                                                                                                                                                                                                                                                                                                                       | implicit characteristic 50                                                                                                                                                                                             |                                     |
| queues 86. See also messages; topics<br>infrastructure and 108<br>security and 90<br>trade-off analysis 88-91                                                                                                                                                                                                                                                                                                           | queues and 90                                                                                                                                                                                                          |                                     |
| R                                                                                                                                                                                                                                                                                                                                                                                                                       | service granularity, microservices versus EDA 379                                                                                                                                                                      |                                     |
| RDD (resume-driven development) 48                                                                                                                                                                                                                                                                                                                                                                                      | shared code, granularity and 314-317                                                                                                                                                                                   |                                     |
| recoverability 54                                                                                                                                                                                                                                                                                                                                                                                                       | shared libraries 322, 336, 343                                                                                                                                                                                         |                                     |
| choreography and 329                                                                                                                                                                                                                                                                                                                                                                                                    | code sharing 321                                                                                                                                                                                                       |                                     |
| reliability/safety 54                                                                                                                                                                                                                                                                                                                                                                                                   | shared services 322, 336, 343                                                                                                                                                                                          |                                     |
| request for comment (RFC) 100                                                                                                                                                                                                                                                                                                                                                                                           | code reuse 320                                                                                                                                                                                                         |                                     |
| request processing 380                                                                                                                                                                                                                                                                                                                                                                                                  | single-purpose 307                                                                                                                                                                                                     |                                     |
| requirements<br>documents 42, 278, 282, 304-305, 404<br>interpreting/translating 66<br>non-functional 43<br>versus solutions 62                                                                                                                                                                                                                                                                                         | smartphone as monolith 173                                                                                                                                                                                             |                                     |
| resume-driven development (RDD) 48                                                                                                                                                                                                                                                                                                                                                                                      | soft skills for architects 432-433                                                                                                                                                                                     |                                     |
| return on investment (ROI) 92                                                                                                                                                                                                                                                                                                                                                                                           | solutions versus requirements 62                                                                                                                                                                                       |                                     |
| RFC (request for comment) 100                                                                                                                                                                                                                                                                                                                                                                                           | source code repository 124-125                                                                                                                                                                                         |                                     |
| roadmap for planning 281                                                                                                                                                                                                                                                                                                                                                                                                | SQL (Structured Query Language) joins 233                                                                                                                                                                              |                                     |
| robustness 54, 56, 74                                                                                                                                                                                                                                                                                                                                                                                                   | stakeholders                                                                                                                                                                                                           |                                     |
| ROI (return on investment) 92                                                                                                                                                                                                                                                                                                                                                                                           | planning stages and 292                                                                                                                                                                                                |                                     |
| S                                                                                                                                                                                                                                                                                                                                                                                                                       | requirements documents 42                                                                                                                                                                                              |                                     |
| scalability 4, 6, 54, 56, 74                                                                                                                                                                                                                                                                                                                                                                                            | standardization, characteristics and 48                                                                                                                                                                                |                                     |
| choreography 329                                                                                                                                                                                                                                                                                                                                                                                                        | state management, choreography and 329                                                                                                                                                                                 |                                     |
| EDAs 384                                                                                                                                                                                                                                                                                                                                                                                                                | strategic decisions 19-21                                                                                                                                                                                              |                                     |
| layered architecture 205                                                                                                                                                                                                                                                                                                                                                                                                | structural architectural characteristics 53                                                                                                                                                                            |                                     |
| microservices and 313, 332                                                                                                                                                                                                                                                                                                                                                                                              | structural design                                                                                                                                                                                                      |                                     |
| orchestration and 327                                                                                                                                                                                                                                                                                                                                                                                                   | domain considerations 46                                                                                                                                                                                               |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | internal 50                                                                                                                                                                                                            |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | non-domain considerations 46                                                                                                                                                                                           |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | Superseded status (ADRs) 101                                                                                                                                                                                           |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | synchronous calls, EDAs 385                                                                                                                                                                                            |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | synchronous communication                                                                                                                                                                                              |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | architecture style selection and 412                                                                                                                                                                                   |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | versus asynchronous communication 362-366                                                                                                                                                                              |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | benefits 367                                                                                                                                                                                                           |                                     |
|                                                                                                                                                                                                                                                                                                                                                                                                                         | system functionality 11<br>system quality attributes 58                                                                                                                                                                |                                     |
| T                                                                                                                                                                                                                                                                                                                                                                                                                       | U                                                                                                                                                                                                                      |                                     |
| tactical decisions 19-21                                                                                                                                                                                                                                                                                                                                                                                                | UML (Unified Modeling Language) class diagram 1                                                                                                                                                                        |                                     |
| technical debt, coding architect and 429                                                                                                                                                                                                                                                                                                                                                                                | unknown unknowns 85                                                                                                                                                                                                    |                                     |
| technical depth of knowledge 437                                                                                                                                                                                                                                                                                                                                                                                        | usability 55                                                                                                                                                                                                           |                                     |
| technically-partitioned architecture 170–171, 180                                                                                                                                                                                                                                                                                                                                                                       | user interface. <i>See also</i> MVC (Model-View-Controller pattern                                                                                                                                                     |                                     |
| testability 4, 52                                                                                                                                                                                                                                                                                                                                                                                                       | diagramming 290                                                                                                                                                                                                        |                                     |
| EDAs 385                                                                                                                                                                                                                                                                                                                                                                                                                | field arrangement 22                                                                                                                                                                                                   |                                     |
| layered architecture 205                                                                                                                                                                                                                                                                                                                                                                                                | integration 282                                                                                                                                                                                                        |                                     |
| microservices architecture 332                                                                                                                                                                                                                                                                                                                                                                                          | microkernel architecture 262                                                                                                                                                                                           |                                     |
| modular monoliths 234                                                                                                                                                                                                                                                                                                                                                                                                   | public-facing 248                                                                                                                                                                                                      |                                     |
| three-tier architectures 199                                                                                                                                                                                                                                                                                                                                                                                            | requests and 191                                                                                                                                                                                                       |                                     |
| tightly coupled systems 150                                                                                                                                                                                                                                                                                                                                                                                             | scalability and 60                                                                                                                                                                                                     |                                     |
| topics 86. <i>See also</i> events; messages; queues                                                                                                                                                                                                                                                                                                                                                                     | UI layer 193                                                                                                                                                                                                           |                                     |
| trade-off analysis 89                                                                                                                                                                                                                                                                                                                                                                                                   | V                                                                                                                                                                                                                      |                                     |
| topologies                                                                                                                                                                                                                                                                                                                                                                                                              | version-control system 111                                                                                                                                                                                             |                                     |
| databases 389                                                                                                                                                                                                                                                                                                                                                                                                           | W                                                                                                                                                                                                                      |                                     |
| database-per-service 374–375                                                                                                                                                                                                                                                                                                                                                                                            | whiteboards 95, 104                                                                                                                                                                                                    |                                     |
| domain-partitioned 372–373                                                                                                                                                                                                                                                                                                                                                                                              | wikis 111                                                                                                                                                                                                              |                                     |
| monolithic 370–371                                                                                                                                                                                                                                                                                                                                                                                                      | workflow                                                                                                                                                                                                               |                                     |
| trade-off analysis<br>architectural decisions 114<br>ATAM (Architecture Tradeoff Analysis Method) 92<br>EDA (event-driven architecture) 385<br>First Law of Software Architecture 90<br>layered architecture 205<br>microkernel architecture 267<br>microservices architecture 333<br>modular monolithic architecture 235<br>queues 88–91<br>selections and 87<br>topics 89<br>translating/interpreting requirements 66 | amount 333<br>analysis 279<br>granularity and 314–317<br>management 324–325<br>orchestration and 327<br>workflow approach to logical architecture 132, 154<br>actor/action approach and 137<br>Workflow layer 189, 193 |                                     |

#### **the index**

#### **the index**

#### **the index**

two-tier architectures [199](#page-234-0)

# **Learn from experts. Become one yourself.**

Books | Live online courses Instant answers | Virtual events Videos | Interactive learning

Get started at oreilly.com.